var SocialCalc;SocialCalc||(SocialCalc={});
SocialCalc.Constants={textdatadefaulttype:"t",s_BrowserNotSupported:"Browser not supported.",s_InternalError:"Internal SocialCalc error (probably an internal bug): ",s_pssUnknownColType:"Unknown col type item",s_pssUnknownRowType:"Unknown row type item",s_pssUnknownLineType:"Unknown line type",s_cfspUnknownCellType:"Unknown cell type item",doCanonicalizeSheet:!0,s_escUnknownSheetCmd:"Unknown sheet command: ",s_escUnknownSetCoordCmd:"Unknown set coord command: ",s_escUnknownCmd:"Unknown command: ",
s_caccCircRef:"Circular reference to ",defaultRowNameWidth:"30",defaultAssumedRowHeight:15,defaultCellIDPrefix:"cell_",defaultCellLayout:"padding:2px 2px 1px 2px;vertical-align:top;",defaultCellFontStyle:"normal normal",defaultCellFontSize:"small",defaultCellFontFamily:"Verdana,Arial,Helvetica,sans-serif",defaultPaneDividerWidth:"2",defaultPaneDividerHeight:"3",defaultGridCSS:"1px solid #C0C0C0;",defaultCommentClass:"",defaultCommentStyle:"background-repeat:no-repeat;background-position:top right;background-image:url(images/sc-commentbg.gif);",
defaultCommentNoGridClass:"",defaultCommentNoGridStyle:"",defaultColWidth:"80",defaultMinimumColWidth:10,defaultHighlightTypeCursorClass:"",defaultHighlightTypeCursorStyle:"color:#FFF;backgroundColor:#A6A6A6;",defaultHighlightTypeRangeClass:"",defaultHighlightTypeRangeStyle:"color:#000;backgroundColor:#E5E5E5;",defaultColnameClass:"",defaultColnameStyle:"font-size:small;text-align:center;color:#FFFFFF;background-color:#808080;cursor:e-resize;",defaultSelectedColnameClass:"",defaultSelectedColnameStyle:"font-size:small;text-align:center;color:#FFFFFF;background-color:#404040;cursor:e-resize;",
defaultRownameClass:"",defaultRownameStyle:"font-size:small;text-align:right;color:#FFFFFF;background-color:#808080;",defaultSelectedRownameClass:"",defaultSelectedRownameStyle:"font-size:small;text-align:right;color:#FFFFFF;background-color:#404040;",defaultUpperLeftClass:"",defaultUpperLeftStyle:"font-size:small;",defaultSkippedCellClass:"",defaultSkippedCellStyle:"font-size:small;background-color:#CCC",defaultPaneDividerClass:"",defaultPaneDividerStyle:"font-size:small;background-color:#C0C0C0;padding:0px;",
s_rcMissingSheet:"Render Context must have a sheet object",defaultLinkFormatString:'<span style="font-size:smaller;text-decoration:none !important;background-color:#66B;color:#FFF;">Link</span>',defaultPageLinkFormatString:'<span style="font-size:smaller;text-decoration:none !important;background-color:#66B;color:#FFF;">Page</span>',defaultFormatdt:"d-mmm-yyyy h:mm:ss",defaultFormatd:"d-mmm-yyyy",defaultFormatt:"[h]:mm:ss",defaultDisplayTRUE:"TRUE",defaultDisplayFALSE:"FALSE",defaultImagePrefix:"images/sc-",
defaultTableEditorIDPrefix:"te_",defaultPageUpDnAmount:15,AllowCtrlS:!0,defaultTableControlThickness:20,cteGriddivClass:"",s_statusline_executing:"Executing...",s_statusline_displaying:"Displaying...",s_statusline_ordering:"Ordering...",s_statusline_calculating:"Calculating...",s_statusline_calculatingls:"Calculating... Loading Sheet...",s_statusline_doingserverfunc:"doing server function ",s_statusline_incell:" in cell ",s_statusline_calcstart:"Calculation start...",s_statusline_sum:"SUM",s_statusline_recalcneeded:'<span style="color:#999;">(Recalc needed)</span>',
s_statusline_circref:'<span style="color:red;">Circular reference: ',s_inputboxdisplaymultilinetext:"[Multi-line text: Click icon on right to edit]",defaultInputEchoClass:"",defaultInputEchoStyle:"filter:alpha(opacity=90);opacity:.9;backgroundColor:#FFD;border:1px solid #884;fontSize:small;padding:2px 10px 1px 2px;cursor:default;",defaultInputEchoPromptClass:"",defaultInputEchoPromptStyle:"filter:alpha(opacity=90);opacity:.9;backgroundColor:#FFD;borderLeft:1px solid #884;borderRight:1px solid #884;borderBottom:1px solid #884;fontSize:small;fontStyle:italic;padding:2px 10px 1px 2px;cursor:default;",
ietUnknownFunction:"Unknown function ",CH_radius1:29,CH_radius2:41,s_CHfillAllTooltip:"Fill Contents and Formats Down/Right",s_CHfillContentsTooltip:"Fill Contents Only Down/Right",s_CHmovePasteAllTooltip:"Move Contents and Formats",s_CHmovePasteContentsTooltip:"Move Contents Only",s_CHmoveInsertAllTooltip:"Slide Contents and Formats within Row/Col",s_CHmoveInsertContentsTooltip:"Slide Contents within Row/Col",s_CHindicatorOperationLookup:{Fill:"Fill",FillC:"Fill Contents",Move:"Move",MoveI:"Slide",
MoveC:"Move Contents",MoveIC:"Slide Contents"},s_CHindicatorDirectionLookup:{Down:" Down",Right:" Right",Horizontal:" Horizontal",Vertical:" Vertical"},defaultTCSliderThickness:9,defaultTCButtonThickness:20,defaultTCThumbThickness:15,TCmainStyle:"backgroundColor:#EEE;",TCmainClass:"",TCendcapStyle:"backgroundColor:#FFF;",TCendcapClass:"",TCpanesliderStyle:"backgroundColor:#CCC;",TCpanesliderClass:"",s_panesliderTooltiph:"Drag to lock pane vertically",s_panesliderTooltipv:"Drag to lock pane horizontally",
TClessbuttonStyle:"backgroundColor:#AAA;",TClessbuttonClass:"",TClessbuttonRepeatWait:300,TClessbuttonRepeatInterval:20,TCmorebuttonStyle:"backgroundColor:#AAA;",TCmorebuttonClass:"",TCmorebuttonRepeatWait:300,TCmorebuttonRepeatInterval:20,TCscrollareaStyle:"backgroundColor:#DDD;",TCscrollareaClass:"",TCscrollareaRepeatWait:500,TCscrollareaRepeatInterval:100,TCthumbClass:"",TCthumbStyle:"backgroundColor:#CCC;",TCPStrackinglineClass:"",TCPStrackinglineStyle:"overflow:hidden;position:absolute;zIndex:100;",
TCPStrackinglineThickness:"2px",TCTDFSthumbstatusvClass:"",TCTDFSthumbstatusvStyle:"height:20px;width:auto;border:3px solid #808080;overflow:hidden;backgroundColor:#FFF;fontSize:small;position:absolute;zIndex:100;",TCTDFSthumbstatushClass:"",TCTDFSthumbstatushStyle:"height:20px;width:auto;border:1px solid black;padding:2px;backgroundColor:#FFF;fontSize:small;position:absolute;zIndex:100;",TCTDFSthumbstatusrownumClass:"",TCTDFSthumbstatusrownumStyle:"color:#FFF;background-color:#808080;font-size:small;white-space:nowrap;padding:3px;",
TCTDFStopOffsetv:0,TCTDFSleftOffsetv:-80,s_TCTDFthumbstatusPrefixv:"Row ",TCTDFStopOffseth:-30,TCTDFSleftOffseth:0,s_TCTDFthumbstatusPrefixh:"Col ",TooltipOffsetX:2,TooltipOffsetY:10,TDpopupElementClass:"",TDpopupElementStyle:"border:1px solid black;padding:1px 2px 2px 2px;textAlign:center;backgroundColor:#FFF;fontSize:7pt;fontFamily:Verdana,Arial,Helvetica,sans-serif;position:absolute;width:auto;zIndex:110;",SCToolbarbackground:"background-color:#404040;",SCTabbackground:"background-color:#CCC;",
SCTabselectedCSS:"font-size:small;padding:6px 30px 6px 8px;color:#FFF;background-color:#404040;cursor:default;border-right:1px solid #CCC;",SCTabplainCSS:"font-size:small;padding:6px 30px 6px 8px;color:#FFF;background-color:#808080;cursor:default;border-right:1px solid #CCC;",SCToolbartext:"font-size:x-small;font-weight:bold;color:#FFF;padding-bottom:4px;",SCFormulabarheight:30,SCStatuslineheight:20,SCStatuslineCSS:"font-size:10px;padding:3px 0px;",SCFormatNumberFormats:"[cancel]:|[break]:|%loc!Default!:|[custom]:|%loc!Automatic!:general|%loc!Auto w/ commas!:[,]General|[break]:|00:00|000:000|0000:0000|00000:00000|[break]:|%loc!Formula!:formula|%loc!Hidden!:hidden|[newcol]:1234:0|1,234:#,##0|1,234.5:#,##0.0|1,234.56:#,##0.00|1,234.567:#,##0.000|1,234.5678:#,##0.0000|[break]:|1,234%:#,##0%|1,234.5%:#,##0.0%|1,234.56%:#,##0.00%|[newcol]:|$1,234:$#,##0|$1,234.5:$#,##0.0|$1,234.56:$#,##0.00|[break]:|(1,234):#,##0_);(#,##0)|(1,234.5):#,##0.0_);(#,##0.0)|(1,234.56):#,##0.00_);(#,##0.00)|[break]:|($1,234):#,##0_);($#,##0)|($1,234.5):$#,##0.0_);($#,##0.0)|($1,234.56):$#,##0.00_);($#,##0.00)|[newcol]:|1/4/06:m/d/yy|01/04/2006:mm/dd/yyyy|2006-01-04:yyyy-mm-dd|4-Jan-06:d-mmm-yy|04-Jan-2006:dd-mmm-yyyy|January 4, 2006:mmmm d, yyyy|[break]:|1\\c23:h:mm|1\\c23 PM:h:mm AM/PM|1\\c23\\c45:h:mm:ss|01\\c23\\c45:hh:mm:ss|26\\c23 (h\\cm):[hh]:mm|69\\c45 (m\\cs):[mm]:ss|69 (s):[ss]|[newcol]:|2006-01-04 01\\c23\\c45:yyyy-mm-dd hh:mm:ss|January 4, 2006:mmmm d, yyyy hh:mm:ss|Wed:ddd|Wednesday:dddd|",
SCFormatTextFormats:"[cancel]:|[break]:|%loc!Default!:|[custom]:|%loc!Automatic!:general|%loc!Plain Text!:text-plain|HTML:text-html|%loc!Wikitext!:text-wiki|%loc!Link!:text-link|%loc!Formula!:formula|%loc!Hidden!:hidden|",SCFormatPadsizes:"[cancel]:|[break]:|%loc!Default!:|[custom]:|%loc!No padding!:0px|[newcol]:|1 pixel:1px|2 pixels:2px|3 pixels:3px|4 pixels:4px|5 pixels:5px|6 pixels:6px|7 pixels:7px|8 pixels:8px|[newcol]:|9 pixels:9px|10 pixels:10px|11 pixels:11px|12 pixels:12px|13 pixels:13px|14 pixels:14px|16 pixels:16px|18 pixels:18px|[newcol]:|20 pixels:20px|22 pixels:22px|24 pixels:24px|28 pixels:28px|36 pixels:36px|",
SCFormatFontsizes:"[cancel]:|[break]:|%loc!Default!:|[custom]:|X-Small:x-small|Small:small|Medium:medium|Large:large|X-Large:x-large|[newcol]:|6pt:6pt|7pt:7pt|8pt:8pt|9pt:9pt|10pt:10pt|11pt:11pt|12pt:12pt|14pt:14pt|16pt:16pt|[newcol]:|18pt:18pt|20pt:20pt|22pt:22pt|24pt:24pt|28pt:28pt|36pt:36pt|48pt:48pt|72pt:72pt|[newcol]:|8 pixels:8px|9 pixels:9px|10 pixels:10px|11 pixels:11px|12 pixels:12px|13 pixels:13px|14 pixels:14px|[newcol]:|16 pixels:16px|18 pixels:18px|20 pixels:20px|22 pixels:22px|24 pixels:24px|28 pixels:28px|36 pixels:36px|",
SCFormatFontfamilies:"[cancel]:|[break]:|%loc!Default!:|[custom]:|Verdana:Verdana,Arial,Helvetica,sans-serif|Arial:arial,helvetica,sans-serif|Courier:'Courier New',Courier,monospace|",SCFormatFontlook:"[cancel]:|[break]:|%loc!Default!:|%loc!Normal!:normal normal|%loc!Bold!:normal bold|%loc!Italic!:italic normal|%loc!Bold Italic!:italic bold",SCFormatTextAlignhoriz:"[cancel]:|[break]:|%loc!Default!:|%loc!Left!:left|%loc!Center!:center|%loc!Right!:right|",SCFormatNumberAlignhoriz:"[cancel]:|[break]:|%loc!Default!:|%loc!Left!:left|%loc!Center!:center|%loc!Right!:right|",
SCFormatAlignVertical:"[cancel]:|[break]:|%loc!Default!:|%loc!Top!:top|%loc!Middle!:middle|%loc!Bottom!:bottom|",SCFormatColwidth:"[cancel]:|[break]:|%loc!Default!:|[custom]:|[newcol]:|20 pixels:20|40:40|60:60|80:80|100:100|120:120|140:140|160:160|[newcol]:|180 pixels:180|200:200|220:220|240:240|260:260|280:280|300:300|",SCFormatRecalc:"[cancel]:|[break]:|%loc!Auto!:|%loc!Manual!:off|",ISCButtonBorderNormal:"#404040",ISCButtonBorderHover:"#999",ISCButtonBorderDown:"#FFF",ISCButtonDownBackground:"#888",
s_PopupListCancel:"[Cancel]",s_PopupListCustom:"Custom",s_loc_align_center:"Align Center",s_loc_align_left:"Align Left",s_loc_align_right:"Align Right",s_loc_alignment:"Alignment",s_loc_audit:"Audit",s_loc_audit_trail_this_session:"Audit Trail This Session",s_loc_auto:"Auto",s_loc_auto_sum:"Auto Sum",s_loc_auto_wX_commas:"Auto w/ commas",s_loc_automatic:"Automatic",s_loc_background:"Background",s_loc_bold:"Bold",s_loc_bold_XampX_italics:"Bold &amp; Italics",s_loc_bold_italic:"Bold Italic",s_loc_borders:"Borders",
s_loc_borders_off:"Borders Off",s_loc_borders_on:"Borders On",s_loc_bottom:"Bottom",s_loc_bottom_border:"Bottom Border",s_loc_cell_settings:"CELL SETTINGS",s_loc_csv_format:"CSV format",s_loc_cancel:"Cancel",s_loc_category:"Category",s_loc_center:"Center",s_loc_clear:"Clear",s_loc_clear_socialcalc_clipboard:"Clear SocialCalc Clipboard",s_loc_clipboard:"Clipboard",s_loc_color:"Color",s_loc_column_:"Column ",s_loc_comment:"Comment",s_loc_copy:"Copy",s_loc_custom:"Custom",s_loc_cut:"Cut",s_loc_default:"Default",
s_loc_default_alignment:"Default Alignment",s_loc_default_column_width:"Default Column Width",s_loc_default_font:"Default Font",s_loc_default_format:"Default Format",s_loc_default_padding:"Default Padding",s_loc_delete:"Delete",s_loc_delete_column:"Delete Column",s_loc_delete_contents:"Delete Contents",s_loc_delete_row:"Delete Row",s_loc_description:"Description",s_loc_display_clipboard_in:"Display Clipboard in",s_loc_down:"Down",s_loc_edit:"Edit",s_loc_existing_names:"Existing Names",s_loc_family:"Family",
s_loc_fill_down:"Fill Down",s_loc_fill_right:"Fill Right",s_loc_font:"Font",s_loc_format:"Format",s_loc_formula:"Formula",s_loc_function_list:"Function List",s_loc_functions:"Functions",s_loc_grid:"Grid",s_loc_hidden:"Hidden",s_loc_horizontal:"Horizontal",s_loc_insert_column:"Insert Column",s_loc_insert_row:"Insert Row",s_loc_italic:"Italic",s_loc_last_sort:"Last Sort",s_loc_left:"Left",s_loc_left_border:"Left Border",s_loc_link:"Link",s_loc_link_input_box:"Link Input Box",s_loc_list:"List",s_loc_load_socialcalc_clipboard_with_this:"Load SocialCalc Clipboard With This",
s_loc_major_sort:"Major Sort",s_loc_manual:"Manual",s_loc_merge_cells:"Merge Cells",s_loc_middle:"Middle",s_loc_minor_sort:"Minor Sort",s_loc_move_insert:"Move Insert",s_loc_move_paste:"Move Paste",s_loc_multiXline_input_box:"Multi-line Input Box",s_loc_name:"Name",s_loc_names:"Names",s_loc_no_padding:"No padding",s_loc_normal:"Normal",s_loc_number:"Number",s_loc_number_horizontal:"Number Horizontal",s_loc_ok:"OK",s_loc_padding:"Padding",s_loc_page_name:"Page Name",s_loc_paste:"Paste",s_loc_paste_formats:"Paste Formats",
s_loc_plain_text:"Plain Text",s_loc_recalc:"Recalc",s_loc_recalculation:"Recalculation",s_loc_redo:"Redo",s_loc_right:"Right",s_loc_right_border:"Right Border",s_loc_sheet_settings:"SHEET SETTINGS",s_loc_save:"Save",s_loc_save_to:"Save to",s_loc_set_cell_contents:"Set Cell Contents",s_loc_set_cells_to_sort:"Set Cells To Sort",s_loc_set_value_to:"Set Value To",s_loc_set_to_link_format:"Set to Link format",s_loc_setXclear_move_from:"Set/Clear Move From",s_loc_show_cell_settings:"Show Cell Settings",
s_loc_show_sheet_settings:"Show Sheet Settings",s_loc_show_in_new_browser_window:"Show in new browser window",s_loc_size:"Size",s_loc_socialcalcXsave_format:"SocialCalc-save format",s_loc_sort:"Sort",s_loc_sort_:"Sort ",s_loc_sort_cells:"Sort Cells",s_loc_swap_colors:"Swap Colors",s_loc_tabXdelimited_format:"Tab-delimited format",s_loc_text:"Text",s_loc_text_horizontal:"Text Horizontal",s_loc_this_is_aXbrXsample:"This is a<br>sample",s_loc_top:"Top",s_loc_top_border:"Top Border",s_loc_undone_steps:"UNDONE STEPS",
s_loc_url:"URL",s_loc_undo:"Undo",s_loc_unmerge_cells:"Unmerge Cells",s_loc_up:"Up",s_loc_value:"Value",s_loc_vertical:"Vertical",s_loc_wikitext:"Wikitext",s_loc_workspace:"Workspace",s_loc_XnewX:"[New]",s_loc_XnoneX:"[None]",s_loc_Xselect_rangeX:"[select range]",SVStatuslineheight:20,SVStatuslineCSS:"font-size:10px;padding:3px 0px;",FormatNumber_separatorchar:",",FormatNumber_decimalchar:".",FormatNumber_defaultCurrency:"$",s_FormatNumber_daynames:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),
s_FormatNumber_daynames3:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),s_FormatNumber_monthnames:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),s_FormatNumber_monthnames3:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),s_FormatNumber_am:"AM",s_FormatNumber_am1:"A",s_FormatNumber_pm:"PM",s_FormatNumber_pm1:"P",s_parseerrexponent:"Improperly formed number exponent",s_parseerrchar:"Unexpected character in formula",s_parseerrstring:"Improperly formed string",
s_parseerrspecialvalue:"Improperly formed special value",s_parseerrtwoops:"Error in formula (two operators inappropriately in a row)",s_parseerrmissingopenparen:"Missing open parenthesis in list with comma(s). ",s_parseerrcloseparennoopen:"Closing parenthesis without open parenthesis. ",s_parseerrmissingcloseparen:"Missing close parenthesis. ",s_parseerrmissingoperand:"Missing operand. ",s_parseerrerrorinformula:"Error in formula.",s_calcerrerrorvalueinformula:"Error value in formula",s_parseerrerrorinformulabadval:"Error in formula resulting in bad value",
s_formularangeresult:"Formula results in range value:",s_calcerrnumericnan:"Formula results in an bad numeric value",s_calcerrnumericoverflow:"Numeric overflow",s_sheetunavailable:"Sheet unavailable:",s_calcerrcellrefmissing:"Cell reference missing when expected.",s_calcerrsheetnamemissing:"Sheet name missing when expected.",s_circularnameref:"Circular name reference to name",s_calcerrunknownname:"Unknown name",s_calcerrincorrectargstofunction:"Incorrect arguments to function",s_sheetfuncunknownfunction:"Unknown function",
s_sheetfunclnarg:"LN argument must be greater than 0",s_sheetfunclog10arg:"LOG10 argument must be greater than 0",s_sheetfunclogsecondarg:"LOG second argument must be numeric greater than 0",s_sheetfunclogfirstarg:"LOG first argument must be greater than 0",s_sheetfuncroundsecondarg:"ROUND second argument must be numeric",s_sheetfuncddblife:"DDB life must be greater than 1",s_sheetfuncslnlife:"SLN life must be greater than 1",s_fdef_ABS:"Absolute value function. ",s_fdef_ACOS:"Trigonometric arccosine function. ",
s_fdef_AND:"True if all arguments are true. ",s_fdef_ASIN:"Trigonometric arcsine function. ",s_fdef_ATAN:"Trigonometric arctan function. ",s_fdef_ATAN2:"Trigonometric arc tangent function (result is in radians). ",s_fdef_AVERAGE:"Averages the values. ",s_fdef_CHOOSE:"Returns the value specified by the index. The values may be ranges of cells. ",s_fdef_COLUMNS:"Returns the number of columns in the range. ",s_fdef_COS:"Trigonometric cosine function (value is in radians). ",s_fdef_COUNT:"Counts the number of numeric values, not blank, text, or error. ",
s_fdef_COUNTA:"Counts the number of non-blank values. ",s_fdef_COUNTBLANK:'Counts the number of blank values. (Note: "" is not blank.) ',s_fdef_COUNTIF:'Counts the number of number of cells in the range that meet the criteria. The criteria may be a value ("x", 15, 1+3) or a test (>25). ',s_fdef_DATE:'Returns the appropriate date value given numbers for year, month, and day. For example: DATE(2006,2,1) for February 1, 2006. Note: In this program, day "1" is December 31, 1899 and the year 1900 is not a leap year. Some programs use January 1, 1900, as day "1" and treat 1900 as a leap year. In both cases, though, dates on or after March 1, 1900, are the same. ',
s_fdef_DAVERAGE:"Averages the values in the specified field in records that meet the criteria. ",s_fdef_DAY:"Returns the day of month for a date value. ",s_fdef_DCOUNT:"Counts the number of numeric values, not blank, text, or error, in the specified field in records that meet the criteria. ",s_fdef_DCOUNTA:"Counts the number of non-blank values in the specified field in records that meet the criteria. ",s_fdef_DDB:"Returns the amount of depreciation at the given period of time (the default factor is 2 for double-declining balance).   ",
s_fdef_DEGREES:"Converts value in radians into degrees. ",s_fdef_DGET:"Returns the value of the specified field in the single record that meets the criteria. ",s_fdef_DMAX:"Returns the maximum of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DMIN:"Returns the maximum of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DPRODUCT:"Returns the result of multiplying the numeric values in the specified field in records that meet the criteria. ",
s_fdef_DSTDEV:"Returns the sample standard deviation of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DSTDEVP:"Returns the standard deviation of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DSUM:"Returns the sum of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DVAR:"Returns the sample variance of the numeric values in the specified field in records that meet the criteria. ",s_fdef_DVARP:"Returns the variance of the numeric values in the specified field in records that meet the criteria. ",
s_fdef_EVEN:"Rounds the value up in magnitude to the nearest even integer. ",s_fdef_EXACT:'Returns "true" if the values are exactly the same, including case, type, etc. ',s_fdef_EXP:"Returns e raised to the value power. ",s_fdef_FACT:"Returns factorial of the value. ",s_fdef_FALSE:'Returns the logical value "false". ',s_fdef_FIND:'Returns the starting position within string2 of the first occurrence of string1 at or after "start". If start is omitted, 1 is assumed. ',s_fdef_FV:"Returns the future value of repeated payments of money invested at the given rate for the specified number of periods, with optional present value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). ",
s_fdef_HLOOKUP:"Look for the matching value for the given value in the range and return the corresponding value in the cell specified by the row offset. If rangelookup is 1 (the default) and not 0, match if within numeric brackets (match<=value) instead of exact match. ",s_fdef_HOUR:"Returns the hour portion of a time or date/time value. ",s_fdef_IF:"Results in true-value if logical-expression is TRUE or non-zero, otherwise results in false-value. ",s_fdef_INDEX:"Returns a cell or range reference for the specified row and column in the range. If range is 1-dimensional, then only one of rownum or colnum are needed. If range is 2-dimensional and rownum or colnum are zero, a reference to the range of just the specified column or row is returned. You can use the returned reference value in a range, e.g., sum(A1:INDEX(A2:A10,4)). ",
s_fdef_INT:"Returns the value rounded down to the nearest integer (towards -infinity). ",s_fdef_IRR:"Returns the interest rate at which the cash flows in the range have a net present value of zero. Uses an iterative process that will return #NUM! error if it does not converge. There may be more than one possible solution. Providing the optional guess value may help in certain situations where it does not converge or finds an inappropriate solution (the default guess is 10%). ",s_fdef_ISBLANK:'Returns "true" if the value is a reference to a blank cell. ',
s_fdef_ISERR:'Returns "true" if the value is of type "Error" but not "NA". ',s_fdef_ISERROR:'Returns "true" if the value is of type "Error". ',s_fdef_ISLOGICAL:'Returns "true" if the value is of type "Logical" (true/false). ',s_fdef_ISNA:'Returns "true" if the value is the error type "NA". ',s_fdef_ISNONTEXT:'Returns "true" if the value is not of type "Text". ',s_fdef_ISNUMBER:'Returns "true" if the value is of type "Number" (including logical values). ',s_fdef_ISTEXT:'Returns "true" if the value is of type "Text". ',
s_fdef_LEFT:"Returns the specified number of characters from the text value. If count is omitted, 1 is assumed. ",s_fdef_LEN:"Returns the number of characters in the text value. ",s_fdef_LN:"Returns the natural logarithm of the value. ",s_fdef_LOG:"Returns the logarithm of the value using the specified base. ",s_fdef_LOG10:"Returns the base 10 logarithm of the value. ",s_fdef_LOWER:"Returns the text value with all uppercase characters converted to lowercase. ",s_fdef_MATCH:"Look for the matching value for the given value in the range and return position (the first is 1) in that range. If rangelookup is 1 (the default) and not 0, match if within numeric brackets (match<=value) instead of exact match. If rangelookup is -1, act like 1 but the bracket is match>=value. ",
s_fdef_MAX:"Returns the maximum of the numeric values. ",s_fdef_MID:"Returns the specified number of characters from the text value starting from the specified position. ",s_fdef_MIN:"Returns the minimum of the numeric values. ",s_fdef_MINUTE:"Returns the minute portion of a time or date/time value. ",s_fdef_MOD:"Returns the remainder of the first value divided by the second. ",s_fdef_MONTH:"Returns the month part of a date value. ",s_fdef_N:"Returns the value if it is a numeric value otherwise an error. ",
s_fdef_NA:"Returns the #N/A error value which propagates through most operations. ",s_fdef_NOT:"Returns FALSE if value is true, and TRUE if it is false. ",s_fdef_NOW:"Returns the current date/time. ",s_fdef_NPER:"Returns the number of periods at which payments invested each period at the given rate with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period) has the given present value. ",s_fdef_NPV:"Returns the net present value of cash flows (which may be individual values and/or ranges) at the given rate. The flows are positive if income, negative if paid out, and are assumed at the end of each period. ",
s_fdef_ODD:"Rounds the value up in magnitude to the nearest odd integer. ",s_fdef_OR:"True if any argument is true ",s_fdef_PI:"The value 3.1415926... ",s_fdef_PMT:"Returns the amount of each payment that must be invested at the given rate for the specified number of periods to have the specified present value, with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). ",s_fdef_POWER:"Returns the first value raised to the second value power. ",
s_fdef_PRODUCT:"Returns the result of multiplying the numeric values. ",s_fdef_PROPER:"Returns the text value with the first letter of each word converted to uppercase and the others to lowercase. ",s_fdef_PV:"Returns the present value of the given number of payments each invested at the given rate, with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). ",s_fdef_RADIANS:"Converts value in degrees into radians. ",s_fdef_RATE:"Returns the rate at which the given number of payments each invested at the given rate has the specified present value, with optional future value (default 0) and payment type (default 0 = at end of period, 1 = beginning of period). Uses an iterative process that will return #NUM! error if it does not converge. There may be more than one possible solution. Providing the optional guess value may help in certain situations where it does not converge or finds an inappropriate solution (the default guess is 10%). ",
s_fdef_REPLACE:"Returns text1 with the specified number of characters starting from the specified position replaced by text2. ",s_fdef_REPT:"Returns the text repeated the specified number of times. ",s_fdef_RIGHT:"Returns the specified number of characters from the text value starting from the end. If count is omitted, 1 is assumed. ",s_fdef_ROUND:"Rounds the value to the specified number of decimal places. If precision is negative, then round to powers of 10. The default precision is 0 (round to integer). ",
s_fdef_ROWS:"Returns the number of rows in the range. ",s_fdef_SECOND:"Returns the second portion of a time or date/time value (truncated to an integer). ",s_fdef_SIN:"Trigonometric sine function (value is in radians) ",s_fdef_SLN:"Returns the amount of depreciation at each period of time using the straight-line method. ",s_fdef_SQRT:"Square root of the value ",s_fdef_STDEV:"Returns the sample standard deviation of the numeric values. ",s_fdef_STDEVP:"Returns the standard deviation of the numeric values. ",
s_fdef_SUBSTITUTE:'Returns text1 with the all occurrences of oldtext replaced by newtext. If "occurrence" is present, then only that occurrence is replaced. ',s_fdef_SUM:"Adds the numeric values. The values to the sum function may be ranges in the form similar to A1:B5. ",s_fdef_SUMIF:'Sums the numeric values of cells in the range that meet the criteria. The criteria may be a value ("x", 15, 1+3) or a test (>25). If range2 is present, then range1 is tested and the corresponding range2 value is summed. ',
s_fdef_SYD:"Depreciation by Sum of Year's Digits method. ",s_fdef_T:"Returns the text value or else a null string. ",s_fdef_TAN:"Trigonometric tangent function (value is in radians) ",s_fdef_TIME:"Returns the time value given the specified hour, minute, and second. ",s_fdef_TODAY:'Returns the current date (an integer). Note: In this program, day "1" is December 31, 1899 and the year 1900 is not a leap year. Some programs use January 1, 1900, as day "1" and treat 1900 as a leap year. In both cases, though, dates on or after March 1, 1900, are the same. ',
s_fdef_TRIM:"Returns the text value with leading, trailing, and repeated spaces removed. ",s_fdef_TRUE:'Returns the logical value "true". ',s_fdef_TRUNC:"Truncates the value to the specified number of decimal places. If precision is negative, truncate to powers of 10. ",s_fdef_UPPER:"Returns the text value with all lowercase characters converted to uppercase. ",s_fdef_VALUE:"Converts the specified text value into a numeric value. Various forms that look like numbers (including digits followed by %, forms that look like dates, etc.) are handled. This may not handle all of the forms accepted by other spreadsheets and may be locale dependent. ",
s_fdef_VAR:"Returns the sample variance of the numeric values. ",s_fdef_VARP:"Returns the variance of the numeric values. ",s_fdef_VLOOKUP:"Look for the matching value for the given value in the range and return the corresponding value in the cell specified by the column offset. If rangelookup is 1 (the default) and not 0, match if within numeric brackets (match>=value) instead of exact match. ",s_fdef_WEEKDAY:"Returns the day of week specified by the date value. If type is 1 (the default), Sunday is day and Saturday is day 7. If type is 2, Monday is day 1 and Sunday is day 7. If type is 3, Monday is day 0 and Sunday is day 6. ",
s_fdef_YEAR:"Returns the year part of a date value. ",s_farg_v:"value",s_farg_vn:"value1, value2, ...",s_farg_xy:"valueX, valueY",s_farg_choose:"index, value1, value2, ...",s_farg_range:"range",s_farg_rangec:"range, criteria",s_farg_date:"year, month, day",s_farg_dfunc:"databaserange, fieldname, criteriarange",s_farg_ddb:"cost, salvage, lifetime, period [, factor]",s_farg_find:"string1, string2 [, start]",s_farg_fv:"rate, n, payment, [pv, [paytype]]",s_farg_hlookup:"value, range, row, [rangelookup]",
s_farg_iffunc:"logical-expression, true-value, false-value",s_farg_index:"range, rownum, colnum",s_farg_irr:"range, [guess]",s_farg_tc:"text, count",s_farg_log:"value, base",s_farg_match:"value, range, [rangelookup]",s_farg_mid:"text, start, length",s_farg_nper:"rate, payment, pv, [fv, [paytype]]",s_farg_npv:"rate, value1, value2, ...",s_farg_pmt:"rate, n, pv, [fv, [paytype]]",s_farg_pv:"rate, n, payment, [fv, [paytype]]",s_farg_rate:"n, payment, pv, [fv, [paytype, [guess]]]",s_farg_replace:"text1, start, length, text2",
s_farg_vp:"value, [precision]",s_farg_valpre:"value, precision",s_farg_csl:"cost, salvage, lifetime",s_farg_cslp:"cost, salvage, lifetime, period",s_farg_subs:"text1, oldtext, newtext [, occurrence]",s_farg_sumif:"range1, criteria [, range2]",s_farg_hms:"hour, minute, second",s_farg_txt:"text",s_farg_vlookup:"value, range, col, [rangelookup]",s_farg_weekday:"date, [type]",s_farg_dt:"date",function_classlist:"all,stat,lookup,datetime,financial,test,math,text".split(","),s_fclass_all:"All",s_fclass_stat:"Statistics",
s_fclass_lookup:"Lookup",s_fclass_datetime:"Date & Time",s_fclass_financial:"Financial",s_fclass_test:"Test",s_fclass_math:"Math",s_fclass_text:"Text",lastone:null};
SocialCalc.ConstantsDefaultClasses={defaultComment:"",defaultCommentNoGrid:"",defaultHighlightTypeCursor:"",defaultHighlightTypeRange:"",defaultColname:"",defaultSelectedColname:"",defaultRowname:"",defaultSelectedRowname:"",defaultUpperLeft:"",defaultSkippedCell:"",defaultPaneDivider:"",cteGriddiv:"",defaultInputEcho:{classname:"",style:"filter:alpha(opacity=90);opacity:.9;"},TCmain:"",TCendcap:"",TCpaneslider:"",TClessbutton:"",TCmorebutton:"",TCscrollarea:"",TCthumb:"",TCPStrackingline:"",TCTDFSthumbstatus:"",
TDpopupElement:""};SocialCalc.ConstantsSetClasses=function(a){var b=SocialCalc.ConstantsDefaultClasses,c=SocialCalc.Constants,d,a=a||"";for(d in b)"string"==typeof b[d]?(c[d+"Class"]=a+(b[d]||d),void 0!==c[d+"Style"]&&(c[d+"Style"]="")):"object"==typeof b[d]&&(c[d+"Class"]=a+(b[d].classname||d),c[d+"Style"]=b[d].style)};SocialCalc||(SocialCalc={});SocialCalc.Callbacks={expand_wiki:null,expand_markup:function(a,b,c){return SocialCalc.default_expand_markup(a,b,c)},MakePageLink:null,NormalizeSheetName:null};SocialCalc.Cell=function(a){this.coord=a;this.datavalue="";this.datatype=null;this.formula="";this.valuetype="b"};
SocialCalc.CellProperties={coord:1,datavalue:1,datatype:1,formula:1,valuetype:1,errors:1,comment:1,bt:2,br:2,bb:2,bl:2,layout:2,font:2,color:2,bgcolor:2,cellformat:2,nontextvalueformat:2,textvalueformat:2,colspan:2,rowspan:2,cssc:2,csss:2,mod:2,displaystring:3,parseinfo:3,hcolspan:3,hrowspan:3};
SocialCalc.CellPropertiesTable={bt:"borderstyle",br:"borderstyle",bb:"borderstyle",bl:"borderstyle",layout:"layout",font:"font",color:"color",bgcolor:"color",cellformat:"cellformat",nontextvalueformat:"valueformat",textvalueformat:"valueformat"};SocialCalc.Sheet=function(){SocialCalc.ResetSheet(this);this.statuscallbackparams=this.statuscallback=null};
SocialCalc.ResetSheet=function(a){a.cells={};a.attribs={lastcol:1,lastrow:1,defaultlayout:0};a.rowattribs={hide:{},height:{}};a.colattribs={width:{},hide:{}};a.names={};a.layouts=[];a.layouthash={};a.fonts=[];a.fonthash={};a.colors=[];a.colorhash={};a.borderstyles=[];a.borderstylehash={};a.cellformats=[];a.cellformathash={};a.valueformats=[];a.valueformathash={};a.copiedfrom="";a.changes=new SocialCalc.UndoStack;a.renderneeded=!1;a.changedrendervalues=!0;a.recalcchangedavalue=!1};
SocialCalc.Sheet.prototype.ResetSheet=function(){SocialCalc.ResetSheet(this)};SocialCalc.Sheet.prototype.AddCell=function(a){return this.cells[a.coord]=a};SocialCalc.Sheet.prototype.GetAssuredCell=function(a){return this.cells[a]||this.AddCell(new SocialCalc.Cell(a))};SocialCalc.Sheet.prototype.ParseSheetSave=function(a){SocialCalc.ParseSheetSave(a,this)};SocialCalc.Sheet.prototype.CellFromStringParts=function(a,b,c){return SocialCalc.CellFromStringParts(this,a,b,c)};
SocialCalc.Sheet.prototype.CreateSheetSave=function(a,b){return SocialCalc.CreateSheetSave(this,a,b)};SocialCalc.Sheet.prototype.CellToString=function(a){return SocialCalc.CellToString(this,a)};SocialCalc.Sheet.prototype.CanonicalizeSheet=function(a){return SocialCalc.CanonicalizeSheet(this,a)};SocialCalc.Sheet.prototype.EncodeCellAttributes=function(a){return SocialCalc.EncodeCellAttributes(this,a)};SocialCalc.Sheet.prototype.EncodeSheetAttributes=function(){return SocialCalc.EncodeSheetAttributes(this)};
SocialCalc.Sheet.prototype.DecodeCellAttributes=function(a,b,c){return SocialCalc.DecodeCellAttributes(this,a,b,c)};SocialCalc.Sheet.prototype.DecodeSheetAttributes=function(a){return SocialCalc.DecodeSheetAttributes(this,a)};SocialCalc.Sheet.prototype.ScheduleSheetCommands=function(a,b,c){return SocialCalc.ScheduleSheetCommands(this,a,b,c)};SocialCalc.Sheet.prototype.SheetUndo=function(){return SocialCalc.SheetUndo(this)};SocialCalc.Sheet.prototype.SheetRedo=function(){return SocialCalc.SheetRedo(this)};
SocialCalc.Sheet.prototype.CreateAuditString=function(){return SocialCalc.CreateAuditString(this)};SocialCalc.Sheet.prototype.GetStyleNum=function(a,b){return SocialCalc.GetStyleNum(this,a,b)};SocialCalc.Sheet.prototype.GetStyleString=function(a,b){return SocialCalc.GetStyleString(this,a,b)};SocialCalc.Sheet.prototype.RecalcSheet=function(){return SocialCalc.RecalcSheet(this)};
SocialCalc.ParseSheetSave=function(a,b){var c=a.split(/\r\n|\n/),d=[],e,g,h,j,k=SocialCalc.Constants;for(e=0;e<c.length;e++)switch(d=c[e],d=d.split(":"),d[0]){case "cell":h=b.GetAssuredCell(d[1]);g=2;b.CellFromStringParts(h,d,g);break;case "col":j=d[1];for(g=2;h=d[g++];)switch(h){case "w":b.colattribs.width[j]=d[g++];break;case "hide":b.colattribs.hide[j]=d[g++];break;default:throw k.s_pssUnknownColType+" '"+h+"'";}break;case "row":j=d[1]-0;for(g=2;h=d[g++];)switch(h){case "h":b.rowattribs.height[j]=
d[g++]-0;break;case "hide":b.rowattribs.hide[j]=d[g++];break;default:throw k.s_pssUnknownRowType+" '"+h+"'";}break;case "sheet":j=b.attribs;for(g=1;h=d[g++];)switch(h){case "c":j.lastcol=d[g++]-0;break;case "r":j.lastrow=d[g++]-0;break;case "w":j.defaultcolwidth=d[g++]+"";break;case "h":j.defaultrowheight=d[g++]-0;break;case "tf":j.defaulttextformat=d[g++]-0;break;case "ntf":j.defaultnontextformat=d[g++]-0;break;case "layout":j.defaultlayout=d[g++]-0;break;case "font":j.defaultfont=d[g++]-0;break;
case "tvf":j.defaulttextvalueformat=d[g++]-0;break;case "ntvf":j.defaultnontextvalueformat=d[g++]-0;break;case "color":j.defaultcolor=d[g++]-0;break;case "bgcolor":j.defaultbgcolor=d[g++]-0;break;case "circularreferencecell":j.circularreferencecell=d[g++];break;case "recalc":j.recalc=d[g++];break;case "needsrecalc":j.needsrecalc=d[g++];break;default:g+=1}break;case "name":g=SocialCalc.decodeFromSave(d[1]).toUpperCase();b.names[g]={desc:SocialCalc.decodeFromSave(d[2])};b.names[g].definition=SocialCalc.decodeFromSave(d[3]);
break;case "layout":d=c[e].match(/^layout\:(\d+)\:(.+)$/);b.layouts[d[1]-0]=d[2];b.layouthash[d[2]]=d[1]-0;break;case "font":b.fonts[d[1]-0]=d[2];b.fonthash[d[2]]=d[1]-0;break;case "color":b.colors[d[1]-0]=d[2];b.colorhash[d[2]]=d[1]-0;break;case "border":b.borderstyles[d[1]-0]=d[2];b.borderstylehash[d[2]]=d[1]-0;break;case "cellformat":g=SocialCalc.decodeFromSave(d[2]);b.cellformats[d[1]-0]=g;b.cellformathash[g]=d[1]-0;break;case "valueformat":g=SocialCalc.decodeFromSave(d[2]);b.valueformats[d[1]-
0]=g;b.valueformathash[g]=d[1]-0;break;case "version":break;case "copiedfrom":b.copiedfrom=d[1]+":"+d[2];break;case "clipboardrange":case "clipboard":break;case "":break;default:throw alert(k.s_pssUnknownLineType+" '"+d[0]+"'"),k.s_pssUnknownLineType+" '"+d[0]+"'";}};
SocialCalc.CellFromStringParts=function(a,b,c,d){for(;a=c[d++];)switch(a){case "v":b.datavalue=SocialCalc.decodeFromSave(c[d++])-0;b.datatype="v";b.valuetype="n";break;case "t":b.datavalue=SocialCalc.decodeFromSave(c[d++]);b.datatype="t";b.valuetype=SocialCalc.Constants.textdatadefaulttype;break;case "vt":a=c[d++];b.valuetype=a;"n"==a.charAt(0)?(b.datatype="v",b.datavalue=SocialCalc.decodeFromSave(c[d++])-0):(b.datatype="t",b.datavalue=SocialCalc.decodeFromSave(c[d++]));break;case "vtf":a=c[d++];
b.valuetype=a;b.datavalue="n"==a.charAt(0)?SocialCalc.decodeFromSave(c[d++])-0:SocialCalc.decodeFromSave(c[d++]);b.formula=SocialCalc.decodeFromSave(c[d++]);b.datatype="f";break;case "vtc":a=c[d++];b.valuetype=a;b.datavalue="n"==a.charAt(0)?SocialCalc.decodeFromSave(c[d++])-0:SocialCalc.decodeFromSave(c[d++]);b.formula=SocialCalc.decodeFromSave(c[d++]);b.datatype="c";break;case "e":b.errors=SocialCalc.decodeFromSave(c[d++]);break;case "b":b.bt=c[d++]-0;b.br=c[d++]-0;b.bb=c[d++]-0;b.bl=c[d++]-0;break;
case "l":b.layout=c[d++]-0;break;case "f":b.font=c[d++]-0;break;case "c":b.color=c[d++]-0;break;case "bg":b.bgcolor=c[d++]-0;break;case "cf":b.cellformat=c[d++]-0;break;case "ntvf":b.nontextvalueformat=c[d++]-0;break;case "tvf":b.textvalueformat=c[d++]-0;break;case "colspan":b.colspan=c[d++]-0;break;case "rowspan":b.rowspan=c[d++]-0;break;case "cssc":b.cssc=c[d++];break;case "csss":b.csss=SocialCalc.decodeFromSave(c[d++]);break;case "mod":d+=1;break;case "comment":b.comment=SocialCalc.decodeFromSave(c[d++]);
break;default:throw SocialCalc.Constants.s_cfspUnknownCellType+" '"+a+"'";}};SocialCalc.sheetfields=["defaultrowheight","defaultcolwidth","circularreferencecell","recalc","needsrecalc"];SocialCalc.sheetfieldsshort=["h","w","circularreferencecell","recalc","needsrecalc"];SocialCalc.sheetfieldsxlat="defaulttextformat,defaultnontextformat,defaulttextvalueformat,defaultnontextvalueformat,defaultcolor,defaultbgcolor,defaultfont,defaultlayout".split(",");SocialCalc.sheetfieldsxlatshort="tf,ntf,tvf,ntvf,color,bgcolor,font,layout".split(",");
SocialCalc.sheetfieldsxlatxlt="cellformat,cellformat,valueformat,valueformat,color,color,font,layout".split(",");
SocialCalc.CreateSheetSave=function(a,b,c){var d,e,g,h,j,k=[];a.CanonicalizeSheet(c||SocialCalc.Constants.doCanonicalizeSheet);var l=a.xlt;e=b?SocialCalc.ParseRange(b):{cr1:{row:1,col:1},cr2:{row:l.maxrow,col:l.maxcol}};c=e.cr1;e=e.cr2;k.push("version:1.5");for(g=c.row;g<=e.row;g++)for(h=c.col;h<=e.col;h++)if(j=SocialCalc.crToCoord(h,g),d=a.cells[j])d=a.CellToString(d),0!=d.length&&(d="cell:"+j+d,k.push(d));for(h=1;h<=l.maxcol;h++)j=SocialCalc.rcColname(h),a.colattribs.width[j]&&k.push("col:"+j+":w:"+
a.colattribs.width[j]),a.colattribs.hide[j]&&k.push("col:"+j+":hide:"+a.colattribs.hide[j]);for(g=1;g<=l.maxrow;g++)a.rowattribs.height[g]&&k.push("row:"+g+":h:"+a.rowattribs.height[g]),a.rowattribs.hide[g]&&k.push("row:"+g+":hide:"+a.rowattribs.hide[g]);d="sheet:c:"+l.maxcol+":r:"+l.maxrow;for(g=0;g<SocialCalc.sheetfields.length;g++)(h=SocialCalc.encodeForSave(a.attribs[SocialCalc.sheetfields[g]]))&&(d+=":"+SocialCalc.sheetfieldsshort[g]+":"+h);for(g=0;g<SocialCalc.sheetfieldsxlat.length;g++)(h=
a.attribs[SocialCalc.sheetfieldsxlat[g]])&&(d+=":"+SocialCalc.sheetfieldsxlatshort[g]+":"+l[SocialCalc.sheetfieldsxlatxlt[g]+"sxlat"][h]);k.push(d);for(g=1;g<l.newborderstyles.length;g++)k.push("border:"+g+":"+l.newborderstyles[g]);for(g=1;g<l.newcellformats.length;g++)k.push("cellformat:"+g+":"+SocialCalc.encodeForSave(l.newcellformats[g]));for(g=1;g<l.newcolors.length;g++)k.push("color:"+g+":"+l.newcolors[g]);for(g=1;g<l.newfonts.length;g++)k.push("font:"+g+":"+l.newfonts[g]);for(g=1;g<l.newlayouts.length;g++)k.push("layout:"+
g+":"+l.newlayouts[g]);for(g=1;g<l.newvalueformats.length;g++)k.push("valueformat:"+g+":"+SocialCalc.encodeForSave(l.newvalueformats[g]));for(g=0;g<l.namesorder.length;g++)d=l.namesorder[g],k.push("name:"+SocialCalc.encodeForSave(d).toUpperCase()+":"+SocialCalc.encodeForSave(a.names[d].desc)+":"+SocialCalc.encodeForSave(a.names[d].definition));b&&k.push("copiedfrom:"+SocialCalc.crToCoord(c.col,c.row)+":"+SocialCalc.crToCoord(e.col,e.row));k.push("");delete a.xlt;return k.join("\n")};
SocialCalc.CellToString=function(a,b){var c,d,e,g,h,j;c="";if(!b)return c;d=SocialCalc.encodeForSave(b.datavalue);"v"==b.datatype?c="n"==b.valuetype?c+(":v:"+d):c+(":vt:"+b.valuetype+":"+d):"t"==b.datatype?c=b.valuetype==SocialCalc.Constants.textdatadefaulttype?c+(":t:"+d):c+(":vt:"+b.valuetype+":"+d):(e=SocialCalc.encodeForSave(b.formula),"f"==b.datatype?c+=":vtf:"+b.valuetype+":"+d+":"+e:"c"==b.datatype&&(c+=":vtc:"+b.valuetype+":"+d+":"+e));b.errors&&(c+=":e:"+SocialCalc.encodeForSave(b.errors));
d=b.bt||"";e=b.br||"";g=b.bb||"";h=b.bl||"";if(a.xlt){j=a.xlt;if(d||e||g||h)c+=":b:"+j.borderstylesxlat[d||0]+":"+j.borderstylesxlat[e||0]+":"+j.borderstylesxlat[g||0]+":"+j.borderstylesxlat[h||0];b.layout&&(c+=":l:"+j.layoutsxlat[b.layout]);b.font&&(c+=":f:"+j.fontsxlat[b.font]);b.color&&(c+=":c:"+j.colorsxlat[b.color]);b.bgcolor&&(c+=":bg:"+j.colorsxlat[b.bgcolor]);b.cellformat&&(c+=":cf:"+j.cellformatsxlat[b.cellformat]);b.textvalueformat&&(c+=":tvf:"+j.valueformatsxlat[b.textvalueformat]);b.nontextvalueformat&&
(c+=":ntvf:"+j.valueformatsxlat[b.nontextvalueformat])}else{if(d||e||g||h)c+=":b:"+d+":"+e+":"+g+":"+h;b.layout&&(c+=":l:"+b.layout);b.font&&(c+=":f:"+b.font);b.color&&(c+=":c:"+b.color);b.bgcolor&&(c+=":bg:"+b.bgcolor);b.cellformat&&(c+=":cf:"+b.cellformat);b.textvalueformat&&(c+=":tvf:"+b.textvalueformat);b.nontextvalueformat&&(c+=":ntvf:"+b.nontextvalueformat)}b.colspan&&(c+=":colspan:"+b.colspan);b.rowspan&&(c+=":rowspan:"+b.rowspan);b.cssc&&(c+=":cssc:"+b.cssc);b.csss&&(c+=":csss:"+SocialCalc.encodeForSave(b.csss));
b.mod&&(c+=":mod:"+b.mod);b.comment&&(c+=":comment:"+SocialCalc.encodeForSave(b.comment));return c};
SocialCalc.CanonicalizeSheet=function(a,b){var c,d,e,g,h,j,k,l=0,m=0,r="borderstyle,cellformat,color,font,layout,valueformat".split(","),p={namesorder:[]};for(h in a.names)p.namesorder.push(h);p.namesorder.sort();if(!SocialCalc.Constants.doCanonicalizeSheet||!b){for(g=0;g<r.length;g++){h=r[g];p["new"+h+"s"]=a[h+"s"];c=a[h+"s"].length;e=Array(c);e[0]="";for(k=1;k<c;k++)e[k]=k;p[h+"sxlat"]=e}p.maxrow=a.attribs.lastrow;p.maxcol=a.attribs.lastcol}else{for(g=0;g<r.length;g++)h=r[g],p[h+"sUsed"]={};k=p.colorsUsed;
j=p.borderstylesUsed;var n=p.fontsUsed,s=p.layoutsUsed,q=p.cellformatsUsed,t=p.valueformatsUsed;for(d in a.cells)if(e=SocialCalc.coordToCr(d),g=a.cells[d],h=!1,g.valuetype&&"b"!=g.valuetype&&(h=!0),g.color&&(k[g.color]=1,h=!0),g.bgcolor&&(k[g.bgcolor]=1,h=!0),g.bt&&(j[g.bt]=1,h=!0),g.br&&(j[g.br]=1,h=!0),g.bb&&(j[g.bb]=1,h=!0),g.bl&&(j[g.bl]=1,h=!0),g.layout&&(s[g.layout]=1,h=!0),g.font&&(n[g.font]=1,h=!0),g.cellformat&&(q[g.cellformat]=1,h=!0),g.textvalueformat&&(t[g.textvalueformat]=1,h=!0),g.nontextvalueformat&&
(t[g.nontextvalueformat]=1,h=!0),h)if(e.row>l&&(l=e.row),e.col>m)m=e.col;for(k=0;k<SocialCalc.sheetfieldsxlat.length;k++)(c=a.attribs[SocialCalc.sheetfieldsxlat[k]])&&(p[SocialCalc.sheetfieldsxlatxlt[k]+"sUsed"][c]=1);h={height:1,hide:1};for(c in h)for(e in a.rowattribs[c])e>l&&(l=e);h={hide:1,width:1};for(c in h)for(d in a.colattribs[c])e=SocialCalc.coordToCr(d+"1"),e.col>m&&(m=e.col);for(g=0;g<r.length;g++){h=r[g];d=[];e=p[h+"sUsed"];for(c in e)d.push(a[h+"s"][c]);d.sort();d.unshift("");e=[""];
j=a[h+"hash"];for(k=1;k<d.length;k++)e[j[d[k]]]=k;p[h+"sxlat"]=e;p["new"+h+"s"]=d}p.maxrow=l||1;p.maxcol=m||1}a.xlt=p};
SocialCalc.EncodeCellAttributes=function(a,b){var c,d,e,g={},h=function(a){g[a]={def:!0,val:""}},j=function(a){for(var b=0;b<a.length;b++)h(a[b])},k=function(a,b){g[a].def=!1;g[a].val=b||""};c=function(a,b){"*"!=b&&(g[a].def=!1,g[a].val=b)};var l=a.GetAssuredCell(b);h("alignhoriz");l.cellformat&&k("alignhoriz",a.cellformats[l.cellformat]);j(["alignvert","padtop","padright","padbottom","padleft"]);l.layout&&(d=a.layouts[l.layout].match(/^padding:\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+);vertical-align:\s*(\S+);/),
c("padtop",d[1]),c("padright",d[2]),c("padbottom",d[3]),c("padleft",d[4]),c("alignvert",d[5]));j(["fontfamily","fontlook","fontsize"]);l.font&&(d=a.fonts[l.font].match(/^(\*|\S+? \S+?) (\S+?) (\S.*)$/),c("fontfamily",d[3]),c("fontsize",d[2]),c("fontlook",d[1]));h("textcolor");l.color&&k("textcolor",a.colors[l.color]);h("bgcolor");l.bgcolor&&k("bgcolor",a.colors[l.bgcolor]);j(["numberformat","textformat"]);l.nontextvalueformat&&k("numberformat",a.valueformats[l.nontextvalueformat]);l.textvalueformat&&
k("textformat",a.valueformats[l.textvalueformat]);j(["colspan","rowspan"]);k("colspan",l.colspan||1);k("rowspan",l.rowspan||1);for(c=0;4>c;c++)d="trbl".charAt(c),e="b"+d,h(e),k(e,l[e]?a.borderstyles[l[e]]:""),h(e+"thickness"),h(e+"style"),h(e+"color"),l[e]&&(d=a.borderstyles[l[e]].match(/(\S+)\s+(\S+)\s+(\S.+)/),k(e+"thickness",d[1]),k(e+"style",d[2]),k(e+"color",d[3]));j(["cssc","csss","mod"]);k("cssc",l.cssc||"");k("csss",l.csss||"");k("mod",l.mod||"n");return g};
SocialCalc.EncodeSheetAttributes=function(a){var b=a.attribs,c={},d=function(a){c[a]={def:!0,val:""}},e=function(a){for(var b=0;b<a.length;b++)d(a[b])},g=function(a,b){c[a].def=!1;c[a].val=b||void 0},h=function(a,b){"*"!=b&&(c[a].def=!1,c[a].val=b)};d("colwidth");b.defaultcolwidth&&g("colwidth",b.defaultcolwidth);d("rowheight");b.rowheight&&g("rowheight",b.defaultrowheight);d("textalignhoriz");b.defaulttextformat&&g("textalignhoriz",a.cellformats[b.defaulttextformat]);d("numberalignhoriz");b.defaultnontextformat&&
g("numberalignhoriz",a.cellformats[b.defaultnontextformat]);e(["alignvert","padtop","padright","padbottom","padleft"]);b.defaultlayout&&(parts=a.layouts[b.defaultlayout].match(/^padding:\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+);vertical-align:\s*(\S+);/),h("padtop",parts[1]),h("padright",parts[2]),h("padbottom",parts[3]),h("padleft",parts[4]),h("alignvert",parts[5]));e(["fontfamily","fontlook","fontsize"]);b.defaultfont&&(parts=a.fonts[b.defaultfont].match(/^(\*|\S+? \S+?) (\S+?) (\S.*)$/),h("fontfamily",
parts[3]),h("fontsize",parts[2]),h("fontlook",parts[1]));d("textcolor");b.defaultcolor&&g("textcolor",a.colors[b.defaultcolor]);d("bgcolor");b.defaultbgcolor&&g("bgcolor",a.colors[b.defaultbgcolor]);e(["numberformat","textformat"]);b.defaultnontextvalueformat&&g("numberformat",a.valueformats[b.defaultnontextvalueformat]);b.defaulttextvalueformat&&g("textformat",a.valueformats[b.defaulttextvalueformat]);d("recalc");b.recalc&&g("recalc",b.recalc);return c};
SocialCalc.DecodeCellAttributes=function(a,b,c,d){var e,g,h=a.GetAssuredCell(b),j=!1,k=function(a,b,d){c[a]&&(a=c[a].def?"":c[a].val,a!=(b||"")&&m(d+" "+a))},l="",m=function(a){l&&(l+="\n");l+="set "+(d||b)+" "+a;j=!0};k("alignhoriz",a.cellformats[h.cellformat],"cellformat");e=!c.alignvert.def||!c.padtop.def||!c.padright.def||!c.padbottom.def||!c.padleft.def?"padding:"+(c.padtop.def?"* ":c.padtop.val+" ")+(c.padright.def?"* ":c.padright.val+" ")+(c.padbottom.def?"* ":c.padbottom.val+" ")+(c.padleft.def?
"*":c.padleft.val)+";vertical-align:"+(c.alignvert.def?"*;":c.alignvert.val+";"):"";e!=(a.layouts[h.layout]||"")&&m("layout "+e);e=!c.fontlook.def||!c.fontsize.def||!c.fontfamily.def?(c.fontlook.def?"* ":c.fontlook.val+" ")+(c.fontsize.def?"* ":c.fontsize.val+" ")+(c.fontfamily.def?"*":c.fontfamily.val):"";e!=(a.fonts[h.font]||"")&&m("font "+e);k("textcolor",a.colors[h.color],"color");k("bgcolor",a.colors[h.bgcolor],"bgcolor");k("numberformat",a.valueformats[h.nontextvalueformat],"nontextvalueformat");
k("textformat",a.valueformats[h.textvalueformat],"textvalueformat");for(e=0;4>e;e++)g="trbl".charAt(e),g="b"+g,k(g,a.borderstyles[h[g]],g);k("cssc",h.cssc,"cssc");k("csss",h.csss,"csss");if(c.mod&&(e=c.mod.def?"n":c.mod.val,e!=(h.mod||"n")))"n"==e&&(e=""),m("mod "+e);return j?l:null};
SocialCalc.DecodeSheetAttributes=function(a,b){var c,d=a.attribs,e=!1,g=function(a,c,d){b[a]&&(a=b[a].def?"":b[a].val,a!=(c||"")&&j(d+" "+a))},h="",j=function(a){h&&(h+="\n");h+="set sheet "+a;e=!0};g("colwidth",d.defaultcolwidth,"defaultcolwidth");g("rowheight",d.defaultrowheight,"defaultrowheight");g("textalignhoriz",a.cellformats[d.defaulttextformat],"defaulttextformat");g("numberalignhoriz",a.cellformats[d.defaultnontextformat],"defaultnontextformat");c=!b.alignvert.def||!b.padtop.def||!b.padright.def||
!b.padbottom.def||!b.padleft.def?"padding:"+(b.padtop.def?"* ":b.padtop.val+" ")+(b.padright.def?"* ":b.padright.val+" ")+(b.padbottom.def?"* ":b.padbottom.val+" ")+(b.padleft.def?"*":b.padleft.val)+";vertical-align:"+(b.alignvert.def?"*;":b.alignvert.val+";"):"";c!=(a.layouts[d.defaultlayout]||"")&&j("defaultlayout "+c);c=!b.fontlook.def||!b.fontsize.def||!b.fontfamily.def?(b.fontlook.def?"* ":b.fontlook.val+" ")+(b.fontsize.def?"* ":b.fontsize.val+" ")+(b.fontfamily.def?"*":b.fontfamily.val):"";
c!=(a.fonts[d.defaultfont]||"")&&j("defaultfont "+c);g("textcolor",a.colors[d.defaultcolor],"defaultcolor");g("bgcolor",a.colors[d.defaultbgcolor],"defaultbgcolor");g("numberformat",a.valueformats[d.defaultnontextvalueformat],"defaultnontextvalueformat");g("textformat",a.valueformats[d.defaulttextvalueformat],"defaulttextvalueformat");g("recalc",a.attribs.recalc,"recalc");return e?h:null};
SocialCalc.SheetCommandInfo={sheetobj:null,parseobj:null,timerobj:null,firsttimerdelay:50,timerdelay:1,maxtimeslice:100,saveundo:!1,CmdExtensionCallbacks:{},cmdextensionbusy:""};
SocialCalc.ScheduleSheetCommands=function(a,b,c,d){SocialCalc.Callbacks.broadcast&&!d&&"redisplay"!=b&&"set sheet defaulttextvalueformat text-wiki"!=b&&SocialCalc.Callbacks.broadcast("execute",{cmdstr:b,saveundo:c});d=SocialCalc.SheetCommandInfo;d.sheetobj=a;d.parseobj=new SocialCalc.Parse(b);d.saveundo=c;d.sheetobj.statuscallback&&a.statuscallback(d,"cmdstart","",d.sheetobj.statuscallbackparams);d.saveundo&&d.sheetobj.changes.PushChange("");d.timerobj=window.setTimeout(SocialCalc.SheetCommandsTimerRoutine,
d.firsttimerdelay)};
SocialCalc.SheetCommandsTimerRoutine=function(){var a,b=SocialCalc.SheetCommandInfo,c=new Date;for(b.timerobj=null;!b.parseobj.EOF();){(a=SocialCalc.ExecuteSheetCommand(b.sheetobj,b.parseobj,b.saveundo))&&alert(a);b.parseobj.NextLine();if(0<b.cmdextensionbusy.length){b.sheetobj.statuscallback&&b.sheetobj.statuscallback(b,"cmdextension",b.cmdextensionbusy,b.sheetobj.statuscallbackparams);return}if(new Date-c>=b.maxtimeslice){b.timerobj=window.setTimeout(SocialCalc.SheetCommandsTimerRoutine,b.timerdelay);
return}}b.sheetobj.statuscallback&&b.sheetobj.statuscallback(b,"cmdend","",b.sheetobj.statuscallbackparams)};SocialCalc.ResumeFromCmdExtension=function(){SocialCalc.SheetCommandInfo.cmdextensionbusy="";SocialCalc.SheetCommandsTimerRoutine()};
SocialCalc.ExecuteSheetCommand=function(a,b,c){var d,e,g,h,j,k,l,m,r,p,n,s,q,t,u,v,w,x,z,y,E,G,F,H,A,C,B=a.attribs;A=a.changes;y=SocialCalc.CellProperties;u=SocialCalc.Constants;p=function(){var a=SocialCalc.ParseRange(h);m=a.cr1;r=a.cr2;r.col>B.lastcol&&(B.lastcol=r.col);r.row>B.lastrow&&(B.lastrow=r.row)};l="";d=b.RestOfStringNoMove();c&&a.changes.AddDo(d);e=b.NextToken();switch(e){case "set":h=b.NextToken();j=b.NextToken();g=b.RestOfString();b="set "+h+" "+j;if("sheet"==h)switch(a.renderneeded=
!0,j){case "defaultcolwidth":c&&A.AddUndo(b,B[j]);B[j]=g;break;case "defaultcolor":case "defaultbgcolor":c&&A.AddUndo(b,a.GetStyleString("color",B[j]));B[j]=a.GetStyleNum("color",g);break;case "defaultlayout":c&&A.AddUndo(b,a.GetStyleString("layout",B[j]));B[j]=a.GetStyleNum("layout",g);break;case "defaultfont":c&&A.AddUndo(b,a.GetStyleString("font",B[j]));"* * *"==g&&(g="");B[j]=a.GetStyleNum("font",g);break;case "defaulttextformat":case "defaultnontextformat":c&&A.AddUndo(b,a.GetStyleString("cellformat",
B[j]));B[j]=a.GetStyleNum("cellformat",g);break;case "defaulttextvalueformat":case "defaultnontextvalueformat":c&&A.AddUndo(b,a.GetStyleString("valueformat",B[j]));B[j]=a.GetStyleNum("valueformat",g);for(k in a.cells)delete a.cells[k].displaystring;break;case "lastcol":case "lastrow":c&&A.AddUndo(b,B[j]-0);a=g-0;"number"==typeof a&&(B[j]=0<a?a:1);break;case "recalc":c&&A.AddUndo(b,B[j]);"off"==g?B.recalc=g:delete B.recalc;break;default:l=u.s_escUnknownSheetCmd+d}else if(/(^[A-Z])([A-Z])?(:[A-Z][A-Z]?){0,1}$/i.test(h)){a.renderneeded=
!0;h=h.toUpperCase();k=h.indexOf(":");0<=k?(m=SocialCalc.coordToCr(h.substring(0,k)+"1"),r=SocialCalc.coordToCr(h.substring(k+1)+"1")):r=m=SocialCalc.coordToCr(h+"1");for(b=m.col;b<=r.col;b++)"width"==j&&(k=SocialCalc.rcColname(b),c&&A.AddUndo("set "+k+" width",a.colattribs.width[k]),0<g.length?a.colattribs.width[k]=g:delete a.colattribs.width[k])}else if(/([a-z]){0,1}(\d+)/i.test(h)){p();m.row!=r.row||m.col!=r.col||a.celldisplayneeded||a.renderneeded?(a.renderneeded=!0,a.celldisplayneeded=""):a.celldisplayneeded=
SocialCalc.crToCoord(m.col,m.row);for(p=m.row;p<=r.row;p++)for(b=m.col;b<=r.col;b++)k=SocialCalc.crToCoord(b,p),n=a.GetAssuredCell(k),c&&A.AddUndo("set "+k+" all",a.CellToString(n)),"value"==j?(k=g.indexOf(" "),n.datavalue=g.substring(k+1)-0,delete n.errors,n.datatype="v",n.valuetype=g.substring(0,k),delete n.displaystring,delete n.parseinfo,B.needsrecalc="yes"):"text"==j?(k=g.indexOf(" "),n.datavalue=SocialCalc.decodeFromSave(g.substring(k+1)),delete n.errors,n.datatype="t",n.valuetype=g.substring(0,
k),delete n.displaystring,delete n.parseinfo,B.needsrecalc="yes"):"formula"==j?(n.datavalue=0,delete n.errors,n.datatype="f",n.valuetype="e#N/A",n.formula=g,delete n.displaystring,delete n.parseinfo,B.needsrecalc="yes"):"constant"==j?(k=g.indexOf(" "),e=g.substring(k+1).indexOf(" "),n.datavalue=g.substring(k+1,k+1+e)-0,n.valuetype=g.substring(0,k),"e"==n.valuetype.charAt(0)?n.errors=n.valuetype.substring(1):delete n.errors,n.datatype="c",n.formula=g.substring(k+e+2),delete n.displaystring,delete n.parseinfo,
B.needsrecalc="yes"):"empty"==j?(n.datavalue="",delete n.errors,n.datatype=null,n.formula="",n.valuetype="b",delete n.displaystring,delete n.parseinfo,B.needsrecalc="yes"):"all"==j?(0<g.length?(n=new SocialCalc.Cell(k),a.CellFromStringParts(n,g.split(":"),1),a.cells[k]=n):delete a.cells[k],B.needsrecalc="yes"):/^b[trbl]$/.test(j)?(n[j]=a.GetStyleNum("borderstyle",g),a.renderneeded=!0):"color"==j||"bgcolor"==j?n[j]=a.GetStyleNum("color",g):"layout"==j||"cellformat"==j?n[j]=a.GetStyleNum(j,g):"font"==
j?("* * *"==g&&(g=""),n[j]=a.GetStyleNum("font",g)):"textvalueformat"==j||"nontextvalueformat"==j?(n[j]=a.GetStyleNum("valueformat",g),delete n.displaystring):"cssc"==j?(g=g.replace(/[^a-zA-Z0-9\-]/g,""),n.cssc=g):"csss"==j?(g=g.replace(/\n/g,""),n.csss=g):"mod"==j?(g=g.replace(/[^yY]/g,"").toLowerCase(),n.mod=g):"comment"==j?n.comment=SocialCalc.decodeFromSave(g):l=u.s_escUnknownSetCoordCmd+d}break;case "merge":a.renderneeded=!0;h=b.NextToken();g=b.RestOfString();p();n=a.GetAssuredCell(m.coord);
c&&A.AddUndo("unmerge "+m.coord);r.col>m.col?n.colspan=r.col-m.col+1:delete n.colspan;r.row>m.row?n.rowspan=r.row-m.row+1:delete n.rowspan;a.changedrendervalues=!0;break;case "unmerge":a.renderneeded=!0;h=b.NextToken();g=b.RestOfString();p();n=a.GetAssuredCell(m.coord);c&&A.AddUndo("merge "+m.coord+":"+SocialCalc.crToCoord(m.col+(n.colspan||1)-1,m.row+(n.rowspan||1)-1));delete n.colspan;delete n.rowspan;a.changedrendervalues=!0;break;case "erase":case "cut":a.renderneeded=!0;a.changedrendervalues=
!0;h=b.NextToken();g=b.RestOfString();p();c&&A.AddUndo("changedrendervalues");"cut"==e&&(c&&A.AddUndo("loadclipboard",SocialCalc.encodeForSave(SocialCalc.Clipboard.clipboard)),SocialCalc.Clipboard.clipboard=SocialCalc.CreateSheetSave(a,h));for(p=m.row;p<=r.row;p++)for(b=m.col;b<=r.col;b++)k=SocialCalc.crToCoord(b,p),n=a.GetAssuredCell(k),c&&A.AddUndo("set "+k+" all",a.CellToString(n)),"all"==g?delete a.cells[k]:"formulas"==g?(n.datavalue="",n.datatype=null,n.formula="",n.valuetype="b",delete n.errors,
delete n.displaystring,delete n.parseinfo,n.comment&&delete n.comment):"formats"==g&&(j=new SocialCalc.Cell(k),j.datavalue=n.datavalue,j.datatype=n.datatype,j.formula=n.formula,j.valuetype=n.valuetype,n.comment&&(j.comment=n.comment),a.cells[k]=j);B.needsrecalc="yes";break;case "fillright":case "filldown":a.renderneeded=!0;a.changedrendervalues=!0;c&&A.AddUndo("changedrendervalues");h=b.NextToken();g=b.RestOfString();p();"fillright"==e?(e=!0,s=m.row,q=m.col+1):(e=!1,s=m.row+1,q=m.col);for(p=s;p<=
r.row;p++)for(b=q;b<=r.col;b++){k=SocialCalc.crToCoord(b,p);n=a.GetAssuredCell(k);c&&A.AddUndo("set "+k+" all",a.CellToString(n));e?(t=SocialCalc.crToCoord(m.col,p),u=b-q+1,d=0):(t=SocialCalc.crToCoord(b,m.row),u=0,d=p-s+1);v=a.GetAssuredCell(t);if("all"==g||"formats"==g)for(j in y)1!=y[j]&&(void 0===typeof v[j]||3==y[j]?delete n[j]:n[j]=v[j]);if("all"==g||"formulas"==g)n.datavalue=v.datavalue,n.datatype=v.datatype,n.valuetype=v.valuetype,n.formula="f"==n.datatype?SocialCalc.OffsetFormulaCoords(v.formula,
u,d):v.formula,delete n.parseinfo,n.errors=v.errors;delete n.displaystring}B.needsrecalc="yes";break;case "copy":h=b.NextToken();g=b.RestOfString();c&&A.AddUndo("loadclipboard",SocialCalc.encodeForSave(SocialCalc.Clipboard.clipboard));SocialCalc.Clipboard.clipboard=SocialCalc.CreateSheetSave(a,h);break;case "loadclipboard":g=b.RestOfString();c&&A.AddUndo("loadclipboard",SocialCalc.encodeForSave(SocialCalc.Clipboard.clipboard));SocialCalc.Clipboard.clipboard=SocialCalc.decodeFromSave(g);break;case "clearclipboard":c&&
A.AddUndo("loadclipboard",SocialCalc.encodeForSave(SocialCalc.Clipboard.clipboard));SocialCalc.Clipboard.clipboard="";break;case "paste":a.renderneeded=!0;a.changedrendervalues=!0;c&&A.AddUndo("changedrendervalues");h=b.NextToken();g=b.RestOfString();p();if(!SocialCalc.Clipboard.clipboard)break;e=new SocialCalc.Sheet;e.ParseSheetSave(SocialCalc.Clipboard.clipboard);p=SocialCalc.ParseRange(e.copiedfrom);u=m.col-p.cr1.col;d=m.row-p.cr1.row;w=p.cr2.col-p.cr1.col+1;x=p.cr2.row-p.cr1.row+1;m.col+w-1>B.lastcol&&
(B.lastcol=m.col+w-1);m.row+x-1>B.lastrow&&(B.lastrow=m.row+x-1);for(p=m.row;p<m.row+x;p++)for(b=m.col;b<m.col+w;b++){k=SocialCalc.crToCoord(b,p);n=a.GetAssuredCell(k);c&&A.AddUndo("set "+k+" all",a.CellToString(n));t=SocialCalc.crToCoord(b-u,p-d);v=e.GetAssuredCell(t);if("all"==g||"formats"==g)for(j in y)1!=y[j]&&(void 0===typeof v[j]||3==y[j]?delete n[j]:(k=SocialCalc.CellPropertiesTable[j],n[j]=k&&v[j]?a.GetStyleNum(k,e.GetStyleString(k,v[j])):v[j]));if("all"==g||"formulas"==g)n.datavalue=v.datavalue,
n.datatype=v.datatype,n.valuetype=v.valuetype,n.formula="f"==n.datatype?SocialCalc.OffsetFormulaCoords(v.formula,u,d):v.formula,delete n.parseinfo,n.errors=v.errors,v.comment?n.comment=v.comment:n.comment&&delete n.comment;delete n.displaystring}B.needsrecalc="yes";break;case "sort":a.renderneeded=!0;a.changedrendervalues=!0;c&&A.AddUndo("changedrendervalues");h=b.NextToken();p();d=[];E=[];for(u=G=0;3>=u;u++)d[u]=b.NextToken(),E[u]=b.NextToken(),d[u]&&(G=u);e={};j=[];F=[];H=[];for(p=m.row;p<=r.row;p++){for(b=
m.col;b<=r.col;b++)k=SocialCalc.crToCoord(b,p),(n=a.cells[k])?(e[k]=a.CellToString(n),c&&A.AddUndo("set "+k+" all",e[k])):c&&A.AddUndo("set "+k+" all");j.push(j.length);F.push([]);H.push([]);slast=H.length-1;for(u=0;u<=G;u++)k=d[u]+p,n=a.GetAssuredCell(k),k=n.datavalue,b=n.valuetype.charAt(0)||"b","t"==b&&(k=k.toLowerCase()),F[slast].push(k),H[slast].push(b)}j.sort(function(a,b){var c,d,e,g,h;for(c=0;c<=G;c++)if("up"==E[c]?(d=a,e=b):(d=b,e=a),g=H[d][c],tb=H[e][c],"t"==g?"t"==tb?(d=F[d][c],e=F[e][c],
h=d>e?1:d<e?-1:0):"n"==tb?h=1:"b"==tb?h="up"==E[c]?-1:1:"e"==tb&&(h=-1):"n"==g?"t"==tb?h=-1:"n"==tb?(d=F[d][c]-0,e=F[e][c]-0,h=d>e?1:d<e?-1:0):"b"==tb?h="up"==E[c]?-1:1:"e"==tb&&(h=-1):"e"==g?"e"==tb?(d=F[d][c],e=F[e][c],h=d>e?1:d<e?-1:0):h="b"==tb?"up"==E[c]?-1:1:1:"b"==g&&(h="b"==tb?0:"up"==E[c]?1:-1),h)return h;return a>b?1:a<b?-1:0});for(p=m.row;p<=r.row;p++){c=j[p-m.row];for(b=m.col;b<=r.col;b++)k=SocialCalc.crToCoord(b,p),A=SocialCalc.crToCoord(b,c+m.row),e[A]?(n=new SocialCalc.Cell(k),a.CellFromStringParts(n,
e[A].split(":"),1),"f"==n.datatype&&(n.formula=SocialCalc.OffsetFormulaCoords(n.formula,0,p-m.row-c)),a.cells[k]=n):delete a.cells[k]}B.needsrecalc="yes";break;case "insertcol":case "insertrow":a.renderneeded=!0;a.changedrendervalues=!0;h=b.NextToken();g=b.RestOfString();p();"insertcol"==e?(u=1,g=m.col,d=0,q=1,z=s=m.col,n=1,w=B.lastrow,c&&A.AddUndo("deletecol "+m.coord)):(u=0,d=g=1,q=m.row,s=1,z=B.lastcol,w=n=m.row,c&&A.AddUndo("deleterow "+m.coord));for(p=B.lastrow;p>=q;p--)for(b=B.lastcol;b>=g;b--)t=
SocialCalc.crToCoord(b,p),k=SocialCalc.crToCoord(b+u,p+d),a.cells[t]?a.cells[k]=a.cells[t]:delete a.cells[k];for(p=n;p<=w;p++)for(b=s;b<=z;b++)for(j in k=SocialCalc.crToCoord(b,p),n=new SocialCalc.Cell(k),a.cells[k]=n,t=SocialCalc.crToCoord(b-u,p-d),v=a.GetAssuredCell(t),y)2==y[j]&&(n[j]=v[j]);for(k in a.cells){if((n=a.cells[k])&&"f"==n.datatype)n.formula=SocialCalc.AdjustFormulaCoords(n.formula,m.col,u,m.row,d);n&&delete n.parseinfo}for(C in a.names)a.names[C]&&(b=a.names[C].definition,k="","="==
b.charAt(0)&&(k="=",b=b.substring(1)),a.names[C].definition=k+SocialCalc.AdjustFormulaCoords(b,m.col,u,m.row,d));for(p=B.lastrow;p>=q&&"insertrow"==e;p--)for(j in c=p+d,a.rowattribs)k=a.rowattribs[j][p],a.rowattribs[j][c]!=k&&(k?a.rowattribs[j][c]=k:delete a.rowattribs[j][c]);for(b=B.lastcol;b>=g&&"insertcol"==e;b--)for(j in p=SocialCalc.rcColname(b),c=SocialCalc.rcColname(b+u),a.colattribs)k=a.colattribs[j][p],a.colattribs[j][c]!=k&&(k?a.colattribs[j][c]=k:delete a.colattribs[j][c]);B.lastcol+=u;
B.lastrow+=d;B.needsrecalc="yes";break;case "deletecol":case "deleterow":a.renderneeded=!0;a.changedrendervalues=!0;h=b.NextToken();g=b.RestOfString();g=B.lastcol;y=B.lastrow;p();"deletecol"==e?(u=m.col-r.col-1,d=0,q=r.col+1,s=1):(u=0,d=m.row-r.row-1,q=1,s=r.row+1);for(p=s;p<=y-d;p++)for(b=q;b<=g-u;b++){k=SocialCalc.crToCoord(b+u,p+d);if(c&&(p<s-d||b<q-u))(n=a.cells[k])?A.AddUndo("set "+k+" all",a.CellToString(n)):A.AddUndo("erase "+k+" all");t=SocialCalc.crToCoord(b,p);(n=a.cells[t])?a.cells[k]=
n:delete a.cells[k]}for(k in a.cells)if(n=a.cells[k])"f"==n.datatype?(p=n.formula,n.formula=SocialCalc.AdjustFormulaCoords(p,m.col,u,m.row,d),n.formula!=p&&(delete n.parseinfo,c&&-1!=n.formula.indexOf("#REF!")&&(b=SocialCalc.coordToCr(k),A.AddUndo("set "+SocialCalc.rcColname(b.col-u)+(b.row-d)+" formula "+p)))):delete n.parseinfo;for(C in a.names)a.names[C]&&(b=a.names[C].definition,k="","="==b.charAt(0)&&(k="=",b=b.substring(1)),a.names[C].definition=k+SocialCalc.AdjustFormulaCoords(b,m.col,u,m.row,
d));for(p=s;p<=y-d&&"deleterow"==e;p++)for(j in b=p+d,a.rowattribs)k=a.rowattribs[j][p],a.rowattribs[j][b]!=k&&(c&&A.AddUndo("set "+b+" "+j,a.rowattribs[j][b]),k?a.rowattribs[j][b]=k:delete a.rowattribs[j][b]);for(b=q;b<=g-u&&"deletecol"==e;b++)for(j in p=SocialCalc.rcColname(b),n=SocialCalc.rcColname(b+u),a.colattribs)k=a.colattribs[j][p],a.colattribs[j][n]!=k&&(c&&A.AddUndo("set "+n+" "+j,a.colattribs[j][n]),k?a.colattribs[j][n]=k:delete a.colattribs[j][n]);if(c)if("deletecol"==e)for(b=m.col;b<=
r.col;b++)A.AddUndo("insertcol "+SocialCalc.rcColname(b));else for(p=m.row;p<=r.row;p++)A.AddUndo("insertrow "+p);"deletecol"==e?m.col<=g&&(B.lastcol=r.col<=g?B.lastcol+u:m.col-1):m.row<=y&&(B.lastrow=r.row<=y?B.lastrow+d:m.row-1);B.needsrecalc="yes";break;case "movepaste":case "moveinsert":var I,D;a.renderneeded=!0;a.changedrendervalues=!0;c&&A.AddUndo("changedrendervalues");h=b.NextToken();n=b.NextToken();g=b.RestOfString();""==g&&(g="all");p();D=SocialCalc.coordToCr(n);u=D.col-m.col;d=D.row-m.row;
w=r.col-m.col+1;x=r.row-m.row+1;I={};for(p=m.row;p<=r.row;p++)for(b=m.col;b<=r.col;b++)if(k=SocialCalc.crToCoord(b,p),n=a.GetAssuredCell(k),c&&A.AddUndo("set "+k+" all",a.CellToString(n)),a.cells[k]){I[k]=new SocialCalc.Cell(k);for(j in y)void 0!==typeof n[j]&&(I[k][j]=n[j],"all"==g&&delete n[j],"formulas"==g&&(1==y[j]||3==y[j])&&delete n[j],"formats"==g&&2==y[j]&&delete n[j]);"formulas"==g&&(n.datavalue="",n.datatype=null,n.formula="",n.valuetype="b");"all"==g&&delete a.cells[k]}"moveinsert"==e&&
(s=q=!1,0==d&&(D.col<m.col||D.col>r.col)?D.col<m.col?(z=m.col-D.col,q=-1):(D.col-=1,u=D.col-r.col,z=D.col-r.col,q=1):0==u&&(D.row<m.row||D.row>r.row)?D.row<m.row?(z=m.row-D.row,s=-1):(D.row-=1,d=D.row-r.row,z=D.row-r.row,s=1):e="movepaste");e={};if(s)for(p=0;p<z;p++)for(b=m.col;b<=r.col;b++){0>s?(t=SocialCalc.crToCoord(b,D.row+z-p-1),k=SocialCalc.crToCoord(b,r.row-p)):(t=SocialCalc.crToCoord(b,D.row-z+p+1),k=SocialCalc.crToCoord(b,m.row+p));v=a.GetAssuredCell(t);c&&A.AddUndo("set "+t+" all",a.CellToString(v));
n=a.GetAssuredCell(k);if("all"==g||"formats"==g)for(j in y)1!=y[j]&&(void 0===typeof v[j]||3==y[j]?delete n[j]:n[j]=v[j]);if("all"==g||"formulas"==g)n.datavalue=v.datavalue,n.datatype=v.datatype,n.valuetype=v.valuetype,n.formula=v.formula,delete n.parseinfo,n.errors=v.errors;delete n.displaystring;e[t]=k}if(q)for(b=0;b<z;b++)for(p=m.row;p<=r.row;p++){0>q?(t=SocialCalc.crToCoord(D.col+z-b-1,p),k=SocialCalc.crToCoord(r.col-b,p)):(t=SocialCalc.crToCoord(D.col-z+b+1,p),k=SocialCalc.crToCoord(m.col+b,
p));v=a.GetAssuredCell(t);c&&A.AddUndo("set "+t+" all",a.CellToString(v));n=a.GetAssuredCell(k);if("all"==g||"formats"==g)for(j in y)1!=y[j]&&(void 0===typeof v[j]||3==y[j]?delete n[j]:n[j]=v[j]);if("all"==g||"formulas"==g)n.datavalue=v.datavalue,n.datatype=v.datatype,n.valuetype=v.valuetype,n.formula=v.formula,delete n.parseinfo,n.errors=v.errors;delete n.displaystring;e[t]=k}D.col+w-1>B.lastcol&&(B.lastcol=D.col+w-1);D.row+x-1>B.lastrow&&(B.lastrow=D.row+x-1);for(p=m.row;p<m.row+x;p++)for(b=m.col;b<
m.col+w;b++)if(k=SocialCalc.crToCoord(b+u,p+d),n=a.GetAssuredCell(k),c&&A.AddUndo("set "+k+" all",a.CellToString(n)),t=SocialCalc.crToCoord(b,p),e[t]=k,"all"==g&&!I[t])delete a.cells[k];else{(v=I[t])||(v=a.GetAssuredCell(t));if("all"==g||"formats"==g)for(j in y)1!=y[j]&&(void 0===typeof v[j]||3==y[j]?delete n[j]:n[j]=v[j]);if("all"==g||"formulas"==g)n.datavalue=v.datavalue,n.datatype=v.datatype,n.valuetype=v.valuetype,n.formula=v.formula,delete n.parseinfo,n.errors=v.errors,v.comment?n.comment=v.comment:
n.comment&&delete n.comment;delete n.displaystring}for(k in a.cells)if(n=a.cells[k])"f"==n.datatype?(p=n.formula,n.formula=SocialCalc.ReplaceFormulaCoords(p,e),n.formula!=p&&(delete n.parseinfo,c&&!e[k]&&A.AddUndo("set "+k+" formula "+p))):delete n.parseinfo;for(C in a.names)a.names[C]&&(p=b=a.names[C].definition,k="","="==b.charAt(0)&&(k="=",b=b.substring(1)),a.names[C].definition=k+SocialCalc.ReplaceFormulaCoords(b,e),c&&a.names[C].definition!=p&&A.AddUndo("name define "+C+" "+p));B.needsrecalc=
"yes";break;case "name":h=b.NextToken();C=b.NextToken();g=b.RestOfString();C=C.toUpperCase().replace(/[^A-Z0-9_\.]/g,"");if(""==C)break;if("define"==h){if(""==g)break;a.names[C]?(c&&A.AddUndo("name define "+C+" "+a.names[C].definition),a.names[C].definition=g):(c&&A.AddUndo("name delete "+C),a.names[C]={definition:g,desc:""})}else"desc"==h?a.names[C]&&(c&&A.AddUndo("name desc "+C+" "+a.names[C].desc),a.names[C].desc=g):"delete"==h&&(c&&(a.names[C].desc&&A.AddUndo("name desc "+C+" "+a.names[C].desc),
A.AddUndo("name define "+C+" "+a.names[C].definition)),delete a.names[C]);B.needsrecalc="yes";break;case "recalc":B.needsrecalc="yes";a.recalconce=!0;break;case "redisplay":a.renderneeded=!0;break;case "changedrendervalues":a.changedrendervalues=!0;break;case "startcmdextension":C=b.NextToken();(A=SocialCalc.SheetCommandInfo.CmdExtensionCallbacks[C])&&A.func(C,A.data,a,b,c);break;default:l=u.s_escUnknownCmd+d}return l};
SocialCalc.SheetUndo=function(a){var b,c=a.changes.TOS(),d="";for(b=c?c.undo.length-1:-1;0<=b;b--)d&&(d+="\n"),d+=c.undo[b];a.changes.Undo();a.ScheduleSheetCommands(d,!1)};SocialCalc.SheetRedo=function(a){var b,c;if(a.changes.Redo()){b=a.changes.TOS();var d="";for(c=0;b&&c<b.command.length;c++)d&&(d+="\n"),d+=b.command[c];a.ScheduleSheetCommands(d,!1)}else a.ScheduleSheetCommands("",!1)};
SocialCalc.CreateAuditString=function(a){for(var b,c="",d=a.changes.stack,e=a.changes.tos,a=0;a<=e;a++)for(b=0;b<d[a].command.length;b++)c+=d[a].command[b]+"\n";return c};SocialCalc.GetStyleNum=function(a,b,c){var d;if(0==c.length)return 0;d=a[b+"hash"][c];d||(1>a[b+"s"].length&&a[b+"s"].push(""),d=a[b+"s"].push(c)-1,a[b+"hash"][c]=d,a.changedrendervalues=!0);return d};SocialCalc.GetStyleString=function(a,b,c){return!c?null:a[b+"s"][c]};
SocialCalc.OffsetFormulaCoords=function(a,b,c){var d,e,g,h,j="";d=SocialCalc.Formula;if(!d)return"Need SocialCalc.Formula";var k=d.TokenType,l=k.op,m=k.string,k=k.coord,r=d.TokenOpExpansion,a=d.ParseFormulaIntoTokens(a);for(g=0;g<a.length;g++)if(e=a[g].type,d=a[g].text,e==k){h="";e=SocialCalc.coordToCr(d);"$"!=d.charAt(0)?e.col+=b:h+="$";h+=SocialCalc.rcColname(e.col);-1==d.indexOf("$",1)?e.row+=c:h+="$";h+=e.row;if(1>e.row||1>e.col)h="#REF!";j+=h}else j=e==m?0<=d.indexOf('"')?j+('"'+d.replace(/"/,
'""')+'"'):j+('"'+d+'"'):e==l?j+(r[d]||d):j+d;return j};
SocialCalc.AdjustFormulaCoords=function(a,b,c,d,e){var g,h,j="",k=!1,l=SocialCalc.Formula;if(!l)return"Need SocialCalc.Formula";var m=l.TokenType,r=m.op,p=m.string,m=m.coord,l=l.TokenOpExpansion;parseinfo=SocialCalc.Formula.ParseFormulaIntoTokens(a);for(h=0;h<parseinfo.length;h++){g=parseinfo[h].type;a=parseinfo[h].text;g==r&&("!"==a?k=!0:":"!=a&&(k=!1),a=l[a]||a);if(g==m){cr=SocialCalc.coordToCr(a);if((0>c&&cr.col>=b&&cr.col<b-c||0>e&&cr.row>=d&&cr.row<d-e)&&!k)cr.col=0,cr.row=0;if(!k&&(cr.col>=
b&&(cr.col+=c),cr.row>=d))cr.row+=e;g="$"==a.charAt(0)?"$"+SocialCalc.rcColname(cr.col):SocialCalc.rcColname(cr.col);g=-1!=a.indexOf("$",1)?g+("$"+cr.row):g+cr.row;if(1>cr.row||1>cr.col)g="#REF!";a=g}else g==p&&(a=0<=a.indexOf('"')?'"'+a.replace(/"/,'""')+'"':'"'+a+'"');j+=a}return j};
SocialCalc.ReplaceFormulaCoords=function(a,b){var c,d,e,g="",h=!1;d=SocialCalc.Formula;if(!d)return"Need SocialCalc.Formula";var j=d.TokenType,k=j.op,l=j.string,j=j.coord,m=d.TokenOpExpansion;parseinfo=SocialCalc.Formula.ParseFormulaIntoTokens(a);for(e=0;e<parseinfo.length;e++)c=parseinfo[e].type,d=parseinfo[e].text,c==k&&("!"==d?h=!0:":"!=d&&(h=!1),d=m[d]||d),c==j?(cr=SocialCalc.coordToCr(d),c=SocialCalc.crToCoord(cr.col,cr.row),b[c]&&!h&&(cr=SocialCalc.coordToCr(b[c]),c="$"==d.charAt(0)?"$"+SocialCalc.rcColname(cr.col):
SocialCalc.rcColname(cr.col),d=c=-1!=d.indexOf("$",1)?c+("$"+cr.row):c+cr.row)):c==l&&(d=0<=d.indexOf('"')?'"'+d.replace(/"/,'""')+'"':'"'+d+'"'),g+=d;return g};SocialCalc.RecalcInfo={sheet:null,currentState:0,state:{start_calc:1,order:2,calc:3,start_wait:4,done_wait:5},recalctimer:null,maxtimeslice:100,timeslicedelay:1,starttime:0,LoadSheet:function(){return!1}};
SocialCalc.RecalcData=function(){this.inrecalc=!0;this.celllist=[];this.celllistitem=0;this.calclist=null;this.calclistlength=0;this.nextcalc=this.lastcalc=this.firstcalc=null;this.count=0;this.checkinfo={}};SocialCalc.RecalcCheckInfo=function(){this.oldcoord=null;this.parsepos=0;this.inrangestart=this.inrange=!1;this.r=this.c=this.r2=this.r1=this.c2=this.c1=this.cr2=this.cr1=null};
SocialCalc.RecalcSheet=function(a){var b=SocialCalc.RecalcInfo;delete a.attribs.circularreferencecell;SocialCalc.Formula.FreshnessInfoReset();SocialCalc.RecalcClearTimeout();b.sheet=a;b.currentState=b.state.start_calc;b.starttime=new Date;a.statuscallback&&a.statuscallback(b,"calcstart",null,a.statuscallbackparams);SocialCalc.RecalcSetTimeout()};SocialCalc.RecalcSetTimeout=function(){var a=SocialCalc.RecalcInfo;a.recalctimer=window.setTimeout(SocialCalc.RecalcTimerRoutine,a.timeslicedelay)};
SocialCalc.RecalcClearTimeout=function(){var a=SocialCalc.RecalcInfo;a.recalctimer&&(window.clearTimeout(a.recalctimer),a.recalctimer=null)};SocialCalc.RecalcLoadedSheet=function(a,b,c){var d=SocialCalc.RecalcInfo,e=SocialCalc.Formula,a=SocialCalc.Formula.AddSheetToCache(a||e.SheetCache.waitingForLoading,b);c&&a&&"off"!=a.attribs.recalc&&(a.previousrecalcsheet=d.sheet,d.sheet=a,d.currentState=d.state.start_calc);e.SheetCache.waitingForLoading=null;SocialCalc.RecalcSetTimeout()};
SocialCalc.RecalcTimerRoutine=function(){var a,b,c,d=new Date,e=0,g=SocialCalc.Formula;if(!g)return"Need SocialCalc.Formula";var h=SocialCalc.RecalcInfo,j=h.sheet;if(j){var k=j.recalcdata,l=function(a,b){j.statuscallback&&j.statuscallback(k,a,b,j.statuscallbackparams)};SocialCalc.RecalcClearTimeout();if(h.currentState==h.state.start_calc){k=new SocialCalc.RecalcData;j.recalcdata=k;for(c in j.cells)c&&k.celllist.push(c);k.calclist={};h.currentState=h.state.order}if(h.currentState==h.state.order){for(;k.celllistitem<
k.celllist.length;)if(c=k.celllist[k.celllistitem++],SocialCalc.RecalcCheckCell(j,c),new Date-d>=h.maxtimeslice){l("calcorder",{coord:c,total:k.celllist.length,count:k.celllistitem});SocialCalc.RecalcSetTimeout();return}l("calccheckdone",k.calclistlength);k.nextcalc=k.firstcalc;h.currentState=h.state.calc;SocialCalc.RecalcSetTimeout()}else if(h.currentState==h.state.start_wait){h.currentState=h.state.done_wait;if(h.LoadSheet&&(a=h.LoadSheet(g.SheetCache.waitingForLoading)))return;SocialCalc.RecalcLoadedSheet(null,
"",!1)}else if(h.currentState==h.state.done_wait)h.currentState=h.state.calc,SocialCalc.RecalcSetTimeout();else{h.currentState!=h.state.calc&&alert("Recalc state error: "+h.currentState+". Error in SocialCalc code.");for(c=j.recalcdata.nextcalc;c;){b=j.cells[c];a=g.evaluate_parsed_formula(b.parseinfo,j,!1);if(g.SheetCache.waitingForLoading){k.nextcalc=c;k.count+=e;l("calcloading",{sheetname:g.SheetCache.waitingForLoading});h.currentState=h.state.start_wait;SocialCalc.RecalcSetTimeout();return}if(g.RemoteFunctionInfo.waitingForServer){k.nextcalc=
c;k.count+=e;l("calcserverfunc",{funcname:g.RemoteFunctionInfo.waitingForServer,coord:c,total:k.calclistlength,count:k.count});h.currentState=h.state.done_wait;return}if(b.datavalue!=a.value||b.valuetype!=a.type)b.datavalue=a.value,b.valuetype=a.type,delete b.displaystring,j.recalcchangedavalue=!0;a.error&&(b.errors=a.error);e++;c=j.recalcdata.calclist[c];if(new Date-d>=h.maxtimeslice){k.nextcalc=c;k.count+=e;l("calcstep",{coord:c,total:k.calclistlength,count:k.count});SocialCalc.RecalcSetTimeout();
return}}k.inrecalc=!1;delete j.recalcdata;delete j.attribs.needsrecalc;h.sheet=j.previousrecalcsheet||null;h.sheet?(h.currentState=h.state.calc,SocialCalc.RecalcSetTimeout()):(g.FreshnessInfo.recalc_completed=!0,l("calcfinished",new Date-h.starttime))}}};
SocialCalc.RecalcCheckCell=function(a,b){var c,d,e,g,h,j,k,l,m=SocialCalc.Formula;if(!m)return"Need SocialCalc.Formula";g=m.TokenType;var r=g.op,p=g.name,n=g.coord,s=a.recalcdata,q=s.checkinfo,t=!1,u=null,v=b;a:for(;v;)if(k=a.cells[v],l=q[v],!k||"f"!=k.datatype||l&&"object"!=typeof l)v=u,q[v]&&(u=q[v].oldcoord);else{l||(l=new SocialCalc.RecalcCheckInfo,q[v]=l);k.errors&&delete k.errors;k.parseinfo||(k.parseinfo=m.ParseFormulaIntoTokens(k.formula));c=k.parseinfo;for(g=l.parsepos;g<c.length;g++){if(l.inrange){l.inrangestart&&
(l.cr1.col>l.cr2.col?(l.c1=l.cr2.col,l.c2=l.cr1.col):(l.c1=l.cr1.col,l.c2=l.cr2.col),l.c=l.c1-1,l.cr1.row>l.cr2.row?(l.r1=l.cr2.row,l.r2=l.cr1.row):(l.r1=l.cr1.row,l.r2=l.cr2.row),l.r=l.r1,l.inrangestart=!1);l.c+=1;if(l.c>l.c2){l.r+=1;if(l.r>l.r2){l.inrange=!1;continue}l.c=l.c1}c=SocialCalc.crToCoord(l.c,l.r);l.parsepos=g;l.oldcoord=u;u=v;v=c;if(q[v]&&"object"==typeof q[v])return k.errors=SocialCalc.Constants.s_caccCircRef+b,q[b]=!0,s.firstcalc?s.calclist[s.lastcalc]=b:s.firstcalc=b,s.lastcalc=b,
s.calclistlength++,a.attribs.circularreferencecell=v+"|"+u,k.errors;continue a}e=c[g].type;d=c[g].text;e==r&&("!"==d?t=!0:":"!=d&&(t=!1));if(e==p)if(h=m.LookupName(a,d),"range"==h.type){if(j=h.value.indexOf("|"),-1!=j){l.cr1=SocialCalc.coordToCr(h.value.substring(0,j));d=h.value.indexOf("|",j+1);l.cr2=SocialCalc.coordToCr(h.value.substring(j+1,d));l.inrange=!0;l.inrangestart=!0;g-=1;continue}}else"coord"==h.type&&(e=n,d=h.value);if(e==n)if(2<=g&&c[g-1].type==r&&":"==c[g-1].text&&c[g-2].type==n&&!t)l.cr1=
SocialCalc.coordToCr(c[g-2].text),l.cr2=SocialCalc.coordToCr(d),l.inrange=!0,l.inrangestart=!0,g-=1;else if(!t){-1!=d.indexOf("$")&&(d=d.replace(/\$/g,""));l.parsepos=g+1;l.oldcoord=u;u=v;v=d;if(q[v]&&"object"==typeof q[v])return k.errors=SocialCalc.Constants.s_caccCircRef+b,q[b]=!0,s.firstcalc?s.calclist[s.lastcalc]=b:s.firstcalc=b,s.lastcalc=b,s.calclistlength++,a.attribs.circularreferencecell=v+"|"+u,k.errors;continue a}}t=!1;q[v]=!0;s.firstcalc?s.calclist[s.lastcalc]=v:s.firstcalc=v;s.lastcalc=
v;s.calclistlength++;v=u;u=q[v]?q[v].oldcoord:null}return""};SocialCalc.Parse=function(a){this.str=a;this.pos=0;this.delimiter=" ";this.lineEnd=a.indexOf("\n");0>this.lineEnd&&(this.lineEnd=a.length)};SocialCalc.Parse.prototype.NextToken=function(){if(0>this.pos)return"";var a=this.str.indexOf(this.delimiter,this.pos),b=this.pos;a>this.lineEnd&&(a=this.lineEnd);if(0<=a)return this.pos=a+1,this.str.substring(b,a);this.pos=this.lineEnd;return this.str.substring(b,this.lineEnd)};
SocialCalc.Parse.prototype.RestOfString=function(){var a=this.pos;if(0>this.pos||this.pos>=this.lineEnd)return"";this.pos=this.lineEnd;return this.str.substring(a,this.lineEnd)};SocialCalc.Parse.prototype.RestOfStringNoMove=function(){return 0>this.pos||this.pos>=this.lineEnd?"":this.str.substring(this.pos,this.lineEnd)};SocialCalc.Parse.prototype.NextLine=function(){this.pos=this.lineEnd+1;this.lineEnd=this.str.indexOf("\n",this.pos);0>this.lineEnd&&(this.lineEnd=this.str.length)};
SocialCalc.Parse.prototype.EOF=function(){return 0>this.pos||this.pos>=this.str.length?!0:!1};SocialCalc.UndoStack=function(){this.stack=[];this.tos=-1;this.maxRedo=0;this.maxUndo=50};
SocialCalc.UndoStack.prototype.PushChange=function(a){for(;0<this.stack.length&&this.stack.length-1>this.tos;)this.stack.pop();this.stack.push({command:[],type:a,undo:[]});this.maxRedo&&this.stack.length>this.maxRedo&&this.stack.shift();this.maxUndo&&this.stack.length>this.maxUndo&&(this.stack[this.stack.length-this.maxUndo-1].undo=[]);this.tos=this.stack.length-1};
SocialCalc.UndoStack.prototype.AddDo=function(){for(var a=[],b=0;b<arguments.length;b++)null!=arguments[b]&&a.push(arguments[b]);this.stack[this.stack.length-1].command.push(a.join(" "))};SocialCalc.UndoStack.prototype.AddUndo=function(){for(var a=[],b=0;b<arguments.length;b++)null!=arguments[b]&&a.push(arguments[b]);this.stack[this.stack.length-1].undo.push(a.join(" "))};SocialCalc.UndoStack.prototype.TOS=function(){return 0<=this.tos?this.stack[this.tos]:null};
SocialCalc.UndoStack.prototype.Undo=function(){return 0<=this.tos&&(!this.maxUndo||this.tos>this.stack.length-this.maxUndo-1)?(this.tos-=1,!0):!1};SocialCalc.UndoStack.prototype.Redo=function(){return this.tos<this.stack.length-1?(this.tos+=1,!0):!1};SocialCalc.Clipboard={clipboard:""};
SocialCalc.RenderContext=function(a){var b=a.attribs,c=SocialCalc.Constants;this.sheetobj=a;this.showRCHeaders=this.showGrid=this.hideRowsCols=!1;this.rownamewidth=c.defaultRowNameWidth;this.pixelsPerRow=c.defaultAssumedRowHeight;this.cellskip={};this.coordToCR={};this.colwidth=[];this.totalwidth=0;this.rowpanes=[];this.colpanes=[];this.maxrow=this.maxcol=0;this.highlights={};this.cursorsuffix="";this.highlightTypes={cursor:{style:c.defaultHighlightTypeCursorStyle,className:c.defaultHighlightTypeCursorClass},
range:{style:c.defaultHighlightTypeRangeStyle,className:c.defaultHighlightTypeRangeClass},cursorinsertup:{style:"color:#FFF;backgroundColor:#A6A6A6;backgroundRepeat:repeat-x;backgroundPosition:top left;backgroundImage:url("+c.defaultImagePrefix+"cursorinsertup.gif);",className:c.defaultHighlightTypeCursorClass},cursorinsertleft:{style:"color:#FFF;backgroundColor:#A6A6A6;backgroundRepeat:repeat-y;backgroundPosition:top left;backgroundImage:url("+c.defaultImagePrefix+"cursorinsertleft.gif);",className:c.defaultHighlightTypeCursorClass},
range2:{style:"color:#000;backgroundColor:#FFF;backgroundImage:url("+c.defaultImagePrefix+"range2.gif);",className:""}};this.cellIDprefix=c.defaultCellIDPrefix;this.defaultlinkstyle=null;this.defaultHTMLlinkstyle={type:"html"};this.defaultfontstyle=c.defaultCellFontStyle;this.defaultfontsize=c.defaultCellFontSize;this.defaultfontfamily=c.defaultCellFontFamily;this.defaultlayout=c.defaultCellLayout;this.defaultpanedividerwidth=c.defaultPaneDividerWidth;this.defaultpanedividerheight=c.defaultPaneDividerHeight;
this.gridCSS=c.defaultGridCSS;this.commentClassName=c.defaultCommentClass;this.commentCSS=c.defaultCommentStyle;this.commentNoGridClassName=c.defaultCommentNoGridClass;this.commentNoGridCSS=c.defaultCommentNoGridStyle;this.classnames={colname:c.defaultColnameClass,rowname:c.defaultRownameClass,selectedcolname:c.defaultSelectedColnameClass,selectedrowname:c.defaultSelectedRownameClass,upperleft:c.defaultUpperLeftClass,skippedcell:c.defaultSkippedCellClass,panedivider:c.defaultPaneDividerClass};this.explicitStyles=
{colname:c.defaultColnameStyle,rowname:c.defaultRownameStyle,selectedcolname:c.defaultSelectedColnameStyle,selectedrowname:c.defaultSelectedRownameStyle,upperleft:c.defaultUpperLeftStyle,skippedcell:c.defaultSkippedCellStyle,panedivider:c.defaultPaneDividerStyle};this.cellskip=null;this.needcellskip=!0;this.fonts=[];this.layouts=[];this.needprecompute=!0;if(a)this.rowpanes[0]={first:1,last:b.lastrow},this.colpanes[0]={first:1,last:b.lastcol};else throw c.s_rcMissingSheet;};
SocialCalc.RenderContext.prototype.PrecomputeSheetFontsAndLayouts=function(){SocialCalc.PrecomputeSheetFontsAndLayouts(this)};SocialCalc.RenderContext.prototype.CalculateCellSkipData=function(){SocialCalc.CalculateCellSkipData(this)};SocialCalc.RenderContext.prototype.CalculateColWidthData=function(){SocialCalc.CalculateColWidthData(this)};SocialCalc.RenderContext.prototype.SetRowPaneFirstLast=function(a,b,c){this.rowpanes[a]={first:b,last:c}};
SocialCalc.RenderContext.prototype.SetColPaneFirstLast=function(a,b,c){this.colpanes[a]={first:b,last:c}};SocialCalc.RenderContext.prototype.CoordInPane=function(a,b,c){return SocialCalc.CoordInPane(this,a,b,c)};SocialCalc.RenderContext.prototype.CellInPane=function(a,b,c,d){return SocialCalc.CellInPane(this,a,b,c,d)};SocialCalc.RenderContext.prototype.InitializeTable=function(a){SocialCalc.InitializeTable(this,a)};
SocialCalc.RenderContext.prototype.RenderSheet=function(a,b){return SocialCalc.RenderSheet(this,a,b)};SocialCalc.RenderContext.prototype.RenderColGroup=function(){return SocialCalc.RenderColGroup(this)};SocialCalc.RenderContext.prototype.RenderColHeaders=function(){return SocialCalc.RenderColHeaders(this)};SocialCalc.RenderContext.prototype.RenderSizingRow=function(){return SocialCalc.RenderSizingRow(this)};
SocialCalc.RenderContext.prototype.RenderRow=function(a,b,c){return SocialCalc.RenderRow(this,a,b,c)};SocialCalc.RenderContext.prototype.RenderSpacingRow=function(){return SocialCalc.RenderSpacingRow(this)};SocialCalc.RenderContext.prototype.RenderCell=function(a,b,c,d,e,g){return SocialCalc.RenderCell(this,a,b,c,d,e,g)};
SocialCalc.PrecomputeSheetFontsAndLayouts=function(a){var b,c,d,e,g,h,j=a.sheetobj;e=j.attribs;e.defaultfont&&(b=j.fonts[e.defaultfont],b=b.replace(/^\*/,SocialCalc.Constants.defaultCellFontStyle),b=b.replace(/(.+)\*(.+)/,"$1"+SocialCalc.Constants.defaultCellFontSize+"$2"),b=b.replace(/\*$/,SocialCalc.Constants.defaultCellFontFamily),c=b.match(/^(\S+? \S+?) (\S+?) (\S.*)$/),a.defaultfontstyle=c[1],a.defaultfontsize=c[2],a.defaultfontfamily=c[3]);for(g=1;g<j.fonts.length;g++)c=j.fonts[g],c=c.replace(/^\*/,
a.defaultfontstyle),c=c.replace(/(.+)\*(.+)/,"$1"+a.defaultfontsize+"$2"),c=c.replace(/\*$/,a.defaultfontfamily),c=c.match(/^(\S+?) (\S+?) (\S+?) (\S.*)$/),a.fonts[g]={style:c[1],weight:c[2],size:c[3],family:c[4]};b=/^padding:\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+);vertical-align:\s*(\S+);/;d=SocialCalc.Constants.defaultCellLayout.match(b);e=e.defaultlayout?j.layouts[e.defaultlayout].match(b):",*,*,*,*,*".split(",");for(g=1;g<j.layouts.length;g++){c=j.layouts[g];c=c.match(b);for(h=1;5>=h;h++)"*"==c[h]&&
(c[h]="*"!=e[h]?e[h]:d[h]);a.layouts[g]="padding:"+c[1]+" "+c[2]+" "+c[3]+" "+c[4]+";vertical-align:"+c[5]+";"}a.needprecompute=!1};
SocialCalc.CalculateCellSkipData=function(a){var b,c,d,e,g,h,j,k,l=a.sheetobj;a.maxrow=0;a.maxcol=0;a.cellskip={};for(b=1;b<=l.attribs.lastrow;b++)for(c=1;c<=l.attribs.lastcol;c++)if(d=SocialCalc.crToCoord(c,b),e=l.cells[d],!(void 0===e||a.cellskip[d]))if(g=e.colspan||1,e=e.rowspan||1,1<g||1<e)for(h=b;h<b+e;h++)for(j=c;j<c+g;j++)k=SocialCalc.crToCoord(j,h),k==d?a.coordToCR[d]={row:b,col:c}:a.cellskip[k]=d,h>a.maxrow&&(maxrow=h),j>a.maxcol&&(maxcol=j);a.needcellskip=!1};
SocialCalc.CalculateColWidthData=function(a){var b,c,d,e=a.sheetobj;d=a.showRCHeaders?a.rownamewidth-0:0;for(colpane=0;colpane<a.colpanes.length;colpane++)for(b=a.colpanes[colpane].first;b<=a.colpanes[colpane].last;b++){c=SocialCalc.rcColname(b);c=e.colattribs.width[c]||e.attribs.defaultcolwidth||SocialCalc.Constants.defaultColWidth;if("blank"==c||"auto"==c)c="";a.colwidth[b]=c+"";d+=c&&0<c-0?c-0:10}a.totalwidth=d};
SocialCalc.InitializeTable=function(a,b){b.style.borderCollapse="collapse";b.cellSpacing="0";b.cellPadding="0";b.style.width=a.totalwidth+"px"};
SocialCalc.RenderSheet=function(a,b,c){var d,e,g,h;a.sheetobj.changedrendervalues&&(a.needcellskip=!0,a.needprecompute=!0,a.sheetobj.changedrendervalues=!1);a.needcellskip&&a.CalculateCellSkipData();a.needprecompute&&a.PrecomputeSheetFontsAndLayouts();a.CalculateColWidthData();g=document.createElement("table");a.InitializeTable(g);d=a.RenderColGroup();g.appendChild(d);h=document.createElement("tbody");h.appendChild(a.RenderSizingRow());a.showRCHeaders&&(d=a.RenderColHeaders())&&h.appendChild(d);for(e=
0;e<a.rowpanes.length;e++){for(rownum=a.rowpanes[e].first;rownum<=a.rowpanes[e].last;rownum++)d=a.RenderRow(rownum,e,c),h.appendChild(d);e<a.rowpanes.length-1&&(d=a.RenderSpacingRow(),h.appendChild(d))}g.appendChild(h);b&&(a=b.parentNode)&&a.replaceChild(g,b);return g};
SocialCalc.RenderRow=function(a,b,c,d){var e=document.createElement("tr"),g,h,j;a.showRCHeaders&&(h=document.createElement("td"),a.classnames&&(h.className=a.classnames.rowname),a.explicitStyles&&(h.style.cssText=a.explicitStyles.rowname),h.width=a.rownamewidth,h.style.verticalAlign="top",h.innerHTML=b+"",e.appendChild(h));for(j=0;j<a.colpanes.length;j++){for(g=a.colpanes[j].first;g<=a.colpanes[j].last;g++)(h=a.RenderCell(b,g,c,j,null,d))&&e.appendChild(h);j<a.colpanes.length-1&&(h=document.createElement("td"),
h.width=a.defaultpanedividerwidth,a.classnames.panedivider&&(h.className=a.classnames.panedivider),a.explicitStyles.panedivider&&(h.style.cssText=a.explicitStyles.panedivider),g=document.createElement("div"),g.style.width=a.defaultpanedividerwidth+"px",g.style.overflow="hidden",h.appendChild(g),e.appendChild(h))}return e};
SocialCalc.RenderSpacingRow=function(a){var b,c,d,e,g=document.createElement("tr");a.showRCHeaders&&(c=document.createElement("td"),c.width=a.rownamewidth,c.height=a.defaultpanedividerheight,a.classnames.panedivider&&(c.className=a.classnames.panedivider),a.explicitStyles.panedivider&&(c.style.cssText=a.explicitStyles.panedivider),g.appendChild(c));for(d=0;d<a.colpanes.length;d++){for(b=a.colpanes[d].first;b<=a.colpanes[d].last;b++){c=document.createElement("td");if(e=a.colwidth[b])c.width=e;c.height=
a.defaultpanedividerheight;a.classnames.panedivider&&(c.className=a.classnames.panedivider);a.explicitStyles.panedivider&&(c.style.cssText=a.explicitStyles.panedivider);c&&g.appendChild(c)}d<a.colpanes.length-1&&(c=document.createElement("td"),c.width=a.defaultpanedividerwidth,c.height=a.defaultpanedividerheight,a.classnames.panedivider&&(c.className=a.classnames.panedivider),a.explicitStyles.panedivider&&(c.style.cssText=a.explicitStyles.panedivider),g.appendChild(c))}return g};
SocialCalc.RenderColHeaders=function(a){var b=document.createElement("tr"),c,d;if(!a.showRCHeaders)return null;d=document.createElement("td");a.classnames&&(d.className=a.classnames.upperleft);a.explicitStyles&&(d.style.cssText=a.explicitStyles.upperleft);d.width=a.rownamewidth;b.appendChild(d);for(colpane=0;colpane<a.colpanes.length;colpane++){for(c=a.colpanes[colpane].first;c<=a.colpanes[colpane].last;c++)d=document.createElement("td"),a.classnames&&(d.className=a.classnames.colname),a.explicitStyles&&
(d.style.cssText=a.explicitStyles.colname),d.innerHTML=SocialCalc.rcColname(c),b.appendChild(d);colpane<a.colpanes.length-1&&(d=document.createElement("td"),d.width=a.defaultpanedividerwidth,a.classnames.panedivider&&(d.className=a.classnames.panedivider),a.explicitStyles.panedivider&&(d.style.cssText=a.explicitStyles.panedivider),b.appendChild(d))}return b};
SocialCalc.RenderColGroup=function(a){var b,c,d,e,g=document.createElement("colgroup");a.showRCHeaders&&(d=document.createElement("col"),d.width=a.rownamewidth,g.appendChild(d));for(b=0;b<a.colpanes.length;b++){for(c=a.colpanes[b].first;c<=a.colpanes[b].last;c++){d=document.createElement("col");if(e=a.colwidth[c])d.width=e;g.appendChild(d)}b<a.colpanes.length-1&&(d=document.createElement("col"),d.width=a.defaultpanedividerwidth,g.appendChild(d))}return g};
SocialCalc.RenderSizingRow=function(a){var b,c,d,e,g=document.createElement("tr");a.showRCHeaders&&(d=document.createElement("td"),d.style.width=a.rownamewidth+"px",d.height="1",g.appendChild(d));for(b=0;b<a.colpanes.length;b++){for(c=a.colpanes[b].first;c<=a.colpanes[b].last;c++){d=document.createElement("td");if(e=a.colwidth[c])d.width=e;d.height="1";g.appendChild(d)}b<a.colpanes.length-1&&(d=document.createElement("td"),d.width=a.defaultpanedividerwidth,d.height="1",g.appendChild(d))}return g};
SocialCalc.RenderCell=function(a,b,c,d,e,g,h){var j=a.sheetobj,k,l,m,r,p="",b=b-0,c=c-0,n=SocialCalc.crToCoord(c,b);if(a.cellskip[n]){if(a.CoordInPane(a.cellskip[n],d,e))return null;g=g?SocialCalc.CreatePseudoElement():document.createElement("td");a.classnames.skippedcell&&(g.className=a.classnames.skippedcell);a.explicitStyles.skippedcell&&(g.style.cssText=a.explicitStyles.skippedcell);g.innerHTML="&nbsp;";return g}g=g?SocialCalc.CreatePseudoElement():document.createElement("td");a.cellIDprefix&&
(g.id=a.cellIDprefix+n);(m=j.cells[n])||(m=new SocialCalc.Cell(n));r=j.attribs;scc=SocialCalc.Constants;if(1<m.colspan){for(k=l=1;k<m.colspan;k++)"yes"!=j.colattribs.hide[SocialCalc.rcColname(c+k)]&&a.CellInPane(b,c+k,d,e)&&l++;g.colSpan=l}if(1<m.rowspan){for(k=l=1;k<m.rowspan;k++)"yes"!=j.rowattribs.hide[b+k+""]&&a.CellInPane(b+k,c,d,e)&&l++;g.rowSpan=l}void 0==m.displaystring&&(m.displaystring=SocialCalc.FormatValueForDisplay(j,m.datavalue,n,h||a.defaultlinkstyle));g.innerHTML=m.displaystring;p=
(k=m.layout||r.defaultlayout)?p+a.layouts[k]:p+scc.defaultCellLayout;(k=m.font||r.defaultfont)?(h=a.fonts[k],p+="font-style:"+h.style+";font-weight:"+h.weight+";font-size:"+h.size+";font-family:"+h.family+";"):(scc.defaultCellFontSize&&(p+="font-size:"+scc.defaultCellFontSize+";"),scc.defaultCellFontFamily&&(p+="font-family:"+scc.defaultCellFontFamily+";"));(k=m.color||r.defaultcolor)&&(p+="color:"+j.colors[k]+";");(k=m.bgcolor||r.defaultbgcolor)&&(p+="background-color:"+j.colors[k]+";");(k=m.cellformat)?
p+="text-align:"+j.cellformats[k]+";":(h=m.valuetype.charAt(0),"t"==h?(k=r.defaulttextformat)&&(p+="text-align:"+j.cellformats[k]+";"):"n"==h?p=(k=r.defaultnontextformat)?p+("text-align:"+j.cellformats[k]+";"):p+"text-align:right;":p+="text-align:left;");(k=m.bt)&&(p+="border-top:"+j.borderstyles[k]+";");if(k=m.br)p+="border-right:"+j.borderstyles[k]+";";else if(a.showGrid&&(h=a.CellInPane(b,c+(m.colspan||1),d,e)?SocialCalc.crToCoord(c+(m.colspan||1),b):"nomatch",a.cellskip[h]&&(h=a.cellskip[h]),
!j.cells[h]||!j.cells[h].bl))p+="border-right:"+a.gridCSS;if(k=m.bb)p+="border-bottom:"+j.borderstyles[k]+";";else if(a.showGrid&&(h=a.CellInPane(b+(m.rowspan||1),c,d,e)?SocialCalc.crToCoord(c,b+(m.rowspan||1)):"nomatch",a.cellskip[h]&&(h=a.cellskip[h]),!j.cells[h]||!j.cells[h].bt))p+="border-bottom:"+a.gridCSS;(k=m.bl)&&(p+="border-left:"+j.borderstyles[k]+";");m.comment&&(a.showGrid?(a.commentClassName&&(g.className=(g.className?g.className+" ":"")+a.commentClassName),p+=a.commentCSS):(a.commentNoGridClassName&&
(g.className=(g.className?g.className+" ":"")+a.commentNoGridClassName),p+=a.commentNoGridCSS));g.style.cssText=p;if(h=a.highlights[n])"cursor"==h&&(h+=a.cursorsuffix),a.highlightTypes[h].className&&(g.className=(g.className?g.className+" ":"")+a.highlightTypes[h].className),SocialCalc.setStyles(g,a.highlightTypes[h].style);return g};SocialCalc.CoordInPane=function(a,b,c,d){var e=a.coordToCR[b];if(!e||!e.row||!e.col)throw"Bad coordToCR for "+b;return a.CellInPane(e.row,e.col,c,d)};
SocialCalc.CellInPane=function(a,b,c,d,e){var g=a.rowpanes[d],a=a.colpanes[e];if(!g||!a)throw"CellInPane called with unknown panes "+d+"/"+e;return b<g.first||b>g.last||c<a.first||c>a.last?!1:!0};SocialCalc.CreatePseudoElement=function(){return{style:{cssText:""},innerHTML:"",className:""}};SocialCalc.rcColname=function(a){702<a&&(a=702);1>a&&(a=1);var b=(a-1)%26+65;return(a=Math.floor((a-1)/26))?String.fromCharCode(a+64)+String.fromCharCode(b):String.fromCharCode(b)};SocialCalc.letters="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z".split(",");
SocialCalc.crToCoord=function(a,b){1>a&&(a=1);702<a&&(a=702);1>b&&(b=1);var c=(a-1)%26,d=Math.floor((a-1)/26);return d?SocialCalc.letters[d-1]+SocialCalc.letters[c]+b:SocialCalc.letters[c]+b};SocialCalc.coordToCol={};SocialCalc.coordToRow={};
SocialCalc.coordToCr=function(a){var b,c,d,e=SocialCalc.coordToRow[a];if(e)return{row:e,col:SocialCalc.coordToCol[a]};for(c=e=b=0;c<a.length;c++)d=a.charCodeAt(c),36!=d&&(57>=d?e=10*e+d-48:97<=d?b=26*b+d-96:65<=d&&(b=26*b+d-64));SocialCalc.coordToCol[a]=b;SocialCalc.coordToRow[a]=e;return{row:e,col:b}};
SocialCalc.ParseRange=function(a){var b,c,d;a||(a="A1:A1");a=a.toUpperCase();b=a.indexOf(":");0<=b?(c=a.substring(0,b),d=SocialCalc.coordToCr(c),d.coord=c,c=a.substring(b+1),b=SocialCalc.coordToCr(c),b.coord=c):(d=SocialCalc.coordToCr(a),d.coord=a,b=SocialCalc.coordToCr(a),b.coord=a);return{cr1:d,cr2:b}};SocialCalc.decodeFromSave=function(a){if("string"!=typeof a||-1==a.indexOf("\\"))return a;a=a.replace(/\\c/g,":");a=a.replace(/\\n/g,"\n");return a.replace(/\\b/g,"\\")};
SocialCalc.decodeFromAjax=function(a){if("string"!=typeof a||-1==a.indexOf("\\"))return a;a=a.replace(/\\c/g,":");a=a.replace(/\\n/g,"\n");a=a.replace(/\\e/g,"]]");return a.replace(/\\b/g,"\\")};SocialCalc.encodeForSave=function(a){if("string"!=typeof a)return a;-1!=a.indexOf("\\")&&(a=a.replace(/\\/g,"\\b"));-1!=a.indexOf(":")&&(a=a.replace(/:/g,"\\c"));-1!=a.indexOf("\n")&&(a=a.replace(/\n/g,"\\n"));return a};
SocialCalc.special_chars=function(a){/[&<>"]/.test(a)&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/"/g,"&quot;"));return a};SocialCalc.Lookup=function(a,b){for(i=0;i<b.length;i++)if(b[i]>a)return 0<i?i-1:null;return b.length-1};SocialCalc.setStyles=function(a,b){var c,d,e,g;if(b){c=b.split(";");for(d=0;d<c.length;d++)e=c[d].indexOf(":"),-1!=e&&(g=c[d].substring(0,e),e=c[d].substring(e+1),g&&e&&(a.style[g]=e))}};
SocialCalc.GetViewportInfo=function(){var a={};window.innerWidth?(a.width=window.innerWidth,a.height=window.innerHeight,a.horizontalScroll=window.pageXOffset,a.verticalScroll=window.pageYOffset):document.documentElement&&document.documentElement.clientWidth?(a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight,a.horizontalScroll=document.documentElement.scrollLeft,a.verticalScroll=document.documentElement.scrollTop):document.body.clientWidth&&(a.width=document.body.clientWidth,
a.height=document.body.clientHeight,a.horizontalScroll=document.body.scrollLeft,a.verticalScroll=document.body.scrollTop);return a};SocialCalc.GetElementPosition=function(a){for(var b=0,c=0;a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{left:b,top:c}};
SocialCalc.GetElementPositionWithScroll=function(a){for(var b=0,c=0,d=a;a&&"HTML"!=a.tagName;)a==d&&(b+=a.offsetLeft,c+=a.offsetTop,d=a.offsetParent),a.scrollLeft&&(b-=a.scrollLeft),a.scrollTop&&(c-=a.scrollTop),a=a.parentNode;return{left:b,top:c}};SocialCalc.LookupElement=function(a,b){var c;for(c=0;c<b.length;c++)if(b[c].element==a)return b[c];return null};SocialCalc.AssignID=function(a,b,c){a.idPrefix&&(b.id=a.idPrefix+c)};
SocialCalc.GetCellContents=function(a,b){var c="",d=a.cells[b];if(d)switch(d.datatype){case "v":c=d.datavalue+"";break;case "t":c="'"+d.datavalue;break;case "f":c="="+d.formula;break;case "c":c=d.formula}return c};
SocialCalc.FormatValueForDisplay=function(a,b,c,d){var e,g=a.attribs,h=a.cells[c];h||(h=new SocialCalc.Cell(c));c=h.valuetype||"";e=c.substring(1);c=c.charAt(0);if(h.errors||"e"==c)return b=h.errors||e||"Error in cell";if("t"==c){c=a.valueformats[h.textvalueformat-0]||a.valueformats[g.defaulttextvalueformat-0]||"";if("formula"==c)return b="f"==h.datatype?SocialCalc.special_chars("="+h.formula)||"&nbsp;":"c"==h.datatype?SocialCalc.special_chars("'"+h.formula)||"&nbsp;":SocialCalc.special_chars("'"+
b)||"&nbsp;";b=SocialCalc.format_text_for_display(b,h.valuetype,c,a,d)}else if("n"==c){c=h.nontextvalueformat;if(null==c||""==c)c=g.defaultnontextvalueformat;c=a.valueformats[c-0];if(null==c||"none"==c)c="";if("formula"==c)return b="f"==h.datatype?SocialCalc.special_chars("="+h.formula)||"&nbsp;":"c"==h.datatype?SocialCalc.special_chars("'"+h.formula)||"&nbsp;":SocialCalc.special_chars("'"+b)||"&nbsp;";if("forcetext"==c)return b="f"==h.datatype?SocialCalc.special_chars("="+h.formula)||"&nbsp;":"c"==
h.datatype?SocialCalc.special_chars(h.formula)||"&nbsp;":SocialCalc.special_chars(b)||"&nbsp;";b=SocialCalc.format_number_for_display(b,h.valuetype,c)}else b="&nbsp;";return b};
SocialCalc.format_text_for_display=function(a,b,c,d,e){var g,b=b.substring(1);if("none"==c||null==c)c="";/^(text-|custom|hidden)/.test(c)||(c="");if(""==c||"General"==c){"h"==b&&(c="text-html");if("w"==b||"r"==b)c="text-wiki";"l"==b&&(c="text-link");b||(c="text-plain")}"text-html"!=c&&(SocialCalc.Callbacks.expand_wiki&&/^text-wiki/.test(c)?a=SocialCalc.Callbacks.expand_wiki(a,d,e,c):"text-wiki"==c?a=SocialCalc.special_chars(a):"text-wiki"==c?a=SocialCalc.Callbacks.expand_markup&&SocialCalc.Callbacks.expand_markup(a,
d,e)||SocialCalc.special_chars(a):"text-url"==c?(d=SocialCalc.special_chars(a),e=encodeURI(a),a='<a href="'+e+'">'+d+"</a>"):"text-link"==c?a=SocialCalc.expand_text_link(a,d,e,c):"text-image"==c?(e=encodeURI(a),a='<img src="'+e+'">'):"text-custom:"==c.substring(0,12)?(d=SocialCalc.special_chars(a),d=d.replace(/  /g,"&nbsp; "),d=d.replace(/\n/g,"<br>"),e=encodeURI(a),g={},g.r=a,g.s=d,g.u=e,a=c.substring(12),a=a.replace(/@(r|s|u)/g,function(a,b){return g[b]})):"custom"==c.substring(0,6)?(a=SocialCalc.special_chars(a),
a=a.replace(/  /g,"&nbsp; "),a=a.replace(/\n/g,"<br>"),a+=" (custom format)"):"hidden"==c?a="&nbsp;":(a=SocialCalc.special_chars(a),a=a.replace(/  /g,"&nbsp; "),a=a.replace(/\n/g,"<br>")));return a};
SocialCalc.format_number_for_display=function(a,b,c){var d,e=SocialCalc.Constants;d=a-0;b=b.substring(1);if("Auto"==c||""==c)c="%"==b?"#,##0.0%":"$"==b?"[$]#,##0.00":"dt"==b?e.defaultFormatdt:"d"==b?e.defaultFormatd:"t"==b?e.defaultFormatt:"l"==b?"logical":"General";return"logical"==c?d?e.defaultDisplayTRUE:e.defaultDisplayFALSE:"hidden"==c?"&nbsp;":SocialCalc.FormatNumber.formatNumberWithFormat(a,c,"")};
SocialCalc.DetermineValueType=function(a){var b=a+"",c="t",d,e;d=b.replace(/^\s+/,"");d=d.replace(/\s+$/,"");if(0==b.length)c="";else if(!b.match(/^\s+$/))if(d.match(/^[-+]?\d*(?:\.)?\d*(?:[eE][-+]?\d+)?$/))b=d-0,isNaN(b)?b=a+"":c="n";else if(d.match(/^[-+]?\d*(?:\.)?\d*\s*%$/))b=(d.slice(0,-1)-0)/100,c="n%";else if(d.match(/^[-+]?\$\s*\d*(?:\.)?\d*\s*$/)&&d.match(/\d/))b=d.replace(/\$/,"")-0,c="n$";else if(d.match(/^[-+]?(\d*,\d*)+(?:\.)?\d*$/))b=d.replace(/,/g,"")-0,c="n";else if(d.match(/^[-+]?(\d*,\d*)+(?:\.)?\d*\s*%$/))b=
(d.replace(/[%,]/g,"")-0)/100,c="n%";else if(d.match(/^[-+]?\$\s*(\d*,\d*)+(?:\.)?\d*$/)&&d.match(/\d/))b=d.replace(/[\$,]/g,"")-0,c="n$";else if(a=b.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{1,4})\s*$/))b=a[3]-0,b=SocialCalc.FormatNumber.convert_date_gregorian_to_julian(1E3>b?b+2E3:b,a[1]-0,a[2]-0)-2415019,c="nd";else if(a=b.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})\s*$/))b=a[1]-0,b=SocialCalc.FormatNumber.convert_date_gregorian_to_julian(1E3>b?b+2E3:b,a[2]-0,a[3]-0)-2415019,c="nd";else if(a=
b.match(/^(\d{1,2}):(\d{1,2})\s*$/))d=a[1]-0,e=a[2]-0,24>d&&60>e&&(b=d/24+e/1440,c="nt");else if(a=b.match(/^(\d{1,2}):(\d{1,2}):(\d{1,2})\s*$/))d=a[1]-0,e=a[2]-0,a=a[3]-0,24>d&&60>e&&60>a&&(b=d/24+e/1440+a/86400,c="nt");else if(a=b.match(/^\s*([-+]?\d+) (\d+)\/(\d+)\s*$/)){if(e=a[1]-0,d=a[2]-0,(a=a[3]-0)&&0<a)b=e+(0>e?-d/a:d/a),c="n"}else(a=SocialCalc.InputConstants[b.toUpperCase()])?(d=a.indexOf(","),b=a.substring(0,d)-0,c=a.substring(d+1)):7<d.length&&"http://"==d.substring(0,7).toLowerCase()&&
(b=d,c="tl");return{value:b,type:c}};SocialCalc.InputConstants={TRUE:"1,nl",FALSE:"0,nl","#N/A":"0,e#N/A","#NULL!":"0,e#NULL!","#NUM!":"0,e#NUM!","#DIV/0!":"0,e#DIV/0!","#VALUE!":"0,e#VALUE!","#REF!":"0,e#REF!","#NAME?":"0,e#NAME?"};SocialCalc.default_expand_markup=function(a){a=SocialCalc.special_chars(a);a=a.replace(/  /g,"&nbsp; ");return a=a.replace(/\n/g,"<br>")};
SocialCalc.expand_text_link=function(a,b,c,d){var e;e=SocialCalc.Constants;var b="",g=SocialCalc.ParseCellLinkText(a+"");e=g.desc?SocialCalc.special_chars(g.desc):g.pagename?e.defaultPageLinkFormatString:e.defaultLinkFormatString;7<a.length&&"http://"==a.substring(0,7).toLowerCase()&&">"!=a.charAt(a.length-1)&&(e=e.substring(7));a=g.newwin||!c?' target="_blank"':"";g.pagename?SocialCalc.Callbacks.MakePageLink&&(b=SocialCalc.Callbacks.MakePageLink(g.pagename,g.workspacename,c,d)):b=encodeURI(g.url);
return'<a href="'+b+'"'+a+">"+e+"</a>"};
SocialCalc.ParseCellLinkText=function(a){var b={url:"",desc:"",newwin:!1,pagename:"",workspace:""},c=!1,d=a.length-1,e=0,g=a.lastIndexOf("<"),h=a.lastIndexOf("["),j=a.lastIndexOf("{"),k=-1;if((">"!=a.charAt(d)||-1==g)&&("]"!=a.charAt(d)||-1==h)&&("}"!=a.charAt(d)||"]"!=a.charAt(d-1)||-1==j||-1==h||h<j))d++,k=d;else if(">"==a.charAt(d)?(k=g-1,0<g&&"<"==a.charAt(k)&&">"==a.charAt(d-1)&&(k--,d--,b.newwin=!0)):"]"==a.charAt(d)?(k=h-1,c=!0,0<h&&"["==a.charAt(k)&&"]"==a.charAt(d-1)&&(k--,d--,b.newwin=!0)):
"}"==a.charAt(d)&&(k=j-1,c=!0,wsend=h,d--,0<h&&"["==a.charAt(h-1)&&"]"==a.charAt(d-1)&&(wsend=h-1,d--,b.newwin=!0)," "==a.charAt(wsend-1)&&wsend--,b.workspace=a.substring(j+1,wsend)||"")," "==a.charAt(k)&&k--,'"'==a.charAt(e)&&'"'==a.charAt(k))e++,k--;c?b.pagename=a.substring(h+1,d)||"":b.url=a.substring(g+1,d)||"";k>=e&&(b.desc=a.substring(e,k+1));return b};
SocialCalc.ConvertSaveToOtherFormat=function(a,b,c){var d,e,g,h;e="";if("scsave"==b)return a;if(""==a)return"";d=new SocialCalc.Sheet;d.ParseSheetSave(a);if(c)throw"SocialCalc.ConvertSaveToOtherFormat: Not doing recalc.";a=d.copiedfrom?SocialCalc.ParseRange(d.copiedfrom):{cr1:{row:1,col:1},cr2:{row:d.attribs.lastrow,col:d.attribs.lastcol}};if("html"==b)return e=new SocialCalc.RenderContext(d),d.copiedfrom&&(e.rowpanes[0]={first:a.cr1.row,last:a.cr2.row},e.colpanes[0]={first:a.cr1.col,last:a.cr2.col}),
b=document.createElement("div"),a=e.RenderSheet(null,e.defaultHTMLlinkstyle),b.appendChild(a),delete e,delete d,e=b.innerHTML,delete a,delete b,e;for(c=a.cr1.row;c<=a.cr2.row;c++){for(g=a.cr1.col;g<=a.cr2.col;g++)h=SocialCalc.crToCoord(g,c),h=d.GetAssuredCell(h),h=h.errors?h.errors:h.datavalue+"","csv"==b?(-1!=h.indexOf('"')&&(h=h.replace(/"/g,'""')),/[, \n"]/.test(h)&&(h='"'+h+'"'),g>a.cr1.col&&(h=","+h)):"tab"==b&&(-1!=h.indexOf("\n")&&(-1!=h.indexOf('"')&&(h=h.replace(/"/g,'""')),h='"'+h+'"'),
g>a.cr1.col&&(h="\t"+h)),e+=h;e+="\n"}return e};
SocialCalc.ConvertOtherFormatToSave=function(a,b){var c,d,e,g,h,j,k,l,m,r,p,n,s="",q=function(){r++;r>n&&(n=r);p=SocialCalc.crToCoord(r,m);SocialCalc.SetConvertedCell(c,p,h);h=""};if("scsave"==b)return a;c=new SocialCalc.Sheet;d=a.split(/\r\n|\n/);n=0;if("csv"==b){m=0;j=!1;for(e=0;e<d.length&&!(e==d.length-1&&""==d[e]);e++){j?h+="\n":(h="",m++,r=0);g=d[e];for(k=0;k<g.length;k++)l=g.charAt(k),'"'==l?j?k<g.length-1&&'"'==g.charAt(k+1)?(k++,h+='"'):(j=!1,k==g.length-1&&q()):j=!0:(","==l&&!j?q():h+=l,
k==g.length-1&&!j&&q())}0<n&&(c.attribs.lastrow=m,c.attribs.lastcol=n,s=c.CreateSheetSave("A1:"+SocialCalc.crToCoord(n,m)))}if("tab"==b){m=0;j=!1;for(e=0;e<d.length&&!(e==d.length-1&&""==d[e]);e++){j?h+="\n":(h="",m++,r=0);g=d[e];for(k=0;k<g.length;k++){l=g.charAt(k);if('"'==l){if(j){k<g.length-1?'"'==g.charAt(k+1)?(k++,h+='"'):"\t"==g.charAt(k+1)&&(k++,j=!1,q()):(j=!1,q());continue}if(""==h){j=!0;continue}}"\t"==l&&!j?q():h+=l;k==g.length-1&&!j&&q()}}0<n&&(c.attribs.lastrow=m,c.attribs.lastcol=n,
s=c.CreateSheetSave("A1:"+SocialCalc.crToCoord(n,m)))}return s};SocialCalc.SetConvertedCell=function(a,b,c){a=a.GetAssuredCell(b);b=SocialCalc.DetermineValueType(c);"n"==b.type&&b.value==c?(a.datatype="v",a.valuetype="n",a.datavalue=b.value):"t"==b.type.charAt(0)?(a.datatype="t",a.valuetype=b.type,a.datavalue=b.value):(a.datatype="c",a.valuetype=b.type,a.datavalue=b.value,a.formula=c)};SocialCalc||(SocialCalc={});
SocialCalc.TableEditor=function(a){var b=SocialCalc.Constants;this.context=a;this.fullgrid=this.toplevel=null;this.noEdit=!1;this.timeout=this.cellhandles=this.logo=this.horizontaltablecontrol=this.verticaltablecontrol=this.inputEcho=this.inputBox=this.tableheight=this.height=this.tablewidth=this.width=null;this.ensureecell=this.busy=!1;this.deferredCommands=[];this.lastvisiblecol=this.lastnonscrollingcol=this.firstscrollingcolleft=this.firstscrollingcol=this.lastvisiblerow=this.lastnonscrollingrow=
this.firstscrollingrowtop=this.firstscrollingrow=this.headposition=this.gridposition=null;this.rowpositions=[];this.colpositions=[];this.rowheight=[];this.colwidth=[];this.ecell=null;this.state="start";this.workingvalues={};this.imageprefix=b.defaultImagePrefix;this.idPrefix=b.defaultTableEditorIDPrefix;this.pageUpDnAmount=b.defaultPageUpDnAmount;this.recalcFunction=function(a){if(a.context.sheetobj.RecalcSheet)a.context.sheetobj.RecalcSheet(SocialCalc.EditorSheetStatusCallback,a);else return null};
this.ctrlkeyFunction=function(a,b){var e,g,h,j,k;switch(b){case "[ctrl-c]":case "[ctrl-x]":e=a.pasteTextarea;e.value="";if(h=SocialCalc.GetEditorCellElement(a,a.ecell.row,a.ecell.col))h=SocialCalc.GetElementPosition(h.element),e.style.left=h.left-1+"px",e.style.top=h.top-1+"px";k=a.range.hasrange?SocialCalc.crToCoord(a.range.left,a.range.top)+":"+SocialCalc.crToCoord(a.range.right,a.range.bottom):a.ecell.coord;h=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.CreateSheetSave(a.context.sheetobj,k),
"tab");j="[ctrl-c]"==b||a.noEdit?"copy "+k+" formulas":"cut "+k+" formulas";a.EditorScheduleSheetCommands(j,!0,!1);e.style.display="block";e.value=h;e.focus();e.select();window.setTimeout(function(){if(SocialCalc.GetSpreadsheetControlObject){var a=SocialCalc.GetSpreadsheetControlObject();a&&(a=a.editor.pasteTextarea,a.blur(),a.style.display="none",SocialCalc.KeyboardFocus())}},200);break;case "[ctrl-v]":if(a.noEdit)break;if(g=a.pasteHTMLarea)g.style.visibility="visible",g.focus();else{e=a.pasteTextarea;
e.value="";if(h=SocialCalc.GetEditorCellElement(a,a.ecell.row,a.ecell.col))h=SocialCalc.GetElementPosition(h.element),e.style.left=h.left-1+"px",e.style.top=h.top-1+"px";e.style.display="block";e.value="";e.focus()}window.setTimeout(function(){if(SocialCalc.GetSpreadsheetControlObject){var a=SocialCalc.GetSpreadsheetControlObject();if(a){var a=a.editor,b=null,c=!1;if(g=a.pasteHTMLarea){var b=String.fromCharCode(65532),d=g.innerHTML;g.innerHTML=0<=d.search(/<(?![Bb][Rr])[A-Za-z]/)?d.replace(/(?:<\/[Tt][Dd]>)/g,
b):d.replace(/&[Nn][Bb][Ss][Pp];/g,b);b=g.innerText.replace(RegExp(b,"g"),"\t");g.innerHTML="";g.blur();g.style.visibility="hidden"}else d=a.pasteTextarea,b=d.value,d.blur(),d.style.display="none";b=b.replace(/\r\n/g,"\n").replace(/\n?$/,"\n");d=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard,"tab");if(b==d||1==b.length-d.length&&b.substring(0,b.length-1)==d)c=!0;d="";c||(d="loadclipboard "+SocialCalc.encodeForSave(SocialCalc.ConvertOtherFormatToSave(b,"tab"))+"\n");c=a.range.hasrange?
SocialCalc.crToCoord(a.range.left,a.range.top):a.ecell.coord;a.EditorScheduleSheetCommands(d+("paste "+c+" formulas"),!0,!1);SocialCalc.KeyboardFocus()}}},200);break;case "[ctrl-z]":return a.EditorScheduleSheetCommands("undo",!0,!1),!1;case "[ctrl-s]":return window.setTimeout(function(){if(SocialCalc.GetSpreadsheetControlObject){var a=SocialCalc.GetSpreadsheetControlObject();if(a){var a=a.editor,b=a.context.sheetobj,c=b.GetAssuredCell(a.ecell.coord),b=window.prompt("Advanced Feature:\n\nCustom Numeric Format or Command",
c.nontextvalueformat?b.valueformats[c.nontextvalueformat-0]||"":"");if(null!=b){if(b.match(/^cmd:/))j=b.substring(4);else{if(b.match(/^edit:/)){j=b.substring(5);SocialCalc.CtrlSEditor&&SocialCalc.CtrlSEditor(j);return}k=a.range.hasrange?SocialCalc.crToCoord(a.range.left,a.range.top)+":"+SocialCalc.crToCoord(a.range.right,a.range.bottom):a.ecell.coord;j="set "+k+" nontextvalueformat "+b}a.EditorScheduleSheetCommands(j,!0,!1)}}}},200),!1}return!0};a.sheetobj.statuscallback=SocialCalc.EditorSheetStatusCallback;
a.sheetobj.statuscallbackparams=this;this.StatusCallback={};this.MoveECellCallback={};this.RangeChangeCallback={};this.SettingsCallbacks={};this.ecell={coord:"A1",row:1,col:1};a.highlights[this.ecell.coord]="cursor";this.range={hasrange:!1};this.range2={hasrange:!1}};SocialCalc.TableEditor.prototype.CreateTableEditor=function(a,b){return SocialCalc.CreateTableEditor(this,a,b)};SocialCalc.TableEditor.prototype.ResizeTableEditor=function(a,b){return SocialCalc.ResizeTableEditor(this,a,b)};
SocialCalc.TableEditor.prototype.SaveEditorSettings=function(){return SocialCalc.SaveEditorSettings(this)};SocialCalc.TableEditor.prototype.LoadEditorSettings=function(a,b){return SocialCalc.LoadEditorSettings(this,a,b)};SocialCalc.TableEditor.prototype.EditorRenderSheet=function(){SocialCalc.EditorRenderSheet(this)};SocialCalc.TableEditor.prototype.EditorScheduleSheetCommands=function(a,b,c){SocialCalc.EditorScheduleSheetCommands(this,a,b,c)};
SocialCalc.TableEditor.prototype.ScheduleSheetCommands=function(a,b){this.context.sheetobj.ScheduleSheetCommands(a,b)};SocialCalc.TableEditor.prototype.SheetUndo=function(){this.context.sheetobj.SheetUndo()};SocialCalc.TableEditor.prototype.SheetRedo=function(){this.context.sheetobj.SheetRedo()};SocialCalc.TableEditor.prototype.EditorStepSet=function(a,b){SocialCalc.EditorStepSet(this,a,b)};
SocialCalc.TableEditor.prototype.GetStatuslineString=function(a,b,c){return SocialCalc.EditorGetStatuslineString(this,a,b,c)};SocialCalc.TableEditor.prototype.EditorMouseRegister=function(){return SocialCalc.EditorMouseRegister(this)};SocialCalc.TableEditor.prototype.EditorMouseUnregister=function(){return SocialCalc.EditorMouseUnregister(this)};SocialCalc.TableEditor.prototype.EditorMouseRange=function(a){return SocialCalc.EditorMouseRange(this,a)};
SocialCalc.TableEditor.prototype.EditorProcessKey=function(a,b){return SocialCalc.EditorProcessKey(this,a,b)};SocialCalc.TableEditor.prototype.EditorAddToInput=function(a,b){return SocialCalc.EditorAddToInput(this,a,b)};SocialCalc.TableEditor.prototype.DisplayCellContents=function(){return SocialCalc.EditorDisplayCellContents(this)};SocialCalc.TableEditor.prototype.EditorSaveEdit=function(a){return SocialCalc.EditorSaveEdit(this,a)};
SocialCalc.TableEditor.prototype.EditorApplySetCommandsToRange=function(a,b){return SocialCalc.EditorApplySetCommandsToRange(this,a,b)};SocialCalc.TableEditor.prototype.MoveECellWithKey=function(a){return SocialCalc.MoveECellWithKey(this,a)};SocialCalc.TableEditor.prototype.MoveECell=function(a){return SocialCalc.MoveECell(this,a)};SocialCalc.TableEditor.prototype.ReplaceCell=function(a,b,c){SocialCalc.ReplaceCell(this,a,b,c)};
SocialCalc.TableEditor.prototype.UpdateCellCSS=function(a,b,c){SocialCalc.UpdateCellCSS(this,a,b,c)};SocialCalc.TableEditor.prototype.SetECellHeaders=function(a){SocialCalc.SetECellHeaders(this,a)};SocialCalc.TableEditor.prototype.EnsureECellVisible=function(){SocialCalc.EnsureECellVisible(this)};SocialCalc.TableEditor.prototype.RangeAnchor=function(a){SocialCalc.RangeAnchor(this,a)};SocialCalc.TableEditor.prototype.RangeExtend=function(a){SocialCalc.RangeExtend(this,a)};
SocialCalc.TableEditor.prototype.RangeRemove=function(){SocialCalc.RangeRemove(this)};SocialCalc.TableEditor.prototype.Range2Remove=function(){SocialCalc.Range2Remove(this)};SocialCalc.TableEditor.prototype.FitToEditTable=function(){SocialCalc.FitToEditTable(this)};SocialCalc.TableEditor.prototype.CalculateEditorPositions=function(){SocialCalc.CalculateEditorPositions(this)};SocialCalc.TableEditor.prototype.ScheduleRender=function(){SocialCalc.ScheduleRender(this)};
SocialCalc.TableEditor.prototype.DoRenderStep=function(){SocialCalc.DoRenderStep(this)};SocialCalc.TableEditor.prototype.SchedulePositionCalculations=function(){SocialCalc.SchedulePositionCalculations(this)};SocialCalc.TableEditor.prototype.DoPositionCalculations=function(){SocialCalc.DoPositionCalculations(this)};SocialCalc.TableEditor.prototype.CalculateRowPositions=function(a,b,c){return SocialCalc.CalculateRowPositions(this,a,b,c)};
SocialCalc.TableEditor.prototype.CalculateColPositions=function(a,b,c){return SocialCalc.CalculateColPositions(this,a,b,c)};SocialCalc.TableEditor.prototype.ScrollRelative=function(a,b){SocialCalc.ScrollRelative(this,a,b)};SocialCalc.TableEditor.prototype.ScrollRelativeBoth=function(a,b){SocialCalc.ScrollRelativeBoth(this,a,b)};SocialCalc.TableEditor.prototype.PageRelative=function(a,b){SocialCalc.PageRelative(this,a,b)};SocialCalc.TableEditor.prototype.LimitLastPanes=function(){SocialCalc.LimitLastPanes(this)};
SocialCalc.TableEditor.prototype.ScrollTableUpOneRow=function(){return SocialCalc.ScrollTableUpOneRow(this)};SocialCalc.TableEditor.prototype.ScrollTableDownOneRow=function(){return SocialCalc.ScrollTableDownOneRow(this)};SocialCalc.TableEditor.prototype.ScrollTableLeftOneCol=function(){return SocialCalc.ScrollTableLeftOneCol(this)};SocialCalc.TableEditor.prototype.ScrollTableRightOneCol=function(){return SocialCalc.ScrollTableRightOneCol(this)};
SocialCalc.CreateTableEditor=function(a,b,c){var d=SocialCalc.Constants,e=SocialCalc.AssignID;a.toplevel=document.createElement("div");a.width=b;a.height=c;a.griddiv=document.createElement("div");a.tablewidth=Math.max(0,b-d.defaultTableControlThickness);a.tableheight=Math.max(0,c-d.defaultTableControlThickness);a.griddiv.style.width=a.tablewidth+"px";a.griddiv.style.height=a.tableheight+"px";a.griddiv.style.overflow="hidden";a.griddiv.style.cursor="default";d.cteGriddivClass&&(a.griddiv.className=
d.cteGriddivClass);e(a,a.griddiv,"griddiv");a.FitToEditTable();a.EditorRenderSheet();a.griddiv.appendChild(a.fullgrid);a.verticaltablecontrol=new SocialCalc.TableControl(a,!0,a.tableheight);a.verticaltablecontrol.CreateTableControl();e(a,a.verticaltablecontrol.main,"tablecontrolv");a.horizontaltablecontrol=new SocialCalc.TableControl(a,!1,a.tablewidth);a.horizontaltablecontrol.CreateTableControl();e(a,a.horizontaltablecontrol.main,"tablecontrolh");c=document.createElement("table");a.layouttable=c;
c.cellSpacing=0;c.cellPadding=0;e(a,c,"layouttable");b=document.createElement("tbody");c.appendChild(b);c=document.createElement("tr");b.appendChild(c);d=document.createElement("td");d.appendChild(a.griddiv);c.appendChild(d);d=document.createElement("td");d.appendChild(a.verticaltablecontrol.main);c.appendChild(d);c=document.createElement("tr");b.appendChild(c);d=document.createElement("td");d.appendChild(a.horizontaltablecontrol.main);c.appendChild(d);d=document.createElement("td");d.style.background=
"url("+a.imageprefix+"logo.gif) no-repeat center center";d.innerHTML="<div style='cursor:pointer;font-size:1px;'><img src='"+a.imageprefix+"1x1.gif' border='0' width='18' height='18'></div>";c.appendChild(d);a.logo=d;e(a,a.logo,"logo");SocialCalc.TooltipRegister(d.firstChild.firstChild,"SocialCalc",null);a.toplevel.appendChild(a.layouttable);a.noEdit||(a.inputEcho=new SocialCalc.InputEcho(a),e(a,a.inputEcho.main,"inputecho"));a.cellhandles=new SocialCalc.CellHandles(a);b=document.createElement("textarea");
SocialCalc.setStyles(b,"display:none;position:absolute;height:1px;width:1px;opacity:0;filter:alpha(opacity=0);");b.value="";a.pasteTextarea=b;e(a,a.pasteTextarea,"pastetextarea");navigator.userAgent.match(/Safari\//)&&!navigator.userAgent.match(/Chrome\//)&&(window.removeEventListener("beforepaste",SocialCalc.SafariPasteFunction,!1),window.addEventListener("beforepaste",SocialCalc.SafariPasteFunction,!1),window.removeEventListener("beforecopy",SocialCalc.SafariPasteFunction,!1),window.addEventListener("beforecopy",
SocialCalc.SafariPasteFunction,!1),window.removeEventListener("beforecut",SocialCalc.SafariPasteFunction,!1),window.addEventListener("beforecut",SocialCalc.SafariPasteFunction,!1));a.toplevel.appendChild(a.pasteTextarea);b=document.createElement("div");b.innerHTML="    <br/>";1==b.firstChild.nodeType&&(b=document.createElement("div"),a.pasteHTMLarea=b,a.toplevel.appendChild(a.pasteHTMLarea),b.contentEditable=!0,e(a,a.pasteHTMLarea,"pastehtmlarea"),SocialCalc.setStyles(b,"display:block;visibility:hidden;position:absolute;height:1px;width:1px;opacity:0;filter:alpha(opacity=0);overflow:hidden"));
SocialCalc.MouseWheelRegister(a.toplevel,{WheelMove:SocialCalc.EditorProcessMouseWheel,editor:a});a.inputBox&&a.inputBox.element&&(a.inputBox.element.focus(),a.inputBox.element.blur());SocialCalc.KeyboardSetFocus(a);SocialCalc.EditorSheetStatusCallback(null,"startup",null,a);return a.toplevel};SocialCalc.SafariPasteFunction=function(a){a.preventDefault()};
SocialCalc.ResizeTableEditor=function(a,b,c){var d=SocialCalc.Constants;a.width=b;a.height=c;a.toplevel.style.width=b+"px";a.toplevel.style.height=c+"px";a.tablewidth=Math.max(0,b-d.defaultTableControlThickness);a.tableheight=Math.max(0,c-d.defaultTableControlThickness);a.griddiv.style.width=a.tablewidth+"px";a.griddiv.style.height=a.tableheight+"px";a.verticaltablecontrol.main.style.height=a.tableheight+"px";a.horizontaltablecontrol.main.style.width=a.tablewidth+"px";a.FitToEditTable();a.ScheduleRender()};
SocialCalc.SaveEditorSettings=function(a){var b,c,d=a.context,e=a.range,g;g="version:1.0\n";for(b=0;b<d.rowpanes.length;b++)g+="rowpane:"+b+":"+d.rowpanes[b].first+":"+d.rowpanes[b].last+"\n";for(b=0;b<d.colpanes.length;b++)g+="colpane:"+b+":"+d.colpanes[b].first+":"+d.colpanes[b].last+"\n";a.ecell&&(g+="ecell:"+a.ecell.coord+"\n");e.hasrange&&(g+="range:"+e.anchorcoord+":"+e.top+":"+e.bottom+":"+e.left+":"+e.right+"\n");for(c in a.SettingsCallbacks)g+=a.SettingsCallbacks[c].save(a,c);return g};
SocialCalc.LoadEditorSettings=function(a,b,c){var b=b.split(/\r\n|\n/),d=[],e,g,h,j=a.context,k,l;j.rowpanes=[{first:1,last:1}];j.colpanes=[{first:1,last:1}];a.ecell=null;a.range={hasrange:!1};a.range2={hasrange:!1};l=a.range;j.highlights={};k=j.highlights;for(g=0;g<b.length;g++)switch(e=b[g],d=e.split(":"),h=d[0],h){case "version":break;case "rowpane":j.rowpanes[d[1]-0]={first:d[2]-0,last:d[3]-0};break;case "colpane":j.colpanes[d[1]-0]={first:d[2]-0,last:d[3]-0};break;case "ecell":a.ecell=SocialCalc.coordToCr(d[1]);
a.ecell.coord=d[1];k[d[1]]="cursor";break;case "range":l.hasrange=!0;l.anchorcoord=d[1];e=SocialCalc.coordToCr(l.anchorcoord);l.anchorrow=e.row;l.anchorcol=e.col;l.top=d[2]-0;l.bottom=d[3]-0;l.left=d[4]-0;l.right=d[5]-0;for(d=l.top;d<=l.bottom;d++)for(e=l.left;e<=l.right;e++)h=SocialCalc.crToCoord(e,d),"cursor"!=k[h]&&(k[h]="range");break;default:a.SettingsCallbacks[h]&&a.SettingsCallbacks[h].load(a,h,e,c)}};
SocialCalc.EditorRenderSheet=function(a){a.EditorMouseUnregister();a.fullgrid=a.context.RenderSheet(a.fullgrid);a.ecell&&a.SetECellHeaders("selected");SocialCalc.AssignID(a,a.fullgrid,"fullgrid");a.EditorMouseRegister()};
SocialCalc.EditorScheduleSheetCommands=function(a,b,c,d){if("start"==a.state||d)if(a.busy&&!d)a.deferredCommands.push({cmdstr:b,saveundo:c});else switch(b){case "recalc":case "redisplay":a.context.sheetobj.ScheduleSheetCommands(b,!1);break;case "undo":a.SheetUndo();break;case "redo":a.SheetRedo();break;default:a.context.sheetobj.ScheduleSheetCommands(b,c)}};
SocialCalc.EditorSheetStatusCallback=function(a,b,c,d){var e,a=d.context.sheetobj,g=function(a){for(e in d.StatusCallback)d.StatusCallback[e].func&&d.StatusCallback[e].func(d,a,c,d.StatusCallback[e].params)};switch(b){case "startup":break;case "cmdstart":d.busy=!0;a.celldisplayneeded="";break;case "cmdextension":break;case "cmdend":g(b);a.changedrendervalues&&(d.context.PrecomputeSheetFontsAndLayouts(),d.context.CalculateCellSkipData(),a.changedrendervalues=!1);a.celldisplayneeded&&!a.renderneeded&&
(cr=SocialCalc.coordToCr(a.celldisplayneeded),b=SocialCalc.GetEditorCellElement(d,cr.row,cr.col),d.ReplaceCell(b,cr.row,cr.col));if(d.deferredCommands.length){b=d.deferredCommands.shift();d.EditorScheduleSheetCommands(b.cmdstr,b.saveundo,!0);return}a.attribs.needsrecalc&&("off"!=a.attribs.recalc||a.recalconce)&&d.recalcFunction?(d.FitToEditTable(),a.renderneeded=!1,a.recalconce&&delete a.recalconce,d.recalcFunction(d)):a.renderneeded?(d.FitToEditTable(),a.renderneeded=!1,d.ScheduleRender()):d.SchedulePositionCalculations();
return;case "calcstart":d.busy=!0;break;case "calccheckdone":case "calcorder":case "calcstep":case "calcloading":case "calcserverfunc":break;case "calcfinished":g(b);d.ScheduleRender();return;case "schedrender":d.busy=!0;break;case "renderdone":break;case "schedposcalc":d.busy=!0;break;case "doneposcalc":d.deferredCommands.length?(g(b),b=d.deferredCommands.shift(),d.EditorScheduleSheetCommands(b.cmdstr,b.saveundo,!0)):(d.busy=!1,g(b),"start"==d.state&&d.DisplayCellContents());return;default:addmsg("Unknown status: "+
b)}g(b)};SocialCalc.EditorStepInfo={editor:null};
SocialCalc.EditorGetStatuslineString=function(a,b,c,d){var e=SocialCalc.Constants,g,h,j;g="";switch(b){case "moveecell":case "rangechange":case "startup":break;case "cmdstart":d.command=!0;document.body.style.cursor="progress";a.griddiv.style.cursor="progress";g=e.s_statusline_executing;break;case "cmdextension":g="Command Extension: "+c;break;case "cmdend":d.command=!1;break;case "schedrender":g=e.s_statusline_displaying;break;case "renderdone":g=" ";break;case "schedposcalc":g=e.s_statusline_displaying;
break;case "cmdendnorender":case "doneposcalc":document.body.style.cursor="default";a.griddiv.style.cursor="default";break;case "calcorder":g=e.s_statusline_ordering+Math.floor(100*c.count/(c.total||1))+"%";break;case "calcstep":g=e.s_statusline_calculating+Math.floor(100*c.count/(c.total||1))+"%";break;case "calcloading":g=e.s_statusline_calculatingls+": "+c.sheetname;break;case "calcserverfunc":g=e.s_statusline_calculating+Math.floor(100*c.count/(c.total||1))+"%, "+e.s_statusline_doingserverfunc+
c.funcname+e.s_statusline_incell+c.coord;break;case "calcstart":d.calculating=!0;document.body.style.cursor="progress";a.griddiv.style.cursor="progress";g=e.s_statusline_calcstart;break;case "calccheckdone":break;case "calcfinished":d.calculating=!1;break;default:g=b}!g&&d.calculating&&(g=e.s_statusline_calculating);if(!d.calculating&&!d.command&&!g&&a.range.hasrange&&(a.range.left!=a.range.right||a.range.top!=a.range.bottom)){b=0;for(c=a.range.top;c<=a.range.bottom;c++)for(h=a.range.left;h<=a.range.right;h++)(j=
a.context.sheetobj.cells[SocialCalc.crToCoord(h,c)])&&j.valuetype&&"n"==j.valuetype.charAt(0)&&(b+=j.datavalue-0);b=SocialCalc.FormatNumber.formatNumberWithFormat(b,"[,]General","");c=SocialCalc.crToCoord(a.range.left,a.range.top)+":"+SocialCalc.crToCoord(a.range.right,a.range.bottom);g=c+" ("+(a.range.right-a.range.left+1)+"x"+(a.range.bottom-a.range.top+1)+") "+e.s_statusline_sum+"="+b+" "+g}g=a.ecell.coord+" &nbsp; "+g;!d.calculating&&"yes"==a.context.sheetobj.attribs.needsrecalc&&(g+=" &nbsp; "+
e.s_statusline_recalcneeded);if(a=a.context.sheetobj.attribs.circularreferencecell)a=a.replace(/\|/," referenced by "),g+=" &nbsp; "+e.s_statusline_circref+a+"</span>";return g};SocialCalc.EditorMouseInfo={registeredElements:[],editor:null,element:null,ignore:!1,mousedowncoord:"",mouselastcoord:"",mouseresizecol:"",mouseresizeclientx:null,mouseresizedisplay:null};
SocialCalc.EditorMouseRegister=function(a){var b=SocialCalc.EditorMouseInfo,c=a.fullgrid,d;for(d=0;d<b.registeredElements.length;d++)if(b.registeredElements[d].editor==a){if(b.registeredElements[d].element==c)return;break}d<b.registeredElements.length?b.registeredElements[d].element=c:b.registeredElements.push({element:c,editor:a});if(c.addEventListener)c.addEventListener("mousedown",SocialCalc.ProcessEditorMouseDown,!1),c.addEventListener("dblclick",SocialCalc.ProcessEditorDblClick,!1);else if(c.attachEvent)c.attachEvent("onmousedown",
SocialCalc.ProcessEditorMouseDown),c.attachEvent("ondblclick",SocialCalc.ProcessEditorDblClick);else throw"Browser not supported";b.ignore=!1};
SocialCalc.EditorMouseUnregister=function(a){var b=SocialCalc.EditorMouseInfo,c;for(c=0;c<b.registeredElements.length&&b.registeredElements[c].editor!=a;c++);c<b.registeredElements.length&&(a=b.registeredElements[c].element,a.removeEventListener?(a.removeEventListener("mousedown",SocialCalc.ProcessEditorMouseDown,!1),a.removeEventListener("dblclick",SocialCalc.ProcessEditorDblClick,!1)):a.detachEvent&&(a.detachEvent("onmousedown",SocialCalc.ProcessEditorMouseDown),a.detachEvent("ondblclick",SocialCalc.ProcessEditorDblClick)),
b.registeredElements.splice(c,1))};
SocialCalc.ProcessEditorMouseDown=function(a){var b,c,d,e=a||window.event,g=SocialCalc.GetViewportInfo();c=e.clientX+g.horizontalScroll;var h=e.clientY+g.verticalScroll,g=SocialCalc.EditorMouseInfo,j=e.target||e.srcElement;if(!g.ignore){for(b=null;!b&&j;j=j.parentNode)b=SocialCalc.LookupElement(j,g.registeredElements);if(b){if(b=b.editor,g.element=j,d=b.range,(c=SocialCalc.GridMousePosition(b,c,h))&&!c.rowheader)g.editor=b,c.colheader&&c.coltoresize?SocialCalc.ProcessEditorColsizeMouseDown(a,j,c):
c.coord&&(d.hasrange||a.shiftKey&&b.RangeAnchor(),c=b.MoveECell(c.coord),d.hasrange&&(a.shiftKey?b.RangeExtend():b.RangeRemove()),g.mousedowncoord=c,g.mouselastcoord=c,b.EditorMouseRange(c),SocialCalc.KeyboardSetFocus(b),"start"!=b.state&&b.inputBox&&b.inputBox.element.focus(),document.addEventListener?(document.addEventListener("mousemove",SocialCalc.ProcessEditorMouseMove,!0),document.addEventListener("mouseup",SocialCalc.ProcessEditorMouseUp,!0)):j.attachEvent&&(j.setCapture(),j.attachEvent("onmousemove",
SocialCalc.ProcessEditorMouseMove),j.attachEvent("onmouseup",SocialCalc.ProcessEditorMouseUp),j.attachEvent("onlosecapture",SocialCalc.ProcessEditorMouseUp)),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1)}else g.editor=null}};
SocialCalc.EditorMouseRange=function(a,b){var c,d,e=a.range;switch(a.state){case "input":c=a.inputBox.GetText();d=a.workingvalues;if(0<="(+-*/,:!&<>=^".indexOf(c.slice(-1))&&"="==c.slice(0,1)||"="==c)d.partialexpr=c;d.partialexpr?b&&(e.hasrange?a.inputBox.SetText(d.partialexpr+SocialCalc.crToCoord(e.left,e.top)+":"+SocialCalc.crToCoord(e.right,e.bottom)):a.inputBox.SetText(d.partialexpr+b)):(a.inputBox.Blur(),a.inputBox.ShowInputBox(!1),a.state="start",a.cellhandles.ShowCellHandles(!0),a.EditorSaveEdit(),
a.inputBox.DisplayCellContents(null));break;case "inputboxdirect":a.inputBox.Blur(),a.inputBox.ShowInputBox(!1),a.state="start",a.cellhandles.ShowCellHandles(!0),a.EditorSaveEdit(),a.inputBox.DisplayCellContents(null)}};
SocialCalc.ProcessEditorMouseMove=function(a){var b,c,d=a||window.event;b=SocialCalc.GetViewportInfo();c=d.clientX+b.horizontalScroll;var e=d.clientY+b.verticalScroll,g=SocialCalc.EditorMouseInfo;if((b=g.editor)&&!g.ignore)if(c=SocialCalc.GridMousePosition(b,c,e))c&&!c.coord?SocialCalc.SetDragAutoRepeat(b,c):(SocialCalc.SetDragAutoRepeat(b,null),c.coord&&(c.coord!=g.mouselastcoord&&(!a.shiftKey&&!b.range.hasrange&&b.RangeAnchor(g.mousedowncoord),b.MoveECell(c.coord),b.RangeExtend()),g.mouselastcoord=
c.coord,b.EditorMouseRange(c.coord),d.stopPropagation?d.stopPropagation():d.cancelBubble=!0,d.preventDefault?d.preventDefault():d.returnValue=!1))};
SocialCalc.ProcessEditorMouseUp=function(a){var b,c,d,a=a||window.event;b=SocialCalc.GetViewportInfo();d=a.clientX+b.horizontalScroll;var e=a.clientY+b.verticalScroll,g=SocialCalc.EditorMouseInfo;if((b=g.editor)&&!g.ignore)if(c=g.element,d=SocialCalc.GridMousePosition(b,d,e),SocialCalc.SetDragAutoRepeat(b,null),d)return d.coord||(d.coord=b.ecell.coord),b.range.hasrange?(b.MoveECell(d.coord),b.RangeExtend()):d.coord&&d.coord!=g.mousedowncoord&&(b.RangeAnchor(g.mousedowncoord),b.MoveECell(d.coord),
b.RangeExtend()),b.EditorMouseRange(d.coord),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,document.removeEventListener?(document.removeEventListener("mousemove",SocialCalc.ProcessEditorMouseMove,!0),document.removeEventListener("mouseup",SocialCalc.ProcessEditorMouseUp,!0)):c.detachEvent&&(c.detachEvent("onlosecapture",SocialCalc.ProcessEditorMouseUp),c.detachEvent("onmouseup",SocialCalc.ProcessEditorMouseUp),c.detachEvent("onmousemove",
SocialCalc.ProcessEditorMouseMove),c.releaseCapture()),g.editor=null,!1};
SocialCalc.ProcessEditorColsizeMouseDown=function(a,b,c){var a=a||window.event,b=SocialCalc.EditorMouseInfo,d=b.editor,e=SocialCalc.GetViewportInfo(),e=a.clientX+e.horizontalScroll;b.mouseresizecolnum=c.coltoresize;b.mouseresizecol=SocialCalc.rcColname(c.coltoresize);b.mousedownclientx=e;e=document.createElement("div");b.mouseresizedisplay=e;e.style.width="auto";e.style.position="absolute";e.style.zIndex=100;e.style.top=d.headposition.top+0+"px";e.style.left=d.colpositions[c.coltoresize]+"px";e.innerHTML=
'<table cellpadding="0" cellspacing="0"><tr><td style="height:100px;border:1px dashed black;background-color:white;width:'+(d.context.colwidth[b.mouseresizecolnum]-2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+d.context.colwidth[b.mouseresizecolnum]+"</div></td></tr></table>";SocialCalc.setStyles(e.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.85;");d.toplevel.appendChild(e);document.addEventListener?(document.addEventListener("mousemove",
SocialCalc.ProcessEditorColsizeMouseMove,!0),document.addEventListener("mouseup",SocialCalc.ProcessEditorColsizeMouseUp,!0)):d.toplevel.attachEvent&&(d.toplevel.setCapture(),d.toplevel.attachEvent("onmousemove",SocialCalc.ProcessEditorColsizeMouseMove),d.toplevel.attachEvent("onmouseup",SocialCalc.ProcessEditorColsizeMouseUp),d.toplevel.attachEvent("onlosecapture",SocialCalc.ProcessEditorColsizeMouseUp));a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=
!1};
SocialCalc.ProcessEditorColsizeMouseMove=function(a){var a=a||window.event,b=SocialCalc.EditorMouseInfo,c=b.editor;if(c){var d=SocialCalc.GetViewportInfo(),c=c.context.colwidth[b.mouseresizecolnum]-0+(a.clientX+d.horizontalScroll-b.mousedownclientx);c<SocialCalc.Constants.defaultMinimumColWidth&&(c=SocialCalc.Constants.defaultMinimumColWidth);b=b.mouseresizedisplay;b.innerHTML='<table cellpadding="0" cellspacing="0"><tr><td style="height:100px;border:1px dashed black;background-color:white;width:'+(c-
2)+'px;">&nbsp;</td><td><div style="font-size:small;color:white;background-color:gray;padding:4px;">'+c+"</div></td></tr></table>";SocialCalc.setStyles(b.firstChild.lastChild.firstChild.childNodes[0],"filter:alpha(opacity=85);opacity:.85;");a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1}};
SocialCalc.ProcessEditorColsizeMouseUp=function(a){var b=a||window.event,a=SocialCalc.EditorMouseInfo,c=a.editor;if(c){element=a.element;var d=SocialCalc.GetViewportInfo(),d=b.clientX+d.horizontalScroll;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0;b.preventDefault?b.preventDefault():b.returnValue=!1;document.removeEventListener?(document.removeEventListener("mousemove",SocialCalc.ProcessEditorColsizeMouseMove,!0),document.removeEventListener("mouseup",SocialCalc.ProcessEditorColsizeMouseUp,
!0)):c.toplevel.detachEvent&&(c.toplevel.detachEvent("onlosecapture",SocialCalc.ProcessEditorColsizeMouseUp),c.toplevel.detachEvent("onmouseup",SocialCalc.ProcessEditorColsizeMouseUp),c.toplevel.detachEvent("onmousemove",SocialCalc.ProcessEditorColsizeMouseMove),c.toplevel.releaseCapture());b=c.context.colwidth[a.mouseresizecolnum]-0+(d-a.mousedownclientx);b<SocialCalc.Constants.defaultMinimumColWidth&&(b=SocialCalc.Constants.defaultMinimumColWidth);c.EditorScheduleSheetCommands("set "+a.mouseresizecol+
" width "+b,!0,!1);c.timeout&&window.clearTimeout(c.timeout);c.timeout=window.setTimeout(SocialCalc.FinishColsize,1);return!1}};SocialCalc.FinishColsize=function(){var a=SocialCalc.EditorMouseInfo,b=a.editor;b&&(b.toplevel.removeChild(a.mouseresizedisplay),a.mouseresizedisplay=null,a.editor=null)};SocialCalc.AutoRepeatInfo={timer:null,mouseinfo:null,repeatinterval:1E3,editor:null,repeatcallback:null};
SocialCalc.SetDragAutoRepeat=function(a,b,c){var d=SocialCalc.AutoRepeatInfo;d.repeatcallback=c;if(b){d.editor=a;if(d.mouseinfo)if(b.rowheader||b.rowfooter)b.row!=d.mouseinfo.row&&(c=SocialCalc.crToCoord(a.ecell.col,b.row),d.repeatcallback?(a=b.row<d.mouseinfo.row?"left":b.row>d.mouseinfo.row?"right":"",d.repeatcallback(c,a)):(a.MoveECell(c),a.MoveECell(c),a.RangeExtend(),a.EditorMouseRange(c)));else if((b.colheader||b.colfooter)&&b.col!=d.mouseinfo.col)c=SocialCalc.crToCoord(b.col,a.ecell.row),d.repeatcallback?
(a=b.row<d.mouseinfo.row?"left":b.row>d.mouseinfo.row?"right":"",d.repeatcallback(c,a)):(a.MoveECell(c),a.RangeExtend(),a.EditorMouseRange(c));d.mouseinfo=b;if(5>b.distance)d.repeatinterval=333;else if(10>b.distance)d.repeatinterval=250;else if(25>b.distance)d.repeatinterval=100;else if(35>b.distance)d.repeatinterval=75;else{d.timer&&(window.clearTimeout(d.timer),d.timer=null);return}d.timer||(d.timer=window.setTimeout(SocialCalc.DragAutoRepeat,d.repeatinterval))}else d.timer&&(window.clearTimeout(d.timer),
d.timer=null),d.mouseinfo=null};
SocialCalc.DragAutoRepeat=function(){var a=SocialCalc.AutoRepeatInfo,b=a.mouseinfo,c;b.rowheader?c="left":b.rowfooter?c="right":b.colheader?c="up":b.colfooter&&(c="down");a.repeatcallback?(b=SocialCalc.coordToCr(a.editor.ecell.coord),"left"==c&&1<b.col?b.col--:"right"==c?b.col++:"up"==c&&1<b.row?b.row--:"down"==c&&b.row++,b=SocialCalc.crToCoord(b.col,b.row),a.repeatcallback(b,c)):(b=a.editor.MoveECellWithKey("[a"+c+"]shifted"))&&a.editor.EditorMouseRange(b);a.timer=window.setTimeout(SocialCalc.DragAutoRepeat,
a.repeatinterval)};
SocialCalc.ProcessEditorDblClick=function(a){var b,c,a=a||window.event,d=SocialCalc.GetViewportInfo();c=a.clientX+d.horizontalScroll;var e=a.clientY+d.verticalScroll,d=SocialCalc.EditorMouseInfo,g=a.target||a.srcElement;if(!d.ignore){for(b=null;!b&&g;g=g.parentNode)b=SocialCalc.LookupElement(g,d.registeredElements);if(b){if(b=b.editor,(c=SocialCalc.GridMousePosition(b,c,e))&&c.coord){d.editor=b;d.element=g;sheetobj=b.context.sheetobj;switch(b.state){case "start":SocialCalc.EditorOpenCellEdit(b)}a.stopPropagation?a.stopPropagation():
a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1}}else d.editor=null}};
SocialCalc.EditorOpenCellEdit=function(a){var b;if(!a.ecell||!a.inputBox||a.inputBox.element.disabled)return!0;if("none"==a.inputBox.element.style.display){for(f in a.StatusCallback)a.StatusCallback[f].func(a,"editecell",null,a.StatusCallback[f].params);return!0}a.inputBox.ShowInputBox(!0);a.inputBox.Focus();a.state="inputboxdirect";a.inputBox.SetText("");a.inputBox.DisplayCellContents();a.inputBox.Select("end");b=a.workingvalues;b.partialexpr="";b.ecoord=a.ecell.coord;b.erow=a.ecell.row;b.ecol=a.ecell.col};
SocialCalc.EditorProcessKey=function(a,b,c){var d,e=a.workingvalues,g=a.range;"string"!=typeof b&&(b="");switch(a.state){case "start":c.shiftKey&&"[a"==b.substr(0,2)&&(b+="shifted");"[enter]"==b&&(b="[adown]");"[tab]"==b&&(b=c.shiftKey?"[aleft]":"[aright]");if("[a"==b.substr(0,2)||"[pg"==b.substr(0,3)||"[home]"==b)return a=a.MoveECellWithKey(b),!a;if("[del]"==b||"[backspace]"==b){a.noEdit||a.EditorApplySetCommandsToRange("empty","");break}if("[esc]"==b){if(g.hasrange)for(d in a.RangeRemove(),a.MoveECell(g.anchorcoord),
a.StatusCallback)a.StatusCallback[d].func(a,"specialkey",b,a.StatusCallback[d].params);break}if("[f2]"==b){if(a.noEdit)return!0;SocialCalc.EditorOpenCellEdit(a);break}if(1<b.length&&"["==b.substr(0,1)||0==b.length)return a.ctrlkeyFunction&&0<b.length?a.ctrlkeyFunction(a,b):!0;if(!a.ecell||!a.inputBox)return!0;if("none"==a.inputBox.element.style.display){for(d in a.StatusCallback)a.StatusCallback[d].func(a,"editecell",b,a.StatusCallback[d].params);return!0}a.inputBox.element.disabled=!1;a.state="input";
a.inputBox.ShowInputBox(!0);a.inputBox.Focus();a.inputBox.SetText(b);a.inputBox.Select("end");e.partialexpr="";e.ecoord=a.ecell.coord;e.erow=a.ecell.row;e.ecol=a.ecell.col;a.RangeRemove();break;case "input":d=a.inputBox.GetText();if(a.inputBox.skipOne)break;if("[esc]"==b||"[enter]"==b||"[tab]"==b||b&&"[a"==b.substr(0,2)){if(0<="(+-*/,:!&<>=^".indexOf(d.slice(-1))&&"="==d.slice(0,1)||"="==d)e.partialexpr=d;if(e.partialexpr&&(c.shiftKey&&"[a"==b.substr(0,2)&&(b+="shifted"),d=a.MoveECellWithKey(b))){g.hasrange?
a.inputBox.SetText(e.partialexpr+SocialCalc.crToCoord(g.left,g.top)+":"+SocialCalc.crToCoord(g.right,g.bottom)):a.inputBox.SetText(e.partialexpr+d);break}a.inputBox.Blur();a.inputBox.ShowInputBox(!1);a.state="start";a.cellhandles.ShowCellHandles(!0);"[esc]"!=b?(a.EditorSaveEdit(),a.ecell.coord!=e.ecoord&&a.MoveECell(e.ecoord),"[enter]"==b&&(b="[adown]"),"[tab]"==b&&(b=c.shiftKey?"[aleft]":"[aright]"),"[a"==b.substr(0,2)&&a.MoveECellWithKey(b)):(a.inputBox.DisplayCellContents(),a.RangeRemove(),a.MoveECell(e.ecoord));
break}if(e.partialexpr&&"[backspace]"==b){a.inputBox.SetText(e.partialexpr);e.partialexpr="";a.RangeRemove();a.MoveECell(e.ecoord);a.inputBox.ShowInputBox(!0);break}if("[f2]"==b)break;g.hasrange&&a.RangeRemove();a.MoveECell(e.ecoord);e.partialexpr&&(a.inputBox.ShowInputBox(!0),e.partialexpr="");return!0;case "inputboxdirect":a.inputBox.GetText();if("[esc]"==b||"[enter]"==b||"[tab]"==b){a.inputBox.Blur();a.inputBox.ShowInputBox(!1);a.state="start";a.cellhandles.ShowCellHandles(!0);"[esc]"==b?a.inputBox.DisplayCellContents():
(a.EditorSaveEdit(),a.ecell.coord!=e.ecoord&&a.MoveECell(e.ecoord),"[enter]"==b&&(b="[adown]"),"[tab]"==b&&(b=c.shiftKey?"[aleft]":"[aright]"),"[a"==b.substr(0,2)&&a.MoveECellWithKey(b));break}if("[f2]"==b)break;return!0;case "skip-and-start":a.state="start";a.cellhandles.ShowCellHandles(!0);break;default:return!0}return!1};
SocialCalc.EditorAddToInput=function(a,b,c){var d=a.workingvalues;if(!a.noEdit)switch(a.state){case "start":a.state="input";a.inputBox.ShowInputBox(!0);a.inputBox.element.disabled=!1;a.inputBox.Focus();a.inputBox.SetText((c||"")+b);a.inputBox.Select("end");d.partialexpr="";d.ecoord=a.ecell.coord;d.erow=a.ecell.row;d.ecol=a.ecell.col;a.RangeRemove();break;case "input":case "inputboxdirect":a.inputBox.element.focus(),d.partialexpr&&(a.inputBox.SetText(d.partialexpr),d.partialexpr="",a.RangeRemove(),
a.MoveECell(d.ecoord)),a.inputBox.SetText(a.inputBox.GetText()+b)}};SocialCalc.EditorDisplayCellContents=function(a){a.inputBox&&a.inputBox.DisplayCellContents()};
SocialCalc.EditorSaveEdit=function(a,b){var c,d;c=a.context.sheetobj;var e=a.workingvalues;d="string"==typeof b?b:a.inputBox.GetText();c=SocialCalc.GetCellContents(c,e.ecoord)+"";d!=c&&(c=d.charAt(0),"="==c&&-1==d.indexOf("\n")?(c="formula",d=d.substring(1)):"'"==c?(c="text t",d=d.substring(1)):0==d.length?c="empty":(c=SocialCalc.DetermineValueType(d),c="n"==c.type&&d==c.value+""?"value n":"t"==c.type.charAt(0)?"text "+c.type:""==c.type?"text t":"constant "+c.type+" "+c.value),"t"==c.charAt(0)&&(d=
SocialCalc.encodeForSave(d)),a.EditorScheduleSheetCommands("set "+e.ecoord+" "+c+" "+d,!0,!1))};SocialCalc.EditorApplySetCommandsToRange=function(a,b){var c;c=a.ecell;var d=a.range;d.hasrange?(coord=SocialCalc.crToCoord(d.left,d.top)+":"+SocialCalc.crToCoord(d.right,d.bottom),c="set "+coord+" "+b):c="set "+c.coord+" "+b;a.EditorScheduleSheetCommands(c,!0,!1);a.DisplayCellContents()};
SocialCalc.EditorProcessMouseWheel=function(a,b,c,d){d.functionobj.editor.busy||(0<b&&d.functionobj.editor.ScrollRelative(!0,-1),0>b&&d.functionobj.editor.ScrollRelative(!0,1))};
SocialCalc.GridMousePosition=function(a,b,c){var d,e,g={};for(d=1;d<a.rowpositions.length&&!(a.rowheight[d]&&a.rowpositions[d]+a.rowheight[d]>c);d++);for(e=1;e<a.colpositions.length&&!(a.colwidth[e]&&a.colpositions[e]+a.colwidth[e]>b);e++);g.row=d;g.col=e;if(a.headposition){if(b<a.headposition.left&&b>=a.gridposition.left)g.rowheader=!0,g.distance=a.headposition.left-b;else if(c<a.headposition.top&&c>a.gridposition.top){g.colheader=!0;g.distance=a.headposition.top-c;g.coltoresize=e-(a.colpositions[e]+
a.colwidth[e]/2>b?1:0)||1;for(b=0;b<a.context.colpanes.length;b++)if(g.coltoresize>=a.context.colpanes[b].first&&g.coltoresize<=a.context.colpanes[b].last)return g;delete g.coltoresize}else b>=a.verticaltablecontrol.controlborder?(g.rowfooter=!0,g.distance=b-a.verticaltablecontrol.controlborder):c>=a.horizontaltablecontrol.controlborder?(g.colfooter=!0,g.distance=c-a.horizontaltablecontrol.controlborder):b<a.gridposition.left?(g.rowheader=!0,g.distance=a.headposition.left-b):c<=a.gridposition.top?
(g.colheader=!0,g.distance=a.headposition.top-c):(g.coord=SocialCalc.crToCoord(g.col,g.row),a.context.cellskip[g.coord]&&(g.coord=a.context.cellskip[g.coord]));return g}return null};
SocialCalc.GetEditorCellElement=function(a,b,c){var d,e,g,h,j=0,k=0;for(d=0;d<a.context.rowpanes.length;d++){if(b>=a.context.rowpanes[d].first&&b<=a.context.rowpanes[d].last)for(e=0;e<a.context.colpanes.length;e++){if(c>=a.context.colpanes[e].first&&c<=a.context.colpanes[e].last){j+=b-a.context.rowpanes[d].first+2;for(g=a.context.colpanes[e].first;g<=c;g++)h=a.context.cellskip[SocialCalc.crToCoord(g,b)],(!h||!a.context.CoordInPane(h,d,e))&&k++;return{element:a.griddiv.firstChild.lastChild.childNodes[j].childNodes[k],
rowpane:d,colpane:e}}for(g=a.context.colpanes[e].first;g<=a.context.colpanes[e].last;g++)h=a.context.cellskip[SocialCalc.crToCoord(g,b)],(!h||!a.context.CoordInPane(h,d,e))&&k++;k+=1}j+=a.context.rowpanes[d].last-a.context.rowpanes[d].first+2}return null};
SocialCalc.MoveECellWithKey=function(a,b){var c,d,e,g=!1;if(!a.ecell)return null;"shifted"==b.slice(-7)&&(b=b.slice(0,-7),g=!0);c=a.ecell.row;d=a.ecell.col;e=a.context.sheetobj.cells[a.ecell.coord];switch(b){case "[adown]":c+=e&&e.rowspan||1;break;case "[aup]":c--;break;case "[pgdn]":c+=a.pageUpDnAmount-1+(e&&e.rowspan||1);break;case "[pgup]":c-=a.pageUpDnAmount;break;case "[aright]":d+=e&&e.colspan||1;break;case "[aleft]":d--;break;case "[home]":d=c=1;break;default:return null}a.range.hasrange||
g&&a.RangeAnchor();c=a.MoveECell(SocialCalc.crToCoord(d,c));a.range.hasrange&&(g?a.RangeExtend():a.RangeRemove());return c};
SocialCalc.MoveECell=function(a,b){var c,d,e=a.context.highlights;if(a.ecell){if(a.ecell.coord==b)return b;SocialCalc.Callbacks.broadcast&&SocialCalc.Callbacks.broadcast("ecell",{original:a.ecell.coord,ecell:b});c=SocialCalc.GetEditorCellElement(a,a.ecell.row,a.ecell.col);delete e[a.ecell.coord];a.range2.hasrange&&a.ecell.row>=a.range2.top&&a.ecell.row<=a.range2.bottom&&a.ecell.col>=a.range2.left&&a.ecell.col<=a.range2.right&&(e[a.ecell.coord]="range2");a.UpdateCellCSS(c,a.ecell.row,a.ecell.col);
a.SetECellHeaders("");a.cellhandles.ShowCellHandles(!1)}else SocialCalc.Callbacks.broadcast&&SocialCalc.Callbacks.broadcast("ecell",{ecell:b});b=a.context.cellskip[b]||b;a.ecell=SocialCalc.coordToCr(b);a.ecell.coord=b;c=SocialCalc.GetEditorCellElement(a,a.ecell.row,a.ecell.col);e[b]="cursor";for(d in a.MoveECellCallback)a.MoveECellCallback[d](a);a.UpdateCellCSS(c,a.ecell.row,a.ecell.col);a.SetECellHeaders("selected");for(d in a.StatusCallback)a.StatusCallback[d].func(a,"moveecell",b,a.StatusCallback[d].params);
a.busy?a.ensureecell=!0:(a.ensureecell=!1,a.EnsureECellVisible());return b};SocialCalc.EnsureECellVisible=function(a){var b=0,c=0;a.ecell.row>a.lastnonscrollingrow&&(a.ecell.row<a.firstscrollingrow?b=a.ecell.row-a.firstscrollingrow:a.ecell.row>a.lastvisiblerow&&(b=a.ecell.row-a.lastvisiblerow));a.ecell.col>a.lastnonscrollingcol&&(a.ecell.col<a.firstscrollingcol?c=a.ecell.col-a.firstscrollingcol:a.ecell.col>a.lastvisiblecol&&(c=a.ecell.col-a.lastvisiblecol));0!=b||0!=c?a.ScrollRelativeBoth(b,c):a.cellhandles.ShowCellHandles(!0)};
SocialCalc.ReplaceCell=function(a,b,c,d){var e;if(b&&(a=a.context.RenderCell(c,d,b.rowpane,b.colpane,!0,null)))for(e in b.element.innerHTML=a.innerHTML,b.element.style.cssText="",b.element.className=a.className,a.style)"cssText"!=a.style[e]&&(b.element.style[e]=a.style[e])};
SocialCalc.UpdateCellCSS=function(a,b,c,d){var e;if(b&&(a=a.context.RenderCell(c,d,b.rowpane,b.colpane,!0,null)))for(e in b.element.style.cssText="",b.element.className=a.className,a.style)"cssText"!=a.style[e]&&(b.element.style[e]=a.style[e])};
SocialCalc.SetECellHeaders=function(a,b){var c=a.ecell,d=a.context,e,g,h,j=0,k=0,l;if(c){for(e=0;e<d.rowpanes.length;e++){g=d.rowpanes[e].first;h=d.rowpanes[e].last;if(c.row>=g&&c.row<=h&&(l=a.fullgrid.childNodes[1].childNodes[2+j+c.row-g].childNodes[0]))d.classnames&&(l.className=d.classnames[b+"rowname"]),d.explicitStyles&&(l.style.cssText=d.explicitStyles[b+"rowname"]),l.style.verticalAlign="top";j+=h-g+2}for(e=0;e<d.colpanes.length;e++){g=d.colpanes[e].first;h=d.colpanes[e].last;if(c.col>=g&&
c.col<=h&&(l=a.fullgrid.childNodes[1].childNodes[1].childNodes[1+k+c.col-g]))if(d.classnames&&(l.className=d.classnames[b+"colname"]),d.explicitStyles)l.style.cssText=d.explicitStyles[b+"colname"];k+=h-g+2}}};SocialCalc.RangeAnchor=function(a,b){a.range.hasrange&&a.RangeRemove();a.RangeExtend(b)};
SocialCalc.RangeExtend=function(a,b){var c,d,e,g,h,j,k=a.context.highlights;c=a.range;d=a.range2;b?(g=SocialCalc.coordToCr(b),g.coord=b):g=a.ecell;if(g){c.hasrange||(c.anchorcoord=g.coord,c.anchorrow=g.row,c.top=g.row,c.bottom=g.row,c.anchorcol=g.col,c.left=g.col,c.right=g.col,c.hasrange=!0);c.anchorrow<g.row?(c.top=c.anchorrow,c.bottom=g.row):(c.top=g.row,c.bottom=c.anchorrow);c.anchorcol<g.col?(c.left=c.anchorcol,c.right=g.col):(c.left=g.col,c.right=c.anchorcol);for(e in k)switch(k[e]){case "range":k[e]=
"unrange";break;case "range2":k[e]="unrange2"}for(g=c.top;g<=c.bottom;g++)for(h=c.left;h<=c.right;h++)switch(e=SocialCalc.crToCoord(h,g),k[e]){case "unrange":k[e]="range";break;case "cursor":break;default:k[e]="newrange"}for(g=d.top;d.hasrange&&g<=d.bottom;g++)for(h=d.left;h<=d.right;h++)switch(e=SocialCalc.crToCoord(h,g),k[e]){case "unrange2":k[e]="range2";break;case "range":case "newrange":case "cursor":break;default:k[e]="newrange2"}for(e in k){switch(k[e]){case "unrange":delete k[e];break;case "newrange":k[e]=
"range";break;case "newrange2":k[e]="range2";break;case "range":case "range2":case "cursor":continue}d=SocialCalc.coordToCr(e);c=SocialCalc.GetEditorCellElement(a,d.row,d.col);a.UpdateCellCSS(c,d.row,d.col)}for(j in a.RangeChangeCallback)a.RangeChangeCallback[j](a);e=SocialCalc.crToCoord(a.range.left,a.range.top);if(a.range.left!=a.range.right||a.range.top!=a.range.bottom)e+=":"+SocialCalc.crToCoord(a.range.right,a.range.bottom);for(j in a.StatusCallback)a.StatusCallback[j].func(a,"rangechange",e,
a.StatusCallback[j].params)}};
SocialCalc.RangeRemove=function(a){var b,c,d,e,g=a.context.highlights,h=a.range,j=a.range2;if(h.hasrange||j.hasrange){for(b=j.top;j.hasrange&&b<=j.bottom;b++)for(c=j.left;c<=j.right;c++)switch(d=SocialCalc.crToCoord(c,b),g[d]){case "range":g[d]="newrange2";break;case "range2":case "cursor":break;default:g[d]="newrange2"}for(d in g){switch(g[d]){case "range":delete g[d];break;case "newrange2":g[d]="range2";break;case "cursor":continue}c=SocialCalc.coordToCr(d);b=SocialCalc.GetEditorCellElement(a,c.row,
c.col);a.UpdateCellCSS(b,c.row,c.col)}h.hasrange=!1;for(e in a.RangeChangeCallback)a.RangeChangeCallback[e](a);for(e in a.StatusCallback)a.StatusCallback[e].func(a,"rangechange","",a.StatusCallback[e].params)}};
SocialCalc.Range2Remove=function(a){var b,c,d,e=a.context.highlights,g=a.range2;if(g.hasrange){for(d in e){switch(e[d]){case "range2":delete e[d];break;case "range":case "cursor":continue}c=SocialCalc.coordToCr(d);b=SocialCalc.GetEditorCellElement(a,c.row,c.col);a.UpdateCellCSS(b,c.row,c.col)}g.hasrange=!1}};
SocialCalc.FitToEditTable=function(a){var b,c,d,e=a.context,g=e.sheetobj;d=e.showRCHeaders?e.rownamewidth-0:0;for(colpane=0;colpane<e.colpanes.length-1;colpane++)for(b=e.colpanes[colpane].first;b<=e.colpanes[colpane].last;b++){c=SocialCalc.rcColname(b);c=g.colattribs.width[c]||g.attribs.defaultcolwidth||SocialCalc.Constants.defaultColWidth;if("blank"==c||"auto"==c)c="";d+=c&&0<c-0?c-0:10}for(b=e.colpanes[colpane].first;1E4>=b;b++){c=SocialCalc.rcColname(b);c=g.colattribs.width[c]||g.attribs.defaultcolwidth||
SocialCalc.Constants.defaultColWidth;if("blank"==c||"auto"==c)c="";d+=c&&0<c-0?c-0:10;if(d>a.tablewidth)break}e.colpanes[colpane].last=b;b=e.showRCHeaders?1:0;for(d=0;d<e.rowpanes.length-1;d++)b+=e.rowpanes[d].last-e.rowpanes[d].first+1;e.rowpanes[d].last=e.rowpanes[d].first+Math.floor((a.tableheight-b*e.pixelsPerRow)/e.pixelsPerRow)+1};
SocialCalc.CalculateEditorPositions=function(a){var b;a.gridposition=SocialCalc.GetElementPosition(a.griddiv);a.headposition=SocialCalc.GetElementPosition(a.griddiv.firstChild.lastChild.childNodes[2].childNodes[1]);a.rowpositions=[];for(b=0;b<a.context.rowpanes.length;b++)a.CalculateRowPositions(b,a.rowpositions,a.rowheight);for(b=0;b<a.rowpositions.length&&!(a.rowpositions[b]>a.gridposition.top+a.tableheight);b++);a.lastvisiblerow=b-1;a.colpositions=[];for(b=0;b<a.context.colpanes.length;b++)a.CalculateColPositions(b,
a.colpositions,a.colwidth);for(b=0;b<a.colpositions.length&&!(a.colpositions[b]>a.gridposition.left+a.tablewidth);b++);a.lastvisiblecol=b-1;a.firstscrollingrow=a.context.rowpanes[a.context.rowpanes.length-1].first;a.firstscrollingrowtop=a.rowpositions[a.firstscrollingrow]||a.headposition.top;a.lastnonscrollingrow=0<a.context.rowpanes.length-1?a.context.rowpanes[a.context.rowpanes.length-2].last:0;a.firstscrollingcol=a.context.colpanes[a.context.colpanes.length-1].first;a.firstscrollingcolleft=a.colpositions[a.firstscrollingcol]||
a.headposition.left;a.lastnonscrollingcol=0<a.context.colpanes.length-1?a.context.colpanes[a.context.colpanes.length-2].last:0;a.verticaltablecontrol.ComputeTableControlPositions();a.horizontaltablecontrol.ComputeTableControlPositions()};SocialCalc.ScheduleRender=function(a){a.timeout&&window.clearTimeout(a.timeout);SocialCalc.EditorSheetStatusCallback(null,"schedrender",null,a);SocialCalc.EditorStepInfo.editor=a;a.timeout=window.setTimeout(SocialCalc.DoRenderStep,1)};
SocialCalc.DoRenderStep=function(){var a=SocialCalc.EditorStepInfo.editor;a.timeout=null;a.EditorRenderSheet();SocialCalc.EditorSheetStatusCallback(null,"renderdone",null,a);SocialCalc.EditorSheetStatusCallback(null,"schedposcalc",null,a);a.timeout=window.setTimeout(SocialCalc.DoPositionCalculations,1)};
SocialCalc.SchedulePositionCalculations=function(a){SocialCalc.EditorStepInfo.editor=a;SocialCalc.EditorSheetStatusCallback(null,"schedposcalc",null,a);a.timeout=window.setTimeout(SocialCalc.DoPositionCalculations,1)};
SocialCalc.DoPositionCalculations=function(){var a=SocialCalc.EditorStepInfo.editor;a.timeout=null;var b=!1;try{a.CalculateEditorPositions(),b=!0}catch(c){}b?(a.verticaltablecontrol.PositionTableControlElements(),a.horizontaltablecontrol.PositionTableControlElements(),SocialCalc.EditorSheetStatusCallback(null,"doneposcalc",null,a),a.ensureecell&&a.ecell&&!a.deferredCommands.length&&(a.ensureecell=!1,a.EnsureECellVisible()),a.cellhandles.ShowCellHandles(!0),SocialCalc.Callbacks.broadcast&&SocialCalc.Callbacks.broadcast("ask.ecell")):
"undefined"!=typeof $&&($(window).trigger("resize"),setTimeout(SocialCalc.DoPositionCalculations,400))};SocialCalc.CalculateRowPositions=function(a,b,c,d){var e,g,h,j,k=a.context,l;if(!k.showRCHeaders)throw"Needs showRCHeaders=true";l=a.fullgrid.lastChild;a=2;for(e=0;e<b;e++)a+=k.rowpanes[e].last-k.rowpanes[e].first+2;g=0;for(b=k.rowpanes[e].first;b<=k.rowpanes[e].last;b++)h=l.childNodes[a+g],g++,j=SocialCalc.GetElementPosition(h.firstChild),c[b]||(c[b]=j.top,d[b]=h.firstChild.offsetHeight)};
SocialCalc.CalculateColPositions=function(a,b,c,d){var e,g,h,j,k=a.context;if(!k.showRCHeaders)throw"Needs showRCHeaders=true";g=a.fullgrid.lastChild;a=1;for(e=0;e<b;e++)a+=k.colpanes[e].last-k.colpanes[e].first+2;h=g.childNodes[1];g=0;for(b=k.colpanes[e].first;b<=k.colpanes[e].last;b++)j=SocialCalc.GetElementPosition(h.childNodes[a+g]),c[b]||(c[b]=j.left,h.childNodes[a+g]&&(d[b]=h.childNodes[a+g].offsetWidth)),g++};
SocialCalc.ScrollRelative=function(a,b,c){b?a.ScrollRelativeBoth(c,0):a.ScrollRelativeBoth(0,c)};
SocialCalc.ScrollRelativeBoth=function(a,b,c){var d=a.context,e=d.rowpanes.length,g=1<e?d.rowpanes[e-2].last+1:1;d.rowpanes[e-1].first+b<g&&(b=-d.rowpanes[e-1].first+g);var g=d.colpanes.length,h=1<g?d.colpanes[g-2].last+1:1;d.colpanes[g-1].first+c<h&&(c=-d.colpanes[g-1].first+h);if((1==b||-1==b)&&0==c)1==b?a.ScrollTableUpOneRow():a.ScrollTableDownOneRow(),a.ecell&&a.SetECellHeaders("selected"),a.SchedulePositionCalculations();else if(0!=b||0!=c)d.rowpanes[e-1].first+=b,d.rowpanes[e-1].last+=b,d.colpanes[g-
1].first+=c,d.colpanes[g-1].last+=c,a.FitToEditTable(),a.ScheduleRender()};
SocialCalc.PageRelative=function(a,b,c){var d=a.context,e=b?"rowpanes":"colpanes",d=d[e][d[e].length-1],g=b?"lastvisiblerow":"lastvisiblecol",e=b?a.rowheight:a.colwidth,h=b?SocialCalc.Constants.defaultAssumedRowHeight:SocialCalc.Constants.defaultColWidth;if(0<c)b=a[g],b==d.first&&(b+=1);else{c=b?a.tableheight-(a.firstscrollingrowtop-a.gridposition.top):a.tablewidth-(a.firstscrollingcolleft-a.gridposition.left);c-=0<e[a[g]]?e[a[g]]:h;for(b=d.first-1;0<b;b--){g=0<e[b]?e[b]:h;if(c<g)break;c-=g}e=d.first;
b>=e&&(b=e-1);1>b&&(b=1)}d.first=b;d.last=b+1;a.LimitLastPanes();a.FitToEditTable();a.ScheduleRender()};SocialCalc.LimitLastPanes=function(a){var a=a.context,b;b=a.rowpanes.length;1<b&&a.rowpanes[b-1].first<=a.rowpanes[b-2].last&&(a.rowpanes[b-1].first=a.rowpanes[b-2].last+1);b=a.colpanes.length;1<b&&a.colpanes[b-1].first<=a.colpanes[b-2].last&&(a.colpanes[b-1].first=a.colpanes[b-2].last+1)};
SocialCalc.ScrollTableUpOneRow=function(a){var b,c,d,e,g,h,j={},k=a.context,l=k.sheetobj,m=a.fullgrid,r;r=m.lastChild;b=k.showRCHeaders?2:1;for(c=0;c<k.rowpanes.length-1;c++)b+=k.rowpanes[c].last-k.rowpanes[c].first+2;r.removeChild(r.childNodes[b]);k.rowpanes[c].first++;k.rowpanes[c].last++;a.FitToEditTable();k.CalculateColWidthData();a=k.RenderRow(k.rowpanes[c].last,c);r.appendChild(a);maxrowspan=1;a=k.rowpanes[c].first-1;for(g=0;g<k.colpanes.length;g++)for(e=k.colpanes[g].first;e<=k.colpanes[g].last;e++)if(coord=
SocialCalc.crToCoord(e,a),!k.cellskip[coord]&&(h=l.cells[coord])&&h.rowspan>maxrowspan)maxrowspan=h.rowspan;if(1<maxrowspan)for(d=1;d<maxrowspan&&!(d+a>=k.rowpanes[c].last);d++)e=k.RenderRow(d+a,c),g=r.childNodes[b+d-1],r.replaceChild(e,g);a=k.rowpanes[c].last;for(g=0;g<k.colpanes.length;g++)for(e=k.colpanes[g].first;e<=k.colpanes[g].last;e++)if(coord=k.cellskip[SocialCalc.crToCoord(e,a)])d=k.coordToCR[coord].row-0,d==k.rowpanes[c].last||d<k.rowpanes[c].first||(h=l.cells[coord])&&1<h.rowspan&&(j[d]=
!0);for(d in j)e=k.RenderRow(d,c),g=r.childNodes[b+(d-k.rowpanes[c].first)],r.replaceChild(e,g);return m};
SocialCalc.ScrollTableDownOneRow=function(a){var b,c,d,e,g,h,j={},k=a.context,l=k.sheetobj,m=a.fullgrid,r;r=m.lastChild;b=k.showRCHeaders?2:1;for(c=0;c<k.rowpanes.length-1;c++)b+=k.rowpanes[c].last-k.rowpanes[c].first+2;r.removeChild(r.childNodes[b+(k.rowpanes[c].last-k.rowpanes[c].first)]);k.rowpanes[c].first--;k.rowpanes[c].last--;a.FitToEditTable();k.CalculateColWidthData();e=k.RenderRow(k.rowpanes[c].first,c);r.insertBefore(e,r.childNodes[b]);maxrowspan=1;a=k.rowpanes[c].first;for(g=0;g<k.colpanes.length;g++)for(e=
k.colpanes[g].first;e<=k.colpanes[g].last;e++)if(coord=SocialCalc.crToCoord(e,a),!k.cellskip[coord]&&(h=l.cells[coord])&&h.rowspan>maxrowspan)maxrowspan=h.rowspan;if(1<maxrowspan)for(d=1;d<maxrowspan&&!(d+a>k.rowpanes[c].last);d++)e=k.RenderRow(d+a,c),g=r.childNodes[b+d],r.replaceChild(e,g);a=k.rowpanes[c].last;for(g=0;g<k.colpanes.length;g++)for(e=k.colpanes[g].first;e<=k.colpanes[g].last;e++)if(coord=SocialCalc.crToCoord(e,a),(h=l.cells[coord])&&1<h.rowspan)j[a]=!0;else if(coord=k.cellskip[SocialCalc.crToCoord(e,
a)])d=k.coordToCR[coord].row-0,d==a||d<k.rowpanes[c].first||(h=l.cells[coord])&&1<h.rowspan&&(j[d]=!0);for(d in j)e=k.RenderRow(d,c),g=r.childNodes[b+(d-k.rowpanes[c].first)],r.replaceChild(e,g);return m};SocialCalc.InputBox=function(a,b){a&&(this.element=a,this.editor=b,this.inputEcho=null,b.inputBox=this,a.onmousedown=SocialCalc.InputBoxOnMouseDown,b.MoveECellCallback.formulabar=function(a){"start"==a.state&&b.inputBox.DisplayCellContents(a.ecell.coord)})};
SocialCalc.InputBox.prototype.DisplayCellContents=function(a){SocialCalc.InputBoxDisplayCellContents(this,a)};SocialCalc.InputBox.prototype.ShowInputBox=function(a){this.editor.inputEcho.ShowInputEcho(a)};SocialCalc.InputBox.prototype.GetText=function(){return this.element.value};SocialCalc.InputBox.prototype.SetText=function(a){this.element&&(this.element.value=a,this.editor.inputEcho.SetText(a+"_"))};SocialCalc.InputBox.prototype.Focus=function(){SocialCalc.InputBoxFocus(this)};
SocialCalc.InputBox.prototype.Blur=function(){return this.element.blur()};
SocialCalc.InputBox.prototype.Select=function(a){if(this.element)switch(a){case "end":if(document.selection&&document.selection.createRange)try{var b=document.selection.createRange().duplicate();b.moveToElementText(this.element);b.collapse(!1);b.select()}catch(c){void 0!=this.element.selectionStart&&(this.element.selectionStart=this.element.value.length,this.element.selectionEnd=this.element.value.length)}else void 0!=this.element.selectionStart&&(this.element.selectionStart=this.element.value.length,
this.element.selectionEnd=this.element.value.length)}};SocialCalc.InputBoxDisplayCellContents=function(a,b){var c=SocialCalc.Constants;if(a){b||(b=a.editor.ecell.coord);var d=SocialCalc.GetCellContents(a.editor.context.sheetobj,b);-1!=d.indexOf("\n")?(d=c.s_inputboxdisplaymultilinetext,a.element.disabled=!0):a.element.disabled=!1;a.SetText(d)}};
SocialCalc.InputBoxFocus=function(a){if(a){a.element.focus();a=a.editor;a.state="input";var b=a.workingvalues;b.partialexpr="";b.ecoord=a.ecell.coord;b.erow=a.ecell.row;b.ecol=a.ecell.col}};
SocialCalc.InputBoxOnMouseDown=function(){var a=SocialCalc.Keyboard.focusTable;if(!a)return!0;var b=a.workingvalues;switch(a.state){case "start":a.state="inputboxdirect";b.partialexpr="";b.ecoord=a.ecell.coord;b.erow=a.ecell.row;b.ecol=a.ecell.col;a.inputEcho.ShowInputEcho(!0);break;case "input":b.partialexpr="",a.MoveECell(b.ecoord),a.state="inputboxdirect",SocialCalc.KeyboardFocus()}};
SocialCalc.InputEcho=function(a){var b=SocialCalc.Constants;this.editor=a;this.text="";this.functionbox=this.prompt=this.main=this.container=this.interval=null;this.container=document.createElement("div");SocialCalc.setStyles(this.container,"display:none;position:absolute;zIndex:10;");this.main=document.createElement("div");b.defaultInputEchoClass&&(this.main.className=b.defaultInputEchoClass);b.defaultInputEchoStyle&&SocialCalc.setStyles(this.main,b.defaultInputEchoStyle);this.main.innerHTML="&nbsp;";
this.container.appendChild(this.main);this.prompt=document.createElement("div");b.defaultInputEchoPromptClass&&(this.prompt.className=b.defaultInputEchoPromptClass);b.defaultInputEchoPromptStyle&&SocialCalc.setStyles(this.prompt,b.defaultInputEchoPromptStyle);this.prompt.innerHTML="";this.container.appendChild(this.prompt);SocialCalc.DragRegister(this.main,!0,!0,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,
positionobj:this.container});a.toplevel.appendChild(this.container)};SocialCalc.InputEcho.prototype.ShowInputEcho=function(a){return SocialCalc.ShowInputEcho(this,a)};SocialCalc.InputEcho.prototype.SetText=function(a){return SocialCalc.SetInputEchoText(this,a)};
SocialCalc.ShowInputEcho=function(a,b){var c;if(c=a.editor)if(b){c.cellhandles.ShowCellHandles(!1);if(c=SocialCalc.GetEditorCellElement(c,c.ecell.row,c.ecell.col))c=SocialCalc.GetElementPosition(c.element),a.container.style.left=c.left-1+"px",a.container.style.top=c.top-1+"px";a.container.style.display="block";a.interval&&window.clearInterval(a.interval);a.interval=window.setInterval(SocialCalc.InputEchoHeartbeat,50)}else a.interval&&window.clearInterval(a.interval),a.container.style.display="none"};
SocialCalc.SetInputEchoText=function(a,b){var c=SocialCalc.Constants,d;d=SocialCalc.special_chars(b);d=d.replace(/\n/g,"<br>");a.text!=d&&(a.main.innerHTML=d,a.text=d);d=b.match(/.*[\+\-\*\/\&\^\<\>\=\,\(]([A-Za-z][A-ZA-z]\w*?)\([^\)]*$/);if("="==b.charAt(0)&&d){if(d=d[1].toUpperCase(),SocialCalc.Formula.FunctionList[d]?(SocialCalc.Formula.FillFunctionInfo(),c=SocialCalc.special_chars(d+"("+SocialCalc.Formula.FunctionArgString(d)+")")):c=c.ietUnknownFunction+d,a.prompt.innerHTML!=c)a.prompt.innerHTML=
c,a.prompt.style.display="block"}else"none"!=a.prompt.style.display&&(a.prompt.innerHTML="",a.prompt.style.display="none")};SocialCalc.InputEchoHeartbeat=function(){var a=SocialCalc.Keyboard.focusTable;if(!a)return!0;a.inputEcho.SetText(a.inputBox.GetText()+"_")};SocialCalc.InputEchoMouseDown=function(){var a=SocialCalc.Keyboard.focusTable;if(!a)return!0;a.inputBox.element.focus()};
SocialCalc.CellHandles=function(a){if(!a.noEdit){this.editor=a;this.movedmouse=this.noCursorSuffix=!1;this.draghandle=document.createElement("div");SocialCalc.setStyles(this.draghandle,"display:none;position:absolute;zIndex:8;border:1px solid white;width:4px;height:4px;fontSize:1px;backgroundColor:#0E93D8;cursor:default;");this.draghandle.innerHTML="&nbsp;";a.toplevel.appendChild(this.draghandle);SocialCalc.AssignID(a,this.draghandle,"draghandle");var b="png";navigator.userAgent.match(/MSIE 6\.0/)&&
(b="gif");this.dragpalette=document.createElement("div");SocialCalc.setStyles(this.dragpalette,"display:none;position:absolute;zIndex:8;width:90px;height:90px;fontSize:1px;textAlign:center;cursor:default;backgroundImage:url("+SocialCalc.Constants.defaultImagePrefix+"drag-handles."+b+");");this.dragpalette.innerHTML="&nbsp;";a.toplevel.appendChild(this.dragpalette);SocialCalc.AssignID(a,this.dragpalette,"dragpalette");this.dragtooltip=document.createElement("div");SocialCalc.setStyles(this.dragtooltip,
"display:none;position:absolute;zIndex:9;border:1px solid black;width:100px;height:auto;fontSize:10px;backgroundColor:#FFFFFF;");this.dragtooltip.innerHTML="&nbsp;";a.toplevel.appendChild(this.dragtooltip);SocialCalc.AssignID(a,this.dragtooltip,"dragtooltip");this.fillinghandle=document.createElement("div");SocialCalc.setStyles(this.fillinghandle,"display:none;position:absolute;zIndex:9;border:1px solid black;width:auto;height:14px;fontSize:10px;backgroundColor:#FFFFFF;");this.fillinghandle.innerHTML=
"&nbsp;";a.toplevel.appendChild(this.fillinghandle);SocialCalc.AssignID(a,this.fillinghandle,"fillinghandle");if(this.draghandle.addEventListener)this.draghandle.addEventListener("mousemove",SocialCalc.CellHandlesMouseMoveOnHandle,!1),this.dragpalette.addEventListener("mousedown",SocialCalc.CellHandlesMouseDown,!1),this.dragpalette.addEventListener("mousemove",SocialCalc.CellHandlesMouseMoveOnHandle,!1);else if(this.draghandle.attachEvent)this.draghandle.attachEvent("onmousemove",SocialCalc.CellHandlesMouseMoveOnHandle),
this.dragpalette.attachEvent("onmousedown",SocialCalc.CellHandlesMouseDown),this.dragpalette.attachEvent("onmousemove",SocialCalc.CellHandlesMouseMoveOnHandle);else throw"Browser not supported";}};SocialCalc.CellHandles.prototype.ShowCellHandles=function(a,b){return SocialCalc.ShowCellHandles(this,a,b)};
SocialCalc.ShowCellHandles=function(a,b,c){var d=a.editor,e=!1,g;if(d&&(b&&(b=d.ecell.row,g=d.ecell.col,"start"==d.state&&!(b>=d.lastvisiblerow)&&!(g>=d.lastvisiblecol)&&!(b<d.firstscrollingrow)&&!(g<d.firstscrollingcol)&&!(d.rowpositions[b+1]+20>d.horizontaltablecontrol.controlborder)&&!(d.rowpositions[b+1]-10<d.headposition.top)&&!(d.colpositions[g+1]+20>d.verticaltablecontrol.controlborder)&&!(d.colpositions[g+1]-30<d.headposition.left)&&(a.draghandle.style.left=d.colpositions[g+1]-1+"px",a.draghandle.style.top=
d.rowpositions[b+1]-1+"px",a.draghandle.style.display="block",c&&(a.draghandle.style.display="none",a.dragpalette.style.left=d.colpositions[g+1]-45+"px",a.dragpalette.style.top=d.rowpositions[b+1]-45+"px",a.dragpalette.style.display="block",e=SocialCalc.GetViewportInfo(),a.dragtooltip.style.right=e.width-(d.colpositions[g+1]-1)+"px",a.dragtooltip.style.bottom=e.height-(d.rowpositions[b+1]-1)+"px",a.dragtooltip.style.display="none"),e=!0)),e||(a.draghandle.style.display="none"),!c))a.dragpalette.style.display=
"none",a.dragtooltip.style.display="none"};
SocialCalc.CellHandlesMouseMoveOnHandle=function(a){var b=SocialCalc.Constants,c=a||window.event,a=c.target||c.srcElement,d=SocialCalc.GetViewportInfo(),e=c.clientX+d.horizontalScroll,d=c.clientY+d.verticalScroll;editor=SocialCalc.Keyboard.focusTable;if(!editor)return!0;c=editor.cellhandles;if(!c.editor)return!0;if(!editor.cellhandles.mouseDown){editor.cellhandles.ShowCellHandles(!0,!0);if(a==c.dragpalette){b=SocialCalc.SegmentDivHit([b.CH_radius1,b.CH_radius2],editor.cellhandles.dragpalette,e,d);
if(0==b){SocialCalc.CellHandlesHoverTimeout();return}c.tooltipstimer&&(window.clearTimeout(c.tooltipstimer),c.tooltipstimer=null);c.tooltipswhichhandle=b;c.tooltipstimer=window.setTimeout(SocialCalc.CellHandlesTooltipsTimeout,700)}c.timer&&(window.clearTimeout(c.timer),c.timer=null);c.timer=window.setTimeout(SocialCalc.CellHandlesHoverTimeout,3E3)}};
SocialCalc.SegmentDivHit=function(a,b,c,d){var e=b.offsetWidth,g=b.offsetHeight,h=b.offsetLeft,b=b.offsetTop,j=0,k=a,l=Math.sqrt(Math.pow(c-h-(e/2-0.5),2)+Math.pow(d-b-(g/2-0.5),2));if(2==k.length)return c>=h&&c<h+e/2&&d>=b&&d<b+g/2&&(l<=a[0]?j=-1:l<=a[1]&&(j=1)),c>=h+e/2&&c<h+e&&d>=b&&d<b+g/2&&(l<=a[0]?j=-2:l<=a[1]&&(j=2)),c>=h+e/2&&c<h+e&&d>=b+g/2&&d<b+g&&(l<=a[0]?j=-3:l<=a[1]&&(j=3)),c>=h&&c<h+e/2&&d>=b+g/2&&d<b+g&&(l<=a[0]?j=-4:l<=a[1]&&(j=4)),j;for(;;)if(c>=h&&c<h+e/2&&d>=b&&d<b+g/2){quadrant+=
"1";j=k[0];if("number"==typeof j)break;k=j;e/=2;g/=2}else if(c>=h+e/2&&c<h+e&&d>=b&&d<b+g/2){quadrant+="2";j=k[1];if("number"==typeof j)break;k=j;e/=2;h+=e;g/=2}else if(c>=h+e/2&&c<h+e&&d>=b+g/2&&d<b+g){quadrant+="3";j=k[2];if("number"==typeof j)break;k=j;e/=2;h+=e;g/=2;b+=g}else if(c>=h&&c<h+e/2&&d>=b+g/2&&d<b+g){quadrant+="4";j=k[3];if("number"==typeof j)break;k=j;e/=2;g/=2;b+=g}else return 0;return j};
SocialCalc.CellHandlesHoverTimeout=function(){editor=SocialCalc.Keyboard.focusTable;if(!editor)return!0;var a=editor.cellhandles;a.timer&&(window.clearTimeout(a.timer),a.timer=null);a.tooltipstimer&&(window.clearTimeout(a.tooltipstimer),a.tooltipstimer=null);editor.cellhandles.ShowCellHandles(!0,!1)};
SocialCalc.CellHandlesTooltipsTimeout=function(){editor=SocialCalc.Keyboard.focusTable;if(!editor)return!0;var a=editor.cellhandles;a.tooltipstimer&&(window.clearTimeout(a.tooltipstimer),a.tooltipstimer=null);var b=a.tooltipswhichhandle;if(0==b)SocialCalc.CellHandlesHoverTimeout();else{if(-3==b)a.dragtooltip.innerHTML=scc.s_CHfillAllTooltip;else if(3==b)a.dragtooltip.innerHTML=scc.s_CHfillContentsTooltip;else if(-2==b)a.dragtooltip.innerHTML=scc.s_CHmovePasteAllTooltip;else if(-4==b)a.dragtooltip.innerHTML=
scc.s_CHmoveInsertAllTooltip;else if(2==b)a.dragtooltip.innerHTML=scc.s_CHmovePasteContentsTooltip;else if(4==b)a.dragtooltip.innerHTML=scc.s_CHmoveInsertContentsTooltip;else{a.dragtooltip.innerHTML="&nbsp;";a.dragtooltip.style.display="none";return}a.dragtooltip.style.display="block"}};
SocialCalc.CellHandlesMouseDown=function(a){var b=SocialCalc.Constants,c,d,a=a||window.event;c=SocialCalc.GetViewportInfo();var e=a.clientX+c.horizontalScroll,g=a.clientY+c.verticalScroll,h=SocialCalc.EditorMouseInfo;c=SocialCalc.Keyboard.focusTable;if(!c)return!0;if(!c.busy){var j=c.cellhandles;j.movedmouse=!1;j.timer&&(window.clearTimeout(j.timer),j.timer=null);j.tooltipstimer&&(window.clearTimeout(j.tooltipstimer),j.tooltipstimer=null);j.dragtooltip.innerHTML="&nbsp;";j.dragtooltip.style.display=
"none";d=c.range;var k=SocialCalc.SegmentDivHit([b.CH_radius1,b.CH_radius2],c.cellhandles.dragpalette,e,g);if(1==k||-1==k||0==k)j.ShowCellHandles(!0,!1);else{h.ignore=!0;-3==k?(j.dragtype="Fill",j.noCursorSuffix=!1):3==k?(j.dragtype="FillC",j.noCursorSuffix=!1):-2==k?(j.dragtype="Move",j.noCursorSuffix=!0):-4==k?(j.dragtype="MoveI",j.noCursorSuffix=!1):2==k?(j.dragtype="MoveC",j.noCursorSuffix=!0):4==k&&(j.dragtype="MoveIC",j.noCursorSuffix=!1);j.filltype=null;switch(j.dragtype){case "Fill":case "FillC":d.hasrange||
c.RangeAnchor();break;case "Move":case "MoveI":case "MoveC":case "MoveIC":d.hasrange||c.RangeAnchor();c.range2.top=c.range.top;c.range2.right=c.range.right;c.range2.bottom=c.range.bottom;c.range2.left=c.range.left;c.range2.hasrange=!0;c.RangeRemove();break;default:return}j.fillinghandle.style.left=e+"px";j.fillinghandle.style.top=g-17+"px";j.fillinghandle.innerHTML=b.s_CHindicatorOperationLookup[j.dragtype]+(b.s_CHindicatorDirectionLookup[c.cellhandles.filltype]||"");j.fillinghandle.style.display=
"block";j.ShowCellHandles(!0,!1);j.mouseDown=!0;h.editor=c;b=c.ecell.coord;j.startingcoord=b;j.startingX=e;j.startingY=g;h.mouselastcoord=b;SocialCalc.KeyboardSetFocus(c);document.addEventListener?(document.addEventListener("mousemove",SocialCalc.CellHandlesMouseMove,!0),document.addEventListener("mouseup",SocialCalc.CellHandlesMouseUp,!0)):j.draghandle.attachEvent&&(j.draghandle.setCapture(),j.draghandle.attachEvent("onmousemove",SocialCalc.CellHandlesMouseMove),j.draghandle.attachEvent("onmouseup",
SocialCalc.CellHandlesMouseUp),j.draghandle.attachEvent("onlosecapture",SocialCalc.CellHandlesMouseUp));a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1}}};
SocialCalc.CellHandlesMouseMove=function(a){var b=SocialCalc.Constants,c,d,e,g,a=a||window.event;c=SocialCalc.GetViewportInfo();var h=a.clientX+c.horizontalScroll,j=a.clientY+c.verticalScroll,k=SocialCalc.EditorMouseInfo;if(c=k.editor){var l=c.cellhandles;if(d=SocialCalc.GridMousePosition(c,h,j))if(d&&!d.coord)SocialCalc.SetDragAutoRepeat(c,d,SocialCalc.CellHandlesDragAutoRepeat);else if(SocialCalc.SetDragAutoRepeat(c,null),d.coord){e=SocialCalc.coordToCr(c.cellhandles.startingcoord);g=SocialCalc.coordToCr(d.coord);
l.movedmouse=!0;switch(l.dragtype){case "Fill":case "FillC":d.coord==l.startingcoord?(l.filltype=null,l.startingX=h,l.startingY=j):l.filltype?"Down"==l.filltype?(g.col=e.col,g.row<e.row&&(g.row=e.row)):(g.row=e.row,g.col<e.col&&(g.col=e.col)):(10<Math.abs(j-l.startingY)?l.filltype="Down":10<Math.abs(h-l.startingX)&&(l.filltype="Right"),g.col=e.col,g.row=e.row);d.coord=SocialCalc.crToCoord(g.col,g.row);d.coord!=k.mouselastcoord&&(c.MoveECell(d.coord),c.RangeExtend());break;case "Move":case "MoveC":d.coord!=
k.mouselastcoord&&(c.MoveECell(d.coord),e=c.range2.right-c.range2.left+d.col,g=c.range2.bottom-c.range2.top+d.row,c.RangeAnchor(SocialCalc.crToCoord(e,g)),c.RangeExtend());break;case "MoveI":case "MoveIC":if(d.coord==l.startingcoord?(l.filltype=null,l.startingX=h,l.startingY=j):l.filltype?"Vertical"==l.filltype?(g.col=c.range2.left,g.row>=c.range2.top&&g.row<=c.range2.bottom+1&&(g.row=c.range2.bottom+2)):(g.row=c.range2.top,g.col>=c.range2.left&&g.col<=c.range2.right+1&&(g.col=c.range2.right+2)):
(10<Math.abs(j-l.startingY)?l.filltype="Vertical":10<Math.abs(h-l.startingX)&&(l.filltype="Horizontal"),g.col=e.col,g.row=e.row),d.coord=SocialCalc.crToCoord(g.col,g.row),d.coord!=k.mouselastcoord)c.MoveECell(d.coord),l.filltype?(e=c.range2.right-c.range2.left+g.col,g=c.range2.bottom-c.range2.top+g.row,c.RangeAnchor(SocialCalc.crToCoord(e,g)),c.RangeExtend()):c.RangeRemove()}l.fillinghandle.style.left=h+"px";l.fillinghandle.style.top=j-17+"px";l.fillinghandle.innerHTML=b.s_CHindicatorOperationLookup[l.dragtype]+
(b.s_CHindicatorDirectionLookup[c.cellhandles.filltype]||"");l.fillinghandle.style.display="block";k.mouselastcoord=d.coord;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1}}};
SocialCalc.CellHandlesDragAutoRepeat=function(a,b){var c=SocialCalc.EditorMouseInfo,d=c.editor;if(d){var e=d.cellhandles,g=SocialCalc.coordToCr(d.cellhandles.startingcoord),h=SocialCalc.coordToCr(a),j,k=0,l=0;"left"==b?l=-1:"right"==b?l=1:"up"==b?k=-1:"down"==b&&(k=1);d.ScrollRelativeBoth(k,l);switch(e.dragtype){case "Fill":case "FillC":e.filltype?"Down"==e.filltype?(h.col=g.col,h.row<g.row&&(h.row=g.row)):(h.row=g.row,h.col<g.col&&(h.col=g.col)):(h.col=g.col,h.row=g.row);j=SocialCalc.crToCoord(h.col,
h.row);j!=c.mouselastcoord&&(d.MoveECell(a),d.RangeExtend());break;case "Move":case "MoveC":a!=c.mouselastcoord&&(d.MoveECell(a),e=d.range2.right-d.range2.left+d.ecell.col,h=d.range2.bottom-d.range2.top+d.ecell.row,d.RangeAnchor(SocialCalc.crToCoord(e,h)),d.RangeExtend());break;case "MoveI":case "MoveIC":if(e.filltype?"Vertical"==e.filltype?(h.col=d.range2.left,h.row>=d.range2.top&&h.row<=d.range2.bottom+1&&(h.row=d.range2.bottom+2)):(h.row=d.range2.top,h.col>=d.range2.left&&h.col<=d.range2.right+
1&&(h.col=d.range2.right+2)):(h.col=g.col,h.row=g.row),j=SocialCalc.crToCoord(h.col,h.row),j!=c.mouselastcoord)d.MoveECell(j),e=d.range2.right-d.range2.left+h.col,h=d.range2.bottom-d.range2.top+h.row,d.RangeAnchor(SocialCalc.crToCoord(e,h)),d.RangeExtend()}c.mouselastcoord=j}};
SocialCalc.CellHandlesMouseUp=function(a){var b,c,d,e,g,h,a=a||window.event;b=SocialCalc.GetViewportInfo();c=a.clientX+b.horizontalScroll;e=a.clientY+b.verticalScroll;var j=SocialCalc.EditorMouseInfo;if(b=j.editor){var k=b.cellhandles;j.ignore=!1;c=SocialCalc.GridMousePosition(b,c,e);SocialCalc.SetDragAutoRepeat(b,null);k.mouseDown=!1;k.noCursorSuffix=!1;k.fillinghandle.style.display="none";c||(c={});c.coord||(c.coord=b.ecell.coord);switch(k.dragtype){case "Fill":case "Move":case "MoveI":d=" all";
break;case "FillC":case "MoveC":case "MoveIC":d=" formulas"}k.movedmouse||(k.dragtype="Nothing");switch(k.dragtype){case "Nothing":b.Range2Remove();b.RangeRemove();break;case "Fill":case "FillC":e=SocialCalc.coordToCr(k.startingcoord);g=SocialCalc.coordToCr(c.coord);k.filltype&&("Down"==k.filltype?g.col=e.col:g.row=e.row);c.coord=SocialCalc.crToCoord(g.col,g.row);b.MoveECell(c.coord);b.RangeExtend();c="Right"==b.cellhandles.filltype?"right":"down";d="fill"+c+" "+SocialCalc.crToCoord(b.range.left,
b.range.top)+":"+SocialCalc.crToCoord(b.range.right,b.range.bottom)+d;b.EditorScheduleSheetCommands(d,!0,!1);break;case "Move":case "MoveC":b.context.cursorsuffix="";d="movepaste "+SocialCalc.crToCoord(b.range2.left,b.range2.top)+":"+SocialCalc.crToCoord(b.range2.right,b.range2.bottom)+" "+b.ecell.coord+d;b.EditorScheduleSheetCommands(d,!0,!1);b.Range2Remove();break;case "MoveI":case "MoveIC":b.context.cursorsuffix="",c=b.range2.right-b.range2.left,e=b.range2.bottom-b.range2.top,g=b.ecell.col-b.range2.left,
h=b.ecell.row-b.range2.top,d="moveinsert "+SocialCalc.crToCoord(b.range2.left,b.range2.top)+":"+SocialCalc.crToCoord(b.range2.right,b.range2.bottom)+" "+b.ecell.coord+d,b.EditorScheduleSheetCommands(d,!0,!1),b.Range2Remove(),b.RangeRemove()," Horizontal"==b.cellhandles.filltype&&0<g?b.MoveECell(SocialCalc.crToCoord(b.ecell.col-c-1,b.ecell.row)):" Vertical"==b.cellhandles.filltype&&0<h&&b.MoveECell(SocialCalc.crToCoord(b.ecell.col,b.ecell.row-e-1)),b.RangeAnchor(SocialCalc.crToCoord(b.ecell.col+c,
b.ecell.row+e)),b.RangeExtend()}a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1;document.removeEventListener?(document.removeEventListener("mousemove",SocialCalc.CellHandlesMouseMove,!0),document.removeEventListener("mouseup",SocialCalc.CellHandlesMouseUp,!0)):k.draghandle.detachEvent&&(k.draghandle.detachEvent("onlosecapture",SocialCalc.CellHandlesMouseUp),k.draghandle.detachEvent("onmouseup",SocialCalc.CellHandlesMouseUp),k.draghandle.detachEvent("onmousemove",
SocialCalc.CellHandlesMouseMove),k.draghandle.releaseCapture());j.editor=null;return!1}};
SocialCalc.TableControl=function(a,b,c){var d=SocialCalc.Constants;this.editor=a;this.vertical=b;this.size=c;this.thumbpos=this.scrollareasize=this.scrollareaend=this.scrollareastart=this.morebuttonstart=this.lessbuttonstart=this.panesliderstart=this.endcapstart=this.controlborder=this.thumb=this.scrollarea=this.morebutton=this.lessbutton=this.paneslider=this.endcap=this.main=null;this.controlthickness=d.defaultTableControlThickness;this.sliderthickness=d.defaultTCSliderThickness;this.buttonthickness=
d.defaultTCButtonThickness;this.thumbthickness=d.defaultTCThumbThickness;this.minscrollingpanesize=this.buttonthickness+this.buttonthickness+this.thumbthickness+20};SocialCalc.TableControl.prototype.CreateTableControl=function(){return SocialCalc.CreateTableControl(this)};SocialCalc.TableControl.prototype.PositionTableControlElements=function(){SocialCalc.PositionTableControlElements(this)};SocialCalc.TableControl.prototype.ComputeTableControlPositions=function(){SocialCalc.ComputeTableControlPositions(this)};
SocialCalc.CreateTableControl=function(a){var b,c,d=SocialCalc.AssignID,e=SocialCalc.setStyles,g=SocialCalc.Constants,h=a.editor.imageprefix,j=a.vertical?"v":"h";a.main=document.createElement("div");b=a.main.style;b.height=(a.vertical?a.size:a.controlthickness)+"px";b.width=(a.vertical?a.controlthickness:a.size)+"px";b.zIndex=0;e(a.main,g.TCmainStyle);b.backgroundImage="url("+h+"main-"+j+".gif)";g.TCmainClass&&(a.main.className=g.TCmainClass);a.main.style.display="none";a.endcap=document.createElement("div");
b=a.endcap.style;b.height=a.controlthickness+"px";b.width=a.controlthickness+"px";b.zIndex=1;b.overflow="hidden";b.position="absolute";e(a.endcap,g.TCendcapStyle);b.backgroundImage="url("+h+"endcap-"+j+".gif)";g.TCendcapClass&&(a.endcap.className=g.TCendcapClass);d(a.editor,a.endcap,"endcap"+j);a.main.appendChild(a.endcap);a.paneslider=document.createElement("div");b=a.paneslider.style;b.height=(a.vertical?a.sliderthickness:a.controlthickness)+"px";b.overflow="hidden";b.width=(a.vertical?a.controlthickness:
a.sliderthickness)+"px";b.position="absolute";b[a.vertical?"top":"left"]="4px";b.zIndex=3;e(a.paneslider,g.TCpanesliderStyle);b.backgroundImage="url("+h+"paneslider-"+j+".gif)";g.TCpanesliderClass&&(a.paneslider.className=g.TCpanesliderClass);d(a.editor,a.paneslider,"paneslider"+j);(function(a,b,c){g["s_"+b+"Tooltip"+c]&&SocialCalc.TooltipRegister(a,g["s_"+b+"Tooltip"+c],null)})(a.paneslider,"paneslider",j);b={MouseDown:SocialCalc.TCPSDragFunctionStart,MouseMove:SocialCalc.TCPSDragFunctionMove,MouseUp:SocialCalc.TCPSDragFunctionStop,
Disabled:function(){return a.editor.busy}};b.control=a;SocialCalc.DragRegister(a.paneslider,a.vertical,!a.vertical,b);a.main.appendChild(a.paneslider);a.lessbutton=document.createElement("div");b=a.lessbutton.style;b.height=(a.vertical?a.buttonthickness:a.controlthickness)+"px";b.width=(a.vertical?a.controlthickness:a.buttonthickness)+"px";b.zIndex=2;b.overflow="hidden";b.position="absolute";e(a.lessbutton,g.TClessbuttonStyle);b.backgroundImage="url("+h+"less-"+j+"n.gif)";g.TClessbuttonClass&&(a.lessbutton.className=
g.TClessbuttonClass);d(a.editor,a.lessbutton,"lessbutton"+j);c={repeatwait:g.TClessbuttonRepeatWait,repeatinterval:g.TClessbuttonRepeatInterval,normalstyle:"backgroundImage:url("+h+"less-"+j+"n.gif);",downstyle:"backgroundImage:url("+h+"less-"+j+"d.gif);",hoverstyle:"backgroundImage:url("+h+"less-"+j+"h.gif);"};b={MouseDown:function(){a.editor.busy||a.editor.ScrollRelative(a.vertical,-1)},Repeat:function(){a.editor.busy||a.editor.ScrollRelative(a.vertical,-1)},Disabled:function(){return a.editor.busy}};
SocialCalc.ButtonRegister(a.lessbutton,c,b);a.main.appendChild(a.lessbutton);a.morebutton=document.createElement("div");b=a.morebutton.style;b.height=(a.vertical?a.buttonthickness:a.controlthickness)+"px";b.width=(a.vertical?a.controlthickness:a.buttonthickness)+"px";b.zIndex=2;b.overflow="hidden";b.position="absolute";e(a.morebutton,g.TCmorebuttonStyle);b.backgroundImage="url("+h+"more-"+j+"n.gif)";g.TCmorebuttonClass&&(a.morebutton.className=g.TCmorebuttonClass);d(a.editor,a.morebutton,"morebutton"+
j);c={repeatwait:g.TCmorebuttonRepeatWait,repeatinterval:g.TCmorebuttonRepeatInterval,normalstyle:"backgroundImage:url("+h+"more-"+j+"n.gif);",downstyle:"backgroundImage:url("+h+"more-"+j+"d.gif);",hoverstyle:"backgroundImage:url("+h+"more-"+j+"h.gif);"};b={MouseDown:function(){a.editor.busy||a.editor.ScrollRelative(a.vertical,1)},Repeat:function(){a.editor.busy||a.editor.ScrollRelative(a.vertical,1)},Disabled:function(){return a.editor.busy}};SocialCalc.ButtonRegister(a.morebutton,c,b);a.main.appendChild(a.morebutton);
a.scrollarea=document.createElement("div");b=a.scrollarea.style;b.height=a.controlthickness+"px";b.width=a.controlthickness+"px";b.zIndex=1;b.overflow="hidden";b.position="absolute";e(a.scrollarea,g.TCscrollareaStyle);b.backgroundImage="url("+h+"scrollarea-"+j+".gif)";g.TCscrollareaClass&&(a.scrollarea.className=g.TCscrollareaClass);d(a.editor,a.scrollarea,"scrollarea"+j);c={repeatwait:g.TCscrollareaRepeatWait,repeatinterval:g.TCscrollareaRepeatWait};b={MouseDown:SocialCalc.ScrollAreaClick,Repeat:SocialCalc.ScrollAreaClick,
Disabled:function(){return a.editor.busy}};b.control=a;SocialCalc.ButtonRegister(a.scrollarea,c,b);a.main.appendChild(a.scrollarea);a.thumb=document.createElement("div");b=a.thumb.style;b.height=(a.vertical?a.thumbthickness:a.controlthickness)+"px";b.width=(a.vertical?a.controlthickness:a.thumbthickness)+"px";b.zIndex=2;b.overflow="hidden";b.position="absolute";e(a.thumb,g.TCthumbStyle);a.thumb.style.backgroundImage="url("+h+"thumb-"+j+"n.gif)";g.TCthumbClass&&(a.thumb.className=g.TCthumbClass);d(a.editor,
a.thumb,"thumb"+j);b={MouseDown:SocialCalc.TCTDragFunctionStart,MouseMove:SocialCalc.TCTDragFunctionMove,MouseUp:SocialCalc.TCTDragFunctionStop,Disabled:function(){return a.editor.busy}};b.control=a;SocialCalc.DragRegister(a.thumb,a.vertical,!a.vertical,b);c={normalstyle:"backgroundImage:url("+h+"thumb-"+j+"n.gif)",name:"Thumb",downstyle:"backgroundImage:url("+h+"thumb-"+j+"d.gif)",hoverstyle:"backgroundImage:url("+h+"thumb-"+j+"h.gif)"};SocialCalc.ButtonRegister(a.thumb,c,null);a.main.appendChild(a.thumb);
return a.main};SocialCalc.ScrollAreaClick=function(a,b,c){a=c.functionobj.control;SocialCalc.GetElementPosition(c.element);a.editor.busy||a.editor.PageRelative(a.vertical,(a.vertical?b.clientY:b.clientX)>a.thumbpos?1:-1)};
SocialCalc.PositionTableControlElements=function(a){var b,c,d=a.editor;a.vertical?(b=a.controlborder+"px",a.endcap.style.top=a.endcapstart+"px",a.endcap.style.left=b,a.paneslider.style.top=a.panesliderstart+"px",a.paneslider.style.left=b,a.lessbutton.style.top=a.lessbuttonstart+"px",a.lessbutton.style.left=b,a.morebutton.style.top=a.morebuttonstart+"px",a.morebutton.style.left=b,a.scrollarea.style.top=a.scrollareastart+"px",a.scrollarea.style.left=b,a.scrollarea.style.height=a.scrollareasize+"px",
c=Math.max(d.context.sheetobj.attribs.lastrow,d.firstscrollingrow+1),c=(d.firstscrollingrow-(d.lastnonscrollingrow+1))*(a.scrollareasize-3*a.thumbthickness)/(c-(d.lastnonscrollingrow+1))+a.scrollareastart-1,c=Math.floor(c),a.thumb.style.top=c+"px",a.thumb.style.left=b):(b=a.controlborder+"px",a.endcap.style.left=a.endcapstart+"px",a.endcap.style.top=b,a.paneslider.style.left=a.panesliderstart+"px",a.paneslider.style.top=b,a.lessbutton.style.left=a.lessbuttonstart+"px",a.lessbutton.style.top=b,a.morebutton.style.left=
a.morebuttonstart+"px",a.morebutton.style.top=b,a.scrollarea.style.left=a.scrollareastart+"px",a.scrollarea.style.top=b,a.scrollarea.style.width=a.scrollareasize+"px",c=Math.max(d.context.sheetobj.attribs.lastcol,d.firstscrollingcol+1),c=(d.firstscrollingcol-(d.lastnonscrollingcol+1))*(a.scrollareasize-a.thumbthickness)/(c-d.lastnonscrollingcol)+a.scrollareastart-1,c=Math.floor(c),a.thumb.style.left=c+"px",a.thumb.style.top=b);a.thumbpos=c;a.main.style.display="block"};
SocialCalc.ComputeTableControlPositions=function(a){var b=a.editor;if(!b.gridposition||!b.headposition)throw"Can't compute table control positions before editor positions";a.vertical?(a.controlborder=b.gridposition.left+b.tablewidth,a.endcapstart=b.gridposition.top,a.panesliderstart=b.firstscrollingrowtop-a.sliderthickness,a.lessbuttonstart=b.firstscrollingrowtop-1,a.morebuttonstart=b.gridposition.top+b.tableheight-a.buttonthickness,a.scrollareastart=b.firstscrollingrowtop-1+a.buttonthickness):(a.controlborder=
b.gridposition.top+b.tableheight,a.endcapstart=b.gridposition.left,a.panesliderstart=b.firstscrollingcolleft-a.sliderthickness,a.lessbuttonstart=b.firstscrollingcolleft-1,a.morebuttonstart=b.gridposition.left+b.tablewidth-a.buttonthickness,a.scrollareastart=b.firstscrollingcolleft-1+a.buttonthickness);a.scrollareaend=a.morebuttonstart-1;a.scrollareasize=a.scrollareaend-a.scrollareastart+1};
SocialCalc.TCPSDragFunctionStart=function(a,b,c){var d=c.functionobj.control.editor,e=SocialCalc.Constants;SocialCalc.DragFunctionStart(a,b,c);b.trackingline=document.createElement("div");b.trackingline.style.height=c.vertical?e.TCPStrackinglineThickness:d.tableheight-(d.headposition.top-d.gridposition.top)+"px";b.trackingline.style.width=c.vertical?d.tablewidth-(d.headposition.left-d.gridposition.left)+"px":e.TCPStrackinglineThickness;b.trackingline.style.backgroundImage="url("+d.imageprefix+"trackingline-"+
(c.vertical?"v":"h")+".gif)";e.TCPStrackinglineClass&&(b.trackingline.className=e.TCPStrackinglineClass);SocialCalc.setStyles(b.trackingline,e.TCPStrackinglineStyle);c.vertical?(row=SocialCalc.Lookup(b.clientY+c.functionobj.control.sliderthickness,d.rowpositions),b.trackingline.style.top=(d.rowpositions[row]||d.headposition.top)+"px",b.trackingline.style.left=d.headposition.left+"px",d.context.rowpanes.length-1&&(d.context.SetRowPaneFirstLast(1,d.context.rowpanes[0].last+1,d.context.rowpanes[0].last+
1),d.FitToEditTable(),d.ScheduleRender())):(col=SocialCalc.Lookup(b.clientX+c.functionobj.control.sliderthickness,d.colpositions),b.trackingline.style.top=d.headposition.top+"px",b.trackingline.style.left=(d.colpositions[col]||d.headposition.left)+"px",d.context.colpanes.length-1&&(d.context.SetColPaneFirstLast(1,d.context.colpanes[0].last+1,d.context.colpanes[0].last+1),d.FitToEditTable(),d.ScheduleRender()));d.griddiv.appendChild(b.trackingline)};
SocialCalc.TCPSDragFunctionMove=function(a,b,c){var d,e;e=c.functionobj.control;d=e.sliderthickness;var g=e.editor;c.vertical?(e=e.morebuttonstart-e.minscrollingpanesize-b.offsetY,b.clientY>e&&(b.clientY=e),e=g.headposition.top-d-b.offsetY,b.clientY<e&&(b.clientY=e),d=SocialCalc.Lookup(b.clientY+d,g.rowpositions),b.trackingline.style.top=(g.rowpositions[d]||g.headposition.top)+"px"):(e=e.morebuttonstart-e.minscrollingpanesize-b.offsetX,b.clientX>e&&(b.clientX=e),e=g.headposition.left-d-b.offsetX,
b.clientX<e&&(b.clientX=e),d=SocialCalc.Lookup(b.clientX+d,g.colpositions),b.trackingline.style.left=(g.colpositions[d]||g.headposition.left)+"px");SocialCalc.DragFunctionPosition(a,b,c)};
SocialCalc.TCPSDragFunctionStop=function(a,b,c){var d,e=c.functionobj.control;d=e.sliderthickness;a=e.editor;c.vertical?(c=e.morebuttonstart-e.minscrollingpanesize-b.offsetY,b.clientY>c&&(b.clientY=c),c=a.headposition.top-d-b.offsetY,b.clientY<c&&(b.clientY=c),d=SocialCalc.Lookup(b.clientY+d,a.rowpositions),d>a.context.sheetobj.attribs.lastrow&&(d=a.context.sheetobj.attribs.lastrow),!d||d<=a.context.rowpanes[0].first)?1<a.context.rowpanes.length&&(a.context.rowpanes.length=1):a.context.rowpanes.length-
1?a.timeout||(a.context.SetRowPaneFirstLast(0,a.context.rowpanes[0].first,d-1),a.context.SetRowPaneFirstLast(1,d,d)):(a.context.SetRowPaneFirstLast(0,a.context.rowpanes[0].first,d-1),a.context.SetRowPaneFirstLast(1,d,d)):(c=e.morebuttonstart-e.minscrollingpanesize-b.offsetX,b.clientX>c&&(b.clientX=c),c=a.headposition.left-d-b.offsetX,b.clientX<c&&(b.clientX=c),d=SocialCalc.Lookup(b.clientX+d,a.colpositions),d>a.context.sheetobj.attribs.lastcol&&(d=a.context.sheetobj.attribs.lastcol),!d||d<=a.context.colpanes[0].first)?
1<a.context.colpanes.length&&(a.context.colpanes.length=1):a.context.colpanes.length-1?a.timeout||(a.context.SetColPaneFirstLast(0,a.context.colpanes[0].first,d-1),a.context.SetColPaneFirstLast(1,d,d)):(a.context.SetColPaneFirstLast(0,a.context.colpanes[0].first,d-1),a.context.SetColPaneFirstLast(1,d,d));a.FitToEditTable();a.griddiv.removeChild(b.trackingline);a.ScheduleRender()};
SocialCalc.TCTDragFunctionStart=function(a,b,c){var d=c.functionobj.control,e=d.editor,g=SocialCalc.Constants;SocialCalc.DragFunctionStart(a,b,c);b.thumbstatus&&(b.thumbstatus.rowmsgele&&(b.thumbstatus.rowmsgele=null),b.thumbstatus.rowpreviewele&&(b.thumbstatus.rowpreviewele=null),e.toplevel.removeChild(b.thumbstatus),b.thumbstatus=null);b.thumbstatus=document.createElement("div");c.vertical?(g.TCTDFSthumbstatusvClass&&(b.thumbstatus.className=g.TCTDFSthumbstatusvClass),SocialCalc.setStyles(b.thumbstatus,
g.TCTDFSthumbstatusvStyle),b.thumbstatus.style.top=b.clientY+g.TCTDFStopOffsetv+"px",b.thumbstatus.style.left=d.controlborder-10-e.tablewidth/2+"px",b.thumbstatus.style.width=e.tablewidth/2+"px",b.thumbcontext=new SocialCalc.RenderContext(e.context.sheetobj),b.thumbcontext.showGrid=!0,b.thumbcontext.rowpanes=[{first:1,last:1}],a=e.context.colpanes[e.context.colpanes.length-1],b.thumbcontext.colpanes=[{first:a.first,last:a.last}],b.thumbstatus.innerHTML='<table cellspacing="0" cellpadding="0"><tr><td valign="top" style="'+
g.TCTDFSthumbstatusrownumStyle+'" class="'+g.TCTDFSthumbstatusrownumClass+'"><div>msg</div></td><td valign="top"><div style="overflow:hidden;">preview</div></td></tr></table>',b.thumbstatus.rowmsgele=b.thumbstatus.firstChild.firstChild.firstChild.firstChild.firstChild,b.thumbstatus.rowpreviewele=b.thumbstatus.firstChild.firstChild.firstChild.childNodes[1].firstChild,e.toplevel.appendChild(b.thumbstatus),SocialCalc.TCTDragFunctionRowSetStatus(b,e,e.firstscrollingrow||1)):(g.TCTDFSthumbstatushClass&&
(b.thumbstatus.className=g.TCTDFSthumbstatushClass),SocialCalc.setStyles(b.thumbstatus,g.TCTDFSthumbstatushStyle),b.thumbstatus.style.top=d.controlborder+g.TCTDFStopOffseth+"px",b.thumbstatus.style.left=b.clientX+g.TCTDFSleftOffseth+"px",e.toplevel.appendChild(b.thumbstatus),b.thumbstatus.innerHTML=g.s_TCTDFthumbstatusPrefixh+SocialCalc.rcColname(e.firstscrollingcol))};
SocialCalc.TCTDragFunctionRowSetStatus=function(a,b,c){a.thumbstatus.rowmsgele.innerHTML=SocialCalc.Constants.s_TCTDFthumbstatusPrefixv+c+" ";a.thumbcontext.rowpanes=[{first:c,last:c}];a.thumbrowshown=c;a.thumbcontext.RenderSheet(a.thumbstatus.rowpreviewele.firstChild,{type:"html"})};
SocialCalc.TCTDragFunctionMove=function(a,b,c){var d,e;d=c.functionobj.control;e=d.editor;var g=SocialCalc.Constants;c.vertical?(b.clientY>d.scrollareaend-b.offsetY-d.thumbthickness+2&&(b.clientY=d.scrollareaend-b.offsetY-d.thumbthickness+2),b.clientY<d.scrollareastart-b.offsetY-1&&(b.clientY=d.scrollareastart-b.offsetY-1),b.thumbstatus.style.top=b.clientY+"px",d=(b.clientY+b.offsetY-d.scrollareastart+1)/(d.scrollareasize-d.thumbthickness)*(e.context.sheetobj.attribs.lastrow-e.lastnonscrollingrow)+
e.lastnonscrollingrow+1,d=Math.floor(d),d<=e.lastnonscrollingrow&&(d=e.lastnonscrollingrow+1),d>e.context.sheetobj.attribs.lastrow&&(d=e.context.sheetobj.attribs.lastrow),d!=b.thumbrowshown&&SocialCalc.TCTDragFunctionRowSetStatus(b,e,d)):(b.clientX>d.scrollareaend-b.offsetX-d.thumbthickness+2&&(b.clientX=d.scrollareaend-b.offsetX-d.thumbthickness+2),b.clientX<d.scrollareastart-b.offsetX-1&&(b.clientX=d.scrollareastart-b.offsetX-1),b.thumbstatus.style.left=b.clientX+"px",d=(b.clientX+b.offsetX-d.scrollareastart+
1)/(d.scrollareasize-d.thumbthickness)*(e.context.sheetobj.attribs.lastcol-e.lastnonscrollingcol)+e.lastnonscrollingcol+1,d=Math.floor(d),d<=e.lastnonscrollingcol&&(d=e.lastnonscrollingcol+1),d>e.context.sheetobj.attribs.lastcol&&(d=e.context.sheetobj.attribs.lastcol),e=g.s_TCTDFthumbstatusPrefixh+SocialCalc.rcColname(d),b.thumbstatus.innerHTML=e);SocialCalc.DragFunctionPosition(a,b,c)};
SocialCalc.TCTDragFunctionStop=function(a,b,c){var d=c.functionobj.control,a=d.editor;c.vertical?(c=(b.clientY+b.offsetY-d.scrollareastart+1)/(d.scrollareasize-d.thumbthickness)*(a.context.sheetobj.attribs.lastrow-a.lastnonscrollingrow)+a.lastnonscrollingrow+1,c=Math.floor(c),c<=a.lastnonscrollingrow&&(c=a.lastnonscrollingrow+1),c>a.context.sheetobj.attribs.lastrow&&(c=a.context.sheetobj.attribs.lastrow),a.context.SetRowPaneFirstLast(a.context.rowpanes.length-1,c,c+1)):(c=(b.clientX+b.offsetX-d.scrollareastart+
1)/(d.scrollareasize-d.thumbthickness)*(a.context.sheetobj.attribs.lastcol-a.lastnonscrollingcol)+a.lastnonscrollingcol+1,c=Math.floor(c),c<=a.lastnonscrollingcol&&(c=a.lastnonscrollingcol+1),c>a.context.sheetobj.attribs.lastcol&&(c=a.context.sheetobj.attribs.lastcol),a.context.SetColPaneFirstLast(a.context.colpanes.length-1,c,c+1));a.FitToEditTable();b.thumbstatus.rowmsgele&&(b.thumbstatus.rowmsgele=null);b.thumbstatus.rowpreviewele&&(b.thumbstatus.rowpreviewele=null);a.toplevel.removeChild(b.thumbstatus);
b.thumbstatus=null;a.ScheduleRender()};SocialCalc.DragInfo={registeredElements:[],draggingElement:null,startX:0,startY:0,startZ:0,clientX:0,clientY:0,offsetX:0,offsetY:0,horizontalScroll:0,verticalScroll:0};
SocialCalc.DragRegister=function(a,b,c,d){var e=SocialCalc.DragInfo;d||(d={MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null});e.registeredElements.push({element:a,vertical:b,horizontal:c,functionobj:d});if(a.addEventListener)a.addEventListener("mousedown",SocialCalc.DragMouseDown,!1);else if(a.attachEvent)a.attachEvent("onmousedown",SocialCalc.DragMouseDown);else throw SocialCalc.Constants.s_BrowserNotSupported;
};SocialCalc.DragUnregister=function(a){var b=SocialCalc.DragInfo,c;if(a)for(c=0;c<b.registeredElements.length;c++)if(b.registeredElements[c].element==a){b.registeredElements.splice(c,1);a.removeEventListener?a.removeEventListener("mousedown",SocialCalc.DragMouseDown,!1):a.detachEvent("onmousedown",SocialCalc.DragMouseDown);break}};
SocialCalc.DragMouseDown=function(a){var a=a||window.event,b=SocialCalc.DragInfo,c=SocialCalc.LookupElement(a.target||a.srcElement,b.registeredElements);if(c&&(!c||!c.functionobj||!c.functionobj.Disabled||!c.functionobj.Disabled(a,b,c))){b.draggingElement=c;var d=SocialCalc.GetViewportInfo();b.horizontalScroll=d.horizontalScroll;b.verticalScroll=d.verticalScroll;b.clientX=a.clientX+b.horizontalScroll;b.clientY=a.clientY+b.verticalScroll;b.startX=b.clientX;b.startY=b.clientY;b.startZ=c.element.style.zIndex;
b.offsetX=0;b.offsetY=0;c.element.style.zIndex="100";document.addEventListener?(document.addEventListener("mousemove",SocialCalc.DragMouseMove,!0),document.addEventListener("mouseup",SocialCalc.DragMouseUp,!0)):c.element.attachEvent&&(c.element.setCapture(),c.element.attachEvent("onmousemove",SocialCalc.DragMouseMove),c.element.attachEvent("onmouseup",SocialCalc.DragMouseUp),c.element.attachEvent("onlosecapture",SocialCalc.DragMouseUp));a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?
a.preventDefault():a.returnValue=!1;c&&c.functionobj&&c.functionobj.MouseDown&&c.functionobj.MouseDown(a,b,c);return!1}};SocialCalc.DragMouseMove=function(a){var a=a||window.event,b=SocialCalc.DragInfo;b.clientX=a.clientX+b.horizontalScroll;b.clientY=a.clientY+b.verticalScroll;var c=b.draggingElement;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;c&&c.functionobj&&c.functionobj.MouseMove&&c.functionobj.MouseMove(a,b,c);return!1};
SocialCalc.DragMouseUp=function(a){var a=a||window.event,b=SocialCalc.DragInfo;b.clientX=a.clientX+b.horizontalScroll;b.clientY=a.clientY+b.verticalScroll;var c=b.draggingElement;c.element.style.zIndex=b.startZ;c&&c.functionobj&&c.functionobj.MouseUp&&c.functionobj.MouseUp(a,b,c);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;document.removeEventListener?(document.removeEventListener("mousemove",SocialCalc.DragMouseMove,!0),document.removeEventListener("mouseup",SocialCalc.DragMouseUp,!0)):
c.element.detachEvent&&(c.element.detachEvent("onlosecapture",SocialCalc.DragMouseUp),c.element.detachEvent("onmouseup",SocialCalc.DragMouseUp),c.element.detachEvent("onmousemove",SocialCalc.DragMouseMove),c.element.releaseCapture());b.draggingElement=null;return!1};SocialCalc.DragFunctionStart=function(a,b,c){c=c.functionobj.positionobj||c.element;a=c.style.top.match(/\d*/);b.offsetY=(a?a[0]-0:0)-b.clientY;a=c.style.left.match(/\d*/);b.offsetX=(a?a[0]-0:0)-b.clientX};
SocialCalc.DragFunctionPosition=function(a,b,c){a=c.functionobj.positionobj||c.element;c.vertical&&(a.style.top=b.clientY+b.offsetY+"px");c.horizontal&&(a.style.left=b.clientX+b.offsetX+"px")};SocialCalc.TooltipInfo={registeredElements:[],registered:!1,tooltipElement:null,timer:null,popupElement:null,clientX:0,clientY:0,offsetX:SocialCalc.Constants.TooltipOffsetX,offsetY:SocialCalc.Constants.TooltipOffsetY};
SocialCalc.TooltipRegister=function(a,b,c){var d=SocialCalc.TooltipInfo;d.registeredElements.push({element:a,tiptext:b,functionobj:c});if(!d.registered){if(document.addEventListener)document.addEventListener("mousemove",SocialCalc.TooltipMouseMove,!1);else if(document.attachEvent)document.attachEvent("onmousemove",SocialCalc.TooltipMouseMove);else throw SocialCalc.Constants.s_BrowserNotSupported;d.registered=!0}};
SocialCalc.TooltipMouseMove=function(a){var b=a||window.event,a=SocialCalc.TooltipInfo;a.viewport=SocialCalc.GetViewportInfo();a.clientX=b.clientX+a.viewport.horizontalScroll;a.clientY=b.clientY+a.viewport.verticalScroll;b=SocialCalc.LookupElement(b.target||b.srcElement,a.registeredElements);a.timer&&(window.clearTimeout(a.timer),a.timer=null);a.popupElement&&SocialCalc.TooltipHide();a.tooltipElement=b||null;b&&!SocialCalc.ButtonInfo.buttonDown&&(a.timer=window.setTimeout(SocialCalc.TooltipWaitDone,
700),a.tooltipElement.element.addEventListener?a.tooltipElement.element.addEventListener("mousedown",SocialCalc.TooltipMouseDown,!1):a.tooltipElement.element.attachEvent&&a.tooltipElement.element.attachEvent("onmousedown",SocialCalc.TooltipMouseDown))};
SocialCalc.TooltipMouseDown=function(){var a=SocialCalc.TooltipInfo;a.timer&&(window.clearTimeout(a.timer),a.timer=null);a.popupElement&&SocialCalc.TooltipHide();a.tooltipElement&&(a.tooltipElement.element.removeEventListener?a.tooltipElement.element.removeEventListener("mousedown",SocialCalc.TooltipMouseDown,!1):a.tooltipElement.element.attachEvent&&a.tooltipElement.element.detachEvent("onmousedown",SocialCalc.TooltipMouseDown),a.tooltipElement=null)};
SocialCalc.TooltipDisplay=function(a){var b=SocialCalc.TooltipInfo,c=SocialCalc.Constants,d=a.functionobj&&"number"==typeof a.functionobj.offsetx?a.functionobj.offsetx:b.offsetX,e=a.functionobj&&"number"==typeof a.functionobj.offsety?a.functionobj.offsety:b.offsetY;b.popupElement=document.createElement("div");c.TDpopupElementClass&&(b.popupElement.className=c.TDpopupElementClass);SocialCalc.setStyles(b.popupElement,c.TDpopupElementStyle);b.popupElement.innerHTML=a.tiptext;b.clientX>b.viewport.width/
2?(b.popupElement.style.bottom=b.viewport.height-b.clientY+e+"px",b.popupElement.style.right=b.viewport.width-b.clientX+d+"px"):(b.popupElement.style.bottom=b.viewport.height-b.clientY+e+"px",b.popupElement.style.left=b.clientX+d+"px");50>b.clientY&&(b.popupElement.style.bottom=b.viewport.height-b.clientY+e-50+"px");document.body.appendChild(b.popupElement)};
SocialCalc.TooltipHide=function(){var a=SocialCalc.TooltipInfo;a.popupElement&&(a.popupElement.parentNode.removeChild(a.popupElement),a.popupElement=null)};SocialCalc.TooltipWaitDone=function(){var a=SocialCalc.TooltipInfo;a.timer=null;SocialCalc.TooltipDisplay(a.tooltipElement)};SocialCalc.ButtonInfo={registeredElements:[],buttonElement:null,doingHover:!1,buttonDown:!1,timer:null,horizontalScroll:0,verticalScroll:0,clientX:0,clientY:0};
SocialCalc.ButtonRegister=function(a,b,c){var d=SocialCalc.ButtonInfo;b||(b={});d.registeredElements.push({name:b.name,element:a,normalstyle:b.normalstyle,hoverstyle:b.hoverstyle,downstyle:b.downstyle,repeatwait:b.repeatwait,repeatinterval:b.repeatinterval,functionobj:c});if(a.addEventListener)a.addEventListener("mousedown",SocialCalc.ButtonMouseDown,!1),a.addEventListener("mouseover",SocialCalc.ButtonMouseOver,!1),a.addEventListener("mouseout",SocialCalc.ButtonMouseOut,!1);else if(a.attachEvent)a.attachEvent("onmousedown",
SocialCalc.ButtonMouseDown),a.attachEvent("onmouseover",SocialCalc.ButtonMouseOver),a.attachEvent("onmouseout",SocialCalc.ButtonMouseOut);else throw SocialCalc.Constants.s_BrowserNotSupported;};
SocialCalc.ButtonMouseOver=function(a){var a=a||window.event,b=SocialCalc.ButtonInfo,c=SocialCalc.LookupElement(a.target||a.srcElement,b.registeredElements);c&&(b.buttonDown?b.buttonElement==c&&(b.doingHover=!0):(b.buttonElement&&b.buttonElement!=c&&b.doingHover&&SocialCalc.setStyles(b.buttonElement.element,b.buttonElement.normalstyle),b.buttonElement=c,b.doingHover=!0,SocialCalc.setStyles(c.element,c.hoverstyle),c&&c.functionobj&&c.functionobj.MouseOver&&c.functionobj.MouseOver(a,b,c)))};
SocialCalc.ButtonMouseOut=function(a){var a=a||window.event,b=SocialCalc.ButtonInfo;if(b.buttonDown)b.doingHover=!1;else{var c=SocialCalc.LookupElement(a.target||a.srcElement,b.registeredElements);b.doingHover&&(b.buttonElement&&SocialCalc.setStyles(b.buttonElement.element,b.buttonElement.normalstyle),b.buttonElement=null,b.doingHover=!1);c&&c.functionobj&&c.functionobj.MouseOut&&c.functionobj.MouseOut(a,b,c)}};
SocialCalc.ButtonMouseDown=function(a){var a=a||window.event,b=SocialCalc.ButtonInfo,c=SocialCalc.GetViewportInfo(),d=SocialCalc.LookupElement(a.target||a.srcElement,b.registeredElements);if(d&&(!d||!d.functionobj||!d.functionobj.Disabled||!d.functionobj.Disabled(a,b,d)))if(b.buttonElement=d,b.buttonDown=!0,SocialCalc.setStyles(d.element,b.buttonElement.downstyle),document.addEventListener?document.addEventListener("mouseup",SocialCalc.ButtonMouseUp,!0):d.element.attachEvent&&(d.element.setCapture(),
d.element.attachEvent("onmouseup",SocialCalc.ButtonMouseUp),d.element.attachEvent("onlosecapture",SocialCalc.ButtonMouseUp)),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,b.horizontalScroll=c.horizontalScroll,b.verticalScroll=c.verticalScroll,b.clientX=a.clientX+b.horizontalScroll,b.clientY=a.clientY+b.verticalScroll,d&&d.functionobj&&d.functionobj.MouseDown&&d.functionobj.MouseDown(a,b,d),d.repeatwait)b.timer=window.setTimeout(SocialCalc.ButtonRepeat,
d.repeatwait)};
SocialCalc.ButtonMouseUp=function(a){var a=a||window.event,b=SocialCalc.ButtonInfo,c=b.buttonElement;b.timer&&(window.clearTimeout(b.timer),b.timer=null);b.buttonDown&&(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,document.removeEventListener?document.removeEventListener("mouseup",SocialCalc.ButtonMouseUp,!0):document.detachEvent&&(c.element.detachEvent("onlosecapture",SocialCalc.ButtonMouseUp),c.element.detachEvent("onmouseup",SocialCalc.ButtonMouseUp),
c.element.releaseCapture()),b.buttonElement.downstyle&&(b.doingHover?SocialCalc.setStyles(c.element,b.buttonElement.hoverstyle):SocialCalc.setStyles(c.element,b.buttonElement.normalstyle)),b.buttonDown=!1,c&&c.functionobj&&c.functionobj.MouseUp&&c.functionobj.MouseUp(a,b,c))};
SocialCalc.ButtonRepeat=function(){var a=SocialCalc.ButtonInfo,b=a.buttonElement;b&&(b&&b.functionobj&&b.functionobj.Repeat&&b.functionobj.Repeat(null,a,b),a.timer=window.setTimeout(SocialCalc.ButtonRepeat,b.repeatinterval||100))};SocialCalc.MouseWheelInfo={registeredElements:[]};
SocialCalc.MouseWheelRegister=function(a,b){SocialCalc.MouseWheelInfo.registeredElements.push({element:a,functionobj:b});if(a.addEventListener)a.addEventListener("DOMMouseScroll",SocialCalc.ProcessMouseWheel,!1),a.addEventListener("mousewheel",SocialCalc.ProcessMouseWheel,!1);else if(a.attachEvent)a.attachEvent("onmousewheel",SocialCalc.ProcessMouseWheel);else throw SocialCalc.Constants.s_BrowserNotSupported;};
SocialCalc.ProcessMouseWheel=function(a){var a=a||window.event,b;if(!SocialCalc.Keyboard.passThru){var c=SocialCalc.MouseWheelInfo;b=a.target||a.srcElement;var d;for(d=null;!d&&b;b=b.parentNode)d=SocialCalc.LookupElement(b,c.registeredElements);d&&((b=a.wheelDelta?a.wheelDelta/120:-a.detail/3)||(b=0),d.functionobj&&d.functionobj.WheelMove&&d.functionobj.WheelMove(a,b,c,d),a.preventDefault&&a.preventDefault(),a.returnValue=!1)}};
SocialCalc.keyboardTables={specialKeysCommon:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},specialKeysIE:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysIE:{67:"[ctrl-c]",83:"[ctrl-s]",86:"[ctrl-v]",
88:"[ctrl-x]",90:"[ctrl-z]"},specialKeysOpera:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysOpera:{67:"[ctrl-c]",83:"[ctrl-s]",86:"[ctrl-v]",88:"[ctrl-x]",90:"[ctrl-z]"},specialKeysSafari:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",63232:"[aup]",63233:"[adown]",63234:"[aleft]",63235:"[aright]",63272:"[del]",63273:"[home]",
63275:"[end]",63276:"[pgup]",63277:"[pgdn]",63237:"[f2]"},controlKeysSafari:{99:"[ctrl-c]",115:"[ctrl-s]",118:"[ctrl-v]",120:"[ctrl-x]",122:"[ctrl-z]"},ignoreKeysSafari:{63236:"[f1]",63238:"[f3]",63239:"[f4]",63240:"[f5]",63241:"[f6]",63242:"[f7]",63243:"[f8]",63244:"[f9]",63245:"[f10]",63246:"[f11]",63247:"[f12]",63289:"[numlock]"},specialKeysFirefox:{8:"[backspace]",9:"[tab]",13:"[enter]",25:"[tab]",27:"[esc]",33:"[pgup]",34:"[pgdn]",35:"[end]",36:"[home]",37:"[aleft]",38:"[aup]",39:"[aright]",
40:"[adown]",45:"[ins]",46:"[del]",113:"[f2]"},controlKeysFirefox:{99:"[ctrl-c]",115:"[ctrl-s]",118:"[ctrl-v]",120:"[ctrl-x]",122:"[ctrl-z]"},ignoreKeysFirefox:{16:"[shift]",17:"[ctrl]",18:"[alt]",20:"[capslock]",19:"[pause]",44:"[printscreen]",91:"[windows]",92:"[windows]",112:"[f1]",114:"[f3]",115:"[f4]",116:"[f5]",117:"[f6]",118:"[f7]",119:"[f8]",120:"[f9]",121:"[f10]",122:"[f11]",123:"[f12]",144:"[numlock]",145:"[scrolllock]",224:"[cmd]"}};
SocialCalc.Keyboard={areListener:!1,focusTable:null,passThru:null,didProcessKey:!1,statusFromProcessKey:!1,repeatingKeyPress:!1,chForProcessKey:""};
SocialCalc.KeyboardSetFocus=function(a){SocialCalc.Keyboard.focusTable=a;SocialCalc.Keyboard.areListener||(document.onkeydown=SocialCalc.ProcessKeyDown,document.onkeypress=SocialCalc.ProcessKeyPress,SocialCalc.Keyboard.areListener=!0);SocialCalc.Keyboard.passThru&&(SocialCalc.Keyboard.passThru.blur&&SocialCalc.Keyboard.passThru.blur(),SocialCalc.Keyboard.passThru=null);switch(typeof window.focus){case "function":window.focus();break;case "boolean":window.focus=!0}};
SocialCalc.KeyboardFocus=function(){SocialCalc.Keyboard.passThru=null;switch(typeof window.focus){case "function":window.focus();break;case "boolean":window.focus=!0}};
SocialCalc.ProcessKeyDown=function(a){var b=SocialCalc.keyboardTables;b.didProcessKey=!1;b.statusFromProcessKey=!1;b.repeatingKeyPress=!1;var c="",d=!0;if(!SocialCalc.Keyboard.passThru){a=a||window.event;if(void 0==a.which||"string"==typeof a.keyIdentifier){c=b.specialKeysCommon[a.keyCode];if(!c&&(a.ctrlKey&&(c=b.controlKeysIE[a.keyCode]),!c))return!0;d=SocialCalc.ProcessKey(c,a);d||(a.preventDefault&&a.preventDefault(),a.returnValue=!1)}else{c=b.specialKeysCommon[a.keyCode];if(!c){if(a.ctrlKey||
a.metaKey)c=b.controlKeysIE[a.keyCode];if(!c)return!0}d=SocialCalc.ProcessKey(c,a);b.didProcessKey=!0;b.statusFromProcessKey=d;b.chForProcessKey=c}return d}};
SocialCalc.ProcessKeyPress=function(a){var b=SocialCalc.keyboardTables,c="",a=a||window.event;if(!SocialCalc.Keyboard.passThru){if(b.didProcessKey){if(b.repeatingKeyPress)return SocialCalc.ProcessKey(b.chForProcessKey,a);b.repeatingKeyPress=!0;return b.statusFromProcessKey}if(void 0==a.which)c=String.fromCharCode(a.keyCode);else{if(!a.which)return!1;if(void 0==a.charCode)if(0!=a.which)if(32>a.which||144==a.which){if(c=b.specialKeysOpera[a.which])return!0}else c=a.ctrlKey?b.controlKeysOpera[a.keyCode]:
String.fromCharCode(a.which);else return!0;else{if(0==a.keyCode&&0==a.charCode)return;if(a.keyCode==a.charCode){if(c=b.specialKeysSafari[a.keyCode],!c){if(b.ignoreKeysSafari[a.keyCode])return!0;c=a.metaKey?b.controlKeysSafari[a.keyCode]:String.fromCharCode(a.which)}}else{if(b.specialKeysFirefox[a.keyCode])return!0;c=String.fromCharCode(a.which);if(a.ctrlKey||a.metaKey)c=b.controlKeysFirefox[a.which]}}}b=SocialCalc.ProcessKey(c,a);b||(a.preventDefault&&a.preventDefault(),a.returnValue=!1);return b}};
SocialCalc.ProcessKey=function(a,b){var c=SocialCalc.Keyboard.focusTable;return!c?!0:c.EditorProcessKey(a,b)};SocialCalc||(SocialCalc={});SocialCalc.FormatNumber={};SocialCalc.FormatNumber.format_definitions={};SocialCalc.FormatNumber.separatorchar=",";SocialCalc.FormatNumber.decimalchar=".";SocialCalc.FormatNumber.daynames="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(",");SocialCalc.FormatNumber.daynames3="Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(",");SocialCalc.FormatNumber.monthnames3="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(",");SocialCalc.FormatNumber.monthnames="January,February,March,April,May,June,July,August,September,October,November,December".split(",");
SocialCalc.FormatNumber.allowedcolors={BLACK:"#000000",BLUE:"#0000FF",CYAN:"#00FFFF",GREEN:"#00FF00",MAGENTA:"#FF00FF",RED:"#FF0000",WHITE:"#FFFFFF",YELLOW:"#FFFF00"};SocialCalc.FormatNumber.alloweddates={H:"h]",M:"m]",MM:"mm]",S:"s]",SS:"ss]"};SocialCalc.FormatNumber.commands={copy:1,color:2,integer_placeholder:3,fraction_placeholder:4,decimal:5,currency:6,general:7,separator:8,date:9,comparison:10,section:11,style:12};
SocialCalc.FormatNumber.datevalues={julian_offset:2415019,seconds_in_a_day:86400,seconds_in_an_hour:3600};
SocialCalc.FormatNumber.formatNumberWithFormat=function(a,b){var c=SocialCalc.Constants,d=SocialCalc.FormatNumber,e,g,h,j,k,l,m,r,p,n,s,q="",t,u,v,w,x,z,y,E,G,F,H,A;A=a-=0;if(!isFinite(A))return"NaN";var C=0>A?1:0;C&&(A=-A);w=0==A?1:0;d.parse_format_string(d.format_definitions,b);t=d.format_definitions[b];if(!t)throw"Format not parsed error!";u=t.sectioninfo.length-1;if(t.hascomparison)for(w=s=u=0;;w++){e=t.operators[w];g=t.operands[w];if(!e){s&&(b="General",d.parse_format_string(d.format_definitions,
b),t=d.format_definitions[b],u=0);break}if(e==d.commands.section){if(!s)break;s=0;u++}else if(e==d.commands.comparison){s=g.indexOf(":");v=g.substring(0,s);g=g.substring(s+1)-0;if("<"==v&&a<g||"<="==v&&a<=g||"="==v&&a==g||"<>"==v&&a!=g||">="==v&&a>=g||">"==v&&a>g)break;s=1}}else 0<u&&(1==u?C?(C=0,u=1):u=0:2==u&&(C?(C=0,u=1):u=w?2:0));u=t.sectioninfo[u];if(0<u.commas)for(s=0;s<u.commas;s++)A/=1E3;if(0<u.percent)for(s=0;s<u.percent;s++)A*=100;g=1;for(s=0;s<u.fractiondigits;s++)g*=10;w=Math.floor(A*
g+0.5);w/=g;if("number"!=typeof w||!isFinite(w))return"NaN";g=w+"";if(0==w&&(u.fractiondigits||u.integerdigits))C=0;if(0<=g.indexOf("e"))return a+"";g=g.match(/^\+{0,1}(\d*)(?:\.(\d*)){0,1}$/);if(!g)return"NaN";w=g[1];if(!w||"0"==w)w="";(v=g[2])||(v="");if(u.hasdate){if(0>a)return"??-???-??&nbsp;??:??:??";h=(a-Math.floor(a))*d.datevalues.seconds_in_a_day;j=a*d.datevalues.seconds_in_a_day;k=Math.floor(h/d.datevalues.seconds_in_an_hour);m=Math.floor(j/d.datevalues.seconds_in_an_hour);h-=k*d.datevalues.seconds_in_an_hour;
l=Math.floor(h/60);r=Math.floor(j/60);g=1;for(s=0;s<u.fractiondigits;s++)g*=10;h=Math.floor((h-60*l)*g+0.5);h/=g;j=Math.floor(j*g+0.5);j/=g;60<=h&&(h=0,l++,r++,60<=l&&(l=0,k++,m++,24<=k&&(k=0,a++)));v=h-Math.floor(h)+"";v=v.substring(2);n=SocialCalc.FormatNumber.convert_date_julian_to_gregorian(Math.floor(a+d.datevalues.julian_offset));s=0;for(mspos=u.sectionstart;;mspos++){e=t.operators[mspos];g=t.operands[mspos];if(!e)break;if(e==d.commands.section)break;if(e==d.commands.date){if(("am/pm"==g.toLowerCase()||
"a/p"==g.toLowerCase())&&!p)12<=k?(k-=12,p="a/p"==g.toLowerCase()?c.s_FormatNumber_pm1:c.s_FormatNumber_pm):p="a/p"==g.toLowerCase()?c.s_FormatNumber_am1:c.s_FormatNumber_am,0>g.indexOf(p)&&(p=p.toLowerCase());if(s&&("m"==g||"mm"==g))t.operands[mspos]+="in";s="h"==g.charAt(0)?1:0}else e!=d.commands.copy&&(s=0)}s=0;for(--mspos;;mspos--){e=t.operators[mspos];g=t.operands[mspos];if(!e)break;if(e==d.commands.section)break;if(e==d.commands.date){if(s&&("m"==g||"mm"==g))t.operands[mspos]+="in";s="ss"==
g?1:0}else e!=d.commands.copy&&(s=0)}}y=z=x=0;G=E="";F=c.FormatNumber_separatorchar;0<=F.indexOf(" ")&&(F=F.replace(/ /g,"&nbsp;"));H=c.FormatNumber_decimalchar;0<=H.indexOf(" ")&&(H=H.replace(/ /g,"&nbsp;"));for(s=u.sectionstart;e=t.operators[s];)if(g=t.operands[s++],e==d.commands.copy)q+=g;else if(e==d.commands.color)E=g;else if(e==d.commands.style)G=g;else if(e==d.commands.integer_placeholder){C&&(q+="-",C=0);x++;if(1==x&&w.length>u.integerdigits)for(;z<w.length-u.integerdigits;z++)q+=w.charAt(z),
u.thousandssep&&(e=w.length-z-1,2<e&&0==e%3&&(q+=F));if(w.length<u.integerdigits&&x<=u.integerdigits-w.length){if("0"==g||"?"==g)q+="0"==g?"0":"&nbsp;",u.thousandssep&&(e=u.integerdigits-x,2<e&&0==e%3&&(q+=F))}else q+=w.charAt(z),u.thousandssep&&(e=w.length-z-1,2<e&&0==e%3&&(q+=F)),z++}else if(e==d.commands.fraction_placeholder){if(y>=v.length){if("0"==g||"?"==g)q+="0"==g?"0":"&nbsp;"}else q+=v.charAt(y);y++}else if(e==d.commands.decimal)C&&(q+="-",C=0),q+=H;else if(e==d.commands.currency)C&&(q+=
"-",C=0),q+=g;else if(e==d.commands.general){if(0!=A&&(g=Math.floor(Math.LOG10E*Math.log(A)),g=Math.pow(10,13-g),A=Math.floor(g*A+0.5)/g,!isFinite(A)))return"NaN";C&&(q+="-");g=A+"";if(0<=g.indexOf("e"))q+=g;else{g=g.match(/^\+{0,1}(\d*)(?:\.(\d*)){0,1}$/);w=g[1];if(!w||"0"==w)w="";(v=g[2])||(v="");y=z=0;if(w.length)for(;z<w.length;z++)q+=w.charAt(z),u.thousandssep&&(e=w.length-z-1,2<e&&0==e%3&&(q+=F));else q+="0";if(v.length)for(q+=H;y<v.length;y++)q+=v.charAt(y)}}else if(e==d.commands.date)g=g.toLowerCase(),
"y"==g||"yy"==g?q+=(n.year+"").substring(2):"yyyy"==g?q+=n.year+"":"d"==g?q+=n.day+"":"dd"==g?(g=1E3+n.day,q+=(g+"").substr(2)):"ddd"==g?(g=Math.floor(a+6)%7,q+=c.s_FormatNumber_daynames3[g]):"dddd"==g?(g=Math.floor(a+6)%7,q+=c.s_FormatNumber_daynames[g]):"m"==g?q+=n.month+"":"mm"==g?(g=1E3+n.month,q+=(g+"").substr(2)):"mmm"==g?q+=c.s_FormatNumber_monthnames3[n.month-1]:"mmmm"==g?q+=c.s_FormatNumber_monthnames[n.month-1]:"mmmmm"==g?q+=c.s_FormatNumber_monthnames[n.month-1].charAt(0):"h"==g?q+=k+"":
"h]"==g?q+=m+"":"mmin"==g?(g=1E3+l+"",q+=g.substr(2)):"mm]"==g?100>r?(g=1E3+r+"",q+=g.substr(2)):q+=r+"":"min"==g?q+=l+"":"m]"==g?q+=r+"":"hh"==g?(g=1E3+k+"",q+=g.substr(2)):"s"==g?(g=Math.floor(h),q+=g+""):"ss"==g?(g=1E3+Math.floor(h)+"",q+=g.substr(2)):"am/pm"==g||"a/p"==g?q+=p:"ss]"==g&&(100>j?(g=1E3+Math.floor(j)+"",q+=g.substr(2)):(g=Math.floor(j),q+=g+""));else if(e==d.commands.section)break;else e!=d.commands.comparison&&(q+="!! Parse error !!");E&&(q='<span style="color:'+E+';">'+q+"</span>");
G&&(q='<span style="'+G+';">'+q+"</span>");return q};
SocialCalc.FormatNumber.parse_format_string=function(a,b){var c=SocialCalc.FormatNumber,d,e,g=1,h,j,k,l,m,r,p,n,s,q,t,u,v;if(!a[b]){d={operators:[],operands:[],sectioninfo:[{}]};a[b]=d;e=0;sectioninfo=d.sectioninfo[e];sectioninfo.sectionstart=0;sectioninfo.integerdigits=0;sectioninfo.fractiondigits=0;sectioninfo.commas=0;for(v=sectioninfo.percent=0;v<b.length;v++)if(s=b.charAt(v),m)'"'==s?(m=0,d.operators.push(c.commands.copy),d.operands.push(r)):r+=s;else if(p)"]"==s?(p=0,s=SocialCalc.FormatNumber.parse_format_bracket(n),
s.operator==c.commands.separator)?sectioninfo.thousandssep=1:(s.operator==c.commands.date&&(sectioninfo.hasdate=1),s.operator==c.commands.comparison&&(d.hascomparison=1),d.operators.push(s.operator),d.operands.push(s.operand)):n+=s;else if(j)d.operators.push(c.commands.copy),d.operands.push(s),j=!1;else if(k)d.operators.push(c.commands.copy),d.operands.push(s+s+s+s+s),k=!1;else if(l)d.operators.push(c.commands.copy),d.operands.push("&nbsp;"),l=!1;else{if(q){if("general".charAt(q)==s.toLowerCase()){q++;
7==q&&(d.operators.push(c.commands.general),d.operands.push(s),q=0);continue}q=0}if(u){if(u.charAt(0)==s){u+=s;continue}d.operators.push(c.commands.date);d.operands.push(u);sectioninfo.hasdate=1;u=""}if(t)if(t+=s,s=t.toLowerCase(),s!="am/pm".substring(0,s.length)&&s!="a/p".substring(0,s.length))ampstr="";else{if("am/pm"==s||"a/p"==s)d.operators.push(c.commands.date),d.operands.push(t),t=""}else"#"==s||"0"==s||"?"==s?(g?(sectioninfo.integerdigits++,sectioninfo.commas&&(sectioninfo.thousandssep=1,sectioninfo.commas=
0),h=1,d.operators.push(c.commands.integer_placeholder)):(sectioninfo.fractiondigits++,d.operators.push(c.commands.fraction_placeholder)),d.operands.push(s)):"."==s?(h=0,d.operators.push(c.commands.decimal),d.operands.push(s),g=0):"$"==s?(h=0,d.operators.push(c.commands.currency),d.operands.push(s)):","==s?h?sectioninfo.commas++:(d.operators.push(c.commands.copy),d.operands.push(s)):"%"==s?(h=0,sectioninfo.percent++,d.operators.push(c.commands.copy),d.operands.push(s)):'"'==s?(h=0,m=1,r=""):"["==
s?(h=0,p=1,n=""):"\\"==s?(j=1,h=0):"*"==s?(k=1,h=0):"_"==s?(l=1,h=0):";"==s?(e++,d.sectioninfo[e]={},sectioninfo=d.sectioninfo[e],sectioninfo.sectionstart=1+d.operators.length,sectioninfo.integerdigits=0,sectioninfo.fractiondigits=0,sectioninfo.commas=0,sectioninfo.percent=0,g=1,h=0,d.operators.push(c.commands.section),d.operands.push(s)):"g"==s.toLowerCase()?(q=1,h=0):"a"==s.toLowerCase()?(t=s,h=0):0<="dmyhHs".indexOf(s)?u=s:(h=0,d.operators.push(c.commands.copy),d.operands.push(s))}u&&(d.operators.push(c.commands.date),
d.operands.push(u),sectioninfo.hasdate=1)}};
SocialCalc.FormatNumber.parse_format_bracket=function(a){var b=SocialCalc.FormatNumber,c=SocialCalc.Constants,d={},e;"$"==a.charAt(0)?(d.operator=b.commands.currency,e=a.match(/^\$(.+?)(\-.+?){0,1}$/),d.operand=e?e[1]||c.FormatNumber_defaultCurrency||"$":a.substring(1)||c.FormatNumber_defaultCurrency||"$"):"?$"==a?(d.operator=b.commands.currency,d.operand="[?$]"):b.allowedcolors[a.toUpperCase()]?(d.operator=b.commands.color,d.operand=b.allowedcolors[a.toUpperCase()]):(e=a.match(/^style=([^"]*)$/))?
(d.operator=b.commands.style,d.operand=e[1]):","==a?(d.operator=b.commands.separator,d.operand=a):b.alloweddates[a.toUpperCase()]?(d.operator=b.commands.date,d.operand=b.alloweddates[a.toUpperCase()]):a.match(/^[<>=]/)?(e=a.match(/^([<>=]+)(.+)$/),d.operator=b.commands.comparison,d.operand=e[1]+":"+e[2]):(d.operator=b.commands.copy,d.operand="["+a+"]");return d};
SocialCalc.FormatNumber.convert_date_gregorian_to_julian=function(a,b,c){c=c-32075+SocialCalc.intFunc(1461*(a+4800+SocialCalc.intFunc((b-14)/12))/4);c+=SocialCalc.intFunc(367*(b-2-12*SocialCalc.intFunc((b-14)/12))/12);return c-=SocialCalc.intFunc(3*SocialCalc.intFunc((a+4900+SocialCalc.intFunc((b-14)/12))/100)/4)};
SocialCalc.FormatNumber.convert_date_julian_to_gregorian=function(a){var b,c,d,e,a=a+68569;b=Math.floor(4*a/146097);a-=Math.floor((146097*b+3)/4);c=Math.floor(4E3*(a+1)/1461001);a=a-Math.floor(1461*c/4)+31;d=Math.floor(80*a/2447);e=a-Math.floor(2447*d/80);a=Math.floor(d/11);return{year:100*(b-49)+c+a,month:d+2-12*a,day:e}};SocialCalc.intFunc=function(a){return 0>a?-Math.floor(-a):Math.floor(a)};SocialCalc||(SocialCalc={});SocialCalc.Formula={};SocialCalc.Formula.ParseState={num:1,alpha:2,coord:3,string:4,stringquote:5,numexp1:6,numexp2:7,alphanumeric:8,specialvalue:9};SocialCalc.Formula.TokenType={num:1,coord:2,op:3,name:4,error:5,string:6,space:7};SocialCalc.Formula.CharClass={num:1,numstart:2,op:3,eof:4,alpha:5,incoord:6,error:7,quote:8,space:9,specialstart:10};
SocialCalc.Formula.CharClassTable={" ":9,"!":3,'"':8,"#":10,$:6,"%":3,"&":3,"(":3,")":3,"*":3,"+":3,",":3,"-":3,".":2,"/":3,"0":1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,":":3,"<":3,"=":3,">":3,A:5,B:5,C:5,D:5,E:5,F:5,G:5,H:5,I:5,J:5,K:5,L:5,M:5,N:5,O:5,P:5,Q:5,R:5,S:5,T:5,U:5,V:5,W:5,X:5,Y:5,Z:5,"^":3,_:5,a:5,b:5,c:5,d:5,e:5,f:5,g:5,h:5,i:5,j:5,k:5,l:5,m:5,n:5,o:5,p:5,q:5,r:5,s:5,t:5,u:5,v:5,w:5,x:5,y:5,z:5};
SocialCalc.Formula.UpperCaseTable={a:"A",b:"B",c:"C",d:"D",e:"E",f:"F",g:"G",h:"H",i:"I",j:"J",k:"K",l:"L",m:"M",n:"N",o:"O",p:"P",q:"Q",r:"R",s:"S",t:"T",u:"U",v:"V",w:"W",x:"X",y:"Y",z:"Z"};SocialCalc.Formula.SpecialConstants={"#NULL!":"0,e#NULL!","#NUM!":"0,e#NUM!","#DIV/0!":"0,e#DIV/0!","#VALUE!":"0,e#VALUE!","#REF!":"0,e#REF!","#NAME?":"0,e#NAME?"};SocialCalc.Formula.TokenPrecedence={"!":1,":":2,",":2,M:-3,P:-3,"%":4,"^":5,"*":6,"/":6,"+":7,"-":7,"&":8,"<":9,">":9,G:9,L:9,N:9};
SocialCalc.Formula.TokenOpExpansion={G:">=",L:"<=",M:"-",N:"<>",P:"+"};
SocialCalc.Formula.TypeLookupTable={unaryminus:{"n*":"|n*:1|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},unaryplus:{"n*":"|n*:1|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},unarypercent:{"n*":"|n:n%|n*:n|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},plus:{"n%":"|n%:n%|nd:n|nt:n|ndt:n|n$:n|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|",nd:"|n%:n|nd:nd|nt:ndt|ndt:ndt|n$:n|n:nd|n*:n|b:n|e*:2|t*:e#VALUE!|",nt:"|n%:n|nd:ndt|nt:nt|ndt:ndt|n$:n|n:nt|n*:n|b:n|e*:2|t*:e#VALUE!|",ndt:"|n%:n|nd:ndt|nt:ndt|ndt:ndt|n$:n|n:ndt|n*:n|b:n|e*:2|t*:e#VALUE!|",
n$:"|n%:n|nd:n|nt:n|ndt:n|n$:n$|n:n$|n*:n|b:n|e*:2|t*:e#VALUE!|",nl:"|n%:n|nd:n|nt:n|ndt:n|n$:n|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|",n:"|n%:n|nd:nd|nt:nt|ndt:ndt|n$:n$|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|",b:"|n%:n%|nd:nd|nt:nt|ndt:ndt|n$:n$|n:n|n*:n|b:n|e*:2|t*:e#VALUE!|","t*":"|n*:e#VALUE!|t*:e#VALUE!|b:e#VALUE!|e*:2|","e*":"|e*:1|n*:1|t*:1|b:1|"},concat:{t:"|t:t|th:th|tw:tw|tl:t|t*:2|e*:2|",th:"|t:th|th:th|tw:t|tl:th|t*:t|e*:2|",tw:"|t:tw|th:t|tw:tw|tl:tw|t*:t|e*:2|",tl:"|t:tl|th:th|tw:tw|tl:tl|t*:t|e*:2|",
"e*":"|e*:1|n*:1|t*:1|"},oneargnumeric:{"n*":"|n*:n|","e*":"|e*:1|","t*":"|t*:e#VALUE!|",b:"|b:n|"},twoargnumeric:{"n*":"|n*:n|t*:e#VALUE!|e*:2|","e*":"|e*:1|n*:1|t*:1|","t*":"|t*:e#VALUE!|n*:e#VALUE!|e*:2|"},propagateerror:{"n*":"|n*:2|e*:2|","e*":"|e*:2|","t*":"|t*:2|e*:2|",b:"|b:2|e*:2|"}};
SocialCalc.Formula.ParseFormulaIntoTokens=function(a){var b,c,d,e,g,h;b=SocialCalc.Formula;var j=SocialCalc.Constants,k=b.ParseState,l=b.TokenType,m=b.CharClass,r=b.CharClassTable,p=b.UpperCaseTable,n=b.ParsePushToken,s=/^\$?[A-Z]{1,2}\$?[1-9]\d*$/i,q=[],t="";g=0;d=!1;for(b=0;b<=a.length;b++)if(b<a.length?(c=a.charAt(b),cclass=r[c]):(c="",cclass=m.eof),g==k.num&&(cclass==m.num?t+=c:cclass==m.numstart&&!d?(d=!0,t+=c):"E"==c||"e"==c?(t+=c,d=!1,g=k.numexp1):(n(q,t,l.num,0),d=!1,g=0)),g==k.numexp1&&(cclass==
k.num?g=k.numexp2:("+"==c||"-"==c)&&"E"==p[t.charAt(t.length-1)]?t+=c:"E"==c||"e"==c||(n(q,j.s_parseerrexponent,l.error,0),g=0)),g==k.numexp2&&(cclass==m.num?t+=c:(n(q,t,l.num,0),g=0)),g==k.alpha&&(cclass==m.num?g=k.coord:cclass==m.alpha||"."==c?t+=c:cclass==m.incoord?g=k.coord:(cclass==m.op||cclass==m.numstart||cclass==m.space||cclass==m.eof?n(q,t.toUpperCase(),l.name,0):n(q,j.s_parseerrchar,l.error,0),g=0)),g==k.coord&&(cclass==m.num?t+=c:cclass==m.incoord?t+=c:cclass==m.alpha?g=k.alphanumeric:
(cclass==m.op||cclass==m.numstart||cclass==m.eof||cclass==m.space?(h=s.test(t)?l.coord:l.name,n(q,t.toUpperCase(),h,0)):n(q,j.s_parseerrchar,l.error,0),g=0)),g==k.alphanumeric&&(cclass==m.num||cclass==m.alpha?t+=c:(cclass==m.op||cclass==m.numstart||cclass==m.space||cclass==m.eof?n(q,t.toUpperCase(),l.name,0):n(q,j.s_parseerrchar,l.error,0),g=0)),g==k.string?cclass==m.quote?g=k.stringquote:cclass==m.eof?(n(q,j.s_parseerrstring,l.error,0),g=0):t+=c:g==k.stringquote?cclass==m.quote?(t+='"',g=k.string):
(n(q,t,l.string,0),g=0):g==k.specialvalue&&("!"==t.charAt(t.length-1)?(n(q,t,l.name,0),g=0):cclass==m.eof?(n(q,j.s_parseerrspecialvalue,l.error,0),g=0):t+=c),0==g)if(cclass==m.num)t=c,g=k.num;else if(cclass==m.numstart)t=c,d=!0,g=k.num;else if(cclass==m.alpha||cclass==m.incoord)t=c,g=k.alpha;else if(cclass==m.specialstart)t=c,g=k.specialvalue;else if(cclass==m.op){t=c;if(0<q.length){if(e=q[q.length-1],g=e.type,e=e.text,g==m.op&&("<"==e||">"==e))t=e+t,q.pop(),0<q.length?(e=q[q.length-1],g=e.type,e=
e.text):(g=m.eof,e="EOF")}else g=m.eof,e="EOF";h=l.op;0==q.length||g==m.op&&")"!=e&&"%"!=e?"-"==t?c=t="M":"+"==t?c=t="P":!(")"==t&&"("==e)&&"("!=t&&(h=l.error,t=j.s_parseerrtwoops):1<t.length&&(">="==t?c=t="G":"<="==t?c=t="L":"<>"==t?c=t="N":(h=l.error,t=j.s_parseerrtwoops));n(q,t,h,c);g=0}else cclass==m.quote?(t="",g=k.string):cclass==m.space?n(q," ",l.space,0):cclass!=m.eof&&n(q,j.s_parseerrchar,l.error,0);return q};SocialCalc.Formula.ParsePushToken=function(a,b,c,d){a.push({text:b,type:c,opcode:d})};
SocialCalc.Formula.evaluate_parsed_formula=function(a,b,c){var d=SocialCalc.Formula,e;e=d.ConvertInfixToPolish(a);return d.EvaluatePolish(a,e,b,c)};
SocialCalc.Formula.ConvertInfixToPolish=function(a){var b=SocialCalc.Formula,c=SocialCalc.Constants,d=b.TokenType,b=b.TokenPrecedence,e=[],g=[],h="",j,k,l,m;for(j=0;j<a.length;j++)if(k=a[j],l=k.type,m=k.text,l==d.num||l==d.coord||l==d.string)e.push(j);else if(l==d.name)g.push(j),e.push(-1);else if(l!=d.space)if(","==m){for(;g.length&&"("!=a[g[g.length-1]].text;)e.push(g.pop());if(0==g.length){h=c.s_parseerrmissingopenparen;break}}else if("("==m)g.push(j);else if(")"==m){for(;g.length&&"("!=a[g[g.length-
1]].text;)e.push(g.pop());if(0==g.length){h=c.s_parseerrcloseparennoopen;break}g.pop();g.length&&a[g[g.length-1]].type==d.name&&e.push(g.pop())}else if(l==d.op){for(g.length&&a[g[g.length-1]].type==d.name&&e.push(g.pop());g.length&&a[g[g.length-1]].type==d.op&&"("!=a[g[g.length-1]].text;){l=b[k.opcode];m=b[a[g[g.length-1]].opcode];if(0<=l&&l<m)break;else if(0>l&&(l=-l,0>m&&(m=-m),l<=m))break;e.push(g.pop())}g.push(j)}else{h=l==d.error?m:"Internal error while processing parsed formula. ";break}for(;0<
g.length;){if("("==a[g[g.length-1]].text){h=c.s_parseerrmissingcloseparen;break}e.push(g.pop())}return h?h:e};
SocialCalc.Formula.EvaluatePolish=function(a,b,c,d){var e=SocialCalc.Formula,g=SocialCalc.Constants,h=e.TokenType,j=e.LookupResultType,k=e.TypeLookupTable,l=e.OperandAsNumber,m=e.OperandAsText,r=e.OperandValueAndType,p=e.OperandsAsCoordOnSheet,n=SocialCalc.format_number_for_display||function(a){return a+""},s="",q={value:"",type:"e#VALUE!",error:g.s_parseerrmissingoperand},t=[],u=function(a,b){t.push({type:a,value:b})},v,w,x,z,y,E;if(!a.length||!(b instanceof Array))return{value:"",type:"e#VALUE!",
error:"string"==typeof b?b:""};for(v=0;v<b.length;v++)if(w=b[v],-1==w)u("start",0);else if(w=a[w],x=w.type,w=w.text,x==h.num)u("n",w-0);else if(x==h.coord)u("coord",w);else if(x==h.string)u("t",w);else if(x==h.op){if(0>=t.length)return q;if("M"==w)x=l(c,t),w=j(x.type,x.type,k.unaryminus),u(w,-x.value);else if("P"==w)x=l(c,t),w=j(x.type,x.type,k.unaryplus),u(w,x.value);else if("%"==w)x=l(c,t),w=j(x.type,x.type,k.unarypercent),u(w,0.01*x.value);else if("&"==w){if(1>=t.length)return q;z=m(c,t);x=m(c,
t);w=j(x.type,x.type,k.concat);u(w,x.value+z.value)}else if(":"==w){if(1>=t.length)return q;x=e.OperandsAsRangeOnSheet(c,t);x.error&&(s=s||x.error);u(x.type,x.value)}else if("!"==w){if(1>=t.length)return q;x=p(c,t);x.error&&(s=s||x.error);u(x.type,x.value)}else if("<"==w||"L"==w||"="==w||"G"==w||">"==w||"N"==w){if(1>=t.length){s=g.s_parseerrmissingoperand;break}z=r(c,t);x=r(c,t);"n"==x.type.charAt(0)&&"n"==z.type.charAt(0)?(y=0,"<"==w?y=x.value<z.value?1:0:"L"==w?y=x.value<=z.value?1:0:"="==w?y=x.value==
z.value?1:0:"G"==w?y=x.value>=z.value?1:0:">"==w?y=x.value>z.value?1:0:"N"==w&&(y=x.value!=z.value?1:0),u("nl",y)):"e"==x.type.charAt(0)?u(x.type,0):"e"==z.type.charAt(0)?u(z.type,0):(y=x.type.charAt(0),E=z.type.charAt(0),"n"==y?x.value=n(x.value,"n",""):"b"==y&&(x.value=""),"n"==E?z.value=n(z.value,"n",""):"b"==E&&(z.value=""),y=0,x.value=x.value.toLowerCase(),z.value=z.value.toLowerCase(),"<"==w?y=x.value<z.value?1:0:"L"==w?y=x.value<=z.value?1:0:"="==w?y=x.value==z.value?1:0:"G"==w?y=x.value>=
z.value?1:0:">"==w?y=x.value>z.value?1:0:"N"==w&&(y=x.value!=z.value?1:0),u("nl",y))}else{if(1>=t.length){s=g.s_parseerrmissingoperand;break}z=l(c,t);x=l(c,t);"+"==w?(w=j(x.type,z.type,k.plus),u(w,x.value+z.value)):"-"==w?(w=j(x.type,z.type,k.plus),u(w,x.value-z.value)):"*"==w?(w=j(x.type,z.type,k.plus),u(w,x.value*z.value)):"/"==w?0!=z.value?u("n",x.value/z.value):u("e#DIV/0!",0):"^"==w&&(x.value=Math.pow(x.value,z.value),x.type="n",isNaN(x.value)&&(x.value=0,x.type="e#NUM!"),u(x.type,x.value))}}else if(x==
h.name){if(s=e.CalculateFunction(w,t,c))break}else{s=g.s_InternalError+"Unknown token "+x+" ("+w+"). ";break}value=t[0]?t[0].value:"";y=t[0]?t[0].type:"";"name"==y&&(x=SocialCalc.Formula.LookupName(c,value),value=x.value,y=x.type,s=s||x.error);"coord"==y&&(x=r(c,t),value=x.value,y=x.type,"b"==y&&(y="n",value=0));1<t.length&&!s&&(s+=g.s_parseerrerrorinformula);a=y;"e"==y.charAt(0)?s=s||y.substring(1)||g.s_calcerrerrorvalueinformula:"range"==y&&(b=value.match(/^(.*)\|(.*)\|/),c=b[1].indexOf("!"),b[1]=
0<=c?b[1].substring(c+1)+"!"+b[1].substring(0,c).toUpperCase():b[1].toUpperCase(),value=b[1]+":"+b[2].toUpperCase(),d||(s=g.s_formularangeresult+" "+value));s&&"e"!=a.charAt(0)&&(value=s,a="e");if("n"==a.charAt(0)&&(isNaN(value)||!isFinite(value)))value=0,a="e#NUM!",s=isNaN(value)?g.s_calcerrnumericnan:g.s_calcerrnumericoverflow;return{value:value,type:a,error:s}};
SocialCalc.Formula.LookupResultType=function(a,b,c){var d,e;e=c[a];if(!e&&(e=c[a.charAt(0)+"*"],!e))return"e#VALUE! (internal error, missing LookupResultType "+a.charAt(0)+"*)";c=e.indexOf("|"+b+":");if(0<=c){d=e.indexOf("|",c+1);if(0>d)return"e#VALUE! (internal error, incorrect LookupResultType "+e+")";e=e.substring(c+b.length+2,d);return"1"==e?a:"2"==e?b:e}c=e.indexOf("|"+b.charAt(0)+"*:");if(0<=c){d=e.indexOf("|",c+1);if(0>d)return"e#VALUE! (internal error, incorrect LookupResultType "+e+")";e=
e.substring(c+4,d);return"1"==e?a:"2"==e?b:e}return"e#VALUE!"};SocialCalc.Formula.TopOfStackValueAndType=function(a,b){var c=SocialCalc.Formula,d={type:"",value:""},e=b.length;if(!e)return d.error=SocialCalc.Constants.s_InternalError+"no operand on stack",d;d.value=b[e-1].value;d.type=b[e-1].type;b.pop();"name"==d.type&&(d=c.LookupName(a,d.value));return d};
SocialCalc.Formula.OperandAsNumber=function(a,b){var c,d=SocialCalc.Formula.OperandValueAndType(a,b);c=d.type.charAt(0);"n"==c?d.value-=0:"b"==c?(d.type="n",d.value=0):"e"==c?d.value=0:(c=SocialCalc.DetermineValueType?SocialCalc.DetermineValueType(d.value):{value:d.value-0,type:"n"},d.value="n"==c.type.charAt(0)?c.value-0:0,d.type=c.type);return d};
SocialCalc.Formula.OperandAsText=function(a,b){var c,d=SocialCalc.Formula.OperandValueAndType(a,b);c=d.type.charAt(0);"t"!=c&&("n"==c?(d.value=SocialCalc.format_number_for_display?SocialCalc.format_number_for_display(d.value,d.type,""):d.value+="",d.type="t"):"b"==c?(d.value="",d.type="t"):"e"==c?d.value="":(b.value=d.value+"",b.type="t"));return d};
SocialCalc.Formula.OperandValueAndType=function(a,b){var c,d,e;c=SocialCalc.Formula;var g={type:"",value:""};d=b.length;if(!d)return g.error=SocialCalc.Constants.s_InternalError+"no operand on stack",g;g.value=b[d-1].value;g.type=b[d-1].type;b.pop();"name"==g.type&&(g=c.LookupName(a,g.value));"range"==g.type&&(g=c.StepThroughRangeDown(b,g.value));if("coord"==g.type){e=a;d=g.value.indexOf("!");if(-1!=d){e=c.FindInSheetCache(g.value.substring(d+1));if(null==e)return g.type="e#REF!",g.error=SocialCalc.Constants.s_sheetunavailable+
" "+g.value.substring(d+1),g.value=0,g;g.value=g.value.substring(0,d)}e?(d=e.cells[SocialCalc.Formula.PlainCoord(g.value)])?(c=d.valuetype,g.value=d.datavalue):c="b":(c="e#N/A",g.value=0);g.type=c||"b";"b"==g.type&&(g.value=0)}return g};
SocialCalc.Formula.OperandAsCoord=function(a,b){var c={type:"",value:""},d=b.length;c.value=b[d-1].value;c.type=b[d-1].type;b.pop();"name"==c.type&&(c=SocialCalc.Formula.LookupName(a,c.value));if("coord"==c.type)return c;c.value=SocialCalc.Constants.s_calcerrcellrefmissing;c.type="e#REF!";return c};
SocialCalc.Formula.OperandsAsCoordOnSheet=function(a,b){var c,d,e,g={},h={};e=SocialCalc.Formula;c=b.length;g.value=b[c-1].value;g.type=b[c-1].type;b.pop();c=e.OperandAsSheetName(a,b);d=e.FindInSheetCache(c.value);if(null==d)return h.type="e#REF!",h.value=0,h.error=SocialCalc.Constants.s_sheetunavailable+" "+c.value,h;"name"==g.type&&(g=e.LookupName(d,g.value));h.type=g.type;"coord"==g.type?h.value=g.value+"!"+c.value:"range"==g.type?(e=g.value.indexOf("|"),d=g.value.indexOf("|",e+1),h.value=g.value.substring(0,
e)+"!"+c.value+"|"+g.value.substring(e+1,d)+"|"):"e"==g.type.charAt(0)?h.value=g.value:(h.error=SocialCalc.Constants.s_calcerrcellrefmissing,h.type="e#REF!",h.value=0);return h};
SocialCalc.Formula.OperandsAsRangeOnSheet=function(a,b){var c,d,e,g,h={},j=SocialCalc.Formula,k=SocialCalc.Constants;c=b.length;h.value=b[c-1].value;h.type=b[c-1].type;b.pop();c=j.OperandAsCoord(a,b);if("coord"!=c.type)return{value:0,type:"e#REF!"};d=a;e=c.value.indexOf("!");if(-1!=e&&(g=c.value.indexOf("|",e+1),0>g&&(g=c.value.length),d=j.FindInSheetCache(c.value.substring(e+1,g)),null==d))return{value:0,type:"e#REF!",errortext:k.s_sheetunavailable+" "+c.value.substring(e+1,g)};"name"==h.type&&(h=
j.LookupName(d,h.value));return"coord"==h.type?{value:c.value+"|"+h.value+"|",type:"range"}:{value:k.s_calcerrcellrefmissing,type:"e#REF!"}};
SocialCalc.Formula.OperandAsSheetName=function(a,b){var c,d={type:"",value:""};c=b.length;d.value=b[c-1].value;d.type=b[c-1].type;b.pop();if("name"==d.type){c=SocialCalc.Formula.LookupName(a,d.value);if(!c.value)return d;d.value=c.value;d.type=c.type}"coord"==d.type&&((c=a.cells[SocialCalc.Formula.PlainCoord(d.value)])?(d.value=c.datavalue,d.type=c.valuetype):(d.value="",d.type="b"));"t"!=d.type.charAt(0)&&(d.value="",d.error=SocialCalc.Constants.s_calcerrsheetnamemissing);return d};
SocialCalc.Formula.LookupName=function(a,b){var c,d,e;d=a.names;e={};c=!1;if(d[b.toUpperCase()]){e.value=d[b.toUpperCase()].definition;if("="==e.value.charAt(0)){if(a.checknamecirc){if(a.checknamecirc[b])return e.type="e#NAME?",e.error=SocialCalc.Constants.s_circularnameref+' "'+b+'".',e}else a.checknamecirc={},c=!0;a.checknamecirc[b]=!0;e=SocialCalc.Formula.ParseFormulaIntoTokens(e.value.substring(1));e=SocialCalc.Formula.evaluate_parsed_formula(e,a,1);delete a.checknamecirc[b];c&&delete a.checknamecirc;
if("range"!=e.type)return e}c=e.value.indexOf(":");-1!=c?(e.type="range",e.value=e.value.substring(0,c)+"|"+e.value.substring(c+1)+"|"):e.type="coord";e.value=e.value.toUpperCase()}else(d=SocialCalc.Formula.SpecialConstants[b.toUpperCase()])?(c=d.indexOf(","),e.value=d.substring(0,c)-0,e.type=d.substring(c+1)):(e.value="",e.type="e#NAME?",e.error=SocialCalc.Constants.s_calcerrunknownname+' "'+b+'"');return e};
SocialCalc.Formula.StepThroughRangeDown=function(a,b){var c,d,e,g,h,j,k,l,m=SocialCalc.Formula;g=b.indexOf("|");e=b.indexOf("|",g+1);c=b.substring(0,g);d=b.substring(g+1,e);e=b.substring(e+1)-0;g=c.indexOf("!");-1!=g?(h=c.substring(g),c=c.substring(0,g)):h="";g=d.indexOf("!");-1!=g&&(d=d.substring(0,g));g=m.OrderRangeParts(c,d);l=0;for(k=g.r1;k<=g.r2;k++)for(j=g.c1;j<=g.c2;j++)if(l++,l>e)return(k!=g.r2||j!=g.c2)&&m.PushOperand(a,"range",c+h+"|"+d+"|"+l),{value:SocialCalc.crToCoord(j,k)+h,type:"coord"}};
SocialCalc.Formula.DecodeRangeParts=function(a,b){var c,d,e,g,h=SocialCalc.Formula;e=b.indexOf("|");g=b.indexOf("|",e+1);c=b.substring(0,e);d=b.substring(e+1,g);e=c.indexOf("!");-1!=e?(g=c.substring(e+1),c=c.substring(0,e)):g="";e=d.indexOf("!");-1!=e&&(d=d.substring(0,e));e=a;if(g&&(e=h.FindInSheetCache(g),null==e))return null;c=h.OrderRangeParts(c,d);return{sheetdata:e,sheetname:g,col1num:c.c1,ncols:c.c2-c.c1+1,row1num:c.r1,nrows:c.r2-c.r1+1}};
SocialCalc.Formula.FunctionList||(SocialCalc.Formula.FunctionList={});SocialCalc.Formula.FunctionClasses=null;SocialCalc.Formula.FunctionArgDefs={};
SocialCalc.Formula.CalculateFunction=function(a,b,c){var d,e,g,h=SocialCalc.Formula;e="";if(d=h.FunctionList[a]){e=[];g=d[0];d=d[1];h.CopyFunctionArgs(b,e);if(d!=100)if(d<0){if(e.length<-d)return e=h.FunctionArgsError(a,b)}else if(e.length!=d)return e=h.FunctionArgsError(a,b);e=g(a,b,e,c)}else if(b.length&&b[b.length-1].type=="start"){b.pop();h.PushOperand(b,"name",a)}else e=SocialCalc.Constants.s_sheetfuncunknownfunction+" "+a+". ";return e};
SocialCalc.Formula.PushOperand=function(a,b,c){a.push({type:b,value:c})};SocialCalc.Formula.CopyFunctionArgs=function(a,b){for(;a.length>0&&a[a.length-1].type!="start";)b.push(a.pop());a.pop()};SocialCalc.Formula.FunctionArgsError=function(a,b){var c=SocialCalc.Constants.s_calcerrincorrectargstofunction+" "+a+". ";SocialCalc.Formula.PushOperand(b,"e#VALUE!",c);return c};SocialCalc.Formula.FunctionSpecificError=function(a,b,c,d){SocialCalc.Formula.PushOperand(b,c,d);return d};
SocialCalc.Formula.CheckForErrorValue=function(a,b){if(b.type.charAt(0)=="e"){a.push(b);return true}return false};
SocialCalc.Formula.FillFunctionInfo=function(){var a=SocialCalc.Formula,b=SocialCalc.Constants,c,d,e;if(!a.FunctionClasses){for(c in a.FunctionList){d=a.FunctionList[c];d[2]&&(a.FunctionArgDefs[d[2]]=b["s_farg_"+d[2]]||"");d[3]||b["s_fdef_"+c]&&(a.FunctionList[c][3]=b["s_fdef_"+c])}a.FunctionClasses={};for(d=0;d<b.function_classlist.length;d++){e=b.function_classlist[d];a.FunctionClasses[e]={name:b["s_fclass_"+e],items:[]}}for(c in a.FunctionList){d=a.FunctionList[c];b=d[4]?d[4].split(","):[];b.push("all");
for(d=0;d<b.length;d++){e=b[d];a.FunctionClasses[e].items.push(c)}}for(e in a.FunctionClasses)a.FunctionClasses[e].items.sort()}};SocialCalc.Formula.FunctionArgString=function(a){var b=SocialCalc.Formula,a=b.FunctionList[a],c;c=a[2];if(!c){a=a[1];if(a==0)c=" ";else{if(a>0){c="v1";for(b=2;b<=a;b++)c=c+(", v"+b);return c}if(a<0){c="v1";for(b=2;b<-a;b++)c=c+(", v"+b);return c+", ..."}return"nargs: "+a}}return c=b.FunctionArgDefs[c]||c};
SocialCalc.Formula.SeriesFunctions=function(a,b,c,d){var e,g;e=SocialCalc.Formula;for(var h=e.OperandValueAndType,j=e.LookupResultType,k=e.TypeLookupTable.plus,l=function(a,c){b.push({type:a,value:c})},m=0,r="",p=0,n=0,s=0,q=1,t,u,v,w,x,z;c.length>0;){e=h(d,c);g=e.type.charAt(0);g=="n"&&(p=p+1);g!="b"&&(n=n+1);g=="b"&&(s=s+1);if(g=="n"){g=e.value-0;m=m+g;q=q*g;t=t!=void 0?g>t?g:t:g;u=u!=void 0?g<u?g:u:g;if(p==1){x=g;z=0}else{v=x+(g-x)/p;z=w=z+(g-x)*(g-v);x=v}r=j(e.type,r||e.type,k)}else if(g=="e"&&
r.charAt(0)!="e")r=e.type}r=r||"n";switch(a){case "SUM":l(r,m);break;case "PRODUCT":l(r,q);break;case "MIN":l(r,u||0);break;case "MAX":l(r,t||0);break;case "COUNT":l("n",p);break;case "COUNTA":l("n",n);break;case "COUNTBLANK":l("n",s);break;case "AVERAGE":p>0?l(r,m/p):l("e#DIV/0!",0);break;case "STDEV":p>1?l(r,Math.sqrt(w/(p-1))):l("e#DIV/0!",0);break;case "STDEVP":p>1?l(r,Math.sqrt(w/p)):l("e#DIV/0!",0);break;case "VAR":p>1?l(r,w/(p-1)):l("e#DIV/0!",0);break;case "VARP":p>1?l(r,w/p):l("e#DIV/0!",
0)}return null};SocialCalc.Formula.FunctionList.AVERAGE=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.COUNT=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.COUNTA=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.COUNTBLANK=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.MAX=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];
SocialCalc.Formula.FunctionList.MIN=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.PRODUCT=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.STDEV=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.STDEVP=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.SUM=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];
SocialCalc.Formula.FunctionList.VAR=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];SocialCalc.Formula.FunctionList.VARP=[SocialCalc.Formula.SeriesFunctions,-1,"vn",null,"stat"];
SocialCalc.Formula.DSeriesFunctions=function(a,b,c,d){var e,g,h,j,k,l,m,r,p=SocialCalc.Formula,n=p.LookupResultType,s=p.TypeLookupTable.plus,q=function(a,c){b.push({type:a,value:c})};g=e=void 0;var t=0,u="",v=0,w=0,x=1,z,y,E,G,F;h=p.TopOfStackValueAndType(d,c);j=p.OperandValueAndType(d,c);k=p.TopOfStackValueAndType(d,c);if(h.type!="range"||k.type!="range")return p.FunctionArgsError(a,b);c=p.DecodeRangeParts(d,h.value);d=p.DecodeRangeParts(d,k.value);j=p.FieldToColnum(c.sheetdata,c.col1num,c.ncols,
c.row1num,j.value,j.type);if(j<=0)q("e#VALUE!",0);else{j=c.col1num+j-1;k=[];for(h=0;h<d.ncols;h++){l=d.sheetdata.GetAssuredCell(SocialCalc.crToCoord(d.col1num+h,d.row1num));criterianum=p.FieldToColnum(c.sheetdata,c.col1num,c.ncols,c.row1num,l.datavalue,l.valuetype);if(criterianum<=0){q("e#VALUE!",0);return}k.push(c.col1num+criterianum-1)}for(h=1;h<c.nrows;h++){m=false;e=1;a:for(;e<d.nrows;e++){for(g=0;g<d.ncols;g++){r=SocialCalc.crToCoord(d.col1num+g,d.row1num+e);l=d.sheetdata.GetAssuredCell(r);r=
l.datavalue;if(!(typeof r=="string"&&r.length==0)){l=k[g];l=SocialCalc.crToCoord(l,c.row1num+h);l=d.sheetdata.GetAssuredCell(l);if(!p.TestCriteria(l.datavalue,l.valuetype||"b",r))continue a}}m=true;break a}if(m){e=SocialCalc.crToCoord(j,c.row1num+h);l=c.sheetdata.GetAssuredCell(e);e=l.datavalue;g=l.valuetype;m=g.charAt(0);m=="n"&&(v=v+1);m!="b"&&(w=w+1);if(m=="n"){v1=e-0;t=t+v1;x=x*v1;z=z!=void 0?v1>z?v1:z:v1;y=y!=void 0?v1<y?v1:y:v1;if(v==1){G=v1;F=0}else{e=G+(v1-G)/v;F=E=F+(v1-G)*(v1-e);G=e}u=n(g,
u||g,s)}else m=="e"&&u.charAt(0)!="e"&&(u=g)}}u=u||"n";switch(a){case "DSUM":q(u,t);break;case "DPRODUCT":q(u,x);break;case "DMIN":q(u,y||0);break;case "DMAX":q(u,z||0);break;case "DCOUNT":q("n",v);break;case "DCOUNTA":q("n",w);break;case "DAVERAGE":v>0?q(u,t/v):q("e#DIV/0!",0);break;case "DSTDEV":v>1?q(u,Math.sqrt(E/(v-1))):q("e#DIV/0!",0);break;case "DSTDEVP":v>1?q(u,Math.sqrt(E/v)):q("e#DIV/0!",0);break;case "DVAR":v>1?q(u,E/(v-1)):q("e#DIV/0!",0);break;case "DVARP":v>1?q(u,E/v):q("e#DIV/0!",0);
break;case "DGET":v==1?q(u,t):v==0?q("e#VALUE!",0):q("e#NUM!",0)}}};SocialCalc.Formula.FunctionList.DAVERAGE=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DCOUNT=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DCOUNTA=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DGET=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];
SocialCalc.Formula.FunctionList.DMAX=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DMIN=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DPRODUCT=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DSTDEV=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DSTDEVP=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];
SocialCalc.Formula.FunctionList.DSUM=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DVAR=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];SocialCalc.Formula.FunctionList.DVARP=[SocialCalc.Formula.DSeriesFunctions,3,"dfunc","","stat"];
SocialCalc.Formula.FieldToColnum=function(a,b,c,d,e,g){var h;if(g.charAt(0)=="n"){g=e-0;return g<=0||g>c?0:Math.floor(g)}if(g.charAt(0)!="t")return 0;e=e?e.toLowerCase():"";for(g=0;g<c;g++){h=a.GetAssuredCell(SocialCalc.crToCoord(b+g,d));h=h.datavalue;h=(h+"").toLowerCase();if(h==e)return g+1}return 0};
SocialCalc.Formula.LookupFunctions=function(a,b,c,d){var e,g,h,j,k,l,m,r,p,n,s;s=SocialCalc.Formula;e=s.OperandValueAndType;var q=function(a,c){b.push({type:a,value:c})};e=e(d,c);if(typeof e.value=="string")e.value=e.value.toLowerCase();g=s.TopOfStackValueAndType(d,c);h=1;if(a=="MATCH"){if(c.length){h=s.OperandAsNumber(d,c);if(h.type.charAt(0)!="n"){q("e#VALUE!",0);return}if(c.length){s.FunctionArgsError(a,b);return 0}h=h.value-0}}else{j=s.OperandAsNumber(d,c);if(j.type.charAt(0)!="n"){q("e#VALUE!",
0);return}j=Math.floor(j.value);if(c.length){h=s.OperandAsNumber(d,c);if(h.type.charAt(0)!="n"){q("e#VALUE!",0);return}if(c.length){s.FunctionArgsError(a,b);return 0}h=h.value?1:0}}e.type=e.type.charAt(0);if(e.type=="n")e.value=e.value-0;if(g.type!="range"){s.FunctionArgsError(a,b);return 0}if(c=s.DecodeRangeParts(d,g.value,g.type)){l=k=g=d=0;if(a=="HLOOKUP"){k=1;if(j>c.nrows){q("e#REF!",0);return}}else if(a=="VLOOKUP"){l=1;if(j>c.ncols){q("e#REF!",0);return}}else if(a=="MATCH")if(c.ncols>1){if(c.nrows>
1){q("e#N/A",0);return}k=1}else l=1;else{s.FunctionArgsError(a,b);return 0}if(j<1&&a!="MATCH"){q("e#VALUE!",0);return 0}for(m;;){s=SocialCalc.crToCoord(c.col1num+d,c.row1num+g);n=c.sheetdata.GetAssuredCell(s);s=n.datavalue;n=n.valuetype?n.valuetype.charAt(0):"b";n=="n"&&(s=s-0);if(h)if(e.type=="n"&&n=="n"){if(e.value==s)break;if(h>0&&e.value>s||h<0&&e.value<s){m=1;r=d;p=g}else if(m){m=2;break}}else{if(e.type=="t"&&n=="t"){s=typeof s=="string"?s.toLowerCase():"";if(e.value==s)break;if(h>0&&e.value>
s||h<0&&e.value<s){m=1;r=d;p=g}else if(m){m=2;break}}}else if(e.type=="n"&&n=="n"){if(e.value==s)break}else if(e.type=="t"&&n=="t"){s=typeof s=="string"?s.toLowerCase():"";if(e.value==s)break}g=g+l;d=d+k;if(g>=c.nrows||d>=c.ncols){if(m){m=2;break}q("e#N/A",0);return}}if(m==2){g=p;d=r}if(a=="MATCH"){s=d+g+1;n="n"}else{s=SocialCalc.crToCoord(c.col1num+d+(a=="VLOOKUP"?j-1:0),c.row1num+g+(a=="HLOOKUP"?j-1:0));n=c.sheetdata.GetAssuredCell(s);s=n.datavalue;n=n.valuetype}q(n,s)}else q("e#REF!",0)};
SocialCalc.Formula.FunctionList.HLOOKUP=[SocialCalc.Formula.LookupFunctions,-3,"hlookup","","lookup"];SocialCalc.Formula.FunctionList.MATCH=[SocialCalc.Formula.LookupFunctions,-2,"match","","lookup"];SocialCalc.Formula.FunctionList.VLOOKUP=[SocialCalc.Formula.LookupFunctions,-3,"vlookup","","lookup"];
SocialCalc.Formula.IndexFunction=function(a,b,c,d){var e,g,h,j,k=SocialCalc.Formula,l=function(a,c){b.push({type:a,value:c})};e=k.TopOfStackValueAndType(d,c);if(e.type!="range"){k.FunctionArgsError(a,b);return 0}g=k.DecodeRangeParts(d,e.value,e.type);e=g.sheetname?"!"+g.sheetname:"";h={value:0};j={value:0};if(c.length){h=k.OperandAsNumber(d,c);if(h.type.charAt(0)!="n"||h.value<0){l("e#VALUE!",0);return}if(c.length){j=k.OperandAsNumber(d,c);if(j.type.charAt(0)!="n"||j.value<0){l("e#VALUE!",0);return}if(c.length){k.FunctionArgsError(a,
b);return 0}}else if(g.nrows==1){j.value=h.value;h.value=0}}if(h.value>g.nrows||j.value>g.ncols)l("e#REF!",0);else{if(h.value==0)if(j.value==0)if(g.nrows==1&&g.ncols==1){a=SocialCalc.crToCoord(g.col1num,g.row1num)+e;c="coord"}else{a=SocialCalc.crToCoord(g.col1num,g.row1num)+e+"|"+SocialCalc.crToCoord(g.col1num+g.ncols-1,g.row1num+g.nrows-1)+"|";c="range"}else if(g.nrows==1){a=SocialCalc.crToCoord(g.col1num+j.value-1,g.row1num)+e;c="coord"}else{a=SocialCalc.crToCoord(g.col1num+j.value-1,g.row1num)+
e+"|"+SocialCalc.crToCoord(g.col1num+j.value-1,g.row1num+g.nrows-1)+"|";c="range"}else if(j.value==0)if(g.ncols==1){a=SocialCalc.crToCoord(g.col1num,g.row1num+h.value-1)+e;c="coord"}else{a=SocialCalc.crToCoord(g.col1num,g.row1num+h.value-1)+e+"|"+SocialCalc.crToCoord(g.col1num+g.ncols-1,g.row1num+h.value-1)+"|";c="range"}else{a=SocialCalc.crToCoord(g.col1num+j.value-1,g.row1num+h.value-1)+e;c="coord"}l(c,a)}};SocialCalc.Formula.FunctionList.INDEX=[SocialCalc.Formula.IndexFunction,-1,"index","","lookup"];
SocialCalc.Formula.CountifSumifFunctions=function(a,b,c,d){var e,g,h,j,k=0,l="",m=0,r=SocialCalc.Formula,p=r.OperandValueAndType,n=r.LookupResultType,s=r.TypeLookupTable.plus;e=r.TopOfStackValueAndType(d,c);g=r.OperandAsText(d,c);if(a=="SUMIF")if(c.length==1)h=r.TopOfStackValueAndType(d,c);else if(c.length==0)h={value:e.value,type:e.type};else{r.FunctionArgsError(a,b);return 0}else h={value:e.value,type:e.type};if(g.type.charAt(0)=="n")g.value=g.value+"";else if(g.type.charAt(0)=="e")g.value=null;
else if(g.type.charAt(0)=="b")g.value=null;if(e.type!="coord"&&e.type!="range"){r.FunctionArgsError(a,b);return 0}if(a=="SUMIF"&&h.type!="coord"&&h.type!="range"){r.FunctionArgsError(a,b);return 0}c.push(e);e=[];for(e.push(h);c.length;){h=p(d,c);j=p(d,e);if(r.TestCriteria(h.value,h.type,g.value)){m=m+1;if(j.type.charAt(0)=="n"){k=k+(j.value-0);l=n(j.type,l||j.type,s)}else if(j.type.charAt(0)=="e"&&l.charAt(0)!="e")l=j.type}}a=="SUMIF"?b.push({type:l||"n",value:k}):a=="COUNTIF"&&b.push({type:"n",value:m})};
SocialCalc.Formula.FunctionList.COUNTIF=[SocialCalc.Formula.CountifSumifFunctions,2,"rangec","","stat"];SocialCalc.Formula.FunctionList.SUMIF=[SocialCalc.Formula.CountifSumifFunctions,-2,"sumif","","stat"];SocialCalc.Formula.IfFunction=function(a,b,c,d){a=SocialCalc.Formula.OperandValueAndType(d,c);d=a.type.charAt(0);if(d!="n"&&d!="b")b.push({type:"e#VALUE!",value:0});else{a.value||c.pop();b.push(c.pop());a.value&&c.pop();return null}};
SocialCalc.Formula.FunctionList.IF=[SocialCalc.Formula.IfFunction,3,"iffunc","","test"];
SocialCalc.Formula.DateFunction=function(a,b,c,d){var a=SocialCalc.Formula,e=0,g=a.OperandAsNumber(d,c),h=a.OperandAsNumber(d,c),c=a.OperandAsNumber(d,c),d=a.LookupResultType(g.type,h.type,a.TypeLookupTable.twoargnumeric),d=a.LookupResultType(d,c.type,a.TypeLookupTable.twoargnumeric);if(d.charAt(0)=="n"){e=SocialCalc.FormatNumber.convert_date_gregorian_to_julian(Math.floor(g.value),Math.floor(h.value),Math.floor(c.value))-SocialCalc.FormatNumber.datevalues.julian_offset;d="nd"}a.PushOperand(b,d,e)};
SocialCalc.Formula.FunctionList.DATE=[SocialCalc.Formula.DateFunction,3,"date","","datetime"];SocialCalc.Formula.TimeFunction=function(a,b,c,d){var a=SocialCalc.Formula,e=0,g=a.OperandAsNumber(d,c),h=a.OperandAsNumber(d,c),c=a.OperandAsNumber(d,c),d=a.LookupResultType(g.type,h.type,a.TypeLookupTable.twoargnumeric),d=a.LookupResultType(d,c.type,a.TypeLookupTable.twoargnumeric);if(d.charAt(0)=="n"){e=(g.value*3600+h.value*60+c.value)/86400;d="nt"}a.PushOperand(b,d,e)};
SocialCalc.Formula.FunctionList.TIME=[SocialCalc.Formula.TimeFunction,3,"hms","","datetime"];
SocialCalc.Formula.DMYFunctions=function(a,b,c,d){var e,g=SocialCalc.Formula,h=0,j=g.OperandAsNumber(d,c),k=g.LookupResultType(j.type,j.type,g.TypeLookupTable.oneargnumeric);if(k.charAt(0)=="n"){e=SocialCalc.FormatNumber.convert_date_julian_to_gregorian(Math.floor(j.value+SocialCalc.FormatNumber.datevalues.julian_offset));switch(a){case "DAY":h=e.day;break;case "MONTH":h=e.month;break;case "YEAR":h=e.year;break;case "WEEKDAY":e={value:1};if(c.length){e=g.OperandAsNumber(d,c);if(e.type.charAt(0)!=
"n"||e.value<1||e.value>3){g.PushOperand(b,"e#VALUE!",0);return}if(c.length){g.FunctionArgsError(a,b);return}}a=6;e.value>1&&(a=a-1);h=Math.floor(j.value+a)%7+(e.value<3?1:0)}}g.PushOperand(b,k,h)};SocialCalc.Formula.FunctionList.DAY=[SocialCalc.Formula.DMYFunctions,1,"v","","datetime"];SocialCalc.Formula.FunctionList.MONTH=[SocialCalc.Formula.DMYFunctions,1,"v","","datetime"];SocialCalc.Formula.FunctionList.YEAR=[SocialCalc.Formula.DMYFunctions,1,"v","","datetime"];
SocialCalc.Formula.FunctionList.WEEKDAY=[SocialCalc.Formula.DMYFunctions,-1,"weekday","","datetime"];
SocialCalc.Formula.HMSFunctions=function(a,b,c,d){var e,g=SocialCalc.Formula,h=0,j=g.OperandAsNumber(d,c),k=g.LookupResultType(j.type,j.type,g.TypeLookupTable.oneargnumeric);if(k.charAt(0)=="n"){if(j.value<0){g.PushOperand(b,"e#NUM!",0);return}e=j.value-Math.floor(j.value);e=e*24;c=Math.floor(e);e=e-Math.floor(e);e=e*60;d=Math.floor(e);e=e-Math.floor(e);e=Math.floor(e*60+(j.value>=0?0.5:-0.5));a=="HOUR"?h=c:a=="MINUTE"?h=d:a=="SECOND"&&(h=e)}g.PushOperand(b,k,h)};
SocialCalc.Formula.FunctionList.HOUR=[SocialCalc.Formula.HMSFunctions,1,"v","","datetime"];SocialCalc.Formula.FunctionList.MINUTE=[SocialCalc.Formula.HMSFunctions,1,"v","","datetime"];SocialCalc.Formula.FunctionList.SECOND=[SocialCalc.Formula.HMSFunctions,1,"v","","datetime"];
SocialCalc.Formula.ExactFunction=function(a,b,c,d){var a=SocialCalc.Formula,e=0,g="nl",h=a.OperandValueAndType(d,c),j=h.type.charAt(0),c=a.OperandValueAndType(d,c),d=c.type.charAt(0);if(j=="t")if(d=="t")e=h.value==c.value?1:0;else if(d=="b")e=h.value.length?0:1;else if(d=="n")e=h.value==c.value+""?1:0;else if(d=="e"){e=c.value;g=c.type}else e=0;else if(j=="n")if(d=="n")e=h.value-0==c.value-0?1:0;else if(d=="b")e=0;else if(d=="t")e=h.value+""==c.value?1:0;else if(d=="e"){e=c.value;g=c.type}else e=
0;else if(j=="b")if(d=="t")e=c.value.length?0:1;else if(d=="b")e=1;else if(d=="n")e=0;else if(d=="e"){e=c.value;g=c.type}else e=0;else if(j=="e"){e=h.value;g=h.type}a.PushOperand(b,g,e)};SocialCalc.Formula.FunctionList.EXACT=[SocialCalc.Formula.ExactFunction,2,"","","text"];SocialCalc.Formula.ArgList={FIND:[1,1,0],LEFT:[1,0],LEN:[1],LOWER:[1],MID:[1,0,0],PROPER:[1],REPLACE:[1,0,0,1],REPT:[1,0],RIGHT:[1,0],SUBSTITUTE:[1,1,1,0],TRIM:[1],UPPER:[1]};
SocialCalc.Formula.StringFunctions=function(a,b,c,d){var e,g,h,j=SocialCalc.Formula;h=0;var k="e#VALUE!",l=c.length,m=j.ArgList[a],r=[],p=[];for(e=1;e<=l;e++){if(e>m.length){j.FunctionArgsError(a,b);return}m[e-1]==0?g=j.OperandAsNumber(d,c):m[e-1]==1?g=j.OperandAsText(d,c):m[e-1]==-1&&(g=j.OperandValueAndType(d,c));r[e]=g.value;p[e]=g.type;if(g.type.charAt(0)=="e"){j.PushOperand(b,g.type,h);return}}switch(a){case "FIND":h=p[3]?r[3]-1:0;if(h<0)h="Start is before string";else{h=r[2].indexOf(r[1],h);
if(h>=0){h=h+1;k="n"}else h="Not found"}break;case "LEFT":h=p[2]?r[2]-0:1;if(h<0)h="Negative length";else{h=r[1].substring(0,h);k="t"}break;case "LEN":h=r[1].length;k="n";break;case "LOWER":h=r[1].toLowerCase();k="t";break;case "MID":a=r[2]-0;h=r[3]-0;if(h<1||a<1)h="Bad arguments";else{h=r[1].substring(a-1,a+h-1);k="t"}break;case "PROPER":h=r[1].replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});k="t";break;case "REPLACE":a=r[2]-0;h=r[3]-0;if(h<0||a<1)h="Bad arguments";
else{h=r[1].substring(0,a-1)+r[4]+r[1].substring(a-1+h);k="t"}break;case "REPT":a=r[2]-0;if(a<0)h="Negative count";else{for(h="";a>0;a--)h=h+r[1];k="t"}break;case "RIGHT":h=p[2]?r[2]-0:1;if(h<0)h="Negative length";else{h=r[1].slice(-h);k="t"}break;case "SUBSTITUTE":fulltext=r[1];oldtext=r[2];newtext=r[3];if(r[4]!=null){which=r[4]-0;if(which<=0){h="Non-positive instance number";break}}else which=0;oldpos=a=0;for(h="";;){pos=fulltext.indexOf(oldtext,oldpos);if(pos>=0){a++;h=h+fulltext.substring(oldpos,
pos);if(which==0)h=h+newtext;else if(which==a){h=h+(newtext+fulltext.substring(pos+oldtext.length));break}else h=h+oldtext;oldpos=pos+oldtext.length}else{h=h+fulltext.substring(oldpos);break}}k="t";break;case "TRIM":h=r[1];h=h.replace(/^ */,"");h=h.replace(/ *$/,"");h=h.replace(/ +/g," ");k="t";break;case "UPPER":h=r[1].toUpperCase();k="t"}j.PushOperand(b,k,h)};SocialCalc.Formula.FunctionList.FIND=[SocialCalc.Formula.StringFunctions,-2,"find","","text"];
SocialCalc.Formula.FunctionList.LEFT=[SocialCalc.Formula.StringFunctions,-2,"tc","","text"];SocialCalc.Formula.FunctionList.LEN=[SocialCalc.Formula.StringFunctions,1,"txt","","text"];SocialCalc.Formula.FunctionList.LOWER=[SocialCalc.Formula.StringFunctions,1,"txt","","text"];SocialCalc.Formula.FunctionList.MID=[SocialCalc.Formula.StringFunctions,3,"mid","","text"];SocialCalc.Formula.FunctionList.PROPER=[SocialCalc.Formula.StringFunctions,1,"v","","text"];
SocialCalc.Formula.FunctionList.REPLACE=[SocialCalc.Formula.StringFunctions,4,"replace","","text"];SocialCalc.Formula.FunctionList.REPT=[SocialCalc.Formula.StringFunctions,2,"tc","","text"];SocialCalc.Formula.FunctionList.RIGHT=[SocialCalc.Formula.StringFunctions,-1,"tc","","text"];SocialCalc.Formula.FunctionList.SUBSTITUTE=[SocialCalc.Formula.StringFunctions,-3,"subs","","text"];SocialCalc.Formula.FunctionList.TRIM=[SocialCalc.Formula.StringFunctions,1,"v","","text"];
SocialCalc.Formula.FunctionList.UPPER=[SocialCalc.Formula.StringFunctions,1,"v","","text"];
SocialCalc.Formula.IsFunctions=function(a,b,c,d){var e=SocialCalc.Formula,g=0,c=e.OperandValueAndType(d,c),d=c.type.charAt(0);switch(a){case "ISBLANK":g=c.type=="b"?1:0;break;case "ISERR":g=d=="e"?c.type=="e#N/A"?0:1:0;break;case "ISERROR":g=d=="e"?1:0;break;case "ISLOGICAL":g=c.type=="nl"?1:0;break;case "ISNA":g=c.type=="e#N/A"?1:0;break;case "ISNONTEXT":g=d=="t"?0:1;break;case "ISNUMBER":g=d=="n"?1:0;break;case "ISTEXT":g=d=="t"?1:0}e.PushOperand(b,"nl",g)};
SocialCalc.Formula.FunctionList.ISBLANK=[SocialCalc.Formula.IsFunctions,1,"v","","test"];SocialCalc.Formula.FunctionList.ISERR=[SocialCalc.Formula.IsFunctions,1,"v","","test"];SocialCalc.Formula.FunctionList.ISERROR=[SocialCalc.Formula.IsFunctions,1,"v","","test"];SocialCalc.Formula.FunctionList.ISLOGICAL=[SocialCalc.Formula.IsFunctions,1,"v","","test"];SocialCalc.Formula.FunctionList.ISNA=[SocialCalc.Formula.IsFunctions,1,"v","","test"];
SocialCalc.Formula.FunctionList.ISNONTEXT=[SocialCalc.Formula.IsFunctions,1,"v","","test"];SocialCalc.Formula.FunctionList.ISNUMBER=[SocialCalc.Formula.IsFunctions,1,"v","","test"];SocialCalc.Formula.FunctionList.ISTEXT=[SocialCalc.Formula.IsFunctions,1,"v","","test"];
SocialCalc.Formula.NTVFunctions=function(a,b,c,d){var e=SocialCalc.Formula,g=0,h="e#VALUE!",c=e.OperandValueAndType(d,c),d=c.type.charAt(0);switch(a){case "N":g=d=="n"?c.value-0:0;h="n";break;case "T":g=d=="t"?c.value+"":"";h="t";break;case "VALUE":if(d=="n"||d=="b"){g=c.value||0;h="n"}else if(d=="t"){c=SocialCalc.DetermineValueType(c.value);if(c.type.charAt(0)!="n"){g=0;h="e#VALUE!"}else{g=c.value-0;h="n"}}}if(d=="e")h=c.type;e.PushOperand(b,h,g)};
SocialCalc.Formula.FunctionList.N=[SocialCalc.Formula.NTVFunctions,1,"v","","math"];SocialCalc.Formula.FunctionList.T=[SocialCalc.Formula.NTVFunctions,1,"v","","text"];SocialCalc.Formula.FunctionList.VALUE=[SocialCalc.Formula.NTVFunctions,1,"v","","text"];
SocialCalc.Formula.Math1Functions=function(a,b,c,d){var e={},g=SocialCalc.Formula,d=g.OperandAsNumber(d,c),c=d.value;e.type=g.LookupResultType(d.type,d.type,g.TypeLookupTable.oneargnumeric);if(e.type=="n")switch(a){case "ABS":c=Math.abs(c);break;case "ACOS":c>=-1&&c<=1?c=Math.acos(c):e.type="e#NUM!";break;case "ASIN":c>=-1&&c<=1?c=Math.asin(c):e.type="e#NUM!";break;case "ATAN":c=Math.atan(c);break;case "COS":c=Math.cos(c);break;case "DEGREES":c=c*180/Math.PI;break;case "EVEN":c=c<0?-c:c;c=c!=Math.floor(c)?
Math.floor(c+1)+Math.floor(c+1)%2:c+c%2;d.value<0&&(c=-c);break;case "EXP":c=Math.exp(c);break;case "FACT":a=1;for(c=Math.floor(c);c>0;c--)a=a*c;c=a;break;case "INT":c=Math.floor(c);break;case "LN":if(c<=0){e.type="e#NUM!";e.error=SocialCalc.Constants.s_sheetfunclnarg}c=Math.log(c);break;case "LOG10":if(c<=0){e.type="e#NUM!";e.error=SocialCalc.Constants.s_sheetfunclog10arg}c=Math.log(c)/Math.log(10);break;case "ODD":c=c<0?-c:c;c=c!=Math.floor(c)?Math.floor(c+1)+(1-Math.floor(c+1)%2):c+(1-c%2);d.value<
0&&(c=-c);break;case "RADIANS":c=c*Math.PI/180;break;case "SIN":c=Math.sin(c);break;case "SQRT":c>=0?c=Math.sqrt(c):e.type="e#NUM!";break;case "TAN":Math.cos(c)!=0?c=Math.tan(c):e.type="e#NUM!"}e.value=c;b.push(e);return null};SocialCalc.Formula.FunctionList.ABS=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.ACOS=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.ASIN=[SocialCalc.Formula.Math1Functions,1,"v","","math"];
SocialCalc.Formula.FunctionList.ATAN=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.COS=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.DEGREES=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.EVEN=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.EXP=[SocialCalc.Formula.Math1Functions,1,"v","","math"];
SocialCalc.Formula.FunctionList.FACT=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.INT=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.LN=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.LOG10=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.ODD=[SocialCalc.Formula.Math1Functions,1,"v","","math"];
SocialCalc.Formula.FunctionList.RADIANS=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.SIN=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.SQRT=[SocialCalc.Formula.Math1Functions,1,"v","","math"];SocialCalc.Formula.FunctionList.TAN=[SocialCalc.Formula.Math1Functions,1,"v","","math"];
SocialCalc.Formula.Math2Functions=function(a,b,c,d){var e,g,h={};g=SocialCalc.Formula;e=g.OperandAsNumber(d,c);c=g.OperandAsNumber(d,c);h.type=g.LookupResultType(e.type,c.type,g.TypeLookupTable.twoargnumeric);if(h.type=="n")switch(a){case "ATAN2":e.value==0&&c.value==0?h.type="e#DIV/0!":h.value=Math.atan2(c.value,e.value);break;case "POWER":h.value=Math.pow(e.value,c.value);if(isNaN(h.value)){h.value=0;h.type="e#NUM!"}break;case "MOD":if(c.value==0)h.type="e#DIV/0!";else{a=e.value/c.value;a=Math.floor(a);
h.value=e.value-a*c.value}break;case "TRUNC":a=1;if(c.value>=0){c.value=Math.floor(c.value);for(g=0;g<c.value;g++)a=a*10;h.value=Math.floor(Math.abs(e.value)*a)/a}else if(c.value<0){c.value=Math.floor(-c.value);for(g=0;g<c.value;g++)a=a*10;h.value=Math.floor(Math.abs(e.value)/a)*a}if(e.value<0)h.value=-h.value}b.push(h);return null};SocialCalc.Formula.FunctionList.ATAN2=[SocialCalc.Formula.Math2Functions,2,"xy","","math"];
SocialCalc.Formula.FunctionList.MOD=[SocialCalc.Formula.Math2Functions,2,"","","math"];SocialCalc.Formula.FunctionList.POWER=[SocialCalc.Formula.Math2Functions,2,"","","math"];SocialCalc.Formula.FunctionList.TRUNC=[SocialCalc.Formula.Math2Functions,2,"valpre","","math"];
SocialCalc.Formula.LogFunction=function(a,b,c,d){var e,g={},h=SocialCalc.Formula;g.value=0;e=h.OperandAsNumber(d,c);g.type=h.LookupResultType(e.type,e.type,h.TypeLookupTable.oneargnumeric);if(c.length==1){c=h.OperandAsNumber(d,c);if(c.type.charAt(0)!="n"||c.value<=0){h.FunctionSpecificError(a,b,"e#NUM!",SocialCalc.Constants.s_sheetfunclogsecondarg);return 0}}else{if(c.length!=0){h.FunctionArgsError(a,b);return 0}c={value:Math.E,type:"n"}}if(g.type=="n"){if(e.value<=0){h.FunctionSpecificError(a,b,
"e#NUM!",SocialCalc.Constants.s_sheetfunclogfirstarg);return 0}g.value=Math.log(e.value)/Math.log(c.value)}b.push(g)};SocialCalc.Formula.FunctionList.LOG=[SocialCalc.Formula.LogFunction,-1,"log","","math"];
SocialCalc.Formula.RoundFunction=function(a,b,c,d){var e,g,h=SocialCalc.Formula;g=0;var j="e#VALUE!";e=h.OperandValueAndType(d,c);j=h.LookupResultType(e.type,e.type,h.TypeLookupTable.oneargnumeric);if(c.length==1){c=h.OperandValueAndType(d,c);if(c.type.charAt(0)!="n"){h.FunctionSpecificError(a,b,"e#NUM!",SocialCalc.Constants.s_sheetfuncroundsecondarg);return 0}}else{if(c.length!=0){h.FunctionArgsError(a,b);return 0}c={value:0,type:"n"}}if(j=="n"){c.value=c.value-0;if(c.value==0)g=Math.round(e.value);
else if(c.value>0){a=1;c.value=Math.floor(c.value);for(g=0;g<c.value;g++)a=a*10;e=Math.round(e.value*a);g=e/a}else if(c.value<0){a=1;c.value=Math.floor(-c.value);for(g=0;g<c.value;g++)a=a*10;e=Math.round(e.value/a);g=e*a}}h.PushOperand(b,j,g)};SocialCalc.Formula.FunctionList.ROUND=[SocialCalc.Formula.RoundFunction,-1,"vp","","math"];
SocialCalc.Formula.AndOrFunctions=function(a,b,c,d){var e,g,h=SocialCalc.Formula,j="";for(a=="AND"?g=1:a=="OR"&&(g=0);c.length;){e=h.OperandValueAndType(d,c);if(e.type.charAt(0)=="n"){e.value=e.value-0;a=="AND"?g=e.value!=0?g:0:a=="OR"&&(g=e.value!=0?1:g);j=h.LookupResultType(e.type,j||"nl",h.TypeLookupTable.propagateerror)}else if(e.type.charAt(0)=="e"&&j.charAt(0)!="e")j=e.type}if(j.length<1){j="e#VALUE!";g=0}h.PushOperand(b,j,g)};
SocialCalc.Formula.FunctionList.AND=[SocialCalc.Formula.AndOrFunctions,-1,"vn","","test"];SocialCalc.Formula.FunctionList.OR=[SocialCalc.Formula.AndOrFunctions,-1,"vn","","test"];SocialCalc.Formula.NotFunction=function(a,b,c,d){var a=0,e=SocialCalc.Formula,c=e.OperandValueAndType(d,c),d=e.LookupResultType(c.type,c.type,e.TypeLookupTable.propagateerror);if(c.type.charAt(0)=="n"||c.type=="b"){a=c.value-0!=0?0:1;d="nl"}else c.type.charAt(0)=="t"&&(d="e#VALUE!");e.PushOperand(b,d,a)};
SocialCalc.Formula.FunctionList.NOT=[SocialCalc.Formula.NotFunction,1,"v","","test"];SocialCalc.Formula.ChooseFunction=function(a,b,c,d){var e,g,h=0,j=SocialCalc.Formula,k=j.OperandAsNumber(d,c);if(k.type.charAt(0)!="n")k.value=0;k.value=Math.floor(k.value);for(a=0;c.length;){g=j.TopOfStackValueAndType(d,c);a=a+1;if(k.value==a){h=g.value;e=g.type;break}}e?j.PushOperand(b,e,h):j.PushOperand(b,"e#VALUE!",0)};SocialCalc.Formula.FunctionList.CHOOSE=[SocialCalc.Formula.ChooseFunction,-2,"choose","","lookup"];
SocialCalc.Formula.ColumnsRowsFunctions=function(a,b,c,d){var e=0,g=SocialCalc.Formula,c=g.TopOfStackValueAndType(d,c);if(c.type=="coord"){e=1;a="n"}else if(c.type=="range"){d=g.DecodeRangeParts(d,c.value);if(a=="COLUMNS")e=d.ncols;else if(a=="ROWS")e=d.nrows;a="n"}else{e=0;a="e#VALUE!"}g.PushOperand(b,a,e)};SocialCalc.Formula.FunctionList.COLUMNS=[SocialCalc.Formula.ColumnsRowsFunctions,1,"range","","lookup"];
SocialCalc.Formula.FunctionList.ROWS=[SocialCalc.Formula.ColumnsRowsFunctions,1,"range","","lookup"];
SocialCalc.Formula.ZeroArgFunctions=function(a,b){var c,d,e={value:0};switch(a){case "FALSE":e.type="nl";e.value=0;break;case "NA":e.type="e#N/A";break;case "NOW":c=new Date;d=c.getTimezoneOffset();c=c.getTime()/1E3;e.value=25569+c/86400-d/1440;e.type="ndt";SocialCalc.Formula.FreshnessInfo["volatile"].NOW=true;break;case "PI":e.type="n";e.value=Math.PI;break;case "TODAY":c=new Date;d=c.getTimezoneOffset();c=c.getTime()/1E3;e.value=Math.floor(25569+c/86400-d/1440);e.type="nd";SocialCalc.Formula.FreshnessInfo["volatile"].TODAY=
true;break;case "TRUE":e.type="nl";e.value=1}b.push(e);return null};SocialCalc.Formula.FunctionList.FALSE=[SocialCalc.Formula.ZeroArgFunctions,0,"","","test"];SocialCalc.Formula.FunctionList.NA=[SocialCalc.Formula.ZeroArgFunctions,0,"","","test"];SocialCalc.Formula.FunctionList.NOW=[SocialCalc.Formula.ZeroArgFunctions,0,"","","datetime"];SocialCalc.Formula.FunctionList.PI=[SocialCalc.Formula.ZeroArgFunctions,0,"","","math"];
SocialCalc.Formula.FunctionList.TODAY=[SocialCalc.Formula.ZeroArgFunctions,0,"","","datetime"];SocialCalc.Formula.FunctionList.TRUE=[SocialCalc.Formula.ZeroArgFunctions,0,"","","test"];
SocialCalc.Formula.DDBFunction=function(a,b,c,d){var e,g=SocialCalc.Formula,h=g.OperandAsNumber(d,c),j=g.OperandAsNumber(d,c),k=g.OperandAsNumber(d,c),l=g.OperandAsNumber(d,c);if(!g.CheckForErrorValue(b,h)&&!g.CheckForErrorValue(b,j)&&!g.CheckForErrorValue(b,k)&&!g.CheckForErrorValue(b,l)){if(k.value<1){g.FunctionSpecificError(a,b,"e#NUM!",SocialCalc.Constants.s_sheetfuncddblife);return 0}e={value:2,type:"n"};c.length>0&&(e=g.OperandAsNumber(d,c));if(c.length!=0){g.FunctionArgsError(a,b);return 0}if(!g.CheckForErrorValue(b,
e)){c=a=0;for(d=1;d<=l.value-0&&d<=k.value;d++){a=(h.value-c)*(e.value/k.value);h.value-c-a<j.value&&(a=h.value-c-j.value);c=c+a}g.PushOperand(b,"n$",a)}}};SocialCalc.Formula.FunctionList.DDB=[SocialCalc.Formula.DDBFunction,-4,"ddb","","financial"];
SocialCalc.Formula.SLNFunction=function(a,b,c,d){var e=SocialCalc.Formula,g=e.OperandAsNumber(d,c),h=e.OperandAsNumber(d,c),c=e.OperandAsNumber(d,c);if(!e.CheckForErrorValue(b,g)&&!e.CheckForErrorValue(b,h)&&!e.CheckForErrorValue(b,c)){if(c.value<1){e.FunctionSpecificError(a,b,"e#NUM!",SocialCalc.Constants.s_sheetfuncslnlife);return 0}e.PushOperand(b,"n$",(g.value-h.value)/c.value)}};SocialCalc.Formula.FunctionList.SLN=[SocialCalc.Formula.SLNFunction,3,"csl","","financial"];
SocialCalc.Formula.SYDFunction=function(a,b,c,d){var a=SocialCalc.Formula,e=a.OperandAsNumber(d,c),g=a.OperandAsNumber(d,c),h=a.OperandAsNumber(d,c),d=a.OperandAsNumber(d,c);if(!a.CheckForErrorValue(b,e)&&!a.CheckForErrorValue(b,g)&&!a.CheckForErrorValue(b,h)&&!a.CheckForErrorValue(b,d)){if(h.value<1||d.value<=0){a.PushOperand(b,"e#NUM!",0);return 0}c=(h.value+1)*h.value/2;a.PushOperand(b,"n$",(e.value-g.value)*(h.value-d.value+1)/c)}};
SocialCalc.Formula.FunctionList.SYD=[SocialCalc.Formula.SYDFunction,4,"cslp","","financial"];
SocialCalc.Formula.InterestFunctions=function(a,b,c,d){var e,g,h,j,k,l,m,r,p,n=SocialCalc.Formula,s=n.OperandAsNumber(d,c);m=n.OperandAsNumber(d,c);l=n.OperandAsNumber(d,c);e=n.LookupResultType(s.type,m.type,n.TypeLookupTable.twoargnumeric);e=n.LookupResultType(e,l.type,n.TypeLookupTable.twoargnumeric);if(c.length){h=n.OperandAsNumber(d,c);e=n.LookupResultType(e,h.type,n.TypeLookupTable.twoargnumeric);if(c.length){j=n.OperandAsNumber(d,c);e=n.LookupResultType(e,j.type,n.TypeLookupTable.twoargnumeric);
if(c.length){if(a!="RATE"){n.FunctionArgsError(a,b);return 0}k=n.OperandAsNumber(d,c);e=n.LookupResultType(e,k.type,n.TypeLookupTable.twoargnumeric)}}}if(e=="n")switch(a){case "FV":k=s.value;a=m.value;m=l.value;l=h!=null?h.value:0;j=j!=null?j.value?1:0:0;g=h=k==0?-l-m*a:-(l*Math.pow(1+k,a)+m*(1+k*j)*(Math.pow(1+k,a)-1)/k);e="n$";break;case "NPER":k=s.value;m=m.value;l=l.value;h=h!=null?h.value:0;j=j!=null?j.value?1:0:0;if(k==0){if(m==0){n.PushOperand(b,"e#NUM!",0);return}a=(l+h)/-m}else{r=m*(1+k*
j)/k;p=l+r;if(p==0||k<=-1){n.PushOperand(b,"e#NUM!",0);return}r=(r-h)/p;if(r<=0){n.PushOperand(b,"e#NUM!",0);return}r=Math.log(r);p=Math.log(1+k);a=r/p}g=a;e="n";break;case "PMT":k=s.value;a=m.value;l=l.value;h=h!=null?h.value:0;j=j!=null?j.value?1:0:0;if(a==0){n.PushOperand(b,"e#NUM!",0);return}g=m=k==0?(h-l)/a:(0-h-l*Math.pow(1+k,a))/((1+k*j)*(Math.pow(1+k,a)-1)/k);e="n$";break;case "PV":k=s.value;a=m.value;m=l.value;h=h!=null?h.value:0;j=j!=null?j.value?1:0:0;if(k==-1){n.PushOperand(b,"e#DIV/0!",
0);return}g=l=k==0?-h-m*a:(-h-m*(1+k*j)*(Math.pow(1+k,a)-1)/k)/Math.pow(1+k,a);e="n$";break;case "RATE":a=s.value;m=m.value;l=l.value;h=h!=null?h.value:0;j=j!=null?j.value?1:0:0;k=k!=null?k.value:0.1;c=0;delta=1;epsilon=1.0E-7;for(k=k||1.0E-8;(delta>=0?delta:-delta)>epsilon&&k!=r;){delta=h+l*Math.pow(1+k,a)+m*(1+k*j)*(Math.pow(1+k,a)-1)/k;if(p!=null){p=(delta-p)/(k-r)||0.0010;r=k;k=k-delta/p}else{r=k;k=1.1*k}p=delta;c++;if(c>=100){n.PushOperand(b,"e#NUM!",0);return}}g=k;e="n%"}n.PushOperand(b,e,g)};
SocialCalc.Formula.FunctionList.FV=[SocialCalc.Formula.InterestFunctions,-3,"fv","","financial"];SocialCalc.Formula.FunctionList.NPER=[SocialCalc.Formula.InterestFunctions,-3,"nper","","financial"];SocialCalc.Formula.FunctionList.PMT=[SocialCalc.Formula.InterestFunctions,-3,"pmt","","financial"];SocialCalc.Formula.FunctionList.PV=[SocialCalc.Formula.InterestFunctions,-3,"pv","","financial"];SocialCalc.Formula.FunctionList.RATE=[SocialCalc.Formula.InterestFunctions,-3,"rate","","financial"];
SocialCalc.Formula.NPVFunction=function(a,b,c,d){var e,g,h,j,k=SocialCalc.Formula;e=k.OperandAsNumber(d,c);if(!k.CheckForErrorValue(b,e)){g=0;a="n";for(h=1;c.length;){j=k.OperandValueAndType(d,c);if(j.type.charAt(0)=="n"){h=h*(1+e.value);if(h==0){k.PushOperand(b,"e#DIV/0!",0);return}g=g+j.value/h;a=k.LookupResultType(j.type,a||j.type,k.TypeLookupTable.plus)}else if(j.type.charAt(0)=="e"&&a.charAt(0)!="e"){a=j.type;break}}a.charAt(0)=="n"&&(a="n$");k.PushOperand(b,a,g)}};
SocialCalc.Formula.FunctionList.NPV=[SocialCalc.Formula.NPVFunction,-2,"npv","","financial"];
SocialCalc.Formula.IRRFunction=function(a,b,c,d){var e,g,h,j;j=[];var k=[],l=SocialCalc.Formula;for(j.push(c.pop());j.length;){e=l.OperandValueAndType(d,j);if(e.type.charAt(0)=="n")k.push(e.value);else if(e.type.charAt(0)=="e"){l.PushOperand(b,"e#VALUE!",0);return}}if(k.length){e={value:0};if(c.length){e=l.OperandAsNumber(d,c);if(e.type.charAt(0)!="n"&&e.type.charAt(0)!="b"){l.PushOperand(b,"e#VALUE!",0);return}if(c.length){l.FunctionArgsError(a,b);return}}e.value=e.value||0.1;a=0;c=e.value;for(d=
1;(d>=0?d:-d)>1.0E-7&&c!=h;){d=0;e=1;for(j=0;j<k.length;j++){e=e*(1+c);if(e==0){l.PushOperand(b,"e#DIV/0!",0);return}d=d+k[j]/e}if(g!=null){g=(d-g)/(c-h);h=c;c=c-d/g}else{h=c;c=1.1*c}g=d;a++;if(a>=20){l.PushOperand(b,"e#NUM!",0);return}}l.PushOperand(b,"n%",c)}else l.PushOperand(b,"e#NUM!",0)};SocialCalc.Formula.FunctionList.IRR=[SocialCalc.Formula.IRRFunction,-1,"irr","","financial"];SocialCalc.Formula.SheetCache={sheets:{},waitingForLoading:null,constants:{asloaded:0,recalcing:1,recalcdone:2},loadsheet:null};
SocialCalc.Formula.FindInSheetCache=function(a){var b=SocialCalc.Formula.SheetCache,a=SocialCalc.Formula.NormalizeSheetName(a);if(b.sheets[a])return b.sheets[a].sheet;if(b.waitingForLoading)return null;b.waitingForLoading=a;return null};
SocialCalc.Formula.AddSheetToCache=function(a,b){var c=null,d=SocialCalc.Formula.SheetCache,e=d.constants,g=SocialCalc.Formula.NormalizeSheetName(a);if(b){c=new SocialCalc.Sheet;c.ParseSheetSave(b)}d.sheets[g]={sheet:c,recalcstate:e.asloaded,name:g};SocialCalc.Formula.FreshnessInfo.sheets[g]=true;return c};SocialCalc.Formula.NormalizeSheetName=function(a){return SocialCalc.Callbacks.NormalizeSheetName?SocialCalc.Callbacks.NormalizeSheetName(a):a.toLowerCase()};
SocialCalc.Formula.RemoteFunctionInfo={waitingForServer:null};SocialCalc.Formula.FreshnessInfo={sheets:{},"volatile":{},recalc_completed:!1};SocialCalc.Formula.FreshnessInfoReset=function(){var a=SocialCalc.Formula.FreshnessInfo;a.sheets={};a["volatile"]={};a.recalc_completed=false};SocialCalc.Formula.PlainCoord=function(a){return a.indexOf("$")==-1?a:a.replace(/\$/g,"")};
SocialCalc.Formula.OrderRangeParts=function(a,b){var c,d,e={};c=SocialCalc.coordToCr(a);d=SocialCalc.coordToCr(b);if(c.col>d.col){e.c1=d.col;e.c2=c.col}else{e.c1=c.col;e.c2=d.col}if(c.row>d.row){e.r1=d.row;e.r2=c.row}else{e.r1=c.row;e.r2=d.row}return e};
SocialCalc.Formula.TestCriteria=function(a,b,c){var d,e,g;if(c==null)return false;c=c+"";d=c.charAt(0);if(d=="="||d=="<"||d==">")c=c.substring(1);else{d=c.substring(0,2);d=="<="||d=="<>"||d==">="?c=c.substring(2):d="none"}c=SocialCalc.DetermineValueType(c);if(!c.type){if(d=="none")return false;if(b.charAt(0)=="b"){if(d=="=")return true}else if(d=="<>")return true;return false}e=false;if(c.type.charAt(0)=="n"&&b.charAt(0)=="t"){g=SocialCalc.DetermineValueType(a);if(g.type.charAt(0)=="n"){a=g.value;
b=g.type}}if(b.charAt(0)=="n"&&c.type.charAt(0)=="n"){a=a-0;c.value=c.value-0;switch(d){case "<":e=a<c.value;break;case "<=":e=a<=c.value;break;case "=":case "none":e=a==c.value;break;case ">=":e=a>=c.value;break;case ">":e=a>c.value;break;case "<>":e=a!=c.value}}else if(b.charAt(0)=="e")e=false;else if(c.type.charAt(0)=="e")e=false;else{b.charAt(0)=="n"&&(a=SocialCalc.format_number_for_display(a,"n",""));if(c.type.charAt(0)=="n")return false;a=a?a.toLowerCase():"";c.value=c.value?c.value.toLowerCase():
"";switch(d){case "<":e=a<c.value;break;case "<=":e=a<=c.value;break;case "=":e=a==c.value;break;case "none":e=a.substring(0,c.value.length)==c.value;break;case ">=":e=a>=c.value;break;case ">":e=a>c.value;break;case "<>":e=a!=c.value}}return e};SocialCalc||(SocialCalc={});SocialCalc.Popup={};SocialCalc.Popup.Types={};SocialCalc.Popup.Controls={};SocialCalc.Popup.Current={};SocialCalc.Popup.imagePrefix="images/sc-";SocialCalc.Popup.LocalizeString=function(a){return a};SocialCalc.Popup.Create=function(a,b,c){var d=SocialCalc.Popup.Types[a];d&&d.Create&&d.Create(a,b,c)};
SocialCalc.Popup.SetValue=function(a,b){var c=SocialCalc.Popup,d=c.Types,e=c.Controls;e[a]?(c=e[a].type,d=d[c],e=e[a].data,d&&d.Create&&(d.SetValue(c,a,b),e.attribs&&e.attribs.changedcallback&&e.attribs.changedcallback(e.attribs,a,b))):alert("Unknown control "+a)};
SocialCalc.Popup.SetDisabled=function(a,b){var c=SocialCalc.Popup,d=c.Types,e=c.Controls;if(e[a]){if(e=e[a].type,(d=d[e])&&d.Create)c.Current.id&&a==c.Current.id&&(d.Hide(e,c.Current.id),c.Current.id=null),d.SetDisabled(e,a,b)}else alert("Unknown control "+a)};SocialCalc.Popup.GetValue=function(a){var b=SocialCalc.Popup,c=b.Types,b=b.Controls;if(b[a])return b=b[a].type,(c=c[b])&&c.Create?c.GetValue(b,a):null;alert("Unknown control "+a)};
SocialCalc.Popup.Initialize=function(a,b){var c=SocialCalc.Popup,d=c.Types,c=c.Controls;c[a]?(c=c[a].type,(d=d[c])&&d.Initialize&&d.Initialize(c,a,b)):alert("Unknown control "+a)};SocialCalc.Popup.Reset=function(a){var b=SocialCalc.Popup.Types;b[a].Reset&&b[a].Reset(a)};
SocialCalc.Popup.CClick=function(a){var b=SocialCalc.Popup,c=b.Types,d=b.Controls;if(d[a]){if(!d[a].data||!d[a].data.disabled){var e=d[a].type,g=c[e];if(b.Current.id&&(c[d[b.Current.id].type].Hide(e,b.Current.id),a==b.Current.id)){b.Current.id=null;return}g&&g.Show&&g.Show(e,a);b.Current.id=a}}else alert("Unknown control "+a)};SocialCalc.Popup.Close=function(){var a=SocialCalc.Popup;a.Current.id&&a.CClick(a.Current.id)};
SocialCalc.Popup.Cancel=function(){var a=SocialCalc.Popup;if(a.Current.id){var b=a.Controls[a.Current.id].type;a.Types[b].Cancel(b,a.Current.id);a.Current.id=null}};
SocialCalc.Popup.CreatePopupDiv=function(a,b){var c,d=SocialCalc.Popup.Controls[a].data,e=document.createElement("div");e.style.position="absolute";c=SocialCalc.GetElementPositionWithScroll(d.mainele);e.style.top=c.top+d.mainele.offsetHeight+"px";e.style.left=c.left+"px";e.style.zIndex=100;e.style.backgroundColor="#FFF";e.style.border="1px solid black";b.width&&(e.style.width=b.width);d.mainele.appendChild(e);b.title&&(e.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">'+
b.title+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.Popup.Cancel();">&nbsp;X&nbsp;</td></tr></table>',b.moveable&&(d.dragregistered=e.firstChild.firstChild.firstChild.firstChild,SocialCalc.DragRegister(d.dragregistered,!0,!0,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:e})));return e};
SocialCalc.Popup.EnsurePosition=function(a,b){function c(a){var b=SocialCalc.GetElementPositionWithScroll(a);b.height=a.offsetHeight;b.width=a.offsetWidth;b.bottom=b.top+b.height;b.right=b.left+b.width;return b}var d=SocialCalc.Popup.Controls[a].data,e=d.mainele.firstChild;if(e){var d=d.popupele,g=c(d),h=c(b),e=c(e);e.bottom+g.height<h.bottom&&e.left+g.width<h.right?(d.style.top=e.bottom+"px",d.style.left=e.left+"px"):e.top-g.height>h.top&&e.left+g.width<h.right?(d.style.top=e.top-g.height+"px",d.style.left=
e.left+"px"):e.bottom+g.height<h.bottom&&e.right-g.width>h.left?(d.style.top=e.bottom+"px",d.style.left=e.right-g.width+"px"):e.top-g.height>h.top&&e.right-g.width>h.left?(d.style.top=e.top-g.height+"px",d.style.left=e.right-g.width+"px"):e.bottom+g.height<h.bottom&&g.width<h.width?(d.style.top=e.bottom+"px",d.style.left=h.left+Math.floor((h.width-g.width)/2)+"px"):e.top-g.height>h.top&&g.width<h.width?(d.style.top=e.top-g.height+"px",d.style.left=h.left+Math.floor((h.width-g.width)/2)+"px"):g.height<
h.height&&e.right+g.width<h.right?(d.style.top=h.top+Math.floor((h.height-g.height)/2)+"px",d.style.left=e.right+"px"):g.height<h.height&&e.left-g.width>h.left&&(d.style.top=h.top+Math.floor((h.height-g.height)/2)+"px",d.style.left=e.left-g.width+"px")}else alert("No main popup element firstChild.")};SocialCalc.Popup.DestroyPopupDiv=function(a,b){a&&(a.innerHTML="",SocialCalc.DragUnregister(b),a.parentNode&&a.parentNode.removeChild(a))};
SocialCalc.Popup.RGBToHex=function(a){var b=SocialCalc.Popup;return""==a?"000000":(a=a.match(/(\d+)\D+(\d+)\D+(\d+)/))?b.ToHex(a[1])+b.ToHex(a[2])+b.ToHex(a[3]):"000000"};SocialCalc.Popup.HexDigits="0123456789ABCDEF";SocialCalc.Popup.ToHex=function(a){var b=SocialCalc.Popup,c=a%16;return b.HexDigits.charAt(Math.floor(a/16))+b.HexDigits.charAt(c)};
SocialCalc.Popup.FromHex=function(a){var b=SocialCalc.Popup,c=b.HexDigits.indexOf(a.charAt(0).toUpperCase()),a=b.HexDigits.indexOf(a.charAt(1).toUpperCase());return 16*(0<=c?c:0)+(0<=a?a:0)};SocialCalc.Popup.HexToRGB=function(a){var b=SocialCalc.Popup;return"rgb("+b.FromHex(a.substring(1,3))+","+b.FromHex(a.substring(3,5))+","+b.FromHex(a.substring(5,7))+")"};SocialCalc.Popup.makeRGB=function(a,b,c){return"rgb("+(0<a?a:0)+","+(0<b?b:0)+","+(0<c?c:0)+")"};
SocialCalc.Popup.splitRGB=function(a){return(a=a.match(/(\d+)\D+(\d+)\D+(\d+)\D/))?{r:a[1]-0,g:a[2]-0,b:a[3]-0}:{r:0,g:0,b:0}};SocialCalc.Popup.Types.List={};
SocialCalc.Popup.Types.List.Create=function(a,b,c){var d=SocialCalc.Popup.Controls,a={type:a,value:"",display:"",data:{}};d[b]?alert("Already created "+b):(d[b]=a,d=a.data,d.attribs=c||{},(c=document.getElementById(b))?(d.mainele=c,c.innerHTML='<input style="cursor:pointer;width:'+(d.attribs.inputWidth||"100px")+';font-size:smaller;" onfocus="this.blur();" onclick="SocialCalc.Popup.CClick(\''+b+'\');" value="">',d.options=[]):alert("Missing element "+b))};
SocialCalc.Popup.Types.List.SetValue=function(a,b,c){a=SocialCalc.Popup.Controls[b].data;a.value=c;a.custom=!1;for(c=0;c<a.options.length;c++)if(o=a.options[c],(!o.a||!o.a.skip&&!o.a.custom&&!o.a.cancel)&&o.v==a.value){a.display=o.o;break}c==a.options.length&&(a.display="Custom",a.custom=!0);a.mainele&&a.mainele.firstChild&&(a.mainele.firstChild.value=a.display)};
SocialCalc.Popup.Types.List.SetDisabled=function(a,b,c){a=SocialCalc.Popup.Controls[b].data;a.disabled=c;a.mainele&&a.mainele.firstChild&&(a.mainele.firstChild.disabled=c)};SocialCalc.Popup.Types.List.GetValue=function(a,b){return SocialCalc.Popup.Controls[b].data.value};SocialCalc.Popup.Types.List.Initialize=function(a,b,c){var d,a=SocialCalc.Popup,e=a.Controls[b].data;for(d in c.attribs)e.attribs[d]=c.attribs[d];e.options=c?c.options:[];c.value&&a.SetValue(b,c.value)};
SocialCalc.Popup.Types.List.Reset=function(a){var b=SocialCalc.Popup,c=b.Types,d=b.Controls;b.Current.id&&d[b.Current.id].type==a&&(c[a].Hide(a,b.Current.id),b.Current.id=null)};
SocialCalc.Popup.Types.List.Show=function(a,b){var c;c=SocialCalc.Popup;var d=c.Controls[b].data,e="";d.popupele=c.CreatePopupDiv(b,d.attribs);d.custom?(e=SocialCalc.Popup.Types.List.MakeCustom(a,b),c=document.createElement("div"),c.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+e+"</div>",d.customele=c.firstChild.firstChild.childNodes[1],d.listdiv=null):(e=SocialCalc.Popup.Types.List.MakeList(a,b),c=document.createElement("div"),c.innerHTML='<div style="cursor:default;padding:4px;">'+
e+"</div>",d.customele=null,d.listdiv=c.firstChild);d.contentele=c;d.mainele&&d.mainele.firstChild&&(d.mainele.firstChild.disabled=!0);d.popupele.appendChild(c);d.attribs.ensureWithin&&SocialCalc.Popup.EnsurePosition(b,d.attribs.ensureWithin)};
SocialCalc.Popup.Types.List.MakeList=function(a,b){var c,d,e,g=SocialCalc.Popup.Controls[b].data,h;h='<table cellspacing="0" cellpadding="0"><tr><td style="vertical-align:top;">';g.ncols=1;for(c=0;c<g.options.length;c++){d=g.options[c];if(d.a){if(d.a.newcol){h+='</td><td style="vertical-align:top;">&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align:top;">';g.ncols+=1;continue}if(d.a.skip){h+='<div style="font-size:x-small;white-space:nowrap;">'+d.o+"</div>";continue}}e=d.v==g.value&&(!d.a||!d.a.custom&&
!d.a.cancel)?"background-color:#DDF;":"";h+='<div style="font-size:x-small;white-space:nowrap;'+e+'" onclick="SocialCalc.Popup.Types.List.ItemClicked(\''+b+"','"+c+"');\" onmousemove=\"SocialCalc.Popup.Types.List.MouseMove('"+b+"',this);\">"+d.o+"</div>"}return h+"</td></tr></table>"};
SocialCalc.Popup.Types.List.MakeCustom=function(a,b){var c=SocialCalc.Popup.LocalizeString,d="",d=SocialCalc.Popup.Controls[b].data.value,d=SocialCalc.special_chars(d);return d='<div style="white-space:nowrap;"><br><input id="customvalue" value="'+d+'"><br><br><input style="font-size:smaller;" type="button" value="'+c("OK")+'" onclick="SocialCalc.Popup.Types.List.CustomOK(\''+b+'\');return false;"><input style="font-size:smaller;" type="button" value="'+c("List")+'" onclick="SocialCalc.Popup.Types.List.CustomToList(\''+
b+'\');"><input style="font-size:smaller;" type="button" value="'+c("Cancel")+'" onclick="SocialCalc.Popup.Close();"><br></div>'};
SocialCalc.Popup.Types.List.ItemClicked=function(a,b){var c,d,e,g=SocialCalc.Popup.Controls[a].data;(c=g.options[b].a)&&c.custom?(c=g.contentele,d=SocialCalc.Popup.Types.List.MakeCustom("List",a),e=document.createElement("div"),e.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+d+"</div>",g.customele=e.firstChild.firstChild.childNodes[1],g.listdiv=null,g.contentele=e,g.popupele.replaceChild(e,c),g.attribs.ensureWithin&&SocialCalc.Popup.EnsurePosition(a,g.attribs.ensureWithin)):
((!c||!c.cancel)&&SocialCalc.Popup.SetValue(a,g.options[b].v),SocialCalc.Popup.Close())};SocialCalc.Popup.Types.List.CustomToList=function(a){var b,c,d,e=SocialCalc.Popup.Controls[a].data;b=e.contentele;c=SocialCalc.Popup.Types.List.MakeList("List",a);d=document.createElement("div");d.innerHTML='<div style="cursor:default;padding:4px;">'+c+"</div>";e.customele=null;e.listdiv=d.firstChild;e.contentele=d;e.popupele.replaceChild(d,b);e.attribs.ensureWithin&&SocialCalc.Popup.EnsurePosition(a,e.attribs.ensureWithin)};
SocialCalc.Popup.Types.List.CustomOK=function(a){SocialCalc.Popup.SetValue(a,SocialCalc.Popup.Controls[a].data.customele.value);SocialCalc.Popup.Close()};SocialCalc.Popup.Types.List.MouseMove=function(a,b){var c,d,e=SocialCalc.Popup.Controls[a].data;if(c=e.listdiv){var g=c.firstChild.firstChild.firstChild;for(c=0;c<e.ncols;c++)for(d=0;d<g.childNodes[2*c].childNodes.length;d++)g.childNodes[2*c].childNodes[d].style.backgroundColor="#FFF";b.style.backgroundColor="#DDF"}};
SocialCalc.Popup.Types.List.Hide=function(a,b){var c=SocialCalc.Popup,d=c.Controls[b].data;c.DestroyPopupDiv(d.popupele,d.dragregistered);d.popupele=null;d.mainele&&d.mainele.firstChild&&(d.mainele.firstChild.disabled=!1)};SocialCalc.Popup.Types.List.Cancel=function(a,b){SocialCalc.Popup.Types.List.Hide(a,b)};SocialCalc.Popup.Types.ColorChooser={};
SocialCalc.Popup.Types.ColorChooser.Create=function(a,b,c){var d=SocialCalc.Popup.Controls,a={type:a,value:"",display:"",data:{}};d[b]?alert("Already created "+b):(d[b]=a,d=a.data,d.attribs=c||{},c=d.attribs,d.value="",(a=document.getElementById(b))?(d.mainele=a,a.innerHTML='<div style="cursor:pointer;border:1px solid black;vertical-align:top;width:'+(c.sampleWidth||"15px")+";height:"+(c.sampleHeight||"15px")+';" onclick="SocialCalc.Popup.Types.ColorChooser.ControlClicked(\''+b+"');\">&nbsp;</div>"):
alert("Missing element "+b))};
SocialCalc.Popup.Types.ColorChooser.SetValue=function(a,b,c){var a=SocialCalc.Popup,b=a.Controls[b].data,d=b.attribs;b.value=c;b.custom=!1;b.mainele&&b.mainele.firstChild&&(b.value?(b.mainele.firstChild.style.backgroundColor=b.value,c=d.backgroundImage?"url("+a.imagePrefix+d.backgroundImage+")":"",a="center center"):(b.mainele.firstChild.style.backgroundColor="#FFF",d.backgroundImageDefault?(c="url("+a.imagePrefix+d.backgroundImageDefault+")",a="center center"):(c="url("+a.imagePrefix+"defaultcolor.gif)",
a="left top")),b.mainele.firstChild.style.backgroundPosition=a,b.mainele.firstChild.style.backgroundImage=c)};
SocialCalc.Popup.Types.ColorChooser.SetDisabled=function(a,b,c){var a=SocialCalc.Popup,d=a.Controls[b].data,e=d.attribs;d.disabled=c;d.mainele&&d.mainele.firstChild&&(c?(d.mainele.firstChild.style.backgroundColor="#DDD",e.backgroundImageDisabled?(img="url("+a.imagePrefix+e.backgroundImageDisabled+")",pos="center center"):(img="url("+a.imagePrefix+"defaultcolor.gif)",pos="left top"),d.mainele.firstChild.style.backgroundPosition=pos,d.mainele.firstChild.style.backgroundImage=img):a.SetValue(b,d.value))};
SocialCalc.Popup.Types.ColorChooser.GetValue=function(a,b){return SocialCalc.Popup.Controls[b].data.value};SocialCalc.Popup.Types.ColorChooser.Initialize=function(a,b,c){var d,a=SocialCalc.Popup,e=a.Controls[b].data;for(d in c.attribs)e.attribs[d]=c.attribs[d];c.value&&a.SetValue(b,c.value)};SocialCalc.Popup.Types.ColorChooser.Reset=function(a){var b=SocialCalc.Popup,c=b.Types,d=b.Controls;b.Current.id&&d[b.Current.id].type==a&&(c[a].Hide(a,b.Current.id),b.Current.id=null)};
SocialCalc.Popup.Types.ColorChooser.Show=function(a,b){var c,d;c=SocialCalc.Popup;var e=c.Controls[b].data;d="";e.oldvalue=e.value;e.popupele=c.CreatePopupDiv(b,e.attribs);e.custom?(d=SocialCalc.Popup.Types.ColorChooser.MakeCustom(a,b),c=document.createElement("div"),c.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+d+"</div>",e.customele=c.firstChild.firstChild.childNodes[2]):(d=SocialCalc.Popup.Types.ColorChooser.CreateGrid(a,b),c=document.createElement("div"),c.style.padding=
"3px",c.style.backgroundColor="#CCC",c.appendChild(d),e.customele=null);e.contentele=c;e.popupele.appendChild(c);e.attribs.ensureWithin&&SocialCalc.Popup.EnsurePosition(b,e.attribs.ensureWithin)};
SocialCalc.Popup.Types.ColorChooser.MakeCustom=function(a,b){var c=SocialCalc.Popup,d=c.LocalizeString,e="";return e='<div style="white-space:nowrap;"><br>#<input id="customvalue" style="width:75px;" value="'+c.Controls[b].data.value+'"><br><br><input style="font-size:smaller;" type="button" value="'+d("OK")+'" onclick="SocialCalc.Popup.Types.ColorChooser.CustomOK(\''+b+'\');return false;"><input style="font-size:smaller;" type="button" value="'+d("Grid")+'" onclick="SocialCalc.Popup.Types.ColorChooser.CustomToGrid(\''+
b+"');\"><br></div>"};SocialCalc.Popup.Types.ColorChooser.ItemClicked=function(){SocialCalc.Popup.Close()};SocialCalc.Popup.Types.ColorChooser.CustomToList=function(){};SocialCalc.Popup.Types.ColorChooser.CustomOK=function(a){var b=SocialCalc.Popup;b.SetValue(a,b.Controls[a].data.customele.value);b.Close()};SocialCalc.Popup.Types.ColorChooser.Hide=function(a,b){var c=SocialCalc.Popup,d=c.Controls[b].data;c.DestroyPopupDiv(d.popupele,d.dragregistered);d.popupele=null};
SocialCalc.Popup.Types.ColorChooser.Cancel=function(a,b){var c=SocialCalc.Popup;c.SetValue(b,c.Controls[b].data.oldvalue);SocialCalc.Popup.Types.ColorChooser.Hide(a,b)};
SocialCalc.Popup.Types.ColorChooser.CreateGrid=function(a,b){var c,d,e,g,h,j=SocialCalc.Popup,k=j.Types,l=j.LocalizeString;c=j.Controls[b].data;c.grid={};var m=c.grid,r=document.createElement("div");c=document.createElement("table");c.cellSpacing=0;c.cellPadding=0;c.style.width="100px";m.table=c;c=document.createElement("tbody");m.table.appendChild(c);m.tbody=c;for(d=0;16>d;d++){e=document.createElement("tr");for(g=0;5>g;g++)h={},m[d+","+g]=h,c=document.createElement("td"),c.style.fontSize="1px",
c.innerHTML="&nbsp;",c.style.height="10px",1>=g?(c.style.width="17px",c.style.borderRight="3px solid white"):(c.style.width="20px",c.style.backgroundRepeat="no-repeat"),e.appendChild(c),h.ele=c;m.tbody.appendChild(e)}r.appendChild(m.table);c=document.createElement("div");c.style.marginTop="3px";c.innerHTML='<table cellspacing="0" cellpadding="0"><tr><td style="width:17px;background-color:#FFF;background-image:url('+j.imagePrefix+'defaultcolor.gif);height:16px;font-size:10px;cursor:pointer;" title="'+
l("Default")+'">&nbsp;</td><td style="width:23px;height:16px;font-size:10px;text-align:center;cursor:pointer;" title="'+l("Custom")+'">#</td><td style="width:60px;height:16px;font-size:10px;text-align:center;cursor:pointer;">'+l("OK")+"</td></tr></table>";m.defaultbox=c.firstChild.firstChild.firstChild.childNodes[0];m.defaultbox.onclick=k.ColorChooser.DefaultClicked;m.custom=c.firstChild.firstChild.firstChild.childNodes[1];m.custom.onclick=k.ColorChooser.CustomClicked;m.msg=c.firstChild.firstChild.firstChild.childNodes[2];
m.msg.onclick=k.ColorChooser.CloseOK;r.appendChild(c);m.table.onmousedown=k.ColorChooser.GridMouseDown;k.ColorChooser.DetermineColors(b);k.ColorChooser.SetColors(b);return r};SocialCalc.Popup.Types.ColorChooser.gridToG=function(a,b,c){return a[b+","+c]};
SocialCalc.Popup.Types.ColorChooser.DetermineColors=function(a){var b=SocialCalc.Popup,c=b.Types.ColorChooser,d=b.Controls[a].data,a=d.grid,e,g=b.splitRGB(d.value),d=2;e=16-Math.floor((g.r+16)/16);a["selectedrow"+d]=e;for(e=0;16>e;e++)c.gridToG(a,e,d).rgb=b.makeRGB(17*(15-e),0,0);d=3;e=16-Math.floor((g.g+16)/16);a["selectedrow"+d]=e;for(e=0;16>e;e++)c.gridToG(a,e,d).rgb=b.makeRGB(0,17*(15-e),0);d=4;e=16-Math.floor((g.b+16)/16);a["selectedrow"+d]=e;for(e=0;16>e;e++)c.gridToG(a,e,d).rgb=b.makeRGB(0,
0,17*(15-e));d=1;for(e=0;16>e;e++)c.gridToG(a,e,d).rgb=b.makeRGB(17*(15-e),17*(15-e),17*(15-e));var d=0,b=[0,68,153,204,255],g="400,310,420,440,442,340,040,042,032,044,024,004,204,314,402,414".split(","),h;for(e=0;16>e;e++)h=g[e],c.gridToG(a,e,d).rgb="rgb("+b[h.charAt(0)-0]+","+b[h.charAt(1)-0]+","+b[h.charAt(2)-0]+")"};
SocialCalc.Popup.Types.ColorChooser.SetColors=function(a){var b,c,d,e=SocialCalc.Popup,g=e.Types.ColorChooser,h=e.Controls[a].data,j=h.grid;for(b=0;16>b;b++)for(c=0;5>c;c++)d=g.gridToG(j,b,c),d.ele.style.backgroundColor=d.rgb,d.ele.title=e.RGBToHex(d.rgb),d.ele.style.backgroundImage=j["selectedrow"+c]==b?"url("+e.imagePrefix+"chooserarrow.gif)":"";e.SetValue(a,h.value);j.msg.style.backgroundColor=h.value;a=e.splitRGB(h.value||"rgb(255,255,255)");j.msg.style.color=220>a.r+a.g+a.b?"#FFF":"#000";h.value?
(j.msg.style.backgroundImage="",j.msg.title=e.RGBToHex(h.value)):(j.msg.style.backgroundColor="#FFF",j.msg.style.backgroundImage="url("+e.imagePrefix+"defaultcolor.gif)",j.msg.title="Default")};
SocialCalc.Popup.Types.ColorChooser.GridMouseDown=function(a){var b=a||window.event,a=SocialCalc.Popup,c=a.Types.ColorChooser,d=a.Current.id;if(d){var e=a.Controls[d].data,g=e.grid;switch(b.type){case "mousedown":g.mousedown=!0;break;case "mouseup":g.mousedown=!1;break;case "mousemove":if(!g.mousedown)return}var h=SocialCalc.GetViewportInfo(),j=b.clientX+h.horizontalScroll,h=b.clientY+h.verticalScroll,b=SocialCalc.GetElementPosition(g.table),h=Math.floor((h-b.top-2)/10),h=0>h?0:h,j=Math.floor((j-
b.left)/20),j=0>j?0:4<j?4:j,g=c.gridToG(g,0>h?0:15<h?15:h,j).ele.style.backgroundColor,b=a.splitRGB(g),h=a.splitRGB(e.value);switch(j){case 2:e.value=a.makeRGB(b.r,h.g,h.b);break;case 3:e.value=a.makeRGB(h.r,b.g,h.b);break;case 4:e.value=a.makeRGB(h.r,h.g,b.b);break;case 0:case 1:e.value=g}c.DetermineColors(d);c.SetColors(d)}};SocialCalc.Popup.Types.ColorChooser.ControlClicked=function(a){var b=SocialCalc.Popup,c=b.Types.ColorChooser,d=b.Current.id;!d||a!=d?b.CClick(a):c.CloseOK()};
SocialCalc.Popup.Types.ColorChooser.DefaultClicked=function(){var a=SocialCalc.Popup,b=a.Current.id;b&&(a=a.Controls[b].data,a.value="",SocialCalc.Popup.SetValue(b,a.value),SocialCalc.Popup.Close())};
SocialCalc.Popup.Types.ColorChooser.CustomClicked=function(){var a=SocialCalc.Popup,b=a.Current.id;if(b){var c=a.Controls[b].data,d,e,g;d=c.contentele;e=SocialCalc.Popup.Types.ColorChooser.MakeCustom("ColorChooser",b);g=document.createElement("div");g.innerHTML='<div style="cursor:default;padding:4px;background-color:#CCC;">'+e+"</div>";c.customele=g.firstChild.firstChild.childNodes[2];c.contentele=g;c.popupele.replaceChild(g,d);c.customele.value=a.RGBToHex(c.value);c.attribs.ensureWithin&&SocialCalc.Popup.EnsurePosition(b,
c.attribs.ensureWithin)}};
SocialCalc.Popup.Types.ColorChooser.CustomToGrid=function(a){var b,c;b=SocialCalc.Popup;var d=b.Controls[a].data;SocialCalc.Popup.SetValue(a,b.HexToRGB("#"+d.customele.value));var e;b=d.contentele;e=SocialCalc.Popup.Types.ColorChooser.CreateGrid("ColorChooser",a);c=document.createElement("div");c.style.padding="3px";c.style.backgroundColor="#CCC";c.appendChild(e);d.customele=null;d.contentele=c;d.popupele.replaceChild(c,b);d.attribs.ensureWithin&&SocialCalc.Popup.EnsurePosition(a,d.attribs.ensureWithin)};
SocialCalc.Popup.Types.ColorChooser.CustomOK=function(a){var b=SocialCalc.Popup;SocialCalc.Popup.SetValue(a,b.HexToRGB("#"+b.Controls[a].data.customele.value));SocialCalc.Popup.Close()};SocialCalc.Popup.Types.ColorChooser.CloseOK=function(){var a=SocialCalc.Popup,b=a.Current.id;b&&(SocialCalc.Popup.SetValue(b,a.Controls[b].data.value),SocialCalc.Popup.Close())};SocialCalc||(alert("Main SocialCalc code module needed"),SocialCalc={});SocialCalc.TableEditor||alert("SocialCalc TableEditor code module needed");SocialCalc.CurrentSpreadsheetControlObject=null;
SocialCalc.SpreadsheetControl=function(){var a=SocialCalc.Constants;this.spreadsheetDiv=this.parentNode=null;this.viewheight=this.width=this.height=this.requestedSpaceBelow=this.requestedWidth=this.requestedHeight=0;this.tabs=[];this.tabnums={};this.tabreplacements={};this.currentTab=-1;this.views={};this.editorDiv=this.spreadsheetDiv=this.editor=this.context=this.sheet=null;this.moverange=this.sortrange="";this.idPrefix="SocialCalc-";this.multipartBoundary="SocialCalcSpreadsheetControlSave";this.imagePrefix=
a.defaultImagePrefix;this.toolbarbackground=a.SCToolbarbackground;this.tabbackground=a.SCTabbackground;this.tabselectedCSS=a.SCTabselectedCSS;this.tabplainCSS=a.SCTabplainCSS;this.toolbartext=a.SCToolbartext;this.formulabarheight=a.SCFormulabarheight;this.statuslineheight=a.SCStatuslineheight;this.statuslineCSS=a.SCStatuslineCSS;this.ExportCallback=null;this.sheet=new SocialCalc.Sheet;this.context=new SocialCalc.RenderContext(this.sheet);this.context.showGrid=true;this.context.showRCHeaders=true;
this.editor=new SocialCalc.TableEditor(this.context);this.editor.StatusCallback.statusline={func:SocialCalc.SpreadsheetControlStatuslineCallback,params:{statuslineid:this.idPrefix+"statusline",recalcid1:this.idPrefix+"divider_recalc",recalcid2:this.idPrefix+"button_recalc"}};SocialCalc.CurrentSpreadsheetControlObject=this;this.editor.MoveECellCallback.movefrom=function(a){var c=SocialCalc.GetSpreadsheetControlObject();c.context.cursorsuffix="";if(a.range2.hasrange&&!a.cellhandles.noCursorSuffix){if(a.ecell.row==
a.range2.top&&(a.ecell.col<a.range2.left||a.ecell.col>a.range2.right+1))c.context.cursorsuffix="insertleft";if(a.ecell.col==a.range2.left&&(a.ecell.row<a.range2.top||a.ecell.row>a.range2.bottom+1))c.context.cursorsuffix="insertup"}};this.formulabuttons={formulafunctions:{image:"formuladialog.gif",tooltip:"Functions",command:SocialCalc.SpreadsheetControl.DoFunctionList},multilineinput:{image:"multilinedialog.gif",tooltip:"Multi-line Input Box",command:SocialCalc.SpreadsheetControl.DoMultiline},link:{image:"linkdialog.gif",
tooltip:"Link Input Box",command:SocialCalc.SpreadsheetControl.DoLink},sum:{image:"sumdialog.gif",tooltip:"Auto Sum",command:SocialCalc.SpreadsheetControl.DoSum}};this.tabnums.edit=this.tabs.length;this.tabs.push({name:"edit",text:"Edit",html:' <div id="%id.edittools" style="padding:10px 0px 0px 0px;">&nbsp;<img id="%id.button_undo" src="%img.undo.gif" style="vertical-align:bottom;"> <img id="%id.button_redo" src="%img.redo.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_copy" src="%img.copy.gif" style="vertical-align:bottom;"> <img id="%id.button_cut" src="%img.cut.gif" style="vertical-align:bottom;"> <img id="%id.button_paste" src="%img.paste.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_delete" src="%img.delete.gif" style="vertical-align:bottom;"> <img id="%id.button_pasteformats" src="%img.pasteformats.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_filldown" src="%img.filldown.gif" style="vertical-align:bottom;"> <img id="%id.button_fillright" src="%img.fillright.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_movefrom" src="%img.movefromoff.gif" style="vertical-align:bottom;"> <img id="%id.button_movepaste" src="%img.movepasteoff.gif" style="vertical-align:bottom;"> <img id="%id.button_moveinsert" src="%img.moveinsertoff.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_alignleft" src="%img.alignleft.gif" style="vertical-align:bottom;"> <img id="%id.button_aligncenter" src="%img.aligncenter.gif" style="vertical-align:bottom;"> <img id="%id.button_alignright" src="%img.alignright.gif" style="vertical-align:bottom;"> &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_borderon" src="%img.borderson.gif" style="vertical-align:bottom;">  <img id="%id.button_borderoff" src="%img.bordersoff.gif" style="vertical-align:bottom;">  <img id="%id.button_swapcolors" src="%img.swapcolors.gif" style="vertical-align:bottom;">  &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_merge" src="%img.merge.gif" style="vertical-align:bottom;">  <img id="%id.button_unmerge" src="%img.unmerge.gif" style="vertical-align:bottom;">  &nbsp;<img src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_insertrow" src="%img.insertrow.gif" style="vertical-align:bottom;">  <img id="%id.button_insertcol" src="%img.insertcol.gif" style="vertical-align:bottom;"> &nbsp; <img id="%id.button_deleterow" src="%img.deleterow.gif" style="vertical-align:bottom;">  <img id="%id.button_deletecol" src="%img.deletecol.gif" style="vertical-align:bottom;">  &nbsp;<img id="%id.divider_recalc" src="%img.divider1.gif" style="vertical-align:bottom;">&nbsp; <img id="%id.button_recalc" src="%img.recalc.gif" style="vertical-align:bottom;">  </div>',
oncreate:null,onclick:null});this.tabnums.settings=this.tabs.length;this.tabs.push({name:"settings",text:"Format",html:'<div id="%id.settingstools" style="display:none;"> <div id="%id.sheetsettingstoolbar" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr><td>   <div style="%tbt.">%loc!SHEET SETTINGS!:</div>   </td></tr><tr><td>   <input id="%id.settings-savesheet" type="button" value="%loc!Save!" onclick="SocialCalc.SettingsControlSave(\'sheet\');">   <input type="button" value="%loc!Cancel!" onclick="SocialCalc.SettingsControlSave(\'cancel\');">   <input type="button" value="%loc!Show Cell Settings!" onclick="SocialCalc.SpreadsheetControlSettingsSwitch(\'cell\');return false;">   </td></tr></table> </div> <div id="%id.cellsettingstoolbar" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr><td>   <div style="%tbt.">%loc!CELL SETTINGS!: <span id="%id.settingsecell">&nbsp;</span></div>   </td></tr><tr><td>  <input id="%id.settings-savecell" type="button" value="%loc!Save!" onclick="SocialCalc.SettingsControlSave(\'cell\');">  <input type="button" value="%loc!Cancel!" onclick="SocialCalc.SettingsControlSave(\'cancel\');">  <input type="button" value="%loc!Show Sheet Settings!" onclick="SocialCalc.SpreadsheetControlSettingsSwitch(\'sheet\');return false;">  </td></tr></table> </div></div>',
view:"settings",onclick:function(a){SocialCalc.SettingsControls.idPrefix=a.idPrefix;SocialCalc.SettingControlReset();var c=a.sheet.EncodeSheetAttributes(),d=a.sheet.EncodeCellAttributes(a.editor.ecell.coord);SocialCalc.SettingsControlLoadPanel(a.views.settings.values.sheetspanel,c);SocialCalc.SettingsControlLoadPanel(a.views.settings.values.cellspanel,d);document.getElementById(a.idPrefix+"settingsecell").innerHTML=a.editor.ecell.coord;SocialCalc.SpreadsheetControlSettingsSwitch("cell");a.views.settings.element.style.height=
a.viewheight+"px";a.views.settings.element.firstChild.style.height=a.viewheight+"px";c=a.editor.range.hasrange?SocialCalc.crToCoord(a.editor.range.left,a.editor.range.top)+":"+SocialCalc.crToCoord(a.editor.range.right,a.editor.range.bottom):a.editor.ecell.coord;document.getElementById(a.idPrefix+"settings-savecell").value=SocialCalc.LocalizeString("Save to")+": "+c},onclickFocus:true});this.views.settings={name:"settings",values:{},oncreate:function(a,c){var d=SocialCalc.Constants;c.values.sheetspanel=
{colorchooser:{id:a.idPrefix+"scolorchooser"},formatnumber:{setting:"numberformat",type:"PopupList",id:a.idPrefix+"formatnumber",initialdata:d.SCFormatNumberFormats},formattext:{setting:"textformat",type:"PopupList",id:a.idPrefix+"formattext",initialdata:d.SCFormatTextFormats},fontfamily:{setting:"fontfamily",type:"PopupList",id:a.idPrefix+"fontfamily",initialdata:d.SCFormatFontfamilies},fontlook:{setting:"fontlook",type:"PopupList",id:a.idPrefix+"fontlook",initialdata:d.SCFormatFontlook},fontsize:{setting:"fontsize",
type:"PopupList",id:a.idPrefix+"fontsize",initialdata:d.SCFormatFontsizes},textalignhoriz:{setting:"textalignhoriz",type:"PopupList",id:a.idPrefix+"textalignhoriz",initialdata:d.SCFormatTextAlignhoriz},numberalignhoriz:{setting:"numberalignhoriz",type:"PopupList",id:a.idPrefix+"numberalignhoriz",initialdata:d.SCFormatNumberAlignhoriz},alignvert:{setting:"alignvert",type:"PopupList",id:a.idPrefix+"alignvert",initialdata:d.SCFormatAlignVertical},textcolor:{setting:"textcolor",type:"ColorChooser",id:a.idPrefix+
"textcolor"},bgcolor:{setting:"bgcolor",type:"ColorChooser",id:a.idPrefix+"bgcolor"},padtop:{setting:"padtop",type:"PopupList",id:a.idPrefix+"padtop",initialdata:d.SCFormatPadsizes},padright:{setting:"padright",type:"PopupList",id:a.idPrefix+"padright",initialdata:d.SCFormatPadsizes},padbottom:{setting:"padbottom",type:"PopupList",id:a.idPrefix+"padbottom",initialdata:d.SCFormatPadsizes},padleft:{setting:"padleft",type:"PopupList",id:a.idPrefix+"padleft",initialdata:d.SCFormatPadsizes},colwidth:{setting:"colwidth",
type:"PopupList",id:a.idPrefix+"colwidth",initialdata:d.SCFormatColwidth},recalc:{setting:"recalc",type:"PopupList",id:a.idPrefix+"recalc",initialdata:d.SCFormatRecalc}};c.values.cellspanel={name:"cell",colorchooser:{id:a.idPrefix+"scolorchooser"},cformatnumber:{setting:"numberformat",type:"PopupList",id:a.idPrefix+"cformatnumber",initialdata:d.SCFormatNumberFormats},cformattext:{setting:"textformat",type:"PopupList",id:a.idPrefix+"cformattext",initialdata:d.SCFormatTextFormats},cfontfamily:{setting:"fontfamily",
type:"PopupList",id:a.idPrefix+"cfontfamily",initialdata:d.SCFormatFontfamilies},cfontlook:{setting:"fontlook",type:"PopupList",id:a.idPrefix+"cfontlook",initialdata:d.SCFormatFontlook},cfontsize:{setting:"fontsize",type:"PopupList",id:a.idPrefix+"cfontsize",initialdata:d.SCFormatFontsizes},calignhoriz:{setting:"alignhoriz",type:"PopupList",id:a.idPrefix+"calignhoriz",initialdata:d.SCFormatTextAlignhoriz},calignvert:{setting:"alignvert",type:"PopupList",id:a.idPrefix+"calignvert",initialdata:d.SCFormatAlignVertical},
ctextcolor:{setting:"textcolor",type:"ColorChooser",id:a.idPrefix+"ctextcolor"},cbgcolor:{setting:"bgcolor",type:"ColorChooser",id:a.idPrefix+"cbgcolor"},cbt:{setting:"bt",type:"BorderSide",id:a.idPrefix+"cbt"},cbr:{setting:"br",type:"BorderSide",id:a.idPrefix+"cbr"},cbb:{setting:"bb",type:"BorderSide",id:a.idPrefix+"cbb"},cbl:{setting:"bl",type:"BorderSide",id:a.idPrefix+"cbl"},cpadtop:{setting:"padtop",type:"PopupList",id:a.idPrefix+"cpadtop",initialdata:d.SCFormatPadsizes},cpadright:{setting:"padright",
type:"PopupList",id:a.idPrefix+"cpadright",initialdata:d.SCFormatPadsizes},cpadbottom:{setting:"padbottom",type:"PopupList",id:a.idPrefix+"cpadbottom",initialdata:d.SCFormatPadsizes},cpadleft:{setting:"padleft",type:"PopupList",id:a.idPrefix+"cpadleft",initialdata:d.SCFormatPadsizes}};SocialCalc.SettingsControlInitializePanel(c.values.sheetspanel);SocialCalc.SettingsControlInitializePanel(c.values.cellspanel)},replacements:{itemtitle:{regex:/\%itemtitle\./g,replacement:'style="padding:12px 10px 0px 10px;font-weight:bold;text-align:right;vertical-align:top;font-size:small;"'},
sectiontitle:{regex:/\%sectiontitle\./g,replacement:'style="padding:16px 10px 0px 0px;font-weight:bold;vertical-align:top;font-size:small;color:#C00;"'},parttitle:{regex:/\%parttitle\./g,replacement:'style="font-weight:bold;font-size:x-small;padding:0px 0px 3px 0px;"'},itembody:{regex:/\%itembody\./g,replacement:'style="padding:12px 0px 0px 0px;vertical-align:top;font-size:small;"'},bodypart:{regex:/\%bodypart\./g,replacement:'style="padding:0px 10px 0px 0px;font-size:small;vertical-align:top;"'}},
divStyle:"border:1px solid black;overflow:auto;",html:'<div id="%id.scolorchooser" style="display:none;position:absolute;z-index:20;"></div><table cellspacing="0" cellpadding="0"> <tr><td style="vertical-align:top;"><table id="%id.sheetsettingstable" style="display:none;" cellspacing="0" cellpadding="0"><tr> <td %itemtitle.><br>%loc!Default Format!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Number!</div>     <span id="%id.formatnumber"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Text!</div>     <span id="%id.formattext"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Alignment!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Text Horizontal!</div>     <span id="%id.textalignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Number Horizontal!</div>     <span id="%id.numberalignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Vertical!</div>     <span id="%id.alignvert"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Font!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Family!</div>     <span id="%id.fontfamily"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bold &amp; Italics!</div>     <span id="%id.fontlook"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Size!</div>     <span id="%id.fontsize"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Color!</div>     <div id="%id.textcolor"></div>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Background!</div>     <div id="%id.bgcolor"></div>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Padding!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Top!</div>     <span id="%id.padtop"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Right!</div>     <span id="%id.padright"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bottom!</div>     <span id="%id.padbottom"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Left!</div>     <span id="%id.padleft"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Default Column Width!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>&nbsp;</div>     <span id="%id.colwidth"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Recalculation!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>&nbsp;</div>     <span id="%id.recalc"></span>    </td>   </tr></table> </td></tr></table><table id="%id.cellsettingstable" cellspacing="0" cellpadding="0"><tr> <td %itemtitle.><br>%loc!Format!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Number!</div>     <span id="%id.cformatnumber"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Text!</div>     <span id="%id.cformattext"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Alignment!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Horizontal!</div>     <span id="%id.calignhoriz"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Vertical!</div>     <span id="%id.calignvert"></span>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Font!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Family!</div>     <span id="%id.cfontfamily"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bold &amp; Italics!</div>     <span id="%id.cfontlook"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Size!</div>     <span id="%id.cfontsize"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Color!</div>     <div id="%id.ctextcolor"></div>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Background!</div>     <div id="%id.cbgcolor"></div>    </td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Borders!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0">    <tr><td %bodypart. colspan="3"><div %parttitle.>%loc!Top Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Right Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Bottom Border!</div></td>     <td %bodypart. colspan="3"><div %parttitle.>%loc!Left Border!</div></td>    </tr><tr>    <td %bodypart.>     <input id="%id.cbt-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbt-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbr-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbr-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbb-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbb-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>    <td %bodypart.>     <input id="%id.cbl-onoff-bcb" onclick="SocialCalc.SettingsControlOnchangeBorder(this);" type="checkbox">    </td>    <td %bodypart.>     <div id="%id.cbl-color"></div>    </td>    <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>   </tr></table> </td></tr><tr> <td %itemtitle.><br>%loc!Padding!:</td> <td %itembody.>   <table cellspacing="0" cellpadding="0"><tr>    <td %bodypart.>     <div %parttitle.>%loc!Top!</div>     <span id="%id.cpadtop"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Right!</div>     <span id="%id.cpadright"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Bottom!</div>     <span id="%id.cpadbottom"></span>    </td>    <td %bodypart.>     <div %parttitle.>%loc!Left!</div>     <span id="%id.cpadleft"></span>    </td>   </tr></table> </td></tr></table> </td><td style="vertical-align:top;padding:12px 0px 0px 12px;">  <div style="width:100px;height:100px;overflow:hidden;border:1px solid black;background-color:#EEE;padding:6px;">   <table cellspacing="0" cellpadding="0"><tr>    <td id="sample-text" style="height:100px;width:100px;"><div>%loc!This is a<br>sample!</div><div>-1234.5</div></td>   </tr></table>  </div> </td></tr></table><br>'};
this.tabnums.sort=this.tabs.length;this.tabs.push({name:"sort",text:"Sort",html:' <div id="%id.sorttools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:4px;width:160px;">    <div style="%tbt.">%loc!Set Cells To Sort!</div>    <select id="%id.sortlist" size="1" onfocus="%s.CmdGotFocus(this);"><option selected>[select range]</option></select>    <input type="button" value="%loc!OK!" onclick="%s.DoCmd(this, \'ok-setsort\');" style="font-size:x-small;">   </td>   <td style="vertical-align:middle;padding-right:16px;width:100px;text-align:right;">    <div style="%tbt.">&nbsp;</div>    <input type="button" id="%id.sortbutton" value="%loc!Sort Cells! A1:A1" onclick="%s.DoCmd(this, \'dosort\');" style="visibility:hidden;">   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Major Sort!</div>      <select id="%id.majorsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="majorsort" id="%id.majorsortup" value="up" checked><span style="font-size:x-small;color:#FFF;">%loc!Up!</span><br>      <input type="radio" name="majorsort" id="%id.majorsortdown" value="down"><span style="font-size:x-small;color:#FFF;">%loc!Down!</span>     </td>    </tr></table>   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Minor Sort!</div>      <select id="%id.minorsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="minorsort" id="%id.minorsortup" value="up" checked><span style="font-size:x-small;color:#FFF;">%loc!Up!</span><br>      <input type="radio" name="minorsort" id="%id.minorsortdown" value="down"><span style="font-size:x-small;color:#FFF;">%loc!Down!</span>     </td>    </tr></table>   </td>   <td style="vertical-align:top;padding-right:16px;">    <table cellspacing="0" cellpadding="0"><tr>     <td style="vertical-align:top;">      <div style="%tbt.">%loc!Last Sort!</div>      <select id="%id.lastsort" size="1" onfocus="%s.CmdGotFocus(this);"></select>     </td><td>      <input type="radio" name="lastsort" id="%id.lastsortup" value="up" checked><span style="font-size:x-small;color:#FFF;">%loc!Up!</span><br>      <input type="radio" name="lastsort" id="%id.lastsortdown" value="down"><span style="font-size:x-small;color:#FFF;">%loc!Down!</span>     </td>    </tr></table>   </td>  </tr></table> </div>',
onclick:SocialCalc.SpreadsheetControlSortOnclick});this.editor.SettingsCallbacks.sort={save:SocialCalc.SpreadsheetControlSortSave,load:SocialCalc.SpreadsheetControlSortLoad};this.tabnums.audit=this.tabs.length;this.tabs.push({name:"audit",text:"Audit",html:'<div id="%id.audittools" style="display:none;"> <div style="%tbt.">&nbsp;</div></div>',view:"audit",onclick:function(a){var c=SocialCalc.LocalizeString,d,e,g='<table cellspacing="0" cellpadding="0" style="margin-bottom:10px;"><tr><td style="font-size:small;padding:6px;"><b>'+
c("Audit Trail This Session")+":</b><br><br>",h=a.sheet.changes.stack,j=a.sheet.changes.tos;for(d=0;d<h.length;d++){d==j+1&&(g=g+('<br></td></tr><tr><td style="font-size:small;background-color:#EEE;padding:6px;">'+c("UNDONE STEPS")+":<br>"));for(e=0;e<h[d].command.length;e++)g=g+(SocialCalc.special_chars(h[d].command[e])+"<br>")}a.views.audit.element.innerHTML=g+"</td></tr></table>";SocialCalc.CmdGotFocus(true)},onclickFocus:true});this.views.audit={name:"audit",divStyle:"border:1px solid black;overflow:auto;",
html:"Audit Trail"};this.tabnums.comment=this.tabs.length;this.tabs.push({name:"comment",text:"Comment",html:'<div id="%id.commenttools" style="display:none;"><table cellspacing="0" cellpadding="0"><tr><td><textarea id="%id.commenttext" style="font-size:small;height:32px;width:600px;overflow:auto;" onfocus="%s.CmdGotFocus(this);"></textarea></td><td style="vertical-align:top;">&nbsp;<input type="button" value="%loc!Save!" onclick="%s.SpreadsheetControlCommentSet();" style="font-size:x-small;"></td></tr></table></div>',
view:"sheet",onclick:SocialCalc.SpreadsheetControlCommentOnclick,onunclick:SocialCalc.SpreadsheetControlCommentOnunclick});this.tabnums.names=this.tabs.length;this.tabs.push({name:"names",text:"Names",html:'<div id="%id.namestools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:24px;">    <div style="%tbt.">%loc!Existing Names!</div>    <select id="%id.nameslist" size="1" onchange="%s.SpreadsheetControlNamesChangedName();" onfocus="%s.CmdGotFocus(this);"><option selected>[New]</option></select>   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Name!</div>    <input type="text" id="%id.namesname" style="font-size:x-small;width:75px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Description!</div>    <input type="text" id="%id.namesdesc" style="font-size:x-small;width:150px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">%loc!Value!</div>    <input type="text" id="%id.namesvalue" width="16" style="font-size:x-small;width:100px;" onfocus="%s.CmdGotFocus(this);">   </td>   <td style="vertical-align:top;padding-right:12px;width:100px;">    <div style="%tbt.">%loc!Set Value To!</div>    <input type="button" id="%id.namesrangeproposal" value="A1" onclick="%s.SpreadsheetControlNamesSetValue();" style="font-size:x-small;">   </td>   <td style="vertical-align:top;padding-right:6px;">    <div style="%tbt.">&nbsp;</div>    <input type="button" value="%loc!Save!" onclick="%s.SpreadsheetControlNamesSave();" style="font-size:x-small;">    <input type="button" value="%loc!Delete!" onclick="%s.SpreadsheetControlNamesDelete()" style="font-size:x-small;">   </td>  </tr></table></div>',
view:"sheet",onclick:SocialCalc.SpreadsheetControlNamesOnclick,onunclick:SocialCalc.SpreadsheetControlNamesOnunclick});this.tabnums.clipboard=this.tabs.length;this.tabs.push({name:"clipboard",text:"Clipboard",html:'<div id="%id.clipboardtools" style="display:none;">  <table cellspacing="0" cellpadding="0"><tr>   <td style="vertical-align:top;padding-right:24px;">    <div style="%tbt.">     &nbsp;    </div>   </td>  </tr></table></div>',view:"clipboard",onclick:SocialCalc.SpreadsheetControlClipboardOnclick,
onclickFocus:"clipboardtext"});this.views.clipboard={name:"clipboard",divStyle:"overflow:auto;",html:' <div style="font-size:x-small;padding:5px 0px 10px 0px;">  <b>%loc!Display Clipboard in!:</b>  <input type="radio" id="%id.clipboardformat-tab" name="%id.clipboardformat" checked onclick="%s.SpreadsheetControlClipboardFormat(\'tab\');"> %loc!Tab-delimited format! &nbsp;  <input type="radio" id="%id.clipboardformat-csv" name="%id.clipboardformat" onclick="%s.SpreadsheetControlClipboardFormat(\'csv\');"> %loc!CSV format! &nbsp;  <input type="radio" id="%id.clipboardformat-scsave" name="%id.clipboardformat" onclick="%s.SpreadsheetControlClipboardFormat(\'scsave\');"> %loc!SocialCalc-save format! </div> <input type="button" value="%loc!Load SocialCalc Clipboard With This!" style="font-size:x-small;" onclick="%s.SpreadsheetControlClipboardLoad();">&nbsp;  <input type="button" value="%loc!Clear SocialCalc Clipboard!" style="font-size:x-small;" onclick="%s.SpreadsheetControlClipboardClear();">&nbsp;  <br> <textarea id="%id.clipboardtext" style="font-size:small;height:350px;width:800px;overflow:auto;" onfocus="%s.CmdGotFocus(this);"></textarea>'}};
SocialCalc.SpreadsheetControl.prototype.InitializeSpreadsheetControl=function(a,b,c,d){return SocialCalc.InitializeSpreadsheetControl(this,a,b,c,d)};SocialCalc.SpreadsheetControl.prototype.DoOnResize=function(){return SocialCalc.DoOnResize(this)};SocialCalc.SpreadsheetControl.prototype.SizeSSDiv=function(){return SocialCalc.SizeSSDiv(this)};SocialCalc.SpreadsheetControl.prototype.ExecuteCommand=function(a,b){return SocialCalc.SpreadsheetControlExecuteCommand(this,a,b)};
SocialCalc.SpreadsheetControl.prototype.CreateSheetHTML=function(){return SocialCalc.SpreadsheetControlCreateSheetHTML(this)};SocialCalc.SpreadsheetControl.prototype.CreateSpreadsheetSave=function(a){return SocialCalc.SpreadsheetControlCreateSpreadsheetSave(this,a)};SocialCalc.SpreadsheetControl.prototype.DecodeSpreadsheetSave=function(a){return SocialCalc.SpreadsheetControlDecodeSpreadsheetSave(this,a)};
SocialCalc.SpreadsheetControl.prototype.CreateCellHTML=function(a){return SocialCalc.SpreadsheetControlCreateCellHTML(this,a)};SocialCalc.SpreadsheetControl.prototype.CreateCellHTMLSave=function(a){return SocialCalc.SpreadsheetControlCreateCellHTMLSave(this,a)};SocialCalc.SpreadsheetControl.prototype.ParseSheetSave=function(a){return this.sheet.ParseSheetSave(a)};SocialCalc.SpreadsheetControl.prototype.CreateSheetSave=function(){return this.sheet.CreateSheetSave()};
SocialCalc.InitializeSpreadsheetControl=function(a,b,c,d,e){var g=SocialCalc.Constants,h=SocialCalc.LocalizeString,j=SocialCalc.LocalizeSubstrings,k,l,m,r=a.tabs,p=a.views;a.requestedHeight=c;a.requestedWidth=d;a.requestedSpaceBelow=e;typeof b=="string"&&(b=document.getElementById(b));b==null&&alert("SocialCalc.SpreadsheetControl not given parent node.");a.parentNode=b;a.spreadsheetDiv=document.createElement("div");a.SizeSSDiv();for(c=b.firstChild;c!=null;c=b.firstChild)b.removeChild(c);c='<div><div style="'+
a.toolbarbackground+'padding:12px 10px 10px 4px;height:40px;">';for(d=0;d<r.length;d++)c=c+r[d].html;c=c+('</div><div style="'+a.tabbackground+'padding-bottom:4px;margin:0px 0px 8px 0px;"><table cellpadding="0" cellspacing="0"><tr>');for(d=0;d<r.length;d++)c=c+('  <td id="%id.'+r[d].name+'tab" style="'+(d==0?a.tabselectedCSS:a.tabplainCSS)+'" onclick="%s.SetTab(this);">'+h(r[d].text)+"</td>");c=c+" </tr></table></div></div>";a.currentTab=0;for(l in a.tabreplacements)c=c.replace(a.tabreplacements[l].regex,
a.tabreplacements[l].replacement);c=c.replace(/\%s\./g,"SocialCalc.");c=c.replace(/\%id\./g,a.idPrefix);c=c.replace(/\%tbt\./g,a.toolbartext);c=c.replace(/\%img\./g,a.imagePrefix);c=j(c);a.spreadsheetDiv.innerHTML=c;b.appendChild(a.spreadsheetDiv);a.Buttons={button_undo:{tooltip:"Undo",command:"undo"},button_redo:{tooltip:"Redo",command:"redo"},button_copy:{tooltip:"Copy",command:"copy"},button_cut:{tooltip:"Cut",command:"cut"},button_paste:{tooltip:"Paste",command:"paste"},button_pasteformats:{tooltip:"Paste Formats",
command:"pasteformats"},button_delete:{tooltip:"Delete Contents",command:"delete"},button_filldown:{tooltip:"Fill Down",command:"filldown"},button_fillright:{tooltip:"Fill Right",command:"fillright"},button_movefrom:{tooltip:"Set/Clear Move From",command:"movefrom"},button_movepaste:{tooltip:"Move Paste",command:"movepaste"},button_moveinsert:{tooltip:"Move Insert",command:"moveinsert"},button_alignleft:{tooltip:"Align Left",command:"align-left"},button_aligncenter:{tooltip:"Align Center",command:"align-center"},
button_alignright:{tooltip:"Align Right",command:"align-right"},button_borderon:{tooltip:"Borders On",command:"borderon"},button_borderoff:{tooltip:"Borders Off",command:"borderoff"},button_swapcolors:{tooltip:"Swap Colors",command:"swapcolors"},button_merge:{tooltip:"Merge Cells",command:"merge"},button_unmerge:{tooltip:"Unmerge Cells",command:"unmerge"},button_insertrow:{tooltip:"Insert Row",command:"insertrow"},button_insertcol:{tooltip:"Insert Column",command:"insertcol"},button_deleterow:{tooltip:"Delete Row",
command:"deleterow"},button_deletecol:{tooltip:"Delete Column",command:"deletecol"},button_recalc:{tooltip:"Recalc",command:"recalc"}};for(m in a.Buttons)if(b=document.getElementById(a.idPrefix+m)){b.style.border="1px solid "+g.ISCButtonBorderNormal;SocialCalc.TooltipRegister(b,h(a.Buttons[m].tooltip),{});SocialCalc.ButtonRegister(b,{normalstyle:"border:1px solid "+g.ISCButtonBorderNormal+";backgroundColor:"+g.ISCButtonBorderNormal+";",hoverstyle:"border:1px solid "+g.ISCButtonBorderHover+";backgroundColor:"+
g.ISCButtonBorderNormal+";",downstyle:"border:1px solid "+g.ISCButtonBorderDown+";backgroundColor:"+g.ISCButtonDownBackground+";"},{MouseDown:SocialCalc.DoButtonCmd,command:a.Buttons[m].command})}else alert("Button "+(a.idPrefix+m)+" missing");a.formulabarDiv=document.createElement("div");a.formulabarDiv.style.height=a.formulabarheight+"px";a.formulabarDiv.innerHTML='<input type="text" size="60" value="">&nbsp;';a.spreadsheetDiv.appendChild(a.formulabarDiv);new SocialCalc.InputBox(a.formulabarDiv.firstChild,
a.editor);for(m in a.formulabuttons){b=document.createElement("img");b.id=a.idPrefix+m;b.src=a.imagePrefix+a.formulabuttons[m].image;b.style.verticalAlign="middle";b.style.border="1px solid #FFF";b.style.marginLeft="4px";SocialCalc.TooltipRegister(b,h(a.formulabuttons[m].tooltip),{});SocialCalc.ButtonRegister(b,{normalstyle:"border:1px solid #FFF;backgroundColor:#FFF;",hoverstyle:"border:1px solid #CCC;backgroundColor:#FFF;",downstyle:"border:1px solid #000;backgroundColor:#FFF;"},{MouseDown:a.formulabuttons[m].command});
a.formulabarDiv.appendChild(b)}for(d=0;d<r.length;d++)if(r[d].oncreate)r[d].oncreate(a,r[d].name);a.nonviewheight=a.statuslineheight+a.spreadsheetDiv.firstChild.offsetHeight+a.spreadsheetDiv.lastChild.offsetHeight;a.viewheight=a.height-a.nonviewheight;a.editorDiv=a.editor.CreateTableEditor(a.width,a.viewheight);a.spreadsheetDiv.appendChild(a.editorDiv);for(k in p){c=p[k].html;for(l in p[k].replacements)c=c.replace(p[k].replacements[l].regex,p[k].replacements[l].replacement);c=c.replace(/\%s\./g,"SocialCalc.");
c=c.replace(/\%id\./g,a.idPrefix);c=c.replace(/\%tbt\./g,a.toolbartext);c=c.replace(/\%img\./g,a.imagePrefix);g=document.createElement("div");SocialCalc.setStyles(g,p[k].divStyle);g.style.display="none";g.style.width=a.width+"px";g.style.height=a.viewheight+"px";c=j(c);g.innerHTML=c;a.spreadsheetDiv.appendChild(g);p[k].element=g;if(p[k].oncreate)p[k].oncreate(a,p[k])}p.sheet={name:"sheet",element:a.editorDiv};a.statuslineDiv=document.createElement("div");a.statuslineDiv.style.cssText=a.statuslineCSS;
a.statuslineDiv.style.height=a.statuslineheight-((a.statuslineDiv.style.paddingTop||"0px").slice(0,-2)-0)-((a.statuslineDiv.style.paddingBottom||"0px").slice(0,-2)-0)+"px";a.statuslineDiv.id=a.idPrefix+"statusline";a.spreadsheetDiv.appendChild(a.statuslineDiv)};SocialCalc.LocalizeString=function(a){var b=SocialCalc.LocalizeStringList[a];if(!b){b=SocialCalc.Constants["s_loc_"+a.toLowerCase().replace(/\s/g,"_").replace(/\W/g,"X")]||a;SocialCalc.LocalizeStringList[a]=b}return b};
SocialCalc.LocalizeStringList={};SocialCalc.LocalizeSubstrings=function(a){var b=SocialCalc.LocalizeString;return a.replace(/%(loc|ssc)!(.*?)!/g,function(a,d,e){return d=="ssc"?SocialCalc.Constants[e]||alert("Missing constant: "+e):b(e)})};SocialCalc.GetSpreadsheetControlObject=function(){var a=SocialCalc.CurrentSpreadsheetControlObject;if(a)return a};
SocialCalc.DoOnResize=function(a){var b,c=a.views;if(a.SizeSSDiv()){for(vname in c){b=c[vname].element;b.style.width=a.width+"px";b.style.height=a.height-a.nonviewheight+"px"}a.editor.ResizeTableEditor(a.width,a.height-a.nonviewheight)}};
SocialCalc.SizeSSDiv=function(a){var b,c,d,e;d=false;b=SocialCalc.GetViewportInfo();c=SocialCalc.GetElementPosition(a.parentNode);c.bottom=0;c.right=0;e=a.parentNode.style;if(e.marginTop)c.top=c.top+(e.marginTop.slice(0,-2)-0);if(e.marginBottom)c.bottom=c.bottom+(e.marginBottom.slice(0,-2)-0);if(e.marginLeft)c.left=c.left+(e.marginLeft.slice(0,-2)-0);if(e.marginRight)c.right=c.right+(e.marginRight.slice(0,-2)-0);e=a.requestedHeight||b.height-(c.top+c.bottom+10)-(a.requestedSpaceBelow||0);if(a.height!=
e){a.height=e;a.spreadsheetDiv.style.height=e+"px";d=true}e=a.requestedWidth||b.width-(c.left+c.right+10)||700;if(a.width!=e){a.width=e;a.spreadsheetDiv.style.width=e+"px";d=true}return d};
SocialCalc.SetTab=function(a){var b,c,d,e,g,h={},j={},k=SocialCalc.GetSpreadsheetControlObject(),l=k.tabs,m=k.views,a=typeof a=="string"?a:a.id.slice(k.idPrefix.length,-3);if(k.editor.busy&&(!l[k.currentTab].view||l[k.currentTab].view=="sheet"))for(e=0;e<l.length;e++)if(l[e].name==a&&l[e].view&&l[e].view!="sheet")return;if(k.tabs[k.currentTab].onunclick)k.tabs[k.currentTab].onunclick(k,k.tabs[k.currentTab].name);for(e=0;e<l.length;e++){b=l[e].name;h[b]=document.getElementById(k.idPrefix+b+"tab");
j[b]=document.getElementById(k.idPrefix+b+"tools");if(b==a){c=e;j[b].style.display="block";h[b].style.cssText=k.tabselectedCSS}else{j[b].style.display="none";h[b].style.cssText=k.tabplainCSS}}k.currentTab=c;if(l[c].onclick)l[c].onclick(k,a);for(g in m)if(!l[c].view&&g=="sheet"||l[c].view==g){m[g].element.style.display="block";d=g}else m[g].element.style.display="none";if(l[c].onclickFocus){c=l[c].onclickFocus;if(typeof c=="string"){c=document.getElementById(k.idPrefix+c);c.focus()}SocialCalc.CmdGotFocus(c)}else SocialCalc.KeyboardFocus();
if(m[d].needsresize&&m[d].onresize){m[d].needsresize=false;m[d].onresize(k,m[d])}if(d=="sheet"){k.statuslineDiv.style.display="block";k.editor.ScheduleRender()}else k.statuslineDiv.style.display="none"};
SocialCalc.SpreadsheetControlStatuslineCallback=function(a,b,c,d){var e=document.getElementById(d.statuslineid);if(e)e.innerHTML=a.GetStatuslineString(b,c,d);switch(b){case "cmdendnorender":case "calcfinished":case "doneposcalc":b=document.getElementById(d.recalcid1);d=document.getElementById(d.recalcid2);if(!b||!d)break;if(a.context.sheetobj.attribs.needsrecalc=="yes"){b.style.display="inline";d.style.display="inline"}else{b.style.display="none";d.style.display="none"}}};
SocialCalc.UpdateSortRangeProposal=function(a){document.getElementById(SocialCalc.GetSpreadsheetControlObject().idPrefix+"sortlist").options[0].text=a.range.hasrange?SocialCalc.crToCoord(a.range.left,a.range.top)+":"+SocialCalc.crToCoord(a.range.right,a.range.bottom):SocialCalc.LocalizeString("[select range]")};
SocialCalc.LoadColumnChoosers=function(a){var b=SocialCalc.LocalizeString,c,d,e,g;if(a.sortrange&&a.sortrange.indexOf(":")==-1){c=SocialCalc.Formula.LookupName(a.sheet,a.sortrange||"");if(c.type=="range"){c=c.value.match(/^(.*)\|(.*)\|$/);c=c[1]+":"+c[2]}else c="A1:A1"}else c=a.sortrange;var h=SocialCalc.ParseRange(c);e=document.getElementById(a.idPrefix+"majorsort");g=e.selectedIndex;e.options.length=0;e.options[e.options.length]=new Option(b("[None]"),"");for(c=h.cr1.col;c<=h.cr2.col;c++){d=SocialCalc.rcColname(c);
e.options[e.options.length]=new Option(b("Column ")+d,d)}e.selectedIndex=g>1&&g<=h.cr2.col-h.cr1.col+1?g:1;e=document.getElementById(a.idPrefix+"minorsort");g=e.selectedIndex;e.options.length=0;e.options[e.options.length]=new Option(b("[None]"),"");for(c=h.cr1.col;c<=h.cr2.col;c++){d=SocialCalc.rcColname(c);e.options[e.options.length]=new Option(d,d)}e.selectedIndex=g>0&&g<=h.cr2.col-h.cr1.col+1?g:0;e=document.getElementById(a.idPrefix+"lastsort");g=e.selectedIndex;e.options.length=0;e.options[e.options.length]=
new Option(b("[None]"),"");for(c=h.cr1.col;c<=h.cr2.col;c++){d=SocialCalc.rcColname(c);e.options[e.options.length]=new Option(d,d)}e.selectedIndex=g>0&&g<=h.cr2.col-h.cr1.col+1?g:0};SocialCalc.CmdGotFocus=function(a){SocialCalc.Keyboard.passThru=a};SocialCalc.DoButtonCmd=function(a,b,c){SocialCalc.DoCmd(c.element,c.functionobj.command)};
SocialCalc.DoCmd=function(a,b){var c,d,e,g,h,j;g=SocialCalc.GetSpreadsheetControlObject();e=g.editor;switch(b){case "undo":g.ExecuteCommand("undo","");break;case "redo":g.ExecuteCommand("redo","");break;case "fill-rowcolstuff":case "fill-text":e=b.substring(5);d=document.getElementById(g.idPrefix+e+"list");for(c=d.length=0;c<SocialCalc.SpreadsheetCmdTable[e].length;c++)d.options[c]=new Option(SocialCalc.SpreadsheetCmdTable[e][c].t);b="changed-"+e;case "changed-rowcolstuff":case "changed-text":e=b.substring(8);
d=document.getElementById(g.idPrefix+e+"list");d=SocialCalc.SpreadsheetCmdTable.slists[SocialCalc.SpreadsheetCmdTable[e][d.selectedIndex].s];g=document.getElementById(g.idPrefix+e+"slist");for(c=g.length=0;c<(d.length||0);c++)g.options[c]=new Option(d[c].t,d[c].s);return;case "ok-rowcolstuff":case "ok-text":e=b.substring(3);d=document.getElementById(g.idPrefix+e+"list");g=document.getElementById(g.idPrefix+e+"slist");c=SocialCalc.SpreadsheetCmdTable[e][d.selectedIndex].c;d=g[g.selectedIndex].value;
SocialCalc.SpreadsheetControlExecuteCommand(a,c,d);break;case "ok-setsort":c=document.getElementById(g.idPrefix+"sortlist");g.sortrange=c.selectedIndex==0?e.range.hasrange?SocialCalc.crToCoord(e.range.left,e.range.top)+":"+SocialCalc.crToCoord(e.range.right,e.range.bottom):e.ecell.coord+":"+e.ecell.coord:c.options[c.selectedIndex].value;d=document.getElementById(g.idPrefix+"sortbutton");d.value=SocialCalc.LocalizeString("Sort ")+g.sortrange;d.style.visibility="visible";SocialCalc.LoadColumnChoosers(g);
a&&a.blur&&a.blur();SocialCalc.KeyboardFocus();return;case "dosort":if(g.sortrange&&g.sortrange.indexOf(":")==-1){e=SocialCalc.Formula.LookupName(g.sheet,g.sortrange||"");if(e.type!="range")return;e=e.value.match(/^(.*)\|(.*)\|$/);e=e[1]+":"+e[2]}else e=g.sortrange;if(e=="A1:A1")return;c="sort "+e+" ";e=document.getElementById(g.idPrefix+"majorsort");d=document.getElementById(g.idPrefix+"majorsortup");c=c+(e.options[e.selectedIndex].value+(d.checked?" up":" down"));e=document.getElementById(g.idPrefix+
"minorsort");if(e.selectedIndex>0){d=document.getElementById(g.idPrefix+"minorsortup");c=c+(" "+e.options[e.selectedIndex].value+(d.checked?" up":" down"))}e=document.getElementById(g.idPrefix+"lastsort");if(e.selectedIndex>0){d=document.getElementById(g.idPrefix+"lastsortup");c=c+(" "+e.options[e.selectedIndex].value+(d.checked?" up":" down"))}g.ExecuteCommand(c,"");break;case "merge":c=SocialCalc.SpreadsheetCmdLookup[b]||"";d=SocialCalc.SpreadsheetCmdSLookup[b]||"";g.ExecuteCommand(c,d);if(e.range.hasrange){e.MoveECell(SocialCalc.crToCoord(e.range.left,
e.range.top));e.RangeRemove()}break;case "movefrom":if(e.range2.hasrange){g.context.cursorsuffix="";e.Range2Remove();g.ExecuteCommand("redisplay","")}else if(e.range.hasrange){e.range2.top=e.range.top;e.range2.right=e.range.right;e.range2.bottom=e.range.bottom;e.range2.left=e.range.left;e.range2.hasrange=true;e.MoveECell(SocialCalc.crToCoord(e.range.left,e.range.top))}else{e.range2.top=e.ecell.row;e.range2.right=e.ecell.col;e.range2.bottom=e.ecell.row;e.range2.left=e.ecell.col;e.range2.hasrange=true}c=
e.range2.hasrange?"":"off";d=document.getElementById(g.idPrefix+"button_movefrom");d.src=g.imagePrefix+"movefrom"+c+".gif";d=document.getElementById(g.idPrefix+"button_movepaste");d.src=g.imagePrefix+"movepaste"+c+".gif";d=document.getElementById(g.idPrefix+"button_moveinsert");d.src=g.imagePrefix+"moveinsert"+c+".gif";e.range2.hasrange&&e.RangeRemove();break;case "movepaste":case "moveinsert":if(e.range2.hasrange){g.context.cursorsuffix="";c=b+" "+SocialCalc.crToCoord(e.range2.left,e.range2.top)+
":"+SocialCalc.crToCoord(e.range2.right,e.range2.bottom)+" "+e.ecell.coord;g.ExecuteCommand(c,"");e.Range2Remove();d=document.getElementById(g.idPrefix+"button_movefrom");d.src=g.imagePrefix+"movefromoff.gif";d=document.getElementById(g.idPrefix+"button_movepaste");d.src=g.imagePrefix+"movepasteoff.gif";d=document.getElementById(g.idPrefix+"button_moveinsert");d.src=g.imagePrefix+"moveinsertoff.gif"}break;case "swapcolors":c=g.sheet;h=c.GetAssuredCell(e.ecell.coord);d=c.attribs.defaultcolor?c.colors[c.attribs.defaultcolor]:
"rgb(0,0,0)";j=c.attribs.defaultbgcolor?c.colors[c.attribs.defaultbgcolor]:"rgb(255,255,255)";e=h.color?c.colors[h.color]:d;e==j&&(e="");c=h.bgcolor?c.colors[h.bgcolor]:j;c==d&&(c="");g.ExecuteCommand("set %C color "+c+"%Nset %C bgcolor "+e,"");break;default:c=SocialCalc.SpreadsheetCmdLookup[b]||"";d=SocialCalc.SpreadsheetCmdSLookup[b]||"";g.ExecuteCommand(c,d)}a&&a.blur&&a.blur();SocialCalc.KeyboardFocus()};
SocialCalc.SpreadsheetCmdLookup={copy:"copy %C all",cut:"cut %C all",paste:"paste %C all",pasteformats:"paste %C formats","delete":"erase %C formulas",filldown:"filldown %C all",fillright:"fillright %C all",erase:"erase %C all",borderon:"set %C bt %S%Nset %C br %S%Nset %C bb %S%Nset %C bl %S",borderoff:"set %C bt %S%Nset %C br %S%Nset %C bb %S%Nset %C bl %S",merge:"merge %C",unmerge:"unmerge %C","align-left":"set %C cellformat left","align-center":"set %C cellformat center","align-right":"set %C cellformat right",
"align-default":"set %C cellformat",insertrow:"insertrow %C",insertcol:"insertcol %C",deleterow:"deleterow %C",deletecol:"deletecol %C",undo:"undo",redo:"redo",recalc:"recalc"};SocialCalc.SpreadsheetCmdSLookup={borderon:"1px solid rgb(0,0,0)",borderoff:""};
SocialCalc.SpreadsheetControlExecuteCommand=function(a,b,c){var a=SocialCalc.GetSpreadsheetControlObject().editor,d,e,g;if(a.range.hasrange){e=d=SocialCalc.crToCoord(a.range.left,a.range.top)+":"+SocialCalc.crToCoord(a.range.right,a.range.bottom);g=SocialCalc.rcColname(a.range.left)+":"+SocialCalc.rcColname(a.range.right)}else{e=a.ecell.coord;d=a.ecell.coord+":"+a.ecell.coord;g=SocialCalc.rcColname(SocialCalc.coordToCr(a.ecell.coord).col)}b=b.replace(/%C/g,e);b=b.replace(/%R/g,d);b=b.replace(/%N/g,
"\n");b=b.replace(/%S/g,c);b=b.replace(/%W/g,g);b=b.replace(/%P/g,"%");a.EditorScheduleSheetCommands(b,true,false)};SocialCalc.SpreadsheetControlCreateSheetHTML=function(a){var b,c;b="";b=new SocialCalc.RenderContext(a.sheet);a=document.createElement("div");c=b.RenderSheet(null,{type:"html"});a.appendChild(c);delete b;b=a.innerHTML;delete c;delete a;return b};
SocialCalc.SpreadsheetControlCreateCellHTML=function(a,b,c){var d="",d=a.sheet.cells[b];if(!d)return"";d=d.displaystring==void 0?SocialCalc.FormatValueForDisplay(a.sheet,d.datavalue,b,c||a.context.defaultHTMLlinkstyle):d.displaystring;d=="&nbsp;"&&(d="");return d};
SocialCalc.SpreadsheetControlCreateCellHTMLSave=function(a,b,c){var d,e,g,h,j,k=[];d=b?SocialCalc.ParseRange(b):{cr1:{row:1,col:1},cr2:{row:a.sheet.attribs.lastrow,col:a.sheet.attribs.lastcol}};b=d.cr1;d=d.cr2;k.push("version:1.0");for(e=b.row;e<=d.row;e++)for(g=b.col;g<=d.col;g++){h=SocialCalc.crToCoord(g,e);if(j=a.sheet.cells[h]){j=j.displaystring==void 0?SocialCalc.FormatValueForDisplay(a.sheet,j.datavalue,h,c||a.context.defaultHTMLlinkstyle):j.displaystring;j!="&nbsp;"&&k.push(h+":"+SocialCalc.encodeForSave(j))}}k.push("");
return k.join("\n")};
SocialCalc.SpreadsheetControl.DoFunctionList=function(){var a,b,c=SocialCalc.Formula,d=SocialCalc.Constants.function_classlist,e=SocialCalc.GetSpreadsheetControlObject(),g=e.idPrefix+"function";b=document.getElementById(g+"dialog");if(!b){c.FillFunctionInfo();b='<table><tr><td><span style="font-size:x-small;font-weight:bold">%loc!Category!</span><br><select id="'+g+'class" size="'+d.length+'" style="width:120px;" onchange="SocialCalc.SpreadsheetControl.FunctionClassChosen(this.options[this.selectedIndex].value);">';for(a=
0;a<d.length;a++)b=b+('<option value="'+d[a]+'"'+(a==0?" selected>":">")+SocialCalc.special_chars(c.FunctionClasses[d[a]].name)+"</option>");b=b+('</select></td><td>&nbsp;&nbsp;</td><td id="'+g+'list"><span style="font-size:x-small;font-weight:bold">%loc!Functions!</span><br><select id="'+g+'name" size="'+d.length+'" style="width:240px;" onchange="SocialCalc.SpreadsheetControl.FunctionChosen(this.options[this.selectedIndex].value);" ondblclick="SocialCalc.SpreadsheetControl.DoFunctionPaste();">');
b=b+SocialCalc.SpreadsheetControl.GetFunctionNamesStr("all");b=b+('</td></tr><tr><td colspan="3"><div id="'+g+'desc" style="width:380px;height:80px;overflow:auto;font-size:x-small;">'+SocialCalc.SpreadsheetControl.GetFunctionInfoStr(c.FunctionClasses[d[0]].items[0])+'</div><div style="width:380px;text-align:right;padding-top:6px;font-size:small;"><input type="button" value="%loc!Paste!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoFunctionPaste();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideFunctions();"></div></td></tr></table>');
c=document.createElement("div");c.id=g+"dialog";c.style.position="absolute";d=SocialCalc.GetViewportInfo();c.style.top=d.height/3+"px";c.style.left=d.width/3+"px";c.style.zIndex=100;c.style.backgroundColor="#FFF";c.style.border="1px solid black";c.style.width="400px";b=SocialCalc.LocalizeSubstrings('<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">&nbsp;%loc!Function List!</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideFunctions();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+
b+"</div>");c.innerHTML=b;SocialCalc.DragRegister(c.firstChild.firstChild.firstChild.firstChild,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:c});e.spreadsheetDiv.appendChild(c);b=document.getElementById(g+"name");b.focus();SocialCalc.CmdGotFocus(b)}};
SocialCalc.SpreadsheetControl.GetFunctionNamesStr=function(a){var b,c="";b=SocialCalc.Formula.FunctionClasses[a];for(a=0;a<b.items.length;a++)c=c+('<option value="'+b.items[a]+'"'+(a==0?" selected>":">")+b.items[a]+"</option>");return c};SocialCalc.SpreadsheetControl.FillFunctionNames=function(a,b){var c,d;c=SocialCalc.Formula;b.length=0;d=c.FunctionClasses[a];for(c=0;c<d.items.length;c++){b.options[c]=new Option(d.items[c],d.items[c]);if(c==0)b.options[c].selected=true}};
SocialCalc.SpreadsheetControl.GetFunctionInfoStr=function(a){var b=SocialCalc.Formula,c=b.FunctionList[a],d=SocialCalc.special_chars,a="<b>"+a+"("+d(b.FunctionArgString(a))+")</b><br>";return a=a+d(c[3])};SocialCalc.SpreadsheetControl.FunctionClassChosen=function(a){var b=SocialCalc.GetSpreadsheetControlObject().idPrefix+"function",c=SocialCalc.Formula;SocialCalc.SpreadsheetControl.FillFunctionNames(a,document.getElementById(b+"name"));SocialCalc.SpreadsheetControl.FunctionChosen(c.FunctionClasses[a].items[0])};
SocialCalc.SpreadsheetControl.FunctionChosen=function(a){var b=SocialCalc.GetSpreadsheetControlObject().idPrefix+"function";document.getElementById(b+"desc").innerHTML=SocialCalc.SpreadsheetControl.GetFunctionInfoStr(a)};SocialCalc.SpreadsheetControl.HideFunctions=function(){var a=SocialCalc.GetSpreadsheetControlObject(),a=document.getElementById(a.idPrefix+"functiondialog");a.innerHTML="";SocialCalc.DragUnregister(a);SocialCalc.KeyboardFocus();a.parentNode&&a.parentNode.removeChild(a)};
SocialCalc.SpreadsheetControl.DoFunctionPaste=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=a.editor,c=document.getElementById(a.idPrefix+"functionname"),a=document.getElementById(a.idPrefix+"multilinetextarea"),c=c.value+"(";SocialCalc.SpreadsheetControl.HideFunctions();if(a){a.value=a.value+c;a.focus();SocialCalc.CmdGotFocus(a)}else b.EditorAddToInput(c,"=")};
SocialCalc.SpreadsheetControl.DoMultiline=function(){var a=SocialCalc.LocalizeSubstrings,b,c,d=SocialCalc.GetSpreadsheetControlObject(),e=d.editor,g=e.workingvalues,d=SocialCalc.GetSpreadsheetControlObject(),h=d.idPrefix+"multiline";b=document.getElementById(h+"dialog");if(!b){switch(e.state){case "start":g.ecoord=e.ecell.coord;g.erow=e.ecell.row;g.ecol=e.ecell.col;e.RangeRemove();c=SocialCalc.GetCellContents(e.context.sheetobj,g.ecoord);break;case "input":case "inputboxdirect":c=e.inputBox.GetText()}e.inputBox.element.disabled=
true;c=SocialCalc.special_chars(c);b='<textarea id="'+h+'textarea" style="width:380px;height:120px;margin:10px 0px 0px 6px;">'+c+'</textarea><div style="width:380px;text-align:right;padding:6px 0px 4px 6px;font-size:small;">'+a('<input type="button" value="%loc!Set Cell Contents!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoMultilinePaste();">&nbsp;<input type="button" value="%loc!Clear!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoMultilineClear();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideMultiline();"></div></div>');
c=document.createElement("div");c.id=h+"dialog";c.style.position="absolute";e=SocialCalc.GetViewportInfo();c.style.top=e.height/3+"px";c.style.left=e.width/3+"px";c.style.zIndex=100;c.style.backgroundColor="#FFF";c.style.border="1px solid black";c.style.width="400px";c.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">'+a("&nbsp;%loc!Multi-line Input Box!")+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideMultiline();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+
b+"</div>";SocialCalc.DragRegister(c.firstChild.firstChild.firstChild.firstChild,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:c});d.spreadsheetDiv.appendChild(c);b=document.getElementById(h+"textarea");b.focus();SocialCalc.CmdGotFocus(b)}};
SocialCalc.SpreadsheetControl.HideMultiline=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=a.editor,a=document.getElementById(a.idPrefix+"multilinedialog");a.innerHTML="";SocialCalc.DragUnregister(a);SocialCalc.KeyboardFocus();a.parentNode&&a.parentNode.removeChild(a);switch(b.state){case "start":b.inputBox.DisplayCellContents(null);break;case "input":case "inputboxdirect":b.inputBox.element.disabled=false;b.inputBox.Focus()}};
SocialCalc.SpreadsheetControl.DoMultilineClear=function(){var a=SocialCalc.GetSpreadsheetControlObject(),a=document.getElementById(a.idPrefix+"multilinetextarea");a.value="";a.focus()};
SocialCalc.SpreadsheetControl.DoMultilinePaste=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=a.editor,c=b.workingvalues,a=document.getElementById(a.idPrefix+"multilinetextarea").value;SocialCalc.SpreadsheetControl.HideMultiline();switch(b.state){case "start":c.partialexpr="";c.ecoord=b.ecell.coord;c.erow=b.ecell.row;c.ecol=b.ecell.col;break;case "input":case "inputboxdirect":b.inputBox.Blur();b.inputBox.ShowInputBox(false);b.state="start"}b.EditorSaveEdit(a)};
SocialCalc.SpreadsheetControl.DoLink=function(){var a=SocialCalc.LocalizeString,b,c,d,e,g=SocialCalc.GetSpreadsheetControlObject();d=g.editor;e=d.workingvalues;var g=SocialCalc.GetSpreadsheetControlObject(),h=g.idPrefix+"link";c=document.getElementById(h+"dialog");if(!c){switch(d.state){case "start":e.ecoord=d.ecell.coord;e.erow=d.ecell.row;e.ecol=d.ecell.col;d.RangeRemove();b=SocialCalc.GetCellContents(d.context.sheetobj,e.ecoord);break;case "input":case "inputboxdirect":b=d.inputBox.GetText()}d.inputBox.element.disabled=
true;b.charAt(0)=="'"&&(b=b.slice(1));c=SocialCalc.ParseCellLinkText(b);SocialCalc.special_chars(b);b=g.sheet.cells[d.ecell.coord];d=!b||!b.textvalueformat?" checked":"";e=c.newwin?" checked":"";b='<div style="padding:6px 0px 4px 6px;"><span style="font-size:smaller;">'+a("Description")+'</span><br><input type="text" id="'+h+'desc" style="width:380px;" value="'+SocialCalc.special_chars(c.desc)+'"><br><span style="font-size:smaller;">'+a("URL")+'</span><br><input type="text" id="'+h+'url" style="width:380px;" value="'+
SocialCalc.special_chars(c.url)+'"><br>';SocialCalc.Callbacks.MakePageLink&&(b=b+('<span style="font-size:smaller;">'+a("Page Name")+'</span><br><input type="text" id="'+h+'pagename" style="width:380px;" value="'+SocialCalc.special_chars(c.pagename)+'"><br><span style="font-size:smaller;">'+a("Workspace")+'</span><br><input type="text" id="'+h+'workspace" style="width:380px;" value="'+SocialCalc.special_chars(c.workspace)+'"><br>'));b=b+SocialCalc.LocalizeSubstrings('<input type="checkbox" id="'+
h+'format"'+d+'>&nbsp;<span style="font-size:smaller;">%loc!Set to Link format!</span><br><input type="checkbox" id="'+h+'popup"'+e+'>&nbsp;<span style="font-size:smaller;">%loc!Show in new browser window!</span></div><div style="width:380px;text-align:right;padding:6px 0px 4px 6px;font-size:small;"><input type="button" value="%loc!Set Cell Contents!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoLinkPaste();">&nbsp;<input type="button" value="%loc!Clear!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.DoLinkClear();">&nbsp;<input type="button" value="%loc!Cancel!" style="font-size:smaller;" onclick="SocialCalc.SpreadsheetControl.HideLink();"></div></div>');
c=document.createElement("div");c.id=h+"dialog";c.style.position="absolute";d=SocialCalc.GetViewportInfo();c.style.top=d.height/3+"px";c.style.left=d.width/3+"px";c.style.zIndex=100;c.style.backgroundColor="#FFF";c.style.border="1px solid black";c.style.width="400px";c.innerHTML='<table cellspacing="0" cellpadding="0" style="border-bottom:1px solid black;"><tr><td style="font-size:10px;cursor:default;width:100%;background-color:#999;color:#FFF;">&nbsp;'+a("Link Input Box")+'</td><td style="font-size:10px;cursor:default;color:#666;" onclick="SocialCalc.SpreadsheetControl.HideLink();">&nbsp;X&nbsp;</td></tr></table><div style="background-color:#DDD;">'+
b+"</div>";SocialCalc.DragRegister(c.firstChild.firstChild.firstChild.firstChild,true,true,{MouseDown:SocialCalc.DragFunctionStart,MouseMove:SocialCalc.DragFunctionPosition,MouseUp:SocialCalc.DragFunctionPosition,Disabled:null,positionobj:c});g.spreadsheetDiv.appendChild(c);c=document.getElementById(h+"url");c.focus();SocialCalc.CmdGotFocus(c)}};
SocialCalc.SpreadsheetControl.HideLink=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=a.editor,a=document.getElementById(a.idPrefix+"linkdialog");a.innerHTML="";SocialCalc.DragUnregister(a);SocialCalc.KeyboardFocus();a.parentNode&&a.parentNode.removeChild(a);switch(b.state){case "start":b.inputBox.DisplayCellContents(null);break;case "input":case "inputboxdirect":b.inputBox.element.disabled=false;b.inputBox.Focus()}};
SocialCalc.SpreadsheetControl.DoLinkClear=function(){var a=SocialCalc.GetSpreadsheetControlObject();document.getElementById(a.idPrefix+"linkdesc").value="";document.getElementById(a.idPrefix+"linkpagename").value="";document.getElementById(a.idPrefix+"linkworkspace").value="";a=document.getElementById(a.idPrefix+"linkurl");a.value="";a.focus()};
SocialCalc.SpreadsheetControl.DoLinkPaste=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=a.editor,c=b.workingvalues,d=document.getElementById(a.idPrefix+"linkdesc"),e=document.getElementById(a.idPrefix+"linkurl"),g=document.getElementById(a.idPrefix+"linkpagename"),h=document.getElementById(a.idPrefix+"linkworkspace"),j=document.getElementById(a.idPrefix+"linkformat"),k="",l,m;if(document.getElementById(a.idPrefix+"linkpopup").checked){a="<<";k=">>";l="[[";m="]]"}else{a="<";k=">";l="[";
m="]"}k=g&&g.value?h.value?d.value+"{"+h.value+l+g.value+m+"}":d.value+l+g.value+m:d.value+a+e.value+k;SocialCalc.SpreadsheetControl.HideLink();switch(b.state){case "start":c.partialexpr="";c.ecoord=b.ecell.coord;c.erow=b.ecell.row;c.ecol=b.ecell.col;break;case "input":case "inputboxdirect":b.inputBox.Blur();b.inputBox.ShowInputBox(false);b.state="start"}j.checked&&SocialCalc.SpreadsheetControlExecuteCommand(null,"set %C textvalueformat text-link","");b.EditorSaveEdit(k)};
SocialCalc.SpreadsheetControl.DoSum=function(){var a,b,c,d,e=SocialCalc.GetSpreadsheetControlObject().editor,g=e.context.sheetobj;if(e.range.hasrange){a=SocialCalc.crToCoord(e.range.left,e.range.top)+":"+SocialCalc.crToCoord(e.range.right,e.range.bottom);a="set "+SocialCalc.crToCoord(e.range.right,e.range.bottom+1)+" formula sum("+a+")"}else{a=e.ecell.row-1;c=e.ecell.col;if(a<=1)a="set "+e.ecell.coord+" constant e#REF! 0 #REF!";else{for(d=false;a>0;){b=SocialCalc.crToCoord(c,a);b=g.GetAssuredCell(b);
if(!b.datatype||b.datatype=="t"){if(d){a++;break}}else d=true;a--}a="set "+e.ecell.coord+" formula sum("+SocialCalc.crToCoord(c,a)+":"+SocialCalc.crToCoord(c,e.ecell.row-1)+")"}}e.EditorScheduleSheetCommands(a,true,false)};
SocialCalc.SpreadsheetControlSortOnclick=function(a){var b,c,d=[],e=document.getElementById(a.idPrefix+"sortlist");SocialCalc.LoadColumnChoosers(a);a.editor.RangeChangeCallback.sort=SocialCalc.UpdateSortRangeProposal;for(b in a.sheet.names)d.push(b);d.sort();e.length=0;e.options[0]=new Option(SocialCalc.LocalizeString("[select range]"));for(c=0;c<d.length;c++){b=d[c];e.options[c+1]=new Option(b,b);if(b==a.sortrange)e.options[c+1].selected=true}if(a.sortrange=="")e.options[0].selected=true;SocialCalc.UpdateSortRangeProposal(a.editor);
SocialCalc.KeyboardFocus()};
SocialCalc.SpreadsheetControlSortSave=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b,c,d;b="sort:"+SocialCalc.encodeForSave(a.sortrange)+":";c=document.getElementById(a.idPrefix+"majorsort");d=document.getElementById(a.idPrefix+"majorsortup");b=b+(c.selectedIndex+(d.checked?":up":":down"));c=document.getElementById(a.idPrefix+"minorsort");if(c.selectedIndex>0){d=document.getElementById(a.idPrefix+"minorsortup");b=b+(":"+c.selectedIndex+(d.checked?":up":":down"))}else b=b+"::";c=document.getElementById(a.idPrefix+
"lastsort");if(c.selectedIndex>0){d=document.getElementById(a.idPrefix+"lastsortup");b=b+(":"+c.selectedIndex+(d.checked?":up":":down"))}else b=b+"::";return b+"\n"};
SocialCalc.SpreadsheetControlSortLoad=function(a,b,c){a=SocialCalc.GetSpreadsheetControlObject();c=c.split(":");a.sortrange=SocialCalc.decodeFromSave(c[1]);b=document.getElementById(a.idPrefix+"sortbutton");if(a.sortrange){b.value=SocialCalc.LocalizeString("Sort ")+a.sortrange;b.style.visibility="visible"}else b.style.visibility="hidden";SocialCalc.LoadColumnChoosers(a);sele=document.getElementById(a.idPrefix+"majorsort");sele.selectedIndex=c[2]-0;document.getElementById(a.idPrefix+"majorsort"+c[3]).checked=
true;sele=document.getElementById(a.idPrefix+"minorsort");if(c[4]){sele.selectedIndex=c[4]-0;document.getElementById(a.idPrefix+"minorsort"+c[5]).checked=true}else{sele.selectedIndex=0;document.getElementById(a.idPrefix+"minorsortup").checked=true}sele=document.getElementById(a.idPrefix+"lastsort");if(c[6]){sele.selectedIndex=c[6]-0;document.getElementById(a.idPrefix+"lastsort"+c[7]).checked=true}else{sele.selectedIndex=0;document.getElementById(a.idPrefix+"lastsortup").checked=true}return true};
SocialCalc.SpreadsheetControlCommentOnclick=function(a,b){a.editor.MoveECellCallback.comment=SocialCalc.SpreadsheetControlCommentMoveECell;SocialCalc.SpreadsheetControlCommentDisplay(a,b);SocialCalc.KeyboardFocus()};SocialCalc.SpreadsheetControlCommentDisplay=function(a){var b="";a.editor.ecell&&a.editor.ecell.coord&&a.sheet.cells[a.editor.ecell.coord]&&(b=a.sheet.cells[a.editor.ecell.coord].comment||"");document.getElementById(a.idPrefix+"commenttext").value=b};
SocialCalc.SpreadsheetControlCommentMoveECell=function(){SocialCalc.SpreadsheetControlCommentDisplay(SocialCalc.GetSpreadsheetControlObject(),"comment")};
SocialCalc.SpreadsheetControlCommentSet=function(){var a=SocialCalc.GetSpreadsheetControlObject();a.ExecuteCommand("set %C comment "+SocialCalc.encodeForSave(document.getElementById(a.idPrefix+"commenttext").value));var b=SocialCalc.GetEditorCellElement(a.editor,a.editor.ecell.row,a.editor.ecell.col);a.editor.UpdateCellCSS(b,a.editor.ecell.row,a.editor.ecell.col);SocialCalc.KeyboardFocus()};SocialCalc.SpreadsheetControlCommentOnunclick=function(a){delete a.editor.MoveECellCallback.comment};
SocialCalc.SpreadsheetControlNamesOnclick=function(a){document.getElementById(a.idPrefix+"namesname").value="";document.getElementById(a.idPrefix+"namesdesc").value="";document.getElementById(a.idPrefix+"namesvalue").value="";a.editor.RangeChangeCallback.names=SocialCalc.SpreadsheetControlNamesRangeChange;a.editor.MoveECellCallback.names=SocialCalc.SpreadsheetControlNamesRangeChange;SocialCalc.SpreadsheetControlNamesRangeChange(a.editor);SocialCalc.SpreadsheetControlNamesFillNameList();SocialCalc.SpreadsheetControlNamesChangedName()};
SocialCalc.SpreadsheetControlNamesFillNameList=function(){var a=SocialCalc.LocalizeString,b,c=[],d=SocialCalc.GetSpreadsheetControlObject(),e=document.getElementById(d.idPrefix+"nameslist"),g=document.getElementById(d.idPrefix+"namesname").value.toUpperCase().replace(/[^A-Z0-9_\.]/g,"");for(b in d.sheet.names)c.push(b);c.sort();e.length=0;e.options[0]=c.length>0?new Option(a("[New]")):new Option(a("[None]"));for(a=0;a<c.length;a++){b=c[a];e.options[a+1]=new Option(b,b);if(b==g)e.options[a+1].selected=
true}if(g=="")e.options[0].selected=true};
SocialCalc.SpreadsheetControlNamesChangedName=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=document.getElementById(a.idPrefix+"nameslist"),b=b.options[b.selectedIndex].value;if(a.sheet.names[b]){document.getElementById(a.idPrefix+"namesname").value=b;document.getElementById(a.idPrefix+"namesdesc").value=a.sheet.names[b].desc||"";document.getElementById(a.idPrefix+"namesvalue").value=a.sheet.names[b].definition||""}else{document.getElementById(a.idPrefix+"namesname").value="";document.getElementById(a.idPrefix+
"namesdesc").value="";document.getElementById(a.idPrefix+"namesvalue").value=""}};SocialCalc.SpreadsheetControlNamesRangeChange=function(a){var b=SocialCalc.GetSpreadsheetControlObject();document.getElementById(b.idPrefix+"namesrangeproposal").value=a.range.hasrange?SocialCalc.crToCoord(a.range.left,a.range.top)+":"+SocialCalc.crToCoord(a.range.right,a.range.bottom):a.ecell.coord};SocialCalc.SpreadsheetControlNamesOnunclick=function(a){delete a.editor.RangeChangeCallback.names;delete a.editor.MoveECellCallback.names};
SocialCalc.SpreadsheetControlNamesSetValue=function(){var a=SocialCalc.GetSpreadsheetControlObject();document.getElementById(a.idPrefix+"namesvalue").value=document.getElementById(a.idPrefix+"namesrangeproposal").value;SocialCalc.KeyboardFocus()};
SocialCalc.SpreadsheetControlNamesSave=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=document.getElementById(a.idPrefix+"namesname").value;SocialCalc.SetTab(a.tabs[0].name);SocialCalc.KeyboardFocus();b!=""&&a.ExecuteCommand("name define "+b+" "+document.getElementById(a.idPrefix+"namesvalue").value+"\nname desc "+b+" "+document.getElementById(a.idPrefix+"namesdesc").value)};
SocialCalc.SpreadsheetControlNamesDelete=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=document.getElementById(a.idPrefix+"namesname").value;SocialCalc.SetTab(a.tabs[0].name);SocialCalc.KeyboardFocus();b!=""&&a.ExecuteCommand("name delete "+b);SocialCalc.KeyboardFocus()};
SocialCalc.SpreadsheetControlClipboardOnclick=function(a){a=SocialCalc.GetSpreadsheetControlObject();clipele=document.getElementById(a.idPrefix+"clipboardtext");document.getElementById(a.idPrefix+"clipboardformat-tab").checked=true;clipele.value=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard,"tab")};
SocialCalc.SpreadsheetControlClipboardFormat=function(a){var b=SocialCalc.GetSpreadsheetControlObject();clipele=document.getElementById(b.idPrefix+"clipboardtext");clipele.value=SocialCalc.ConvertSaveToOtherFormat(SocialCalc.Clipboard.clipboard,a)};
SocialCalc.SpreadsheetControlClipboardLoad=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b="tab";SocialCalc.SetTab(a.tabs[0].name);SocialCalc.KeyboardFocus();document.getElementById(a.idPrefix+"clipboardformat-csv").checked?b="csv":document.getElementById(a.idPrefix+"clipboardformat-scsave").checked&&(b="scsave");a.editor.EditorScheduleSheetCommands("loadclipboard "+SocialCalc.encodeForSave(SocialCalc.ConvertOtherFormatToSave(document.getElementById(a.idPrefix+"clipboardtext").value,b)),
true,false)};SocialCalc.SpreadsheetControlClipboardClear=function(){var a=SocialCalc.GetSpreadsheetControlObject(),b=document.getElementById(a.idPrefix+"clipboardtext");b.value="";a.editor.EditorScheduleSheetCommands("clearclipboard",true,false);b.focus()};SocialCalc.SpreadsheetControlClipboardExport=function(){var a=SocialCalc.GetSpreadsheetControlObject();a.ExportCallback&&a.ExportCallback(a);SocialCalc.SetTab(a.tabs[0].name);SocialCalc.KeyboardFocus()};
SocialCalc.SpreadsheetControlSettingsSwitch=function(a){SocialCalc.SettingControlReset();var b=SocialCalc.GetSpreadsheetControlObject(),c=document.getElementById(b.idPrefix+"sheetsettingstable"),d=document.getElementById(b.idPrefix+"cellsettingstable"),e=document.getElementById(b.idPrefix+"sheetsettingstoolbar"),g=document.getElementById(b.idPrefix+"cellsettingstoolbar");if(a=="sheet"){c.style.display="block";d.style.display="none";e.style.display="block";g.style.display="none";SocialCalc.SettingsControlSetCurrentPanel(b.views.settings.values.sheetspanel)}else{c.style.display=
"none";d.style.display="block";e.style.display="none";g.style.display="block";SocialCalc.SettingsControlSetCurrentPanel(b.views.settings.values.cellspanel)}};
SocialCalc.SettingsControlSave=function(a){var b,c,d=SocialCalc.GetSpreadsheetControlObject(),e=SocialCalc.SettingsControlUnloadPanel(SocialCalc.SettingsControls.CurrentPanel);SocialCalc.SetTab(d.tabs[0].name);SocialCalc.KeyboardFocus();if(a=="sheet")c=d.sheet.DecodeSheetAttributes(e);else if(a=="cell"){d.editor.range.hasrange&&(b=SocialCalc.crToCoord(d.editor.range.left,d.editor.range.top)+":"+SocialCalc.crToCoord(d.editor.range.right,d.editor.range.bottom));c=d.sheet.DecodeCellAttributes(d.editor.ecell.coord,
e,b)}c&&d.editor.EditorScheduleSheetCommands(c,true,false)};
SocialCalc.SpreadsheetControlCreateSpreadsheetSave=function(a,b){var c="",d="",e,g;if(b)for(e in b){g=b[e].charAt(b[e]-1)!="\n"?"\n":"";c=c+("--"+a.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+b[e]+g);d=d+("part:"+e+"\n")}return"socialcalc:version:1.0\nMIME-Version: 1.0\nContent-Type: multipart/mixed; boundary="+a.multipartBoundary+"\n--"+a.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n# SocialCalc Spreadsheet Control Save\nversion:1.0\npart:sheet\npart:edit\npart:audit\n"+d+
"--"+a.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+a.CreateSheetSave()+"--"+a.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+a.editor.SaveEditorSettings()+"--"+a.multipartBoundary+"\nContent-type: text/plain; charset=UTF-8\n\n"+a.sheet.CreateAuditString()+c+"--"+a.multipartBoundary+"--\n"};
SocialCalc.SpreadsheetControlDecodeSpreadsheetSave=function(a,b){var c,d,e,g,h,j,k,l={},m=[];c=b.search(/^MIME-Version:\s1\.0/mi);if(c<0)return l;d=/^Content-Type:\s*multipart\/mixed;\s*boundary=(\S+)/mig;d.lastIndex=c;e=d.exec(b);if(d.lastIndex<=0)return l;c=e[1];g=RegExp("^--"+c+"(?:\r\n|\n)","mg");g.lastIndex=d.lastIndex;g.exec(b);d=/(?:\r\n|\n)(?:\r\n|\n)/gm;d.lastIndex=g.lastIndex;e=d.exec(b);if(!e)return l;h=d.lastIndex;g.lastIndex=h;e=g.exec(b);if(!e)return l;e=e.index;h=b.substring(h,e).split(/\r\n|\n/);
for(j=0;j<h.length;j++){line=h[j];k=line.split(":");switch(k[0]){case "part":m.push(k[1])}}for(pnum=0;pnum<m.length;pnum++){d.lastIndex=e;e=d.exec(b);if(!e)break;h=d.lastIndex;pnum==m.length-1&&(g=RegExp("^--"+c+"--$","mg"));g.lastIndex=h;e=g.exec(b);if(!e)break;e=e.index;l[m[pnum]]={start:h,end:e}}return l};SocialCalc.SettingsControls={Controls:{},CurrentPanel:null};
SocialCalc.SettingsControlSetCurrentPanel=function(a){SocialCalc.SettingsControls.CurrentPanel=a;SocialCalc.SettingsControls.PopupChangeCallback({panelobj:a},"",null)};SocialCalc.SettingsControlInitializePanel=function(a){var b,c=SocialCalc.SettingsControls;for(b in a)if(b!="name")(ctrl=c.Controls[a[b].type])&&ctrl.Initialize&&ctrl.Initialize(a,b)};
SocialCalc.SettingsControlLoadPanel=function(a,b){var c,d=SocialCalc.SettingsControls;for(c in a)if(c!="name")(ctrl=d.Controls[a[c].type])&&ctrl.SetValue&&ctrl.SetValue(a,c,b[a[c].setting])};SocialCalc.SettingsControlUnloadPanel=function(a){var b,c=SocialCalc.SettingsControls,d={};for(b in a)if(b!="name")(ctrl=c.Controls[a[b].type])&&ctrl.GetValue&&(d[a[b].setting]=ctrl.GetValue(a,b));return d};
SocialCalc.SettingsControls.PopupChangeCallback=function(a){var b=SocialCalc.Constants,c=document.getElementById("sample-text");if(c&&a&&a.panelobj){var d=SocialCalc.CurrentSpreadsheetControlObject.idPrefix,e=a.panelobj.name=="cell"?"c":"",g,h;h=b.defaultCellLayout.match(/^padding.(\S+) (\S+) (\S+) (\S+).vertical.align.(\S+);$/)||[];h={color:["textcolor"],backgroundColor:["bgcolor","#FFF"],fontSize:["fontsize",b.defaultCellFontSize],fontFamily:["fontfamily"],paddingTop:["padtop",h[1]],paddingRight:["padright",
h[2]],paddingBottom:["padbottom",h[3]],paddingLeft:["padleft",h[4]],verticalAlign:["alignvert",h[5]]};for(g in h){b=SocialCalc.Popup.GetValue(d+e+h[g][0])||h[g][1]||"";c.style[g]=b}if(e=="c"){h={borderTop:"cbt",borderRight:"cbr",borderBottom:"cbb",borderLeft:"cbl"};for(g in h){b=SocialCalc.SettingsControls.BorderSideGetValue(a.panelobj,h[g]);c.style[g]=b?b.val||"":""}b=SocialCalc.Popup.GetValue(d+"calignhoriz");c.style.textAlign=b||"left"}else{c.style.border="";b=SocialCalc.Popup.GetValue(d+"textalignhoriz");
c.style.textAlign=b||"left";b=SocialCalc.Popup.GetValue(d+"numberalignhoriz")}c.childNodes[1].style.textAlign=b||"right";h=(b=SocialCalc.Popup.GetValue(d+e+"fontlook"))?b.match(/^(\S+) (\S+)$/)||[]:[];c.style.fontStyle=h[1]||"";c.style.fontWeight=h[2]||"";b=SocialCalc.Popup.GetValue(d+e+"formatnumber")||"General";a=SocialCalc.FormatNumber.formatNumberWithFormat(9.8765,b,"");d=SocialCalc.FormatNumber.formatNumberWithFormat(-1234.5,b,"");d!="??-???-??&nbsp;??:??:??"&&(a=a+("<br>"+d));c.childNodes[1].innerHTML=
a}};SocialCalc.SettingsControls.PopupListSetValue=function(a,b,c){if(c){var d=SocialCalc.Popup;c.def?d.SetValue(a[b].id,""):d.SetValue(a[b].id,c.val)}else alert(b+" no value")};SocialCalc.SettingsControls.PopupListGetValue=function(a,b){var c=a[b];if(!c)return null;return(c=SocialCalc.Popup.GetValue(c.id))?{def:false,val:c}:{def:true,val:0}};
SocialCalc.SettingsControls.PopupListInitialize=function(a,b){var c,d,e,g;c=SocialCalc.SettingsControls;c=a[b].initialdata||c.Controls[a[b].type].InitialData||"";c=SocialCalc.LocalizeSubstrings(c);var h=c.split(/\|/),j=[];for(c=0;c<(h.length||0);c++){d=h[c];e=d.indexOf(":");g=d.substring(0,e);if(g.indexOf("\\")!=-1){g=g.replace(/\\c/g,":");g=g.replace(/\\b/g,"\\")}g=SocialCalc.special_chars(g);j[c]=g=="[custom]"?{o:SocialCalc.Constants.s_PopupListCustom,v:d.substring(e+1),a:{custom:true}}:g=="[cancel]"?
{o:SocialCalc.Constants.s_PopupListCancel,v:"",a:{cancel:true}}:g=="[break]"?{o:"-----",v:"",a:{skip:true}}:g=="[newcol]"?{o:"",v:"",a:{newcol:true}}:{o:g,v:d.substring(e+1)}}SocialCalc.Popup.Create("List",a[b].id,{});SocialCalc.Popup.Initialize(a[b].id,{options:j,attribs:{changedcallback:SocialCalc.SettingsControls.PopupChangeCallback,panelobj:a}})};SocialCalc.SettingsControls.PopupListReset=function(){SocialCalc.Popup.Reset("List")};
SocialCalc.SettingsControls.Controls.PopupList={SetValue:SocialCalc.SettingsControls.PopupListSetValue,GetValue:SocialCalc.SettingsControls.PopupListGetValue,Initialize:SocialCalc.SettingsControls.PopupListInitialize,OnReset:SocialCalc.SettingsControls.PopupListReset,ChangedCallback:null};SocialCalc.SettingsControls.ColorChooserSetValue=function(a,b,c){if(c){var d=SocialCalc.Popup;c.def?d.SetValue(a[b].id,""):d.SetValue(a[b].id,c.val)}else alert(b+" no value")};
SocialCalc.SettingsControls.ColorChooserGetValue=function(a,b){var c=SocialCalc.Popup.GetValue(a[b].id);return c?{def:false,val:c}:{def:true,val:0}};SocialCalc.SettingsControls.ColorChooserInitialize=function(a,b){SocialCalc.Popup.Create("ColorChooser",a[b].id,{});SocialCalc.Popup.Initialize(a[b].id,{attribs:{title:"&nbsp;",moveable:true,width:"106px",changedcallback:SocialCalc.SettingsControls.PopupChangeCallback,panelobj:a}})};SocialCalc.SettingsControls.ColorChooserReset=function(){SocialCalc.Popup.Reset("ColorChooser")};
SocialCalc.SettingsControls.Controls.ColorChooser={SetValue:SocialCalc.SettingsControls.ColorChooserSetValue,GetValue:SocialCalc.SettingsControls.ColorChooserGetValue,Initialize:SocialCalc.SettingsControls.ColorChooserInitialize,OnReset:SocialCalc.SettingsControls.ColorChooserReset,ChangedCallback:null};
SocialCalc.SettingsControls.BorderSideSetValue=function(a,b,c){a=a[b].id;if(c){if(b=document.getElementById(a+"-onoff-bcb"))if(c.val){b.checked=true;b.value=c.val;c=c.val.match(/(\S+)\s+(\S+)\s+(\S.+)/);a=a+"-color";SocialCalc.Popup.SetValue(a,c[3]);SocialCalc.Popup.SetDisabled(a,false)}else{b.checked=false;b.value=c.val;a=a+"-color";SocialCalc.Popup.SetValue(a,"");SocialCalc.Popup.SetDisabled(a,true)}}else alert(b+" no value")};
SocialCalc.SettingsControls.BorderSideGetValue=function(a,b){var c,d=a[b].id;if(c=document.getElementById(d+"-onoff-bcb")){if(c.checked){c=SocialCalc.Popup.GetValue(d+"-color");return{def:false,val:"1px solid "+(c||"rgb(0,0,0)")}}return{def:false,val:""}}};
SocialCalc.SettingsControls.BorderSideInitialize=function(a,b){var c=a[b].id;SocialCalc.Popup.Create("ColorChooser",c+"-color",{});SocialCalc.Popup.Initialize(c+"-color",{attribs:{title:"&nbsp;",width:"106px",moveable:true,changedcallback:SocialCalc.SettingsControls.PopupChangeCallback,panelobj:a}})};
SocialCalc.SettingsControlOnchangeBorder=function(a){var b=SocialCalc.SettingsControls,c=b.CurrentPanel,d=a.id.match(/(^.*\-)(\w+)\-(\w+)\-(\w+)$/);if(d){var e=d[2],c=c[e].type;switch(d[4]){case "bcb":a.checked?b.Controls[c].SetValue(b.CurrentPanel,e,{def:false,val:a.value||"1px solid rgb(0,0,0)"}):b.Controls[c].SetValue(b.CurrentPanel,e,{def:false,val:""})}}};
SocialCalc.SettingsControls.Controls.BorderSide={SetValue:SocialCalc.SettingsControls.BorderSideSetValue,GetValue:SocialCalc.SettingsControls.BorderSideGetValue,OnClick:SocialCalc.SettingsControls.ColorComboOnClick,Initialize:SocialCalc.SettingsControls.BorderSideInitialize,InitialData:{thickness:"1 pixel:1px",style:"Solid:solid"},ChangedCallback:null};SocialCalc.SettingControlReset=function(){var a=SocialCalc.SettingsControls,b;for(b in a.Controls)a.Controls[b].OnReset&&a.Controls[b].OnReset(b)};
SocialCalc.OtherSaveParts={};
SocialCalc.CtrlSEditor=function(a){var b,c;if(a.length>0)b=SocialCalc.special_chars(SocialCalc.OtherSaveParts[a]||"");else{b="Listing of Parts\n";for(c in SocialCalc.OtherSaveParts)b=b+SocialCalc.special_chars("\nPart: "+c+"\n=====\n"+SocialCalc.OtherSaveParts[c]+"\n")}c=document.createElement("div");c.style.cssText="position:absolute;z-index:500;width:300px;height:300px;left:100px;top:200px;border:1px solid black;background-color:#EEE;text-align:center;";c.id="socialcalc-editbox";c.innerHTML=a+'<br><br><textarea id="socialcalc-editbox-textarea" style="width:250px;height:200px;">'+
b+"</textarea><br><br><input type=button onclick=\"SocialCalc.CtrlSEditorDone ('socialcalc-editbox', '"+a+'\');" value="OK">';document.body.appendChild(c);a=document.getElementById("socialcalc-editbox-textarea");a.focus();SocialCalc.CmdGotFocus(a)};SocialCalc.CtrlSEditorDone=function(a,b){var c=document.getElementById(a+"-textarea").value;b.length>0&&(c.length>0?SocialCalc.OtherSaveParts[b]=c:delete SocialCalc.OtherSaveParts[b]);c=document.getElementById(a);SocialCalc.KeyboardFocus();c.parentNode.removeChild(c)};if("undefined"!=typeof global)var window=global;"undefined"!=typeof SocialCalc&&"undefined"!=typeof module&&(module.exports=SocialCalc);var jsdom=require("jsdom").jsdom,document=jsdom("<html><head></head><body><div id='tableeditor'></div></body></html>"),window=document.createWindow(),navigator={userAgent:""};
